var wH=Object.defineProperty,xH=Object.defineProperties;var CH=Object.getOwnPropertyDescriptors;var dI=Object.getOwnPropertySymbols;var EH=Object.prototype.hasOwnProperty,IH=Object.prototype.propertyIsEnumerable;var fI=(e,t,i)=>t in e?wH(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ie=(e,t)=>{for(var i in t||={})EH.call(t,i)&&fI(e,i,t[i]);if(dI)for(var i of dI(t))IH.call(t,i)&&fI(e,i,t[i]);return e},Ae=(e,t)=>xH(e,CH(t));var hi=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof require<"u"?require:t)[i]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var J=(e,t,i)=>new Promise((n,r)=>{var o=u=>{try{a(i.next(u))}catch(c){r(c)}},s=u=>{try{a(i.throw(u))}catch(c){r(c)}},a=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,s);a((i=i.apply(e,t)).next())});function hI(e,t){return Object.is(e,t)}var xn=null,Gf=!1,Kf=1,Xi=Symbol("SIGNAL");function _t(e){let t=xn;return xn=e,t}function pI(){return xn}var nd={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Sb(e){if(Gf)throw new Error("");if(xn===null)return;xn.consumerOnSignalRead(e);let t=xn.nextProducerIndex++;if(Jf(xn),t<xn.producerNode.length&&xn.producerNode[t]!==e&&td(xn)){let i=xn.producerNode[t];Yf(i,xn.producerIndexOfThis[t])}xn.producerNode[t]!==e&&(xn.producerNode[t]=e,xn.producerIndexOfThis[t]=td(xn)?vI(e,xn,t):0),xn.producerLastReadVersion[t]=e.version}function SH(){Kf++}function mI(e){if(!(td(e)&&!e.dirty)&&!(!e.dirty&&e.lastCleanEpoch===Kf)){if(!e.producerMustRecompute(e)&&!Tb(e)){e.dirty=!1,e.lastCleanEpoch=Kf;return}e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=Kf}}function gI(e){if(e.liveConsumerNode===void 0)return;let t=Gf;Gf=!0;try{for(let i of e.liveConsumerNode)i.dirty||DH(i)}finally{Gf=t}}function _I(){return xn?.consumerAllowSignalWrites!==!1}function DH(e){e.dirty=!0,gI(e),e.consumerMarkedDirty?.(e)}function Qf(e){return e&&(e.nextProducerIndex=0),_t(e)}function Db(e,t){if(_t(t),!(!e||e.producerNode===void 0||e.producerIndexOfThis===void 0||e.producerLastReadVersion===void 0)){if(td(e))for(let i=e.nextProducerIndex;i<e.producerNode.length;i++)Yf(e.producerNode[i],e.producerIndexOfThis[i]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function Tb(e){Jf(e);for(let t=0;t<e.producerNode.length;t++){let i=e.producerNode[t],n=e.producerLastReadVersion[t];if(n!==i.version||(mI(i),n!==i.version))return!0}return!1}function $b(e){if(Jf(e),td(e))for(let t=0;t<e.producerNode.length;t++)Yf(e.producerNode[t],e.producerIndexOfThis[t]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function vI(e,t,i){if(bI(e),e.liveConsumerNode.length===0&&yI(e))for(let n=0;n<e.producerNode.length;n++)e.producerIndexOfThis[n]=vI(e.producerNode[n],e,n);return e.liveConsumerIndexOfThis.push(i),e.liveConsumerNode.push(t)-1}function Yf(e,t){if(bI(e),e.liveConsumerNode.length===1&&yI(e))for(let n=0;n<e.producerNode.length;n++)Yf(e.producerNode[n],e.producerIndexOfThis[n]);let i=e.liveConsumerNode.length-1;if(e.liveConsumerNode[t]=e.liveConsumerNode[i],e.liveConsumerIndexOfThis[t]=e.liveConsumerIndexOfThis[i],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,t<e.liveConsumerNode.length){let n=e.liveConsumerIndexOfThis[t],r=e.liveConsumerNode[t];Jf(r),r.producerIndexOfThis[n]=t}}function td(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function Jf(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}function bI(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}function yI(e){return e.producerNode!==void 0}function kb(e){let t=Object.create(TH);t.computation=e;let i=()=>{if(mI(t),Sb(t),t.value===Zf)throw t.error;return t.value};return i[Xi]=t,i}var Eb=Symbol("UNSET"),Ib=Symbol("COMPUTING"),Zf=Symbol("ERRORED"),TH=Ae(ie({},nd),{value:Eb,dirty:!0,error:null,equal:hI,producerMustRecompute(e){return e.value===Eb||e.value===Ib},producerRecomputeValue(e){if(e.value===Ib)throw new Error("Detected cycle in computations.");let t=e.value;e.value=Ib;let i=Qf(e),n;try{n=e.computation()}catch(r){n=Zf,e.error=r}finally{Db(e,i)}if(t!==Eb&&t!==Zf&&n!==Zf&&e.equal(t,n)){e.value=t;return}e.value=n,e.version++}});function $H(){throw new Error}var wI=$H;function xI(){wI()}function CI(e){wI=e}var kH=null;function EI(e){let t=Object.create(SI);t.value=e;let i=()=>(Sb(t),t.value);return i[Xi]=t,i}function Mb(e,t){_I()||xI(),e.equal(e.value,t)||(e.value=t,MH(e))}function II(e,t){_I()||xI(),Mb(e,t(e.value))}var SI=Ae(ie({},nd),{equal:hI,value:void 0});function MH(e){e.version++,SH(),gI(e),kH?.()}function tt(e){return typeof e=="function"}function Ra(e){let i=e(n=>{Error.call(n),n.stack=new Error().stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}var Xf=Ra(e=>function(i){e(this),this.message=i?`${i.length} errors occurred during unsubscription:
${i.map((n,r)=>`${r+1}) ${n.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=i});function Rs(e,t){if(e){let i=e.indexOf(t);0<=i&&e.splice(i,1)}}var Wt=class e{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;let{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(let o of i)o.remove(this);else i.remove(this);let{initialTeardown:n}=this;if(tt(n))try{n()}catch(o){t=o instanceof Xf?o.errors:[o]}let{_finalizers:r}=this;if(r){this._finalizers=null;for(let o of r)try{DI(o)}catch(s){t=t??[],s instanceof Xf?t=[...t,...s.errors]:t.push(s)}}if(t)throw new Xf(t)}}add(t){var i;if(t&&t!==this)if(this.closed)DI(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(i=this._finalizers)!==null&&i!==void 0?i:[]).push(t)}}_hasParent(t){let{_parentage:i}=this;return i===t||Array.isArray(i)&&i.includes(t)}_addParent(t){let{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(t),i):i?[i,t]:t}_removeParent(t){let{_parentage:i}=this;i===t?this._parentage=null:Array.isArray(i)&&Rs(i,t)}remove(t){let{_finalizers:i}=this;i&&Rs(i,t),t instanceof e&&t._removeParent(this)}};Wt.EMPTY=(()=>{let e=new Wt;return e.closed=!0,e})();var Ab=Wt.EMPTY;function eh(e){return e instanceof Wt||e&&"closed"in e&&tt(e.remove)&&tt(e.add)&&tt(e.unsubscribe)}function DI(e){tt(e)?e():e.unsubscribe()}var er={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Oa={setTimeout(e,t,...i){let{delegate:n}=Oa;return n?.setTimeout?n.setTimeout(e,t,...i):setTimeout(e,t,...i)},clearTimeout(e){let{delegate:t}=Oa;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function th(e){Oa.setTimeout(()=>{let{onUnhandledError:t}=er;if(t)t(e);else throw e})}function id(){}var TI=Rb("C",void 0,void 0);function $I(e){return Rb("E",void 0,e)}function kI(e){return Rb("N",e,void 0)}function Rb(e,t,i){return{kind:e,value:t,error:i}}var Os=null;function Na(e){if(er.useDeprecatedSynchronousErrorHandling){let t=!Os;if(t&&(Os={errorThrown:!1,error:null}),e(),t){let{errorThrown:i,error:n}=Os;if(Os=null,i)throw n}}else e()}function MI(e){er.useDeprecatedSynchronousErrorHandling&&Os&&(Os.errorThrown=!0,Os.error=e)}var Ns=class extends Wt{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,eh(t)&&t.add(this)):this.destination=OH}static create(t,i,n){return new eo(t,i,n)}next(t){this.isStopped?Nb(kI(t),this):this._next(t)}error(t){this.isStopped?Nb($I(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Nb(TI,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},AH=Function.prototype.bind;function Ob(e,t){return AH.call(e,t)}var Pb=class{constructor(t){this.partialObserver=t}next(t){let{partialObserver:i}=this;if(i.next)try{i.next(t)}catch(n){nh(n)}}error(t){let{partialObserver:i}=this;if(i.error)try{i.error(t)}catch(n){nh(n)}else nh(t)}complete(){let{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(i){nh(i)}}},eo=class extends Ns{constructor(t,i,n){super();let r;if(tt(t)||!t)r={next:t??void 0,error:i??void 0,complete:n??void 0};else{let o;this&&er.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&Ob(t.next,o),error:t.error&&Ob(t.error,o),complete:t.complete&&Ob(t.complete,o)}):r=t}this.destination=new Pb(r)}};function nh(e){er.useDeprecatedSynchronousErrorHandling?MI(e):th(e)}function RH(e){throw e}function Nb(e,t){let{onStoppedNotification:i}=er;i&&Oa.setTimeout(()=>i(e,t))}var OH={closed:!0,next:id,error:RH,complete:id};var Pa=typeof Symbol=="function"&&Symbol.observable||"@@observable";function ei(e){return e}function Fb(...e){return zb(e)}function zb(e){return e.length===0?ei:e.length===1?e[0]:function(i){return e.reduce((n,r)=>r(n),i)}}var st=(()=>{class e{constructor(i){i&&(this._subscribe=i)}lift(i){let n=new e;return n.source=this,n.operator=i,n}subscribe(i,n,r){let o=PH(i)?i:new eo(i,n,r);return Na(()=>{let{operator:s,source:a}=this;o.add(s?s.call(o,a):a?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(i){try{return this._subscribe(i)}catch(n){i.error(n)}}forEach(i,n){return n=AI(n),new n((r,o)=>{let s=new eo({next:a=>{try{i(a)}catch(u){o(u),s.unsubscribe()}},error:o,complete:r});this.subscribe(s)})}_subscribe(i){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(i)}[Pa](){return this}pipe(...i){return zb(i)(this)}toPromise(i){return i=AI(i),new i((n,r)=>{let o;this.subscribe(s=>o=s,s=>r(s),()=>n(o))})}}return e.create=t=>new e(t),e})();function AI(e){var t;return(t=e??er.Promise)!==null&&t!==void 0?t:Promise}function NH(e){return e&&tt(e.next)&&tt(e.error)&&tt(e.complete)}function PH(e){return e&&e instanceof Ns||NH(e)&&eh(e)}function Lb(e){return tt(e?.lift)}function rt(e){return t=>{if(Lb(t))return t.lift(function(i){try{return e(i,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function nt(e,t,i,n,r){return new Bb(e,t,i,n,r)}var Bb=class extends Ns{constructor(t,i,n,r,o,s){super(t),this.onFinalize=o,this.shouldUnsubscribe=s,this._next=i?function(a){try{i(a)}catch(u){t.error(u)}}:super._next,this._error=r?function(a){try{r(a)}catch(u){t.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:i}=this;super.unsubscribe(),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))}}};function Fa(){return rt((e,t)=>{let i=null;e._refCount++;let n=nt(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount){i=null;return}let r=e._connection,o=i;i=null,r&&(!o||r===o)&&r.unsubscribe(),t.unsubscribe()});e.subscribe(n),n.closed||(i=e.connect())})}var Co=class extends st{constructor(t,i){super(),this.source=t,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,Lb(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){let t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Wt;let i=this.getSubject();t.add(this.source.subscribe(nt(i,void 0,()=>{this._teardown(),i.complete()},n=>{this._teardown(),i.error(n)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Wt.EMPTY)}return t}refCount(){return Fa()(this)}};var RI=Ra(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var lt=(()=>{class e extends st{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){let n=new ih(this,this);return n.operator=i,n}_throwIfClosed(){if(this.closed)throw new RI}next(i){Na(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let n of this.currentObservers)n.next(i)}})}error(i){Na(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;let{observers:n}=this;for(;n.length;)n.shift().error(i)}})}complete(){Na(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return((i=this.observers)===null||i===void 0?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){let{hasError:n,isStopped:r,observers:o}=this;return n||r?Ab:(this.currentObservers=null,o.push(i),new Wt(()=>{this.currentObservers=null,Rs(o,i)}))}_checkFinalizedStatuses(i){let{hasError:n,thrownError:r,isStopped:o}=this;n?i.error(r):o&&i.complete()}asObservable(){let i=new st;return i.source=this,i}}return e.create=(t,i)=>new ih(t,i),e})(),ih=class extends lt{constructor(t,i){super(),this.destination=t,this.source=i}next(t){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.next)===null||n===void 0||n.call(i,t)}error(t){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.error)===null||n===void 0||n.call(i,t)}complete(){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||i===void 0||i.call(t)}_subscribe(t){var i,n;return(n=(i=this.source)===null||i===void 0?void 0:i.subscribe(t))!==null&&n!==void 0?n:Ab}};var dn=class extends lt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){let i=super._subscribe(t);return!i.closed&&t.next(this._value),i}getValue(){let{hasError:t,thrownError:i,_value:n}=this;if(t)throw i;return this._throwIfClosed(),n}next(t){super.next(this._value=t)}};var rd={now(){return(rd.delegate||Date).now()},delegate:void 0};var rh=class extends lt{constructor(t=1/0,i=1/0,n=rd){super(),this._bufferSize=t,this._windowTime=i,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=i===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,i)}next(t){let{isStopped:i,_buffer:n,_infiniteTimeWindow:r,_timestampProvider:o,_windowTime:s}=this;i||(n.push(t),!r&&n.push(o.now()+s)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();let i=this._innerSubscribe(t),{_infiniteTimeWindow:n,_buffer:r}=this,o=r.slice();for(let s=0;s<o.length&&!t.closed;s+=n?1:2)t.next(o[s]);return this._checkFinalizedStatuses(t),i}_trimBuffer(){let{_bufferSize:t,_timestampProvider:i,_buffer:n,_infiniteTimeWindow:r}=this,o=(r?1:2)*t;if(t<1/0&&o<n.length&&n.splice(0,n.length-o),!r){let s=i.now(),a=0;for(let u=1;u<n.length&&n[u]<=s;u+=2)a=u;a&&n.splice(0,a+1)}}};var oh=class extends Wt{constructor(t,i){super()}schedule(t,i=0){return this}};var od={setInterval(e,t,...i){let{delegate:n}=od;return n?.setInterval?n.setInterval(e,t,...i):setInterval(e,t,...i)},clearInterval(e){let{delegate:t}=od;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};var sh=class extends oh{constructor(t,i){super(t,i),this.scheduler=t,this.work=i,this.pending=!1}schedule(t,i=0){var n;if(this.closed)return this;this.state=t;let r=this.id,o=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(o,r,i)),this.pending=!0,this.delay=i,this.id=(n=this.id)!==null&&n!==void 0?n:this.requestAsyncId(o,this.id,i),this}requestAsyncId(t,i,n=0){return od.setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,i,n=0){if(n!=null&&this.delay===n&&this.pending===!1)return i;i!=null&&od.clearInterval(i)}execute(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let n=this._execute(t,i);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,i){let n=!1,r;try{this.work(t)}catch(o){n=!0,r=o||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){let{id:t,scheduler:i}=this,{actions:n}=i;this.work=this.state=this.scheduler=null,this.pending=!1,Rs(n,this),t!=null&&(this.id=this.recycleAsyncId(i,t,null)),this.delay=null,super.unsubscribe()}}};var za=class e{constructor(t,i=e.now){this.schedulerActionCtor=t,this.now=i}schedule(t,i=0,n){return new this.schedulerActionCtor(this,t).schedule(n,i)}};za.now=rd.now;var ah=class extends za{constructor(t,i=za.now){super(t,i),this.actions=[],this._active=!1}flush(t){let{actions:i}=this;if(this._active){i.push(t);return}let n;this._active=!0;do if(n=t.execute(t.state,t.delay))break;while(t=i.shift());if(this._active=!1,n){for(;t=i.shift();)t.unsubscribe();throw n}}};var sd=new ah(sh),OI=sd;var Fn=new st(e=>e.complete());function lh(e){return e&&tt(e.schedule)}function jb(e){return e[e.length-1]}function uh(e){return tt(jb(e))?e.pop():void 0}function Er(e){return lh(jb(e))?e.pop():void 0}function NI(e,t){return typeof jb(e)=="number"?e.pop():t}function FI(e,t,i,n){function r(o){return o instanceof i?o:new i(function(s){s(o)})}return new(i||(i=Promise))(function(o,s){function a(f){try{c(n.next(f))}catch(p){s(p)}}function u(f){try{c(n.throw(f))}catch(p){s(p)}}function c(f){f.done?o(f.value):r(f.value).then(a,u)}c((n=n.apply(e,t||[])).next())})}function PI(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ps(e){return this instanceof Ps?(this.v=e,this):new Ps(e)}function zI(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=i.apply(e,t||[]),r,o=[];return r={},a("next"),a("throw"),a("return",s),r[Symbol.asyncIterator]=function(){return this},r;function s(v){return function(b){return Promise.resolve(b).then(v,p)}}function a(v,b){n[v]&&(r[v]=function(w){return new Promise(function(C,x){o.push([v,w,C,x])>1||u(v,w)})},b&&(r[v]=b(r[v])))}function u(v,b){try{c(n[v](b))}catch(w){m(o[0][3],w)}}function c(v){v.value instanceof Ps?Promise.resolve(v.value.v).then(f,p):m(o[0][2],v)}function f(v){u("next",v)}function p(v){u("throw",v)}function m(v,b){v(b),o.shift(),o.length&&u(o[0][0],o[0][1])}}function LI(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],i;return t?t.call(e):(e=typeof PI=="function"?PI(e):e[Symbol.iterator](),i={},n("next"),n("throw"),n("return"),i[Symbol.asyncIterator]=function(){return this},i);function n(o){i[o]=e[o]&&function(s){return new Promise(function(a,u){s=e[o](s),r(a,u,s.done,s.value)})}}function r(o,s,a,u){Promise.resolve(u).then(function(c){o({value:c,done:a})},s)}}var ch=e=>e&&typeof e.length=="number"&&typeof e!="function";function dh(e){return tt(e?.then)}function fh(e){return tt(e[Pa])}function hh(e){return Symbol.asyncIterator&&tt(e?.[Symbol.asyncIterator])}function ph(e){return new TypeError(`You provided ${e!==null&&typeof e=="object"?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function FH(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var mh=FH();function gh(e){return tt(e?.[mh])}function _h(e){return zI(this,arguments,function*(){let i=e.getReader();try{for(;;){let{value:n,done:r}=yield Ps(i.read());if(r)return yield Ps(void 0);yield yield Ps(n)}}finally{i.releaseLock()}})}function vh(e){return tt(e?.getReader)}function Bt(e){if(e instanceof st)return e;if(e!=null){if(fh(e))return zH(e);if(ch(e))return LH(e);if(dh(e))return BH(e);if(hh(e))return BI(e);if(gh(e))return jH(e);if(vh(e))return VH(e)}throw ph(e)}function zH(e){return new st(t=>{let i=e[Pa]();if(tt(i.subscribe))return i.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function LH(e){return new st(t=>{for(let i=0;i<e.length&&!t.closed;i++)t.next(e[i]);t.complete()})}function BH(e){return new st(t=>{e.then(i=>{t.closed||(t.next(i),t.complete())},i=>t.error(i)).then(null,th)})}function jH(e){return new st(t=>{for(let i of e)if(t.next(i),t.closed)return;t.complete()})}function BI(e){return new st(t=>{UH(e,t).catch(i=>t.error(i))})}function VH(e){return BI(_h(e))}function UH(e,t){var i,n,r,o;return FI(this,void 0,void 0,function*(){try{for(i=LI(e);n=yield i.next(),!n.done;){let s=n.value;if(t.next(s),t.closed)return}}catch(s){r={error:s}}finally{try{n&&!n.done&&(o=i.return)&&(yield o.call(i))}finally{if(r)throw r.error}}t.complete()})}function pi(e,t,i,n=0,r=!1){let o=t.schedule(function(){i(),r?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(o),!r)return o}function bh(e,t=0){return rt((i,n)=>{i.subscribe(nt(n,r=>pi(n,e,()=>n.next(r),t),()=>pi(n,e,()=>n.complete(),t),r=>pi(n,e,()=>n.error(r),t)))})}function yh(e,t=0){return rt((i,n)=>{n.add(e.schedule(()=>i.subscribe(n),t))})}function jI(e,t){return Bt(e).pipe(yh(t),bh(t))}function VI(e,t){return Bt(e).pipe(yh(t),bh(t))}function UI(e,t){return new st(i=>{let n=0;return t.schedule(function(){n===e.length?i.complete():(i.next(e[n++]),i.closed||this.schedule())})})}function HI(e,t){return new st(i=>{let n;return pi(i,t,()=>{n=e[mh](),pi(i,t,()=>{let r,o;try{({value:r,done:o}=n.next())}catch(s){i.error(s);return}o?i.complete():i.next(r)},0,!0)}),()=>tt(n?.return)&&n.return()})}function wh(e,t){if(!e)throw new Error("Iterable cannot be null");return new st(i=>{pi(i,t,()=>{let n=e[Symbol.asyncIterator]();pi(i,t,()=>{n.next().then(r=>{r.done?i.complete():i.next(r.value)})},0,!0)})})}function WI(e,t){return wh(_h(e),t)}function qI(e,t){if(e!=null){if(fh(e))return jI(e,t);if(ch(e))return UI(e,t);if(dh(e))return VI(e,t);if(hh(e))return wh(e,t);if(gh(e))return HI(e,t);if(vh(e))return WI(e,t)}throw ph(e)}function jt(e,t){return t?qI(e,t):Bt(e)}function Ne(...e){let t=Er(e);return jt(e,t)}function La(e,t){let i=tt(e)?e:()=>e,n=r=>r.error(i());return new st(t?r=>t.schedule(n,0,r):n)}function Fs(e){return!!e&&(e instanceof st||tt(e.lift)&&tt(e.subscribe))}var to=Ra(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function GI(e){return e instanceof Date&&!isNaN(e)}function We(e,t){return rt((i,n)=>{let r=0;i.subscribe(nt(n,o=>{n.next(e.call(t,o,r++))}))})}var{isArray:HH}=Array;function WH(e,t){return HH(t)?e(...t):e(t)}function xh(e){return We(t=>WH(e,t))}var{isArray:qH}=Array,{getPrototypeOf:GH,prototype:KH,keys:ZH}=Object;function Ch(e){if(e.length===1){let t=e[0];if(qH(t))return{args:t,keys:null};if(QH(t)){let i=ZH(t);return{args:i.map(n=>t[n]),keys:i}}}return{args:e,keys:null}}function QH(e){return e&&typeof e=="object"&&GH(e)===KH}function Eh(e,t){return e.reduce((i,n,r)=>(i[n]=t[r],i),{})}function zs(...e){let t=Er(e),i=uh(e),{args:n,keys:r}=Ch(e);if(n.length===0)return jt([],t);let o=new st(YH(n,t,r?s=>Eh(r,s):ei));return i?o.pipe(xh(i)):o}function YH(e,t,i=ei){return n=>{KI(t,()=>{let{length:r}=e,o=new Array(r),s=r,a=r;for(let u=0;u<r;u++)KI(t,()=>{let c=jt(e[u],t),f=!1;c.subscribe(nt(n,p=>{o[u]=p,f||(f=!0,a--),a||n.next(i(o.slice()))},()=>{--s||n.complete()}))},n)},n)}}function KI(e,t,i){e?pi(i,e,t):t()}function ZI(e,t,i,n,r,o,s,a){let u=[],c=0,f=0,p=!1,m=()=>{p&&!u.length&&!c&&t.complete()},v=w=>c<n?b(w):u.push(w),b=w=>{o&&t.next(w),c++;let C=!1;Bt(i(w,f++)).subscribe(nt(t,x=>{r?.(x),o?v(x):t.next(x)},()=>{C=!0},void 0,()=>{if(C)try{for(c--;u.length&&c<n;){let x=u.shift();s?pi(t,s,()=>b(x)):b(x)}m()}catch(x){t.error(x)}}))};return e.subscribe(nt(t,v,()=>{p=!0,m()})),()=>{a?.()}}function pn(e,t,i=1/0){return tt(t)?pn((n,r)=>We((o,s)=>t(n,o,r,s))(Bt(e(n,r))),i):(typeof t=="number"&&(i=t),rt((n,r)=>ZI(n,r,e,i)))}function Eo(e=1/0){return pn(ei,e)}function QI(){return Eo(1)}function Io(...e){return QI()(jt(e,Er(e)))}function Ih(e){return new st(t=>{Bt(e()).subscribe(t)})}function Vb(...e){let t=uh(e),{args:i,keys:n}=Ch(e),r=new st(o=>{let{length:s}=i;if(!s){o.complete();return}let a=new Array(s),u=s,c=s;for(let f=0;f<s;f++){let p=!1;Bt(i[f]).subscribe(nt(o,m=>{p||(p=!0,c--),a[f]=m},()=>u--,void 0,()=>{(!u||!p)&&(c||o.next(n?Eh(n,a):a),o.complete())}))}});return t?r.pipe(xh(t)):r}function YI(e=0,t,i=OI){let n=-1;return t!=null&&(lh(t)?i=t:n=t),new st(r=>{let o=GI(e)?+e-i.now():e;o<0&&(o=0);let s=0;return i.schedule(function(){r.closed||(r.next(s++),0<=n?this.schedule(void 0,n):r.complete())},o)})}function Ub(...e){let t=Er(e),i=NI(e,1/0),n=e;return n.length?n.length===1?Bt(n[0]):Eo(i)(jt(n,t)):Fn}function mn(e,t){return rt((i,n)=>{let r=0;i.subscribe(nt(n,o=>e.call(t,o,r++)&&n.next(o)))})}function JI(e){return rt((t,i)=>{let n=!1,r=null,o=null,s=!1,a=()=>{if(o?.unsubscribe(),o=null,n){n=!1;let c=r;r=null,i.next(c)}s&&i.complete()},u=()=>{o=null,s&&i.complete()};t.subscribe(nt(i,c=>{n=!0,r=c,o||Bt(e(c)).subscribe(o=nt(i,a,u))},()=>{s=!0,(!n||!o||o.closed)&&i.complete()}))})}function Hb(e,t=sd){return JI(()=>YI(e,t))}function So(e){return rt((t,i)=>{let n=null,r=!1,o;n=t.subscribe(nt(i,void 0,void 0,s=>{o=Bt(e(s,So(e)(t))),n?(n.unsubscribe(),n=null,o.subscribe(i)):r=!0})),r&&(n.unsubscribe(),n=null,o.subscribe(i))})}function XI(e,t,i,n,r){return(o,s)=>{let a=i,u=t,c=0;o.subscribe(nt(s,f=>{let p=c++;u=a?e(u,f,p):(a=!0,f),n&&s.next(u)},r&&(()=>{a&&s.next(u),s.complete()})))}}function no(e,t){return tt(t)?pn(e,t,1):pn(e,1)}function Sh(e,t=sd){return rt((i,n)=>{let r=null,o=null,s=null,a=()=>{if(r){r.unsubscribe(),r=null;let c=o;o=null,n.next(c)}};function u(){let c=s+e,f=t.now();if(f<c){r=this.schedule(void 0,c-f),n.add(r);return}a()}i.subscribe(nt(n,c=>{o=c,s=t.now(),r||(r=t.schedule(u,e),n.add(r))},()=>{a(),n.complete()},void 0,()=>{o=r=null}))})}function Do(e){return rt((t,i)=>{let n=!1;t.subscribe(nt(i,r=>{n=!0,i.next(r)},()=>{n||i.next(e),i.complete()}))})}function tr(e){return e<=0?()=>Fn:rt((t,i)=>{let n=0;t.subscribe(nt(i,r=>{++n<=e&&(i.next(r),e<=n&&i.complete())}))})}function Wb(e){return We(()=>e)}function Dh(e,t=ei){return e=e??JH,rt((i,n)=>{let r,o=!0;i.subscribe(nt(n,s=>{let a=t(s);(o||!e(r,a))&&(o=!1,r=a,n.next(s))}))})}function JH(e,t){return e===t}function Th(e=XH){return rt((t,i)=>{let n=!1;t.subscribe(nt(i,r=>{n=!0,i.next(r)},()=>n?i.complete():i.error(e())))})}function XH(){return new to}function Ls(e){return rt((t,i)=>{try{t.subscribe(i)}finally{i.add(e)}})}function Ir(e,t){let i=arguments.length>=2;return n=>n.pipe(e?mn((r,o)=>e(r,o,n)):ei,tr(1),i?Do(t):Th(()=>new to))}function Ba(e){return e<=0?()=>Fn:rt((t,i)=>{let n=[];t.subscribe(nt(i,r=>{n.push(r),e<n.length&&n.shift()},()=>{for(let r of n)i.next(r);i.complete()},void 0,()=>{n=null}))})}function qb(e,t){let i=arguments.length>=2;return n=>n.pipe(e?mn((r,o)=>e(r,o,n)):ei,Ba(1),i?Do(t):Th(()=>new to))}function Gb(e,t){return rt(XI(e,t,arguments.length>=2,!0))}function eS(e={}){let{connector:t=()=>new lt,resetOnError:i=!0,resetOnComplete:n=!0,resetOnRefCountZero:r=!0}=e;return o=>{let s,a,u,c=0,f=!1,p=!1,m=()=>{a?.unsubscribe(),a=void 0},v=()=>{m(),s=u=void 0,f=p=!1},b=()=>{let w=s;v(),w?.unsubscribe()};return rt((w,C)=>{c++,!p&&!f&&m();let x=u=u??t();C.add(()=>{c--,c===0&&!p&&!f&&(a=Kb(b,r))}),x.subscribe(C),!s&&c>0&&(s=new eo({next:y=>x.next(y),error:y=>{p=!0,m(),a=Kb(v,i,y),x.error(y)},complete:()=>{f=!0,m(),a=Kb(v,n),x.complete()}}),Bt(w).subscribe(s))})(o)}}function Kb(e,t,...i){if(t===!0){e();return}if(t===!1)return;let n=new eo({next:()=>{n.unsubscribe(),e()}});return Bt(t(...i)).subscribe(n)}function $h(e,t,i){let n,r=!1;return e&&typeof e=="object"?{bufferSize:n=1/0,windowTime:t=1/0,refCount:r=!1,scheduler:i}=e:n=e??1/0,eS({connector:()=>new rh(n,t,i),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}function ad(e){return mn((t,i)=>e<=i)}function ja(...e){let t=Er(e);return rt((i,n)=>{(t?Io(e,i,t):Io(e,i)).subscribe(n)})}function ti(e,t){return rt((i,n)=>{let r=null,o=0,s=!1,a=()=>s&&!r&&n.complete();i.subscribe(nt(n,u=>{r?.unsubscribe();let c=0,f=o++;Bt(e(u,f)).subscribe(r=nt(n,p=>n.next(t?t(u,p,f,c++):p),()=>{r=null,a()}))},()=>{s=!0,a()}))})}function zn(e){return rt((t,i)=>{Bt(e).subscribe(nt(i,()=>i.complete(),id)),!i.closed&&t.subscribe(i)})}function Cn(e,t,i){let n=tt(e)||t||i?{next:e,error:t,complete:i}:e;return n?rt((r,o)=>{var s;(s=n.subscribe)===null||s===void 0||s.call(n);let a=!0;r.subscribe(nt(o,u=>{var c;(c=n.next)===null||c===void 0||c.call(n,u),o.next(u)},()=>{var u;a=!1,(u=n.complete)===null||u===void 0||u.call(n),o.complete()},u=>{var c;a=!1,(c=n.error)===null||c===void 0||c.call(n,u),o.error(u)},()=>{var u,c;a&&((u=n.unsubscribe)===null||u===void 0||u.call(n)),(c=n.finalize)===null||c===void 0||c.call(n)}))}):ei}var e6="https://g.co/ng/security#xss",ke=class extends Error{constructor(t,i){super(hp(t,i)),this.code=t}};function hp(e,t){return`${`NG0${Math.abs(e)}`}${t?": "+t:""}`}function vd(e){return{toString:e}.toString()}var kh="__parameters__";function t6(e){return function(...i){if(e){let n=e(...i);for(let r in n)this[r]=n[r]}}}function LS(e,t,i){return vd(()=>{let n=t6(t);function r(...o){if(this instanceof r)return n.apply(this,o),this;let s=new r(...o);return a.annotation=s,a;function a(u,c,f){let p=u.hasOwnProperty(kh)?u[kh]:Object.defineProperty(u,kh,{value:[]})[kh];for(;p.length<=f;)p.push(null);return(p[f]=p[f]||[]).push(s),u}}return i&&(r.prototype=Object.create(i.prototype)),r.prototype.ngMetadataName=e,r.annotationCls=r,r})}var or=globalThis;function Vt(e){for(let t in e)if(e[t]===Vt)return t;throw Error("Could not find renamed property on target object.")}function n6(e,t){for(let i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=t[i])}function oi(e){if(typeof e=="string")return e;if(Array.isArray(e))return"["+e.map(oi).join(", ")+"]";if(e==null)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;let t=e.toString();if(t==null)return""+t;let i=t.indexOf(`
`);return i===-1?t:t.substring(0,i)}function ly(e,t){return e==null||e===""?t===null?"":t:t==null||t===""?e:e+" "+t}var i6=Vt({__forward_ref__:Vt});function so(e){return e.__forward_ref__=so,e.toString=function(){return oi(this())},e}function ni(e){return BS(e)?e():e}function BS(e){return typeof e=="function"&&e.hasOwnProperty(i6)&&e.__forward_ref__===so}function be(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function qe(e){return{providers:e.providers||[],imports:e.imports||[]}}function pp(e){return tS(e,VS)||tS(e,US)}function jS(e){return pp(e)!==null}function tS(e,t){return e.hasOwnProperty(t)?e[t]:null}function r6(e){let t=e&&(e[VS]||e[US]);return t||null}function nS(e){return e&&(e.hasOwnProperty(iS)||e.hasOwnProperty(o6))?e[iS]:null}var VS=Vt({\u0275prov:Vt}),iS=Vt({\u0275inj:Vt}),US=Vt({ngInjectableDef:Vt}),o6=Vt({ngInjectorDef:Vt}),_e=class{constructor(t,i){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof i=="number"?this.__NG_ELEMENT_ID__=i:i!==void 0&&(this.\u0275prov=be({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function HS(e){return e&&!!e.\u0275providers}var s6=Vt({\u0275cmp:Vt}),a6=Vt({\u0275dir:Vt}),l6=Vt({\u0275pipe:Vt}),u6=Vt({\u0275mod:Vt}),Bh=Vt({\u0275fac:Vt}),ld=Vt({__NG_ELEMENT_ID__:Vt}),rS=Vt({__NG_ENV_ID__:Vt});function e0(e){return typeof e=="string"?e:e==null?"":String(e)}function c6(e){return typeof e=="function"?e.name||e.toString():typeof e=="object"&&e!=null&&typeof e.type=="function"?e.type.name||e.type.toString():e0(e)}function d6(e,t){let i=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new ke(-200,e)}function t0(e,t){throw new ke(-201,!1)}var ut=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(ut||{}),uy;function WS(){return uy}function Ai(e){let t=uy;return uy=e,t}function qS(e,t,i){let n=pp(e);if(n&&n.providedIn=="root")return n.value===void 0?n.value=n.factory():n.value;if(i&ut.Optional)return null;if(t!==void 0)return t;t0(e,"Injector")}var f6={},cd=f6,cy="__NG_DI_FLAG__",jh="ngTempTokenPath",h6="ngTokenPath",p6=/\n/gm,m6="\u0275",oS="__source",Wa;function g6(){return Wa}function To(e){let t=Wa;return Wa=e,t}function _6(e,t=ut.Default){if(Wa===void 0)throw new ke(-203,!1);return Wa===null?qS(e,void 0,t):Wa.get(e,t&ut.Optional?null:void 0,t)}function me(e,t=ut.Default){return(WS()||_6)(ni(e),t)}function ne(e,t=ut.Default){return me(e,mp(t))}function mp(e){return typeof e>"u"||typeof e=="number"?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function dy(e){let t=[];for(let i=0;i<e.length;i++){let n=ni(e[i]);if(Array.isArray(n)){if(n.length===0)throw new ke(900,!1);let r,o=ut.Default;for(let s=0;s<n.length;s++){let a=n[s],u=v6(a);typeof u=="number"?u===-1?r=a.token:o|=u:r=a}t.push(me(r,o))}else t.push(me(n))}return t}function GS(e,t){return e[cy]=t,e.prototype[cy]=t,e}function v6(e){return e[cy]}function b6(e,t,i,n){let r=e[jh];throw t[oS]&&r.unshift(t[oS]),e.message=y6(`
`+e.message,r,i,n),e[h6]=r,e[jh]=null,e}function y6(e,t,i,n=null){e=e&&e.charAt(0)===`
`&&e.charAt(1)==m6?e.slice(2):e;let r=oi(t);if(Array.isArray(t))r=t.map(oi).join(" -> ");else if(typeof t=="object"){let o=[];for(let s in t)if(t.hasOwnProperty(s)){let a=t[s];o.push(s+":"+(typeof a=="string"?JSON.stringify(a):oi(a)))}r=`{${o.join(", ")}}`}return`${i}${n?"("+n+")":""}[${r}]: ${e.replace(p6,`
  `)}`}var gp=GS(LS("Optional"),8);var n0=GS(LS("SkipSelf"),4);function Ga(e,t){let i=e.hasOwnProperty(Bh);return i?e[Bh]:null}function w6(e,t,i){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){let r=e[n],o=t[n];if(i&&(r=i(r),o=i(o)),o!==r)return!1}return!0}function x6(e){return e.flat(Number.POSITIVE_INFINITY)}function i0(e,t){e.forEach(i=>Array.isArray(i)?i0(i,t):t(i))}function KS(e,t,i){t>=e.length?e.push(i):e.splice(t,0,i)}function Vh(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function C6(e,t){let i=[];for(let n=0;n<e;n++)i.push(t);return i}function E6(e,t,i,n){let r=e.length;if(r==t)e.push(i,n);else if(r===1)e.push(n,e[0]),e[0]=i;else{for(r--,e.push(e[r-1],e[r]);r>t;){let o=r-2;e[r]=e[o],r--}e[t]=i,e[t+1]=n}}function r0(e,t,i){let n=bd(e,t);return n>=0?e[n|1]=i:(n=~n,E6(e,n,t,i)),n}function Zb(e,t){let i=bd(e,t);if(i>=0)return e[i|1]}function bd(e,t){return I6(e,t,1)}function I6(e,t,i){let n=0,r=e.length>>i;for(;r!==n;){let o=n+(r-n>>1),s=e[o<<i];if(t===s)return o<<i;s>t?r=o:n=o+1}return~(r<<i)}var Ka={},ii=[],Za=new _e(""),ZS=new _e("",-1),QS=new _e(""),Uh=class{get(t,i=cd){if(i===cd){let n=new Error(`NullInjectorError: No provider for ${oi(t)}!`);throw n.name="NullInjectorError",n}return i}},YS=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(YS||{}),Tr=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Tr||{}),Mo=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(Mo||{});function S6(e,t,i){let n=e.length;for(;;){let r=e.indexOf(t,i);if(r===-1)return r;if(r===0||e.charCodeAt(r-1)<=32){let o=t.length;if(r+o===n||e.charCodeAt(r+o)<=32)return r}i=r+1}}function fy(e,t,i){let n=0;for(;n<i.length;){let r=i[n];if(typeof r=="number"){if(r!==0)break;n++;let o=i[n++],s=i[n++],a=i[n++];e.setAttribute(t,s,a,o)}else{let o=r,s=i[++n];D6(o)?e.setProperty(t,o,s):e.setAttribute(t,o,s),n++}}return n}function JS(e){return e===3||e===4||e===6}function D6(e){return e.charCodeAt(0)===64}function dd(e,t){if(!(t===null||t.length===0))if(e===null||e.length===0)e=t.slice();else{let i=-1;for(let n=0;n<t.length;n++){let r=t[n];typeof r=="number"?i=r:i===0||(i===-1||i===2?sS(e,i,r,null,t[++n]):sS(e,i,r,null,null))}}return e}function sS(e,t,i,n,r){let o=0,s=e.length;if(t===-1)s=-1;else for(;o<e.length;){let a=e[o++];if(typeof a=="number"){if(a===t){s=-1;break}else if(a>t){s=o-1;break}}}for(;o<e.length;){let a=e[o];if(typeof a=="number")break;if(a===i){if(n===null){r!==null&&(e[o+1]=r);return}else if(n===e[o+1]){e[o+2]=r;return}}o++,n!==null&&o++,r!==null&&o++}s!==-1&&(e.splice(s,0,t),o=s+1),e.splice(o++,0,i),n!==null&&e.splice(o++,0,n),r!==null&&e.splice(o++,0,r)}var XS="ng-template";function T6(e,t,i,n){let r=0;if(n){for(;r<t.length&&typeof t[r]=="string";r+=2)if(t[r]==="class"&&S6(t[r+1].toLowerCase(),i,0)!==-1)return!0}else if(o0(e))return!1;if(r=t.indexOf(1,r),r>-1){let o;for(;++r<t.length&&typeof(o=t[r])=="string";)if(o.toLowerCase()===i)return!0}return!1}function o0(e){return e.type===4&&e.value!==XS}function $6(e,t,i){let n=e.type===4&&!i?XS:e.value;return t===n}function k6(e,t,i){let n=4,r=e.attrs,o=r!==null?R6(r):0,s=!1;for(let a=0;a<t.length;a++){let u=t[a];if(typeof u=="number"){if(!s&&!nr(n)&&!nr(u))return!1;if(s&&nr(u))continue;s=!1,n=u|n&1;continue}if(!s)if(n&4){if(n=2|n&1,u!==""&&!$6(e,u,i)||u===""&&t.length===1){if(nr(n))return!1;s=!0}}else if(n&8){if(r===null||!T6(e,r,u,i)){if(nr(n))return!1;s=!0}}else{let c=t[++a],f=M6(u,r,o0(e),i);if(f===-1){if(nr(n))return!1;s=!0;continue}if(c!==""){let p;if(f>o?p="":p=r[f+1].toLowerCase(),n&2&&c!==p){if(nr(n))return!1;s=!0}}}}return nr(n)||s}function nr(e){return(e&1)===0}function M6(e,t,i,n){if(t===null)return-1;let r=0;if(n||!i){let o=!1;for(;r<t.length;){let s=t[r];if(s===e)return r;if(s===3||s===6)o=!0;else if(s===1||s===2){let a=t[++r];for(;typeof a=="string";)a=t[++r];continue}else{if(s===4)break;if(s===0){r+=4;continue}}r+=o?1:2}return-1}else return O6(t,e)}function eD(e,t,i=!1){for(let n=0;n<t.length;n++)if(k6(e,t[n],i))return!0;return!1}function A6(e){let t=e.attrs;if(t!=null){let i=t.indexOf(5);if(!(i&1))return t[i+1]}return null}function R6(e){for(let t=0;t<e.length;t++){let i=e[t];if(JS(i))return t}return e.length}function O6(e,t){let i=e.indexOf(4);if(i>-1)for(i++;i<e.length;){let n=e[i];if(typeof n=="number")return-1;if(n===t)return i;i++}return-1}function N6(e,t){e:for(let i=0;i<t.length;i++){let n=t[i];if(e.length===n.length){for(let r=0;r<e.length;r++)if(e[r]!==n[r])continue e;return!0}}return!1}function aS(e,t){return e?":not("+t.trim()+")":t}function P6(e){let t=e[0],i=1,n=2,r="",o=!1;for(;i<e.length;){let s=e[i];if(typeof s=="string")if(n&2){let a=e[++i];r+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else n&8?r+="."+s:n&4&&(r+=" "+s);else r!==""&&!nr(s)&&(t+=aS(o,r),r=""),n=s,o=o||!nr(n);i++}return r!==""&&(t+=aS(o,r)),t}function F6(e){return e.map(P6).join(",")}function z6(e){let t=[],i=[],n=1,r=2;for(;n<e.length;){let o=e[n];if(typeof o=="string")r===2?o!==""&&t.push(o,e[++n]):r===8&&i.push(o);else{if(!nr(r))break;r=o}n++}return{attrs:t,classes:i}}function Oe(e){return vd(()=>{let t=oD(e),i=Ae(ie({},t),{decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===YS.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Tr.Emulated,styles:e.styles||ii,_:null,schemas:e.schemas||null,tView:null,id:""});sD(i);let n=e.dependencies;return i.directiveDefs=uS(n,!1),i.pipeDefs=uS(n,!0),i.id=j6(i),i})}function L6(e){return Ao(e)||tD(e)}function B6(e){return e!==null}function Ge(e){return vd(()=>({type:e.type,bootstrap:e.bootstrap||ii,declarations:e.declarations||ii,imports:e.imports||ii,exports:e.exports||ii,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function lS(e,t){if(e==null)return Ka;let i={};for(let n in e)if(e.hasOwnProperty(n)){let r=e[n],o,s,a=Mo.None;Array.isArray(r)?(a=r[0],o=r[1],s=r[2]??o):(o=r,s=r),t?(i[o]=a!==Mo.None?[n,a]:n,t[o]=s):i[o]=n}return i}function Me(e){return vd(()=>{let t=oD(e);return sD(t),t})}function Ao(e){return e[s6]||null}function tD(e){return e[a6]||null}function nD(e){return e[l6]||null}function iD(e){let t=Ao(e)||tD(e)||nD(e);return t!==null?t.standalone:!1}function rD(e,t){let i=e[u6]||null;if(!i&&t===!0)throw new Error(`Type ${oi(e)} does not have '\u0275mod' property.`);return i}function oD(e){let t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||Ka,exportAs:e.exportAs||null,standalone:e.standalone===!0,signals:e.signals===!0,selectors:e.selectors||ii,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:lS(e.inputs,t),outputs:lS(e.outputs),debugInfo:null}}function sD(e){e.features?.forEach(t=>t(e))}function uS(e,t){if(!e)return null;let i=t?nD:L6;return()=>(typeof e=="function"?e():e).map(n=>i(n)).filter(B6)}function j6(e){let t=0,i=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(let r of i)t=Math.imul(31,t)+r.charCodeAt(0)<<0;return t+=2147483648,"c"+t}function _p(e){return{\u0275providers:e}}function V6(...e){return{\u0275providers:aD(!0,e),\u0275fromNgModule:!0}}function aD(e,...t){let i=[],n=new Set,r,o=s=>{i.push(s)};return i0(t,s=>{let a=s;hy(a,o,[],n)&&(r||=[],r.push(a))}),r!==void 0&&lD(r,o),i}function lD(e,t){for(let i=0;i<e.length;i++){let{ngModule:n,providers:r}=e[i];s0(r,o=>{t(o,n)})}}function hy(e,t,i,n){if(e=ni(e),!e)return!1;let r=null,o=nS(e),s=!o&&Ao(e);if(!o&&!s){let u=e.ngModule;if(o=nS(u),o)r=u;else return!1}else{if(s&&!s.standalone)return!1;r=e}let a=n.has(r);if(s){if(a)return!1;if(n.add(r),s.dependencies){let u=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let c of u)hy(c,t,i,n)}}else if(o){if(o.imports!=null&&!a){n.add(r);let c;try{i0(o.imports,f=>{hy(f,t,i,n)&&(c||=[],c.push(f))})}finally{}c!==void 0&&lD(c,t)}if(!a){let c=Ga(r)||(()=>new r);t({provide:r,useFactory:c,deps:ii},r),t({provide:QS,useValue:r,multi:!0},r),t({provide:Za,useValue:()=>me(r),multi:!0},r)}let u=o.providers;if(u!=null&&!a){let c=e;s0(u,f=>{t(f,c)})}}else return!1;return r!==e&&e.providers!==void 0}function s0(e,t){for(let i of e)HS(i)&&(i=i.\u0275providers),Array.isArray(i)?s0(i,t):t(i)}var U6=Vt({provide:String,useValue:Vt});function uD(e){return e!==null&&typeof e=="object"&&U6 in e}function H6(e){return!!(e&&e.useExisting)}function W6(e){return!!(e&&e.useFactory)}function Qa(e){return typeof e=="function"}function q6(e){return!!e.useClass}var vp=new _e(""),Oh={},G6={},Qb;function a0(){return Qb===void 0&&(Qb=new Uh),Qb}var si=class{},fd=class extends si{get destroyed(){return this._destroyed}constructor(t,i,n,r){super(),this.parent=i,this.source=n,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,my(t,s=>this.processProvider(s)),this.records.set(ZS,Va(void 0,this)),r.has("environment")&&this.records.set(si,Va(void 0,this));let o=this.records.get(vp);o!=null&&typeof o.value=="string"&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(QS,ii,ut.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let t=_t(null);try{for(let n of this._ngOnDestroyHooks)n.ngOnDestroy();let i=this._onDestroyHooks;this._onDestroyHooks=[];for(let n of i)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),_t(t)}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();let i=To(this),n=Ai(void 0),r;try{return t()}finally{To(i),Ai(n)}}get(t,i=cd,n=ut.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(rS))return t[rS](this);n=mp(n);let r,o=To(this),s=Ai(void 0);try{if(!(n&ut.SkipSelf)){let u=this.records.get(t);if(u===void 0){let c=J6(t)&&pp(t);c&&this.injectableDefInScope(c)?u=Va(py(t),Oh):u=null,this.records.set(t,u)}if(u!=null)return this.hydrate(t,u)}let a=n&ut.Self?a0():this.parent;return i=n&ut.Optional&&i===cd?null:i,a.get(t,i)}catch(a){if(a.name==="NullInjectorError"){if((a[jh]=a[jh]||[]).unshift(oi(t)),o)throw a;return b6(a,t,"R3InjectorError",this.source)}else throw a}finally{Ai(s),To(o)}}resolveInjectorInitializers(){let t=_t(null),i=To(this),n=Ai(void 0),r;try{let o=this.get(Za,ii,ut.Self);for(let s of o)s()}finally{To(i),Ai(n),_t(t)}}toString(){let t=[],i=this.records;for(let n of i.keys())t.push(oi(n));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ke(205,!1)}processProvider(t){t=ni(t);let i=Qa(t)?t:ni(t&&t.provide),n=Z6(t);if(!Qa(t)&&t.multi===!0){let r=this.records.get(i);r||(r=Va(void 0,Oh,!0),r.factory=()=>dy(r.multi),this.records.set(i,r)),i=t,r.multi.push(t)}this.records.set(i,n)}hydrate(t,i){let n=_t(null);try{return i.value===Oh&&(i.value=G6,i.value=i.factory()),typeof i.value=="object"&&i.value&&Y6(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}finally{_t(n)}}injectableDefInScope(t){if(!t.providedIn)return!1;let i=ni(t.providedIn);return typeof i=="string"?i==="any"||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(t){let i=this._onDestroyHooks.indexOf(t);i!==-1&&this._onDestroyHooks.splice(i,1)}};function py(e){let t=pp(e),i=t!==null?t.factory:Ga(e);if(i!==null)return i;if(e instanceof _e)throw new ke(204,!1);if(e instanceof Function)return K6(e);throw new ke(204,!1)}function K6(e){if(e.length>0)throw new ke(204,!1);let i=r6(e);return i!==null?()=>i.factory(e):()=>new e}function Z6(e){if(uD(e))return Va(void 0,e.useValue);{let t=cD(e);return Va(t,Oh)}}function cD(e,t,i){let n;if(Qa(e)){let r=ni(e);return Ga(r)||py(r)}else if(uD(e))n=()=>ni(e.useValue);else if(W6(e))n=()=>e.useFactory(...dy(e.deps||[]));else if(H6(e))n=()=>me(ni(e.useExisting));else{let r=ni(e&&(e.useClass||e.provide));if(Q6(e))n=()=>new r(...dy(e.deps));else return Ga(r)||py(r)}return n}function Va(e,t,i=!1){return{factory:e,value:t,multi:i?[]:void 0}}function Q6(e){return!!e.deps}function Y6(e){return e!==null&&typeof e=="object"&&typeof e.ngOnDestroy=="function"}function J6(e){return typeof e=="function"||typeof e=="object"&&e instanceof _e}function my(e,t){for(let i of e)Array.isArray(i)?my(i,t):i&&HS(i)?my(i.\u0275providers,t):t(i)}function xi(e,t){e instanceof fd&&e.assertNotDestroyed();let i,n=To(e),r=Ai(void 0);try{return t()}finally{To(n),Ai(r)}}function dD(){return WS()!==void 0||g6()!=null}function fD(e){if(!dD())throw new ke(-203,!1)}function X6(e){let t=or.ng;if(t&&t.\u0275compilerFacade)return t.\u0275compilerFacade;throw new Error("JIT compiler unavailable")}function e8(e){return typeof e=="function"}var ao=0,ot=1,Ve=2,Un=3,rr=4,_i=5,hd=6,Hh=7,Oi=8,Ya=9,io=10,Xt=11,pd=12,cS=13,ol=14,Ni=15,Vs=16,Ua=17,ro=18,bp=19,hD=20,$o=21,Yb=22,Ri=23,gi=25,pD=1;var Us=7,Wh=8,Ja=9,mi=10,qh=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(qh||{});function ko(e){return Array.isArray(e)&&typeof e[pD]=="object"}function lo(e){return Array.isArray(e)&&e[pD]===!0}function l0(e){return(e.flags&4)!==0}function yp(e){return e.componentOffset>-1}function wp(e){return(e.flags&1)===1}function Ro(e){return!!e.template}function gy(e){return(e[Ve]&512)!==0}var _y=class{constructor(t,i,n){this.previousValue=t,this.currentValue=i,this.firstChange=n}isFirstChange(){return this.firstChange}};function mD(e,t,i,n){t!==null?t.applyValueToInputSignal(t,n):e[i]=n}function Wn(){return gD}function gD(e){return e.type.prototype.ngOnChanges&&(e.setInput=n8),t8}Wn.ngInherit=!0;function t8(){let e=vD(this),t=e?.current;if(t){let i=e.previous;if(i===Ka)e.previous=t;else for(let n in t)i[n]=t[n];e.current=null,this.ngOnChanges(t)}}function n8(e,t,i,n,r){let o=this.declaredInputs[n],s=vD(e)||i8(e,{previous:Ka,current:null}),a=s.current||(s.current={}),u=s.previous,c=u[o];a[o]=new _y(c&&c.currentValue,i,u===Ka),mD(e,t,r,i)}var _D="__ngSimpleChanges__";function vD(e){return e[_D]||null}function i8(e,t){return e[_D]=t}var dS=null;var Sr=function(e,t,i){dS?.(e,t,i)},r8="svg",o8="math";function $r(e){for(;Array.isArray(e);)e=e[ao];return e}function bD(e,t){return $r(t[e])}function Pi(e,t){return $r(t[e.index])}function u0(e,t){return e.data[t]}function s8(e,t){return e[t]}function Po(e,t){let i=t[e];return ko(i)?i:i[ao]}function a8(e){return(e[Ve]&4)===4}function c0(e){return(e[Ve]&128)===128}function l8(e){return lo(e[Un])}function Xa(e,t){return t==null?null:e[t]}function yD(e){e[Ua]=0}function wD(e){e[Ve]&1024||(e[Ve]|=1024,c0(e)&&xp(e))}function u8(e,t){for(;e>0;)t=t[ol],e--;return t}function md(e){return!!(e[Ve]&9216||e[Ri]?.dirty)}function vy(e){e[io].changeDetectionScheduler?.notify(7),e[Ve]&64&&(e[Ve]|=1024),md(e)&&xp(e)}function xp(e){e[io].changeDetectionScheduler?.notify(0);let t=Hs(e);for(;t!==null&&!(t[Ve]&8192||(t[Ve]|=8192,!c0(t)));)t=Hs(t)}function xD(e,t){if((e[Ve]&256)===256)throw new ke(911,!1);e[$o]===null&&(e[$o]=[]),e[$o].push(t)}function c8(e,t){if(e[$o]===null)return;let i=e[$o].indexOf(t);i!==-1&&e[$o].splice(i,1)}function Hs(e){let t=e[Un];return lo(t)?t[Un]:t}var ct={lFrame:MD(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var CD=!1;function d8(){return ct.lFrame.elementDepthCount}function f8(){ct.lFrame.elementDepthCount++}function h8(){ct.lFrame.elementDepthCount--}function ED(){return ct.bindingsEnabled}function ID(){return ct.skipHydrationRootTNode!==null}function p8(e){return ct.skipHydrationRootTNode===e}function m8(){ct.skipHydrationRootTNode=null}function ht(){return ct.lFrame.lView}function an(){return ct.lFrame.tView}function Ct(e){return ct.lFrame.contextLView=e,e[Oi]}function Et(e){return ct.lFrame.contextLView=null,e}function Ln(){let e=SD();for(;e!==null&&e.type===64;)e=e.parent;return e}function SD(){return ct.lFrame.currentTNode}function g8(){let e=ct.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}function Qs(e,t){let i=ct.lFrame;i.currentTNode=e,i.isParent=t}function d0(){return ct.lFrame.isParent}function f0(){ct.lFrame.isParent=!1}function _8(){return ct.lFrame.contextLView}function DD(){return CD}function fS(e){CD=e}function v8(e){return ct.lFrame.bindingIndex=e}function sl(){return ct.lFrame.bindingIndex++}function TD(e){let t=ct.lFrame,i=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,i}function b8(){return ct.lFrame.inI18n}function y8(e,t){let i=ct.lFrame;i.bindingIndex=i.bindingRootIndex=e,by(t)}function w8(){return ct.lFrame.currentDirectiveIndex}function by(e){ct.lFrame.currentDirectiveIndex=e}function x8(e){let t=ct.lFrame.currentDirectiveIndex;return t===-1?null:e[t]}function h0(){return ct.lFrame.currentQueryIndex}function Cp(e){ct.lFrame.currentQueryIndex=e}function C8(e){let t=e[ot];return t.type===2?t.declTNode:t.type===1?e[_i]:null}function $D(e,t,i){if(i&ut.SkipSelf){let r=t,o=e;for(;r=r.parent,r===null&&!(i&ut.Host);)if(r=C8(o),r===null||(o=o[ol],r.type&10))break;if(r===null)return!1;t=r,e=o}let n=ct.lFrame=kD();return n.currentTNode=t,n.lView=e,!0}function p0(e){let t=kD(),i=e[ot];ct.lFrame=t,t.currentTNode=i.firstChild,t.lView=e,t.tView=i,t.contextLView=e,t.bindingIndex=i.bindingStartIndex,t.inI18n=!1}function kD(){let e=ct.lFrame,t=e===null?null:e.child;return t===null?MD(e):t}function MD(e){let t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return e!==null&&(e.child=t),t}function AD(){let e=ct.lFrame;return ct.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}var RD=AD;function m0(){let e=AD();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function E8(e){return(ct.lFrame.contextLView=u8(e,ct.lFrame.contextLView))[Oi]}function Ys(){return ct.lFrame.selectedIndex}function Ws(e){ct.lFrame.selectedIndex=e}function yd(){let e=ct.lFrame;return u0(e.tView,e.selectedIndex)}function I8(){return ct.lFrame.currentNamespace}var OD=!0;function Ep(){return OD}function Ip(e){OD=e}function S8(e,t,i){let{ngOnChanges:n,ngOnInit:r,ngDoCheck:o}=t.type.prototype;if(n){let s=gD(t);(i.preOrderHooks??=[]).push(e,s),(i.preOrderCheckHooks??=[]).push(e,s)}r&&(i.preOrderHooks??=[]).push(0-e,r),o&&((i.preOrderHooks??=[]).push(e,o),(i.preOrderCheckHooks??=[]).push(e,o))}function Sp(e,t){for(let i=t.directiveStart,n=t.directiveEnd;i<n;i++){let o=e.data[i].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:f}=o;s&&(e.contentHooks??=[]).push(-i,s),a&&((e.contentHooks??=[]).push(i,a),(e.contentCheckHooks??=[]).push(i,a)),u&&(e.viewHooks??=[]).push(-i,u),c&&((e.viewHooks??=[]).push(i,c),(e.viewCheckHooks??=[]).push(i,c)),f!=null&&(e.destroyHooks??=[]).push(i,f)}}function Nh(e,t,i){ND(e,t,3,i)}function Ph(e,t,i,n){(e[Ve]&3)===i&&ND(e,t,i,n)}function Jb(e,t){let i=e[Ve];(i&3)===t&&(i&=16383,i+=1,e[Ve]=i)}function ND(e,t,i,n){let r=n!==void 0?e[Ua]&65535:0,o=n??-1,s=t.length-1,a=0;for(let u=r;u<s;u++)if(typeof t[u+1]=="number"){if(a=t[u],n!=null&&a>=n)break}else t[u]<0&&(e[Ua]+=65536),(a<o||o==-1)&&(D8(e,i,t,u),e[Ua]=(e[Ua]&4294901760)+u+2),u++}function hS(e,t){Sr(4,e,t);let i=_t(null);try{t.call(e)}finally{_t(i),Sr(5,e,t)}}function D8(e,t,i,n){let r=i[n]<0,o=i[n+1],s=r?-i[n]:i[n],a=e[s];r?e[Ve]>>14<e[Ua]>>16&&(e[Ve]&3)===t&&(e[Ve]+=16384,hS(a,o)):hS(a,o)}var qa=-1,qs=class{constructor(t,i,n){this.factory=t,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=n}};function T8(e){return e instanceof qs}function $8(e){return(e.flags&8)!==0}function k8(e){return(e.flags&16)!==0}var Xb={},yy=class{constructor(t,i){this.injector=t,this.parentInjector=i}get(t,i,n){n=mp(n);let r=this.injector.get(t,Xb,n);return r!==Xb||i===Xb?r:this.parentInjector.get(t,i,n)}};function PD(e){return e!==qa}function Gh(e){return e&32767}function M8(e){return e>>16}function Kh(e,t){let i=M8(e),n=t;for(;i>0;)n=n[ol],i--;return n}var wy=!0;function pS(e){let t=wy;return wy=e,t}var A8=256,FD=A8-1,zD=5,R8=0,Dr={};function O8(e,t,i){let n;typeof i=="string"?n=i.charCodeAt(0)||0:i.hasOwnProperty(ld)&&(n=i[ld]),n==null&&(n=i[ld]=R8++);let r=n&FD,o=1<<r;t.data[e+(r>>zD)]|=o}function Zh(e,t){let i=LD(e,t);if(i!==-1)return i;let n=t[ot];n.firstCreatePass&&(e.injectorIndex=t.length,ey(n.data,e),ey(t,null),ey(n.blueprint,null));let r=g0(e,t),o=e.injectorIndex;if(PD(r)){let s=Gh(r),a=Kh(r,t),u=a[ot].data;for(let c=0;c<8;c++)t[o+c]=a[s+c]|u[s+c]}return t[o+8]=r,o}function ey(e,t){e.push(0,0,0,0,0,0,0,0,t)}function LD(e,t){return e.injectorIndex===-1||e.parent&&e.parent.injectorIndex===e.injectorIndex||t[e.injectorIndex+8]===null?-1:e.injectorIndex}function g0(e,t){if(e.parent&&e.parent.injectorIndex!==-1)return e.parent.injectorIndex;let i=0,n=null,r=t;for(;r!==null;){if(n=HD(r),n===null)return qa;if(i++,r=r[ol],n.injectorIndex!==-1)return n.injectorIndex|i<<16}return qa}function xy(e,t,i){O8(e,t,i)}function N8(e,t){if(t==="class")return e.classes;if(t==="style")return e.styles;let i=e.attrs;if(i){let n=i.length,r=0;for(;r<n;){let o=i[r];if(JS(o))break;if(o===0)r=r+2;else if(typeof o=="number")for(r++;r<n&&typeof i[r]=="string";)r++;else{if(o===t)return i[r+1];r=r+2}}}return null}function BD(e,t,i){if(i&ut.Optional||e!==void 0)return e;t0(t,"NodeInjector")}function jD(e,t,i,n){if(i&ut.Optional&&n===void 0&&(n=null),!(i&(ut.Self|ut.Host))){let r=e[Ya],o=Ai(void 0);try{return r?r.get(t,n,i&ut.Optional):qS(t,n,i&ut.Optional)}finally{Ai(o)}}return BD(n,t,i)}function VD(e,t,i,n=ut.Default,r){if(e!==null){if(t[Ve]&2048&&!(n&ut.Self)){let s=L8(e,t,i,n,Dr);if(s!==Dr)return s}let o=UD(e,t,i,n,Dr);if(o!==Dr)return o}return jD(t,i,n,r)}function UD(e,t,i,n,r){let o=F8(i);if(typeof o=="function"){if(!$D(t,e,n))return n&ut.Host?BD(r,i,n):jD(t,i,n,r);try{let s;if(s=o(n),s==null&&!(n&ut.Optional))t0(i);else return s}finally{RD()}}else if(typeof o=="number"){let s=null,a=LD(e,t),u=qa,c=n&ut.Host?t[Ni][_i]:null;for((a===-1||n&ut.SkipSelf)&&(u=a===-1?g0(e,t):t[a+8],u===qa||!gS(n,!1)?a=-1:(s=t[ot],a=Gh(u),t=Kh(u,t)));a!==-1;){let f=t[ot];if(mS(o,a,f.data)){let p=P8(a,t,i,s,n,c);if(p!==Dr)return p}u=t[a+8],u!==qa&&gS(n,t[ot].data[a+8]===c)&&mS(o,a,t)?(s=f,a=Gh(u),t=Kh(u,t)):a=-1}}return r}function P8(e,t,i,n,r,o){let s=t[ot],a=s.data[e+8],u=n==null?yp(a)&&wy:n!=s&&(a.type&3)!==0,c=r&ut.Host&&o===a,f=Fh(a,s,i,u,c);return f!==null?Gs(t,s,f,a):Dr}function Fh(e,t,i,n,r){let o=e.providerIndexes,s=t.data,a=o&1048575,u=e.directiveStart,c=e.directiveEnd,f=o>>20,p=n?a:a+f,m=r?a+f:c;for(let v=p;v<m;v++){let b=s[v];if(v<u&&i===b||v>=u&&b.type===i)return v}if(r){let v=s[u];if(v&&Ro(v)&&v.type===i)return u}return null}function Gs(e,t,i,n){let r=e[i],o=t.data;if(T8(r)){let s=r;s.resolving&&d6(c6(o[i]));let a=pS(s.canSeeViewProviders);s.resolving=!0;let u,c=s.injectImpl?Ai(s.injectImpl):null,f=$D(e,n,ut.Default);try{r=e[i]=s.factory(void 0,o,e,n),t.firstCreatePass&&i>=n.directiveStart&&S8(i,o[i],t)}finally{c!==null&&Ai(c),pS(a),s.resolving=!1,RD()}}return r}function F8(e){if(typeof e=="string")return e.charCodeAt(0)||0;let t=e.hasOwnProperty(ld)?e[ld]:void 0;return typeof t=="number"?t>=0?t&FD:z8:t}function mS(e,t,i){let n=1<<e;return!!(i[t+(e>>zD)]&n)}function gS(e,t){return!(e&ut.Self)&&!(e&ut.Host&&t)}var js=class{constructor(t,i){this._tNode=t,this._lView=i}get(t,i,n){return VD(this._tNode,this._lView,t,mp(n),i)}};function z8(){return new js(Ln(),ht())}function qn(e){return vd(()=>{let t=e.prototype.constructor,i=t[Bh]||Cy(t),n=Object.prototype,r=Object.getPrototypeOf(e.prototype).constructor;for(;r&&r!==n;){let o=r[Bh]||Cy(r);if(o&&o!==i)return o;r=Object.getPrototypeOf(r)}return o=>new o})}function Cy(e){return BS(e)?()=>{let t=Cy(ni(e));return t&&t()}:Ga(e)}function L8(e,t,i,n,r){let o=e,s=t;for(;o!==null&&s!==null&&s[Ve]&2048&&!(s[Ve]&512);){let a=UD(o,s,i,n|ut.Self,Dr);if(a!==Dr)return a;let u=o.parent;if(!u){let c=s[hD];if(c){let f=c.get(i,Dr,n);if(f!==Dr)return f}u=HD(s),s=s[ol]}o=u}return r}function HD(e){let t=e[ot],i=t.type;return i===2?t.declTNode:i===1?e[_i]:null}function Fo(e){return N8(Ln(),e)}function _S(e,t=null,i=null,n){let r=WD(e,t,i,n);return r.resolveInjectorInitializers(),r}function WD(e,t=null,i=null,n,r=new Set){let o=[i||ii,V6(e)];return n=n||(typeof e=="object"?void 0:oi(e)),new fd(o,t||a0(),n||null,r)}var Bs=class Bs{static create(t,i){if(Array.isArray(t))return _S({name:""},i,t,"");{let n=t.name??"";return _S({name:n},t.parent,t.providers,n)}}};Bs.THROW_IF_NOT_FOUND=cd,Bs.NULL=new Uh,Bs.\u0275prov=be({token:Bs,providedIn:"any",factory:()=>me(ZS)}),Bs.__NG_ELEMENT_ID__=-1;var fn=Bs;var B8=new _e("");B8.__NG_ELEMENT_ID__=e=>{let t=Ln();if(t===null)throw new ke(204,!1);if(t.type&2)return t.value;if(e&ut.Optional)return null;throw new ke(204,!1)};var j8="ngOriginalError";function ty(e){return e[j8]}var sr=class{constructor(){this._console=console}handleError(t){let i=this._findOriginalError(t);this._console.error("ERROR",t),i&&this._console.error("ORIGINAL ERROR",i)}_findOriginalError(t){let i=t&&ty(t);for(;i&&ty(i);)i=ty(i);return i||null}},qD=new _e("",{providedIn:"root",factory:()=>ne(sr).handleError.bind(void 0)}),_0=(()=>{let t=class t{};t.__NG_ELEMENT_ID__=V8,t.__NG_ENV_ID__=n=>n;let e=t;return e})(),Ey=class extends _0{constructor(t){super(),this._lView=t}onDestroy(t){return xD(this._lView,t),()=>c8(this._lView,t)}};function V8(){return new Ey(ht())}function U8(){return al(Ln(),ht())}function al(e,t){return new Je(Pi(e,t))}var Je=(()=>{let t=class t{constructor(n){this.nativeElement=n}};t.__NG_ELEMENT_ID__=U8;let e=t;return e})();function GD(e){return e instanceof Je?e.nativeElement:e}var zo=(()=>{let t=class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new dn(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};t.\u0275prov=be({token:t,providedIn:"root",factory:()=>new t});let e=t;return e})();var Iy=class extends lt{constructor(t=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=t,dD()&&(this.destroyRef=ne(_0,{optional:!0})??void 0,this.pendingTasks=ne(zo,{optional:!0})??void 0)}emit(t){let i=_t(null);try{super.next(t)}finally{_t(i)}}subscribe(t,i,n){let r=t,o=i||(()=>null),s=n;if(t&&typeof t=="object"){let u=t;r=u.next?.bind(u),o=u.error?.bind(u),s=u.complete?.bind(u)}this.__isAsync&&(o=this.wrapInTimeout(o),r&&(r=this.wrapInTimeout(r)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:r,error:o,complete:s});return t instanceof Wt&&t.add(a),a}wrapInTimeout(t){return i=>{let n=this.pendingTasks?.add();setTimeout(()=>{t(i),n!==void 0&&this.pendingTasks?.remove(n)})}}},Tt=Iy;function H8(){return this._results[Symbol.iterator]()}var Qh=class e{get changes(){return this._changes??=new Tt}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let i=e.prototype;i[Symbol.iterator]||(i[Symbol.iterator]=H8)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,i){return this._results.reduce(t,i)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,i){this.dirty=!1;let n=x6(t);(this._changesDetected=!w6(this._results,n,i))&&(this._results=n,this.length=n.length,this.last=n[this.length-1],this.first=n[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function KD(e){return(e.flags&128)===128}var ZD=new Map,W8=0;function q8(){return W8++}function G8(e){ZD.set(e[bp],e)}function K8(e){ZD.delete(e[bp])}var vS="__ngContext__";function Oo(e,t){ko(t)?(e[vS]=t[bp],G8(t)):e[vS]=t}function QD(e){return JD(e[pd])}function YD(e){return JD(e[rr])}function JD(e){for(;e!==null&&!lo(e);)e=e[rr];return e}var Sy;function XD(e){Sy=e}function Z8(){if(Sy!==void 0)return Sy;if(typeof document<"u")return document;throw new ke(210,!1)}var wd=new _e("",{providedIn:"root",factory:()=>Q8}),Q8="ng",v0=new _e(""),Fi=new _e("",{providedIn:"platform",factory:()=>"unknown"});var uo=new _e(""),xd=new _e("",{providedIn:"root",factory:()=>Z8().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var Y8="h",J8="b";var X8=()=>null;function b0(e,t,i=!1){return X8(e,t,i)}var e2=!1,eW=new _e("",{providedIn:"root",factory:()=>e2});var Dy=class{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${e6})`}};function Dp(e){return e instanceof Dy?e.changingThisBreaksApplicationSecurity:e}var tW=/^>|^->|<!--|-->|--!>|<!-$/g,nW=/(<|>)/g,iW="\u200B$1\u200B";function rW(e){return e.replace(tW,t=>t.replace(nW,iW))}function t2(e){return e.ownerDocument.defaultView}function n2(e){return e instanceof Function?e():e}function i2(e){return(e??ne(fn)).get(Fi)==="browser"}var oo=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(oo||{}),oW;function y0(e,t){return oW(e,t)}function Ha(e,t,i,n,r){if(n!=null){let o,s=!1;lo(n)?o=n:ko(n)&&(s=!0,n=n[ao]);let a=$r(n);e===0&&i!==null?r==null?l2(t,i,a):Jh(t,i,a,r||null,!0):e===1&&i!==null?Jh(t,i,a,r||null,!0):e===2?yW(t,a,s):e===3&&t.destroyNode(a),o!=null&&xW(t,e,o,i,r)}}function sW(e,t){return e.createText(t)}function aW(e,t,i){e.setValue(t,i)}function lW(e,t){return e.createComment(rW(t))}function r2(e,t,i){return e.createElement(t,i)}function uW(e,t){o2(e,t),t[ao]=null,t[_i]=null}function cW(e,t,i,n,r,o){n[ao]=r,n[_i]=t,$p(e,n,i,1,r,o)}function o2(e,t){t[io].changeDetectionScheduler?.notify(8),$p(e,t,t[Xt],2,null,null)}function dW(e){let t=e[pd];if(!t)return ny(e[ot],e);for(;t;){let i=null;if(ko(t))i=t[pd];else{let n=t[mi];n&&(i=n)}if(!i){for(;t&&!t[rr]&&t!==e;)ko(t)&&ny(t[ot],t),t=t[Un];t===null&&(t=e),ko(t)&&ny(t[ot],t),i=t&&t[rr]}t=i}}function fW(e,t,i,n){let r=mi+n,o=i.length;n>0&&(i[r-1][rr]=t),n<o-mi?(t[rr]=i[r],KS(i,mi+n,t)):(i.push(t),t[rr]=null),t[Un]=i;let s=t[Vs];s!==null&&i!==s&&s2(s,t);let a=t[ro];a!==null&&a.insertView(e),vy(t),t[Ve]|=128}function s2(e,t){let i=e[Ja],n=t[Un];if(ko(n))e[Ve]|=qh.HasTransplantedViews;else{let r=n[Un][Ni];t[Ni]!==r&&(e[Ve]|=qh.HasTransplantedViews)}i===null?e[Ja]=[t]:i.push(t)}function w0(e,t){let i=e[Ja],n=i.indexOf(t);i.splice(n,1)}function Yh(e,t){if(e.length<=mi)return;let i=mi+t,n=e[i];if(n){let r=n[Vs];r!==null&&r!==e&&w0(r,n),t>0&&(e[i-1][rr]=n[rr]);let o=Vh(e,mi+t);uW(n[ot],n);let s=o[ro];s!==null&&s.detachView(o[ot]),n[Un]=null,n[rr]=null,n[Ve]&=-129}return n}function x0(e,t){if(!(t[Ve]&256)){let i=t[Xt];i.destroyNode&&$p(e,t,i,3,null,null),dW(t)}}function ny(e,t){if(t[Ve]&256)return;let i=_t(null);try{t[Ve]&=-129,t[Ve]|=256,t[Ri]&&$b(t[Ri]),pW(e,t),hW(e,t),t[ot].type===1&&t[Xt].destroy();let n=t[Vs];if(n!==null&&lo(t[Un])){n!==t[Un]&&w0(n,t);let r=t[ro];r!==null&&r.detachView(e)}K8(t)}finally{_t(i)}}function hW(e,t){let i=e.cleanup,n=t[Hh];if(i!==null)for(let o=0;o<i.length-1;o+=2)if(typeof i[o]=="string"){let s=i[o+3];s>=0?n[s]():n[-s].unsubscribe(),o+=2}else{let s=n[i[o+1]];i[o].call(s)}n!==null&&(t[Hh]=null);let r=t[$o];if(r!==null){t[$o]=null;for(let o=0;o<r.length;o++){let s=r[o];s()}}}function pW(e,t){let i;if(e!=null&&(i=e.destroyHooks)!=null)for(let n=0;n<i.length;n+=2){let r=t[i[n]];if(!(r instanceof qs)){let o=i[n+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){let a=r[o[s]],u=o[s+1];Sr(4,a,u);try{u.call(a)}finally{Sr(5,a,u)}}else{Sr(4,r,o);try{o.call(r)}finally{Sr(5,r,o)}}}}}function a2(e,t,i){return mW(e,t.parent,i)}function mW(e,t,i){let n=t;for(;n!==null&&n.type&168;)t=n,n=t.parent;if(n===null)return i[ao];{let{componentOffset:r}=n;if(r>-1){let{encapsulation:o}=e.data[n.directiveStart+r];if(o===Tr.None||o===Tr.Emulated)return null}return Pi(n,i)}}function Jh(e,t,i,n,r){e.insertBefore(t,i,n,r)}function l2(e,t,i){e.appendChild(t,i)}function bS(e,t,i,n,r){n!==null?Jh(e,t,i,n,r):l2(e,t,i)}function gW(e,t,i,n){e.removeChild(t,i,n)}function C0(e,t){return e.parentNode(t)}function _W(e,t){return e.nextSibling(t)}function u2(e,t,i){return bW(e,t,i)}function vW(e,t,i){return e.type&40?Pi(e,i):null}var bW=vW,yS;function Tp(e,t,i,n){let r=a2(e,n,t),o=t[Xt],s=n.parent||t[_i],a=u2(s,n,t);if(r!=null)if(Array.isArray(i))for(let u=0;u<i.length;u++)bS(o,r,i[u],a,!1);else bS(o,r,i,a,!1);yS!==void 0&&yS(o,n,t,i,r)}function zh(e,t){if(t!==null){let i=t.type;if(i&3)return Pi(t,e);if(i&4)return Ty(-1,e[t.index]);if(i&8){let n=t.child;if(n!==null)return zh(e,n);{let r=e[t.index];return lo(r)?Ty(-1,r):$r(r)}}else{if(i&32)return y0(t,e)()||$r(e[t.index]);{let n=c2(e,t);if(n!==null){if(Array.isArray(n))return n[0];let r=Hs(e[Ni]);return zh(r,n)}else return zh(e,t.next)}}}return null}function c2(e,t){if(t!==null){let n=e[Ni][_i],r=t.projection;return n.projection[r]}return null}function Ty(e,t){let i=mi+e+1;if(i<t.length){let n=t[i],r=n[ot].firstChild;if(r!==null)return zh(n,r)}return t[Us]}function yW(e,t,i){let n=C0(e,t);n&&gW(e,n,t,i)}function E0(e,t,i,n,r,o,s){for(;i!=null;){if(i.type===128){i=i.next;continue}let a=n[i.index],u=i.type;if(s&&t===0&&(a&&Oo($r(a),n),i.flags|=2),(i.flags&32)!==32)if(u&8)E0(e,t,i.child,n,r,o,!1),Ha(t,e,r,a,o);else if(u&32){let c=y0(i,n),f;for(;f=c();)Ha(t,e,r,f,o);Ha(t,e,r,a,o)}else u&16?d2(e,t,n,i,r,o):Ha(t,e,r,a,o);i=s?i.projectionNext:i.next}}function $p(e,t,i,n,r,o){E0(i,n,e.firstChild,t,r,o,!1)}function wW(e,t,i){let n=t[Xt],r=a2(e,i,t),o=i.parent||t[_i],s=u2(o,i,t);d2(n,0,t,i,r,s)}function d2(e,t,i,n,r,o){let s=i[Ni],u=s[_i].projection[n.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++){let f=u[c];Ha(t,e,r,f,o)}else{let c=u,f=s[Un];KD(n)&&(c.flags|=128),E0(e,t,c,f,r,o,!0)}}function xW(e,t,i,n,r){let o=i[Us],s=$r(i);o!==s&&Ha(t,e,n,o,r);for(let a=mi;a<i.length;a++){let u=i[a];$p(u[ot],u,e,t,n,o)}}function CW(e,t,i,n,r){if(t)r?e.addClass(i,n):e.removeClass(i,n);else{let o=n.indexOf("-")===-1?void 0:oo.DashCase;r==null?e.removeStyle(i,n,o):(typeof r=="string"&&r.endsWith("!important")&&(r=r.slice(0,-10),o|=oo.Important),e.setStyle(i,n,r,o))}}function EW(e,t,i){e.setAttribute(t,"style",i)}function f2(e,t,i){i===""?e.removeAttribute(t,"class"):e.setAttribute(t,"class",i)}function h2(e,t,i){let{mergedAttrs:n,classes:r,styles:o}=i;n!==null&&fy(e,t,n),r!==null&&f2(e,t,r),o!==null&&EW(e,t,o)}var kr={};function U(e=1){p2(an(),ht(),Ys()+e,!1)}function p2(e,t,i,n){if(!n)if((t[Ve]&3)===3){let o=e.preOrderCheckHooks;o!==null&&Nh(t,o,i)}else{let o=e.preOrderHooks;o!==null&&Ph(t,o,0,i)}Ws(i)}function V(e,t=ut.Default){let i=ht();if(i===null)return me(e,t);let n=Ln();return VD(n,i,ni(e),t)}function kp(){let e="invalid";throw new Error(e)}function m2(e,t,i,n,r,o){let s=_t(null);try{let a=null;r&Mo.SignalBased&&(a=t[n][Xi]),a!==null&&a.transformFn!==void 0&&(o=a.transformFn(o)),r&Mo.HasDecoratorInputTransform&&(o=e.inputTransforms[n].call(t,o)),e.setInput!==null?e.setInput(t,a,o,i,n):mD(t,a,n,o)}finally{_t(s)}}function IW(e,t){let i=e.hostBindingOpCodes;if(i!==null)try{for(let n=0;n<i.length;n++){let r=i[n];if(r<0)Ws(~r);else{let o=r,s=i[++n],a=i[++n];y8(s,o);let u=t[o];a(2,u)}}}finally{Ws(-1)}}function Mp(e,t,i,n,r,o,s,a,u,c,f){let p=t.blueprint.slice();return p[ao]=r,p[Ve]=n|4|128|8|64,(c!==null||e&&e[Ve]&2048)&&(p[Ve]|=2048),yD(p),p[Un]=p[ol]=e,p[Oi]=i,p[io]=s||e&&e[io],p[Xt]=a||e&&e[Xt],p[Ya]=u||e&&e[Ya]||null,p[_i]=o,p[bp]=q8(),p[hd]=f,p[hD]=c,p[Ni]=t.type==2?e[Ni]:p,p}function ll(e,t,i,n,r){let o=e.data[t];if(o===null)o=SW(e,t,i,n,r),b8()&&(o.flags|=32);else if(o.type&64){o.type=i,o.value=n,o.attrs=r;let s=g8();o.injectorIndex=s===null?-1:s.injectorIndex}return Qs(o,!0),o}function SW(e,t,i,n,r){let o=SD(),s=d0(),a=s?o:o&&o.parent,u=e.data[t]=AW(e,a,i,t,n,r);return e.firstChild===null&&(e.firstChild=u),o!==null&&(s?o.child==null&&u.parent!==null&&(o.child=u):o.next===null&&(o.next=u,u.prev=o)),u}function g2(e,t,i,n){if(i===0)return-1;let r=t.length;for(let o=0;o<i;o++)t.push(n),e.blueprint.push(n),e.data.push(null);return r}function _2(e,t,i,n,r){let o=Ys(),s=n&2;try{Ws(-1),s&&t.length>gi&&p2(e,t,gi,!1),Sr(s?2:0,r),i(n,r)}finally{Ws(o),Sr(s?3:1,r)}}function I0(e,t,i){if(l0(t)){let n=_t(null);try{let r=t.directiveStart,o=t.directiveEnd;for(let s=r;s<o;s++){let a=e.data[s];if(a.contentQueries){let u=i[s];a.contentQueries(1,u,s)}}}finally{_t(n)}}}function S0(e,t,i){ED()&&(zW(e,t,i,Pi(i,t)),(i.flags&64)===64&&y2(e,t,i))}function D0(e,t,i=Pi){let n=t.localNames;if(n!==null){let r=t.index+1;for(let o=0;o<n.length;o+=2){let s=n[o+1],a=s===-1?i(t,e):e[s];e[r++]=a}}}function v2(e){let t=e.tView;return t===null||t.incompleteFirstPass?e.tView=T0(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function T0(e,t,i,n,r,o,s,a,u,c,f){let p=gi+n,m=p+r,v=DW(p,m),b=typeof c=="function"?c():c;return v[ot]={type:e,blueprint:v,template:i,queries:null,viewQuery:a,declTNode:t,data:v.slice().fill(null,p),bindingStartIndex:p,expandoStartIndex:m,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof o=="function"?o():o,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:u,consts:b,incompleteFirstPass:!1,ssrId:f}}function DW(e,t){let i=[];for(let n=0;n<t;n++)i.push(n<e?null:kr);return i}function TW(e,t,i,n){let o=n.get(eW,e2)||i===Tr.ShadowDom,s=e.selectRootElement(t,o);return $W(s),s}function $W(e){kW(e)}var kW=()=>null;function MW(e,t,i,n){let r=C2(t);r.push(i),e.firstCreatePass&&E2(e).push(n,r.length-1)}function AW(e,t,i,n,r,o){let s=t?t.injectorIndex:-1,a=0;return ID()&&(a|=128),{type:i,index:n,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function wS(e,t,i,n,r){for(let o in t){if(!t.hasOwnProperty(o))continue;let s=t[o];if(s===void 0)continue;n??={};let a,u=Mo.None;Array.isArray(s)?(a=s[0],u=s[1]):a=s;let c=o;if(r!==null){if(!r.hasOwnProperty(o))continue;c=r[o]}e===0?xS(n,i,c,a,u):xS(n,i,c,a)}return n}function xS(e,t,i,n,r){let o;e.hasOwnProperty(i)?(o=e[i]).push(t,n):o=e[i]=[t,n],r!==void 0&&o.push(r)}function RW(e,t,i){let n=t.directiveStart,r=t.directiveEnd,o=e.data,s=t.attrs,a=[],u=null,c=null;for(let f=n;f<r;f++){let p=o[f],m=i?i.get(p):null,v=m?m.inputs:null,b=m?m.outputs:null;u=wS(0,p.inputs,f,u,v),c=wS(1,p.outputs,f,c,b);let w=u!==null&&s!==null&&!o0(t)?ZW(u,f,s):null;a.push(w)}u!==null&&(u.hasOwnProperty("class")&&(t.flags|=8),u.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=a,t.inputs=u,t.outputs=c}function OW(e){return e==="class"?"className":e==="for"?"htmlFor":e==="formaction"?"formAction":e==="innerHtml"?"innerHTML":e==="readonly"?"readOnly":e==="tabindex"?"tabIndex":e}function Ap(e,t,i,n,r,o,s,a){let u=Pi(t,i),c=t.inputs,f;!a&&c!=null&&(f=c[n])?(k0(e,i,f,n,r),yp(t)&&NW(i,t.index)):t.type&3?(n=OW(n),r=s!=null?s(r,t.value||"",n):r,o.setProperty(u,n,r)):t.type&12}function NW(e,t){let i=Po(t,e);i[Ve]&16||(i[Ve]|=64)}function $0(e,t,i,n){if(ED()){let r=n===null?null:{"":-1},o=BW(e,i),s,a;o===null?s=a=null:[s,a]=o,s!==null&&b2(e,t,i,s,r,a),r&&jW(i,n,r)}i.mergedAttrs=dd(i.mergedAttrs,i.attrs)}function b2(e,t,i,n,r,o){for(let c=0;c<n.length;c++)xy(Zh(i,t),e,n[c].type);UW(i,e.data.length,n.length);for(let c=0;c<n.length;c++){let f=n[c];f.providersResolver&&f.providersResolver(f)}let s=!1,a=!1,u=g2(e,t,n.length,null);for(let c=0;c<n.length;c++){let f=n[c];i.mergedAttrs=dd(i.mergedAttrs,f.hostAttrs),HW(e,i,t,u,f),VW(u,f,r),f.contentQueries!==null&&(i.flags|=4),(f.hostBindings!==null||f.hostAttrs!==null||f.hostVars!==0)&&(i.flags|=64);let p=f.type.prototype;!s&&(p.ngOnChanges||p.ngOnInit||p.ngDoCheck)&&((e.preOrderHooks??=[]).push(i.index),s=!0),!a&&(p.ngOnChanges||p.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(i.index),a=!0),u++}RW(e,i,o)}function PW(e,t,i,n,r){let o=r.hostBindings;if(o){let s=e.hostBindingOpCodes;s===null&&(s=e.hostBindingOpCodes=[]);let a=~t.index;FW(s)!=a&&s.push(a),s.push(i,n,o)}}function FW(e){let t=e.length;for(;t>0;){let i=e[--t];if(typeof i=="number"&&i<0)return i}return 0}function zW(e,t,i,n){let r=i.directiveStart,o=i.directiveEnd;yp(i)&&WW(t,i,e.data[r+i.componentOffset]),e.firstCreatePass||Zh(i,t),Oo(n,t);let s=i.initialInputs;for(let a=r;a<o;a++){let u=e.data[a],c=Gs(t,e,a,i);if(Oo(c,t),s!==null&&KW(t,a-r,c,u,i,s),Ro(u)){let f=Po(i.index,t);f[Oi]=Gs(t,e,a,i)}}}function y2(e,t,i){let n=i.directiveStart,r=i.directiveEnd,o=i.index,s=w8();try{Ws(o);for(let a=n;a<r;a++){let u=e.data[a],c=t[a];by(a),(u.hostBindings!==null||u.hostVars!==0||u.hostAttrs!==null)&&LW(u,c)}}finally{Ws(-1),by(s)}}function LW(e,t){e.hostBindings!==null&&e.hostBindings(1,t)}function BW(e,t){let i=e.directiveRegistry,n=null,r=null;if(i)for(let o=0;o<i.length;o++){let s=i[o];if(eD(t,s.selectors,!1))if(n||(n=[]),Ro(s))if(s.findHostDirectiveDefs!==null){let a=[];r=r||new Map,s.findHostDirectiveDefs(s,a,r),n.unshift(...a,s);let u=a.length;$y(e,t,u)}else n.unshift(s),$y(e,t,0);else r=r||new Map,s.findHostDirectiveDefs?.(s,n,r),n.push(s)}return n===null?null:[n,r]}function $y(e,t,i){t.componentOffset=i,(e.components??=[]).push(t.index)}function jW(e,t,i){if(t){let n=e.localNames=[];for(let r=0;r<t.length;r+=2){let o=i[t[r+1]];if(o==null)throw new ke(-301,!1);n.push(t[r],o)}}}function VW(e,t,i){if(i){if(t.exportAs)for(let n=0;n<t.exportAs.length;n++)i[t.exportAs[n]]=e;Ro(t)&&(i[""]=e)}}function UW(e,t,i){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+i,e.providerIndexes=t}function HW(e,t,i,n,r){e.data[n]=r;let o=r.factory||(r.factory=Ga(r.type,!0)),s=new qs(o,Ro(r),V);e.blueprint[n]=s,i[n]=s,PW(e,t,n,g2(e,i,r.hostVars,kr),r)}function WW(e,t,i){let n=Pi(t,e),r=v2(i),o=e[io].rendererFactory,s=16;i.signals?s=4096:i.onPush&&(s=64);let a=Rp(e,Mp(e,r,null,s,n,t,null,o.createRenderer(n,i),null,null,null));e[t.index]=a}function qW(e,t,i,n,r,o){let s=Pi(e,t);GW(t[Xt],s,o,e.value,i,n,r)}function GW(e,t,i,n,r,o,s){if(o==null)e.removeAttribute(t,r,i);else{let a=s==null?e0(o):s(o,n||"",r);e.setAttribute(t,r,a,i)}}function KW(e,t,i,n,r,o){let s=o[t];if(s!==null)for(let a=0;a<s.length;){let u=s[a++],c=s[a++],f=s[a++],p=s[a++];m2(n,i,u,c,f,p)}}function ZW(e,t,i){let n=null,r=0;for(;r<i.length;){let o=i[r];if(o===0){r+=4;continue}else if(o===5){r+=2;continue}if(typeof o=="number")break;if(e.hasOwnProperty(o)){n===null&&(n=[]);let s=e[o];for(let a=0;a<s.length;a+=3)if(s[a]===t){n.push(o,s[a+1],s[a+2],i[r+1]);break}}r+=2}return n}function w2(e,t,i,n){return[e,!0,0,t,null,n,null,i,null,null]}function x2(e,t){let i=e.contentQueries;if(i!==null){let n=_t(null);try{for(let r=0;r<i.length;r+=2){let o=i[r],s=i[r+1];if(s!==-1){let a=e.data[s];Cp(o),a.contentQueries(2,t[s],s)}}}finally{_t(n)}}}function Rp(e,t){return e[pd]?e[cS][rr]=t:e[pd]=t,e[cS]=t,t}function ky(e,t,i){Cp(0);let n=_t(null);try{t(e,i)}finally{_t(n)}}function C2(e){return e[Hh]??=[]}function E2(e){return e.cleanup??=[]}function I2(e,t){let i=e[Ya],n=i?i.get(sr,null):null;n&&n.handleError(t)}function k0(e,t,i,n,r){for(let o=0;o<i.length;){let s=i[o++],a=i[o++],u=i[o++],c=t[s],f=e.data[s];m2(f,c,n,a,u,r)}}function QW(e,t,i){let n=bD(t,e);aW(e[Xt],n,i)}function YW(e,t){let i=Po(t,e),n=i[ot];JW(n,i);let r=i[ao];r!==null&&i[hd]===null&&(i[hd]=b0(r,i[Ya])),M0(n,i,i[Oi])}function JW(e,t){for(let i=t.length;i<e.blueprint.length;i++)t.push(e.blueprint[i])}function M0(e,t,i){p0(t);try{let n=e.viewQuery;n!==null&&ky(1,n,i);let r=e.template;r!==null&&_2(e,t,r,1,i),e.firstCreatePass&&(e.firstCreatePass=!1),t[ro]?.finishViewCreation(e),e.staticContentQueries&&x2(e,t),e.staticViewQueries&&ky(2,e.viewQuery,i);let o=e.components;o!==null&&XW(t,o)}catch(n){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),n}finally{t[Ve]&=-5,m0()}}function XW(e,t){for(let i=0;i<t.length;i++)YW(e,t[i])}function A0(e,t,i,n){let r=_t(null);try{let o=t.tView,a=e[Ve]&4096?4096:16,u=Mp(e,o,i,a,null,t,null,null,n?.injector??null,n?.embeddedViewInjector??null,n?.dehydratedView??null),c=e[t.index];u[Vs]=c;let f=e[ro];return f!==null&&(u[ro]=f.createEmbeddedView(o)),M0(o,u,i),u}finally{_t(r)}}function eq(e,t){let i=mi+t;if(i<e.length)return e[i]}function Xh(e,t){return!t||t.firstChild===null||KD(e)}function R0(e,t,i,n=!0){let r=t[ot];if(fW(r,t,e,i),n){let s=Ty(i,e),a=t[Xt],u=C0(a,e[Us]);u!==null&&cW(r,e[_i],a,t,u,s)}let o=t[hd];o!==null&&o.firstChild!==null&&(o.firstChild=null)}function tq(e,t){let i=Yh(e,t);return i!==void 0&&x0(i[ot],i),i}function ep(e,t,i,n,r=!1){for(;i!==null;){if(i.type===128){i=r?i.projectionNext:i.next;continue}let o=t[i.index];o!==null&&n.push($r(o)),lo(o)&&nq(o,n);let s=i.type;if(s&8)ep(e,t,i.child,n);else if(s&32){let a=y0(i,t),u;for(;u=a();)n.push(u)}else if(s&16){let a=c2(t,i);if(Array.isArray(a))n.push(...a);else{let u=Hs(t[Ni]);ep(u[ot],u,a,n,!0)}}i=r?i.projectionNext:i.next}return n}function nq(e,t){for(let i=mi;i<e.length;i++){let n=e[i],r=n[ot].firstChild;r!==null&&ep(n[ot],n,r,t)}e[Us]!==e[ao]&&t.push(e[Us])}var S2=[];function iq(e){return e[Ri]??rq(e)}function rq(e){let t=S2.pop()??Object.create(sq);return t.lView=e,t}function oq(e){e.lView[Ri]!==e&&(e.lView=null,S2.push(e))}var sq=Ae(ie({},nd),{consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{xp(e.lView)},consumerOnSignalRead(){this.lView[Ri]=this}});function aq(e){let t=e[Ri]??Object.create(lq);return t.lView=e,t}var lq=Ae(ie({},nd),{consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{let t=Hs(e.lView);for(;t&&!D2(t[ot]);)t=Hs(t);t&&wD(t)},consumerOnSignalRead(){this.lView[Ri]=this}});function D2(e){return e.type!==2}var uq=100;function T2(e,t=!0,i=0){let n=e[io],r=n.rendererFactory,o=!1;o||r.begin?.();try{cq(e,i)}catch(s){throw t&&I2(e,s),s}finally{o||(r.end?.(),n.inlineEffectRunner?.flush())}}function cq(e,t){let i=DD();try{fS(!0),My(e,t);let n=0;for(;md(e);){if(n===uq)throw new ke(103,!1);n++,My(e,1)}}finally{fS(i)}}function dq(e,t,i,n){let r=t[Ve];if((r&256)===256)return;let o=!1,s=!1;!o&&t[io].inlineEffectRunner?.flush(),p0(t);let a=!0,u=null,c=null;o||(D2(e)?(c=iq(t),u=Qf(c)):pI()===null?(a=!1,c=aq(t),u=Qf(c)):t[Ri]&&($b(t[Ri]),t[Ri]=null));try{yD(t),v8(e.bindingStartIndex),i!==null&&_2(e,t,i,2,n);let f=(r&3)===3;if(!o)if(f){let v=e.preOrderCheckHooks;v!==null&&Nh(t,v,null)}else{let v=e.preOrderHooks;v!==null&&Ph(t,v,0,null),Jb(t,0)}if(s||fq(t),$2(t,0),e.contentQueries!==null&&x2(e,t),!o)if(f){let v=e.contentCheckHooks;v!==null&&Nh(t,v)}else{let v=e.contentHooks;v!==null&&Ph(t,v,1),Jb(t,1)}IW(e,t);let p=e.components;p!==null&&M2(t,p,0);let m=e.viewQuery;if(m!==null&&ky(2,m,n),!o)if(f){let v=e.viewCheckHooks;v!==null&&Nh(t,v)}else{let v=e.viewHooks;v!==null&&Ph(t,v,2),Jb(t,2)}if(e.firstUpdatePass===!0&&(e.firstUpdatePass=!1),t[Yb]){for(let v of t[Yb])v();t[Yb]=null}o||(t[Ve]&=-73)}catch(f){throw o||xp(t),f}finally{c!==null&&(Db(c,u),a&&oq(c)),m0()}}function $2(e,t){for(let i=QD(e);i!==null;i=YD(i))for(let n=mi;n<i.length;n++){let r=i[n];k2(r,t)}}function fq(e){for(let t=QD(e);t!==null;t=YD(t)){if(!(t[Ve]&qh.HasTransplantedViews))continue;let i=t[Ja];for(let n=0;n<i.length;n++){let r=i[n];wD(r)}}}function hq(e,t,i){let n=Po(t,e);k2(n,i)}function k2(e,t){c0(e)&&My(e,t)}function My(e,t){let n=e[ot],r=e[Ve],o=e[Ri],s=!!(t===0&&r&16);if(s||=!!(r&64&&t===0),s||=!!(r&1024),s||=!!(o?.dirty&&Tb(o)),s||=!1,o&&(o.dirty=!1),e[Ve]&=-9217,s)dq(n,e,n.template,e[Oi]);else if(r&8192){$2(e,1);let a=n.components;a!==null&&M2(e,a,1)}}function M2(e,t,i){for(let n=0;n<t.length;n++)hq(e,t[n],i)}function O0(e,t){let i=DD()?64:1088;for(e[io].changeDetectionScheduler?.notify(t);e;){e[Ve]|=i;let n=Hs(e);if(gy(e)&&!n)return e;e=n}return null}var Ks=class{get rootNodes(){let t=this._lView,i=t[ot];return ep(i,t,i.firstChild,[])}constructor(t,i,n=!0){this._lView=t,this._cdRefInjectingView=i,this.notifyErrorHandler=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Oi]}set context(t){this._lView[Oi]=t}get destroyed(){return(this._lView[Ve]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let t=this._lView[Un];if(lo(t)){let i=t[Wh],n=i?i.indexOf(this):-1;n>-1&&(Yh(t,n),Vh(i,n))}this._attachedToViewContainer=!1}x0(this._lView[ot],this._lView)}onDestroy(t){xD(this._lView,t)}markForCheck(){O0(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Ve]&=-129}reattach(){vy(this._lView),this._lView[Ve]|=128}detectChanges(){this._lView[Ve]|=1024,T2(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ke(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let t=gy(this._lView),i=this._lView[Vs];i!==null&&!t&&w0(i,this._lView),o2(this._lView[ot],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new ke(902,!1);this._appRef=t;let i=gy(this._lView),n=this._lView[Vs];n!==null&&!i&&s2(n,this._lView),vy(this._lView)}},Hn=(()=>{let t=class t{};t.__NG_ELEMENT_ID__=gq;let e=t;return e})(),pq=Hn,mq=class extends pq{constructor(t,i,n){super(),this._declarationLView=t,this._declarationTContainer=i,this.elementRef=n}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,i){return this.createEmbeddedViewImpl(t,i)}createEmbeddedViewImpl(t,i,n){let r=A0(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:i,dehydratedView:n});return new Ks(r)}};function gq(){return Op(Ln(),ht())}function Op(e,t){return e.type&4?new mq(t,e,al(e,t)):null}var zae=new RegExp(`^(\\d+)*(${J8}|${Y8})*(.*)`);var _q=()=>null;function tp(e,t){return _q(e,t)}var el=class{},A2=new _e("",{providedIn:"root",factory:()=>!1});var R2=new _e(""),Ay=class{},np=class{};function vq(e){let t=Error(`No component factory found for ${oi(e)}.`);return t[bq]=e,t}var bq="ngComponent";var Ry=class{resolveComponentFactory(t){throw vq(t)}},H0=class H0{};H0.NULL=new Ry;var tl=H0,nl=class{},ul=(()=>{let t=class t{constructor(){this.destroyNode=null}};t.__NG_ELEMENT_ID__=()=>yq();let e=t;return e})();function yq(){let e=ht(),t=Ln(),i=Po(t.index,e);return(ko(i)?i:e)[Xt]}var wq=(()=>{let t=class t{};t.\u0275prov=be({token:t,providedIn:"root",factory:()=>null});let e=t;return e})();var CS=new Set;function Lo(e){CS.has(e)||(CS.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}function O2(e){let t=!0;return setTimeout(()=>{t&&(t=!1,e())}),typeof or.requestAnimationFrame=="function"&&or.requestAnimationFrame(()=>{t&&(t=!1,e())}),()=>{t=!1}}function ES(e){let t=!0;return queueMicrotask(()=>{t&&e()}),()=>{t=!1}}function IS(...e){}var Re=class e{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Tt(!1),this.onMicrotaskEmpty=new Tt(!1),this.onStable=new Tt(!1),this.onError=new Tt(!1),typeof Zone>"u")throw new ke(908,!1);Zone.assertZonePatched();let r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!n&&i,r.shouldCoalesceRunChangeDetection=n,r.callbackScheduled=!1,Eq(r)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!e.isInAngularZone())throw new ke(909,!1)}static assertNotInAngularZone(){if(e.isInAngularZone())throw new ke(909,!1)}run(t,i,n){return this._inner.run(t,i,n)}runTask(t,i,n,r){let o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+r,t,xq,IS,IS);try{return o.runTask(s,i,n)}finally{o.cancelTask(s)}}runGuarded(t,i,n){return this._inner.runGuarded(t,i,n)}runOutsideAngular(t){return this._outer.run(t)}},xq={};function N0(e){if(e._nesting==0&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Cq(e){e.isCheckStableRunning||e.callbackScheduled||(e.callbackScheduled=!0,Zone.root.run(()=>{O2(()=>{e.callbackScheduled=!1,Oy(e),e.isCheckStableRunning=!0,N0(e),e.isCheckStableRunning=!1})}),Oy(e))}function Eq(e){let t=()=>{Cq(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,n,r,o,s,a)=>{if(Iq(a))return i.invokeTask(r,o,s,a);try{return SS(e),i.invokeTask(r,o,s,a)}finally{(e.shouldCoalesceEventChangeDetection&&o.type==="eventTask"||e.shouldCoalesceRunChangeDetection)&&t(),DS(e)}},onInvoke:(i,n,r,o,s,a,u)=>{try{return SS(e),i.invoke(r,o,s,a,u)}finally{e.shouldCoalesceRunChangeDetection&&!e.callbackScheduled&&!Sq(a)&&t(),DS(e)}},onHasTask:(i,n,r,o)=>{i.hasTask(r,o),n===r&&(o.change=="microTask"?(e._hasPendingMicrotasks=o.microTask,Oy(e),N0(e)):o.change=="macroTask"&&(e.hasPendingMacrotasks=o.macroTask))},onHandleError:(i,n,r,o)=>(i.handleError(r,o),e.runOutsideAngular(()=>e.onError.emit(o)),!1)})}function Oy(e){e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&e.callbackScheduled===!0?e.hasPendingMicrotasks=!0:e.hasPendingMicrotasks=!1}function SS(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function DS(e){e._nesting--,N0(e)}var ip=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Tt,this.onMicrotaskEmpty=new Tt,this.onStable=new Tt,this.onError=new Tt}run(t,i,n){return t.apply(i,n)}runGuarded(t,i,n){return t.apply(i,n)}runOutsideAngular(t){return t()}runTask(t,i,n,r){return t.apply(i,n)}};function Iq(e){return N2(e,"__ignore_ng_zone__")}function Sq(e){return N2(e,"__scheduler_tick__")}function N2(e,t){return!Array.isArray(e)||e.length!==1?!1:e[0]?.data?.[t]===!0}function Dq(e="zone.js",t){return e==="noop"?new ip:e==="zone.js"?new Re(t):e}var ri=function(e){return e[e.EarlyRead=0]="EarlyRead",e[e.Write=1]="Write",e[e.MixedReadWrite=2]="MixedReadWrite",e[e.Read=3]="Read",e}(ri||{}),P2={destroy(){}};function P0(e,t){!t&&fD(P0);let i=t?.injector??ne(fn);return i2(i)?(Lo("NgAfterRender"),F2(e,i,!1,t?.phase??ri.MixedReadWrite)):P2}function Bo(e,t){!t&&fD(Bo);let i=t?.injector??ne(fn);return i2(i)?(Lo("NgAfterNextRender"),F2(e,i,!0,t?.phase??ri.MixedReadWrite)):P2}function Tq(e,t){if(e instanceof Function)switch(t){case ri.EarlyRead:return{earlyRead:e};case ri.Write:return{write:e};case ri.MixedReadWrite:return{mixedReadWrite:e};case ri.Read:return{read:e}}return e}function F2(e,t,i,n){let r=Tq(e,n),o=t.get(F0),s=o.handler??=new Py,a=[],u=[],c=()=>{for(let v of u)s.unregister(v);f()},f=t.get(_0).onDestroy(c),p=0,m=(v,b)=>{if(!b)return;let w=i?(...x)=>(p--,p<1&&c(),b(...x)):b,C=xi(t,()=>new Ny(v,a,w));s.register(C),u.push(C),p++};return m(ri.EarlyRead,r.earlyRead),m(ri.Write,r.write),m(ri.MixedReadWrite,r.mixedReadWrite),m(ri.Read,r.read),{destroy:c}}var Ny=class{constructor(t,i,n){this.phase=t,this.pipelinedArgs=i,this.callbackFn=n,this.zone=ne(Re),this.errorHandler=ne(sr,{optional:!0}),ne(el,{optional:!0})?.notify(6)}invoke(){try{let t=this.zone.runOutsideAngular(()=>this.callbackFn.apply(null,this.pipelinedArgs));this.pipelinedArgs.splice(0,this.pipelinedArgs.length,t)}catch(t){this.errorHandler?.handleError(t)}}},Py=class{constructor(){this.executingCallbacks=!1,this.buckets={[ri.EarlyRead]:new Set,[ri.Write]:new Set,[ri.MixedReadWrite]:new Set,[ri.Read]:new Set},this.deferredCallbacks=new Set}register(t){(this.executingCallbacks?this.deferredCallbacks:this.buckets[t.phase]).add(t)}unregister(t){this.buckets[t.phase].delete(t),this.deferredCallbacks.delete(t)}execute(){this.executingCallbacks=!0;for(let t of Object.values(this.buckets))for(let i of t)i.invoke();this.executingCallbacks=!1;for(let t of this.deferredCallbacks)this.buckets[t.phase].add(t);this.deferredCallbacks.clear()}destroy(){for(let t of Object.values(this.buckets))t.clear();this.deferredCallbacks.clear()}},F0=(()=>{let t=class t{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let n=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let r of n)r()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};t.\u0275prov=be({token:t,providedIn:"root",factory:()=>new t});let e=t;return e})();function rp(e,t,i){let n=i?e.styles:null,r=i?e.classes:null,o=0;if(t!==null)for(let s=0;s<t.length;s++){let a=t[s];if(typeof a=="number")o=a;else if(o==1)r=ly(r,a);else if(o==2){let u=a,c=t[++s];n=ly(n,u+": "+c+";")}}i?e.styles=n:e.stylesWithoutHost=n,i?e.classes=r:e.classesWithoutHost=r}var op=class extends tl{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){let i=Ao(t);return new il(i,this.ngModule)}};function TS(e,t){let i=[];for(let n in e){if(!e.hasOwnProperty(n))continue;let r=e[n];if(r===void 0)continue;let o=Array.isArray(r),s=o?r[0]:r,a=o?r[1]:Mo.None;t?i.push({propName:s,templateName:n,isSignal:(a&Mo.SignalBased)!==0}):i.push({propName:s,templateName:n})}return i}function $q(e){let t=e.toLowerCase();return t==="svg"?r8:t==="math"?o8:null}var il=class extends np{get inputs(){let t=this.componentDef,i=t.inputTransforms,n=TS(t.inputs,!0);if(i!==null)for(let r of n)i.hasOwnProperty(r.propName)&&(r.transform=i[r.propName]);return n}get outputs(){return TS(this.componentDef.outputs,!1)}constructor(t,i){super(),this.componentDef=t,this.ngModule=i,this.componentType=t.type,this.selector=F6(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!i}create(t,i,n,r){let o=_t(null);try{r=r||this.ngModule;let s=r instanceof si?r:r?.injector;s&&this.componentDef.getStandaloneInjector!==null&&(s=this.componentDef.getStandaloneInjector(s)||s);let a=s?new yy(t,s):t,u=a.get(nl,null);if(u===null)throw new ke(407,!1);let c=a.get(wq,null),f=a.get(F0,null),p=a.get(el,null),m={rendererFactory:u,sanitizer:c,inlineEffectRunner:null,afterRenderEventManager:f,changeDetectionScheduler:p},v=u.createRenderer(null,this.componentDef),b=this.componentDef.selectors[0][0]||"div",w=n?TW(v,n,this.componentDef.encapsulation,a):r2(v,b,$q(b)),C=512;this.componentDef.signals?C|=4096:this.componentDef.onPush||(C|=16);let x=null;w!==null&&(x=b0(w,a,!0));let y=T0(0,null,null,1,0,null,null,null,null,null,null),I=Mp(null,y,null,C,null,null,m,v,a,null,x);p0(I);let S,T;try{let $=this.componentDef,k,P=null;$.findHostDirectiveDefs?(k=[],P=new Map,$.findHostDirectiveDefs($,k,P),k.push($)):k=[$];let j=kq(I,w),H=Mq(j,w,$,k,I,m,v);T=u0(y,gi),w&&Oq(v,$,w,n),i!==void 0&&Nq(T,this.ngContentSelectors,i),S=Rq(H,$,k,P,I,[Pq]),M0(y,I,null)}finally{m0()}return new Fy(this.componentType,S,al(T,I),I,T)}finally{_t(o)}}},Fy=class extends Ay{constructor(t,i,n,r,o){super(),this.location=n,this._rootLView=r,this._tNode=o,this.previousInputValues=null,this.instance=i,this.hostView=this.changeDetectorRef=new Ks(r,void 0,!1),this.componentType=t}setInput(t,i){let n=this._tNode.inputs,r;if(n!==null&&(r=n[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),i))return;let o=this._rootLView;k0(o[ot],o,r,t,i),this.previousInputValues.set(t,i);let s=Po(this._tNode.index,o);O0(s,1)}}get injector(){return new js(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}};function kq(e,t){let i=e[ot],n=gi;return e[n]=t,ll(i,n,2,"#host",null)}function Mq(e,t,i,n,r,o,s){let a=r[ot];Aq(n,e,t,s);let u=null;t!==null&&(u=b0(t,r[Ya]));let c=o.rendererFactory.createRenderer(t,i),f=16;i.signals?f=4096:i.onPush&&(f=64);let p=Mp(r,v2(i),null,f,r[e.index],e,o,c,null,null,u);return a.firstCreatePass&&$y(a,e,n.length-1),Rp(r,p),r[e.index]=p}function Aq(e,t,i,n){for(let r of e)t.mergedAttrs=dd(t.mergedAttrs,r.hostAttrs);t.mergedAttrs!==null&&(rp(t,t.mergedAttrs,!0),i!==null&&h2(n,i,t))}function Rq(e,t,i,n,r,o){let s=Ln(),a=r[ot],u=Pi(s,r);b2(a,r,s,i,null,n);for(let f=0;f<i.length;f++){let p=s.directiveStart+f,m=Gs(r,a,p,s);Oo(m,r)}y2(a,r,s),u&&Oo(u,r);let c=Gs(r,a,s.directiveStart+s.componentOffset,s);if(e[Oi]=r[Oi]=c,o!==null)for(let f of o)f(c,t);return I0(a,s,r),c}function Oq(e,t,i,n){if(n)fy(e,i,["ng-version","18.1.2"]);else{let{attrs:r,classes:o}=z6(t.selectors[0]);r&&fy(e,i,r),o&&o.length>0&&f2(e,i,o.join(" "))}}function Nq(e,t,i){let n=e.projection=[];for(let r=0;r<t.length;r++){let o=i[r];n.push(o!=null?Array.from(o):null)}}function Pq(){let e=Ln();Sp(ht()[ot],e)}var ai=(()=>{let t=class t{};t.__NG_ELEMENT_ID__=Fq;let e=t;return e})();function Fq(){let e=Ln();return L2(e,ht())}var zq=ai,z2=class extends zq{constructor(t,i,n){super(),this._lContainer=t,this._hostTNode=i,this._hostLView=n}get element(){return al(this._hostTNode,this._hostLView)}get injector(){return new js(this._hostTNode,this._hostLView)}get parentInjector(){let t=g0(this._hostTNode,this._hostLView);if(PD(t)){let i=Kh(t,this._hostLView),n=Gh(t),r=i[ot].data[n+8];return new js(r,i)}else return new js(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){let i=$S(this._lContainer);return i!==null&&i[t]||null}get length(){return this._lContainer.length-mi}createEmbeddedView(t,i,n){let r,o;typeof n=="number"?r=n:n!=null&&(r=n.index,o=n.injector);let s=tp(this._lContainer,t.ssrId),a=t.createEmbeddedViewImpl(i||{},o,s);return this.insertImpl(a,r,Xh(this._hostTNode,s)),a}createComponent(t,i,n,r,o){let s=t&&!e8(t),a;if(s)a=i;else{let b=i||{};a=b.index,n=b.injector,r=b.projectableNodes,o=b.environmentInjector||b.ngModuleRef}let u=s?t:new il(Ao(t)),c=n||this.parentInjector;if(!o&&u.ngModule==null){let w=(s?c:this.parentInjector).get(si,null);w&&(o=w)}let f=Ao(u.componentType??{}),p=tp(this._lContainer,f?.id??null),m=p?.firstChild??null,v=u.create(c,r,m,o);return this.insertImpl(v.hostView,a,Xh(this._hostTNode,p)),v}insert(t,i){return this.insertImpl(t,i,!0)}insertImpl(t,i,n){let r=t._lView;if(l8(r)){let a=this.indexOf(t);if(a!==-1)this.detach(a);else{let u=r[Un],c=new z2(u,u[_i],u[Un]);c.detach(c.indexOf(t))}}let o=this._adjustIndex(i),s=this._lContainer;return R0(s,r,o,n),t.attachToViewContainerRef(),KS(iy(s),o,t),t}move(t,i){return this.insert(t,i)}indexOf(t){let i=$S(this._lContainer);return i!==null?i.indexOf(t):-1}remove(t){let i=this._adjustIndex(t,-1),n=Yh(this._lContainer,i);n&&(Vh(iy(this._lContainer),i),x0(n[ot],n))}detach(t){let i=this._adjustIndex(t,-1),n=Yh(this._lContainer,i);return n&&Vh(iy(this._lContainer),i)!=null?new Ks(n):null}_adjustIndex(t,i=0){return t??this.length+i}};function $S(e){return e[Wh]}function iy(e){return e[Wh]||(e[Wh]=[])}function L2(e,t){let i,n=t[e.index];return lo(n)?i=n:(i=w2(n,t,null,e),t[e.index]=i,Rp(t,i)),Bq(i,t,e,n),new z2(i,e,t)}function Lq(e,t){let i=e[Xt],n=i.createComment(""),r=Pi(t,e),o=C0(i,r);return Jh(i,o,n,_W(i,r),!1),n}var Bq=Uq,jq=()=>!1;function Vq(e,t,i){return jq(e,t,i)}function Uq(e,t,i,n){if(e[Us])return;let r;i.type&8?r=$r(n):r=Lq(t,i),e[Us]=r}var zy=class e{constructor(t){this.queryList=t,this.matches=null}clone(){return new e(this.queryList)}setDirty(){this.queryList.setDirty()}},Ly=class e{constructor(t=[]){this.queries=t}createEmbeddedView(t){let i=t.queries;if(i!==null){let n=t.contentQueries!==null?t.contentQueries[0]:i.length,r=[];for(let o=0;o<n;o++){let s=i.getByIndex(o),a=this.queries[s.indexInDeclarationView];r.push(a.clone())}return new e(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let i=0;i<this.queries.length;i++)L0(t,i).matches!==null&&this.queries[i].setDirty()}},sp=class{constructor(t,i,n=null){this.flags=i,this.read=n,typeof t=="string"?this.predicate=Zq(t):this.predicate=t}},By=class e{constructor(t=[]){this.queries=t}elementStart(t,i){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(t,i)}elementEnd(t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(t)}embeddedTView(t){let i=null;for(let n=0;n<this.length;n++){let r=i!==null?i.length:0,o=this.getByIndex(n).embeddedTView(t,r);o&&(o.indexInDeclarationView=n,i!==null?i.push(o):i=[o])}return i!==null?new e(i):null}template(t,i){for(let n=0;n<this.queries.length;n++)this.queries[n].template(t,i)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}},jy=class e{constructor(t,i=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(t,i){this.isApplyingToNode(i)&&this.matchTNode(t,i)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,i){this.elementStart(t,i)}embeddedTView(t,i){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,i),new e(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let i=this._declarationNodeIndex,n=t.parent;for(;n!==null&&n.type&8&&n.index!==i;)n=n.parent;return i===(n!==null?n.index:-1)}return this._appliesToNextNode}matchTNode(t,i){let n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){let o=n[r];this.matchTNodeWithReadOption(t,i,Hq(i,o)),this.matchTNodeWithReadOption(t,i,Fh(i,t,o,!1,!1))}else n===Hn?i.type&4&&this.matchTNodeWithReadOption(t,i,-1):this.matchTNodeWithReadOption(t,i,Fh(i,t,n,!1,!1))}matchTNodeWithReadOption(t,i,n){if(n!==null){let r=this.metadata.read;if(r!==null)if(r===Je||r===ai||r===Hn&&i.type&4)this.addMatch(i.index,-2);else{let o=Fh(i,t,r,!1,!1);o!==null&&this.addMatch(i.index,o)}else this.addMatch(i.index,n)}}addMatch(t,i){this.matches===null?this.matches=[t,i]:this.matches.push(t,i)}};function Hq(e,t){let i=e.localNames;if(i!==null){for(let n=0;n<i.length;n+=2)if(i[n]===t)return i[n+1]}return null}function Wq(e,t){return e.type&11?al(e,t):e.type&4?Op(e,t):null}function qq(e,t,i,n){return i===-1?Wq(t,e):i===-2?Gq(e,t,n):Gs(e,e[ot],i,t)}function Gq(e,t,i){if(i===Je)return al(t,e);if(i===Hn)return Op(t,e);if(i===ai)return L2(t,e)}function B2(e,t,i,n){let r=t[ro].queries[n];if(r.matches===null){let o=e.data,s=i.matches,a=[];for(let u=0;s!==null&&u<s.length;u+=2){let c=s[u];if(c<0)a.push(null);else{let f=o[c];a.push(qq(t,f,s[u+1],i.metadata.read))}}r.matches=a}return r.matches}function Vy(e,t,i,n){let r=e.queries.getByIndex(i),o=r.matches;if(o!==null){let s=B2(e,t,r,i);for(let a=0;a<o.length;a+=2){let u=o[a];if(u>0)n.push(s[a/2]);else{let c=o[a+1],f=t[-u];for(let p=mi;p<f.length;p++){let m=f[p];m[Vs]===m[Un]&&Vy(m[ot],m,c,n)}if(f[Ja]!==null){let p=f[Ja];for(let m=0;m<p.length;m++){let v=p[m];Vy(v[ot],v,c,n)}}}}}return n}function z0(e,t){return e[ro].queries[t].queryList}function j2(e,t,i){let n=new Qh((i&4)===4);return MW(e,t,n,n.destroy),(t[ro]??=new Ly).queries.push(new zy(n))-1}function Kq(e,t,i){let n=an();return n.firstCreatePass&&(U2(n,new sp(e,t,i),-1),(t&2)===2&&(n.staticViewQueries=!0)),j2(n,ht(),t)}function V2(e,t,i,n){let r=an();if(r.firstCreatePass){let o=Ln();U2(r,new sp(t,i,n),o.index),Qq(r,e),(i&2)===2&&(r.staticContentQueries=!0)}return j2(r,ht(),i)}function Zq(e){return e.split(",").map(t=>t.trim())}function U2(e,t,i){e.queries===null&&(e.queries=new By),e.queries.track(new jy(t,i))}function Qq(e,t){let i=e.contentQueries||(e.contentQueries=[]),n=i.length?i[i.length-1]:-1;t!==n&&i.push(e.queries.length-1,t)}function L0(e,t){return e.queries.getByIndex(t)}function H2(e,t){let i=e[ot],n=L0(i,t);return n.crossesNgTemplate?Vy(i,e,t,[]):B2(i,e,n,t)}function W2(e){return typeof e=="function"&&e[Xi]!==void 0}function Js(e,t){Lo("NgSignals");let i=EI(e),n=i[Xi];return t?.equal&&(n.equal=t.equal),i.set=r=>Mb(n,r),i.update=r=>II(n,r),i.asReadonly=Yq.bind(i),i}function Yq(){let e=this[Xi];if(e.readonlyFn===void 0){let t=()=>this();t[Xi]=e,e.readonlyFn=t}return e.readonlyFn}function q2(e){return W2(e)&&typeof e.set=="function"}function G2(e,t){let i,n=kb(()=>{i._dirtyCounter();let r=t5(i,e);if(t&&r===void 0)throw new ke(-951,!1);return r});return i=n[Xi],i._dirtyCounter=Js(0),i._flatValue=void 0,n}function Jq(){return G2(!0,!1)}function Xq(){return G2(!0,!0)}function e5(e,t){let i=e[Xi];i._lView=ht(),i._queryIndex=t,i._queryList=z0(i._lView,t),i._queryList.onDirty(()=>i._dirtyCounter.update(n=>n+1))}function t5(e,t){let i=e._lView,n=e._queryIndex;if(i===void 0||n===void 0||i[Ve]&4)return t?void 0:ii;let r=z0(i,n),o=H2(i,n);return r.reset(o,GD),t?r.first:r._changesDetected||e._flatValue===void 0?e._flatValue=r.toArray():e._flatValue}function kS(e,t){return Jq()}function n5(e,t){return Xq()}var K2=(kS.required=n5,kS);function i5(e){let t=[],i=new Map;function n(r){let o=i.get(r);if(!o){let s=e(r);i.set(r,o=s.then(a5))}return o}return ap.forEach((r,o)=>{let s=[];r.templateUrl&&s.push(n(r.templateUrl).then(c=>{r.template=c}));let a=typeof r.styles=="string"?[r.styles]:r.styles||[];if(r.styles=a,r.styleUrl&&r.styleUrls?.length)throw new Error("@Component cannot define both `styleUrl` and `styleUrls`. Use `styleUrl` if the component has one stylesheet, or `styleUrls` if it has multiple");if(r.styleUrls?.length){let c=r.styles.length,f=r.styleUrls;r.styleUrls.forEach((p,m)=>{a.push(""),s.push(n(p).then(v=>{a[c+m]=v,f.splice(f.indexOf(p),1),f.length==0&&(r.styleUrls=void 0)}))})}else r.styleUrl&&s.push(n(r.styleUrl).then(c=>{a.push(c),r.styleUrl=void 0}));let u=Promise.all(s).then(()=>l5(o));t.push(u)}),o5(),Promise.all(t).then(()=>{})}var ap=new Map,r5=new Set;function o5(){let e=ap;return ap=new Map,e}function s5(){return ap.size===0}function a5(e){return typeof e=="string"?e:e.text()}function l5(e){r5.delete(e)}function u5(e){return Object.getPrototypeOf(e.prototype).constructor}function Pt(e){let t=u5(e.type),i=!0,n=[e];for(;t;){let r;if(Ro(e))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new ke(903,!1);r=t.\u0275dir}if(r){if(i){n.push(r);let s=e;s.inputs=Mh(e.inputs),s.inputTransforms=Mh(e.inputTransforms),s.declaredInputs=Mh(e.declaredInputs),s.outputs=Mh(e.outputs);let a=r.hostBindings;a&&p5(e,a);let u=r.viewQuery,c=r.contentQueries;if(u&&f5(e,u),c&&h5(e,c),c5(e,r),n6(e.outputs,r.outputs),Ro(r)&&r.data.animation){let f=e.data;f.animation=(f.animation||[]).concat(r.data.animation)}}let o=r.features;if(o)for(let s=0;s<o.length;s++){let a=o[s];a&&a.ngInherit&&a(e),a===Pt&&(i=!1)}}t=Object.getPrototypeOf(t)}d5(n)}function c5(e,t){for(let i in t.inputs){if(!t.inputs.hasOwnProperty(i)||e.inputs.hasOwnProperty(i))continue;let n=t.inputs[i];if(n!==void 0&&(e.inputs[i]=n,e.declaredInputs[i]=t.declaredInputs[i],t.inputTransforms!==null)){let r=Array.isArray(n)?n[0]:n;if(!t.inputTransforms.hasOwnProperty(r))continue;e.inputTransforms??={},e.inputTransforms[r]=t.inputTransforms[r]}}}function d5(e){let t=0,i=null;for(let n=e.length-1;n>=0;n--){let r=e[n];r.hostVars=t+=r.hostVars,r.hostAttrs=dd(r.hostAttrs,i=dd(i,r.hostAttrs))}}function Mh(e){return e===Ka?{}:e===ii?[]:e}function f5(e,t){let i=e.viewQuery;i?e.viewQuery=(n,r)=>{t(n,r),i(n,r)}:e.viewQuery=t}function h5(e,t){let i=e.contentQueries;i?e.contentQueries=(n,r,o)=>{t(n,r,o),i(n,r,o)}:e.contentQueries=t}function p5(e,t){let i=e.hostBindings;i?e.hostBindings=(n,r)=>{t(n,r),i(n,r)}:e.hostBindings=t}function gn(e){let t=e.inputConfig,i={};for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];Array.isArray(r)&&r[3]&&(i[n]=r[3])}e.inputTransforms=i}var No=class{},gd=class{};var lp=class extends No{constructor(t,i,n){super(),this._parent=i,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new op(this);let r=rD(t);this._bootstrapComponents=n2(r.bootstrap),this._r3Injector=WD(t,i,[{provide:No,useValue:this},{provide:tl,useValue:this.componentFactoryResolver},...n],oi(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){let t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}},up=class extends gd{constructor(t){super(),this.moduleType=t}create(t){return new lp(this.moduleType,t,[])}};function m5(e,t,i){return new lp(e,t,i)}var Uy=class extends No{constructor(t){super(),this.componentFactoryResolver=new op(this),this.instance=null;let i=new fd([...t.providers,{provide:No,useValue:this},{provide:tl,useValue:this.componentFactoryResolver}],t.parent||a0(),t.debugName,new Set(["environment"]));this.injector=i,t.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}};function Np(e,t,i=null){return new Uy({providers:e,parent:t,debugName:i,runEnvironmentInitializers:!0}).injector}function Z2(e){return _5(e)?Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e:!1}function g5(e,t){if(Array.isArray(e))for(let i=0;i<e.length;i++)t(e[i]);else{let i=e[Symbol.iterator](),n;for(;!(n=i.next()).done;)t(n.value)}}function _5(e){return e!==null&&(typeof e=="function"||typeof e=="object")}function jo(e,t,i){let n=e[t];return Object.is(n,i)?!1:(e[t]=i,!0)}function v5(e){return(e.flags&32)===32}function b5(e,t,i,n,r,o,s,a,u){let c=t.consts,f=ll(t,e,4,s||null,a||null);$0(t,i,f,Xa(c,u)),Sp(t,f);let p=f.tView=T0(2,f,n,r,o,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c,null);return t.queries!==null&&(t.queries.template(t,f),p.queries=t.queries.embeddedTView(f)),f}function Q2(e,t,i,n,r,o,s,a,u,c){let f=i+gi,p=t.firstCreatePass?b5(f,t,e,n,r,o,s,a,u):t.data[f];Qs(p,!1);let m=y5(t,e,p,i);Ep()&&Tp(t,e,m,p),Oo(m,e);let v=w2(m,e,m,p);return e[f]=v,Rp(e,v),Vq(v,p,e),wp(p)&&S0(t,e,p),u!=null&&D0(e,p,c),p}function Ze(e,t,i,n,r,o,s,a){let u=ht(),c=an(),f=Xa(c.consts,o);return Q2(u,c,e,t,i,n,r,f,s,a),Ze}var y5=w5;function w5(e,t,i,n){return Ip(!0),t[Xt].createComment("")}function Gn(e,t,i,n){let r=ht(),o=sl();if(jo(r,o,t)){let s=an(),a=yd();qW(a,r,e,t,i,n)}return Gn}function Y2(e,t,i,n){return jo(e,sl(),i)?t+e0(i)+n:kr}function Ah(e,t){return e<<17|t<<2}function Zs(e){return e>>17&32767}function x5(e){return(e&2)==2}function C5(e,t){return e&131071|t<<17}function Hy(e){return e|2}function rl(e){return(e&131068)>>2}function ry(e,t){return e&-131069|t<<2}function E5(e){return(e&1)===1}function Wy(e){return e|1}function I5(e,t,i,n,r,o){let s=o?t.classBindings:t.styleBindings,a=Zs(s),u=rl(s);e[n]=i;let c=!1,f;if(Array.isArray(i)){let p=i;f=p[1],(f===null||bd(p,f)>0)&&(c=!0)}else f=i;if(r)if(u!==0){let m=Zs(e[a+1]);e[n+1]=Ah(m,a),m!==0&&(e[m+1]=ry(e[m+1],n)),e[a+1]=C5(e[a+1],n)}else e[n+1]=Ah(a,0),a!==0&&(e[a+1]=ry(e[a+1],n)),a=n;else e[n+1]=Ah(u,0),a===0?a=n:e[u+1]=ry(e[u+1],n),u=n;c&&(e[n+1]=Hy(e[n+1])),MS(e,f,n,!0),MS(e,f,n,!1),S5(t,f,e,n,o),s=Ah(a,u),o?t.classBindings=s:t.styleBindings=s}function S5(e,t,i,n,r){let o=r?e.residualClasses:e.residualStyles;o!=null&&typeof t=="string"&&bd(o,t)>=0&&(i[n+1]=Wy(i[n+1]))}function MS(e,t,i,n){let r=e[i+1],o=t===null,s=n?Zs(r):rl(r),a=!1;for(;s!==0&&(a===!1||o);){let u=e[s],c=e[s+1];D5(u,t)&&(a=!0,e[s+1]=n?Wy(c):Hy(c)),s=n?Zs(c):rl(c)}a&&(e[i+1]=n?Hy(r):Wy(r))}function D5(e,t){return e===null||t==null||(Array.isArray(e)?e[1]:e)===t?!0:Array.isArray(e)&&typeof t=="string"?bd(e,t)>=0:!1}var ir={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function T5(e){return e.substring(ir.key,ir.keyEnd)}function $5(e){return k5(e),J2(e,X2(e,0,ir.textEnd))}function J2(e,t){let i=ir.textEnd;return i===t?-1:(t=ir.keyEnd=M5(e,ir.key=t,i),X2(e,t,i))}function k5(e){ir.key=0,ir.keyEnd=0,ir.value=0,ir.valueEnd=0,ir.textEnd=e.length}function X2(e,t,i){for(;t<i&&e.charCodeAt(t)<=32;)t++;return t}function M5(e,t,i){for(;t<i&&e.charCodeAt(t)>32;)t++;return t}function Be(e,t,i){let n=ht(),r=sl();if(jo(n,r,t)){let o=an(),s=yd();Ap(o,s,n,e,t,n[Xt],i,!1)}return Be}function qy(e,t,i,n,r){let o=t.inputs,s=r?"class":"style";k0(e,i,o[s],s,n)}function Nt(e,t){return R5(e,t,null,!0),Nt}function Cd(e){O5(B5,A5,e,!0)}function A5(e,t){for(let i=$5(t);i>=0;i=J2(t,i))r0(e,T5(t),!0)}function R5(e,t,i,n){let r=ht(),o=an(),s=TD(2);if(o.firstUpdatePass&&tT(o,e,s,n),t!==kr&&jo(r,s,t)){let a=o.data[Ys()];nT(o,a,r,r[Xt],e,r[s+1]=V5(t,i),n,s)}}function O5(e,t,i,n){let r=an(),o=TD(2);r.firstUpdatePass&&tT(r,null,o,n);let s=ht();if(i!==kr&&jo(s,o,i)){let a=r.data[Ys()];if(iT(a,n)&&!eT(r,o)){let u=n?a.classesWithoutHost:a.stylesWithoutHost;u!==null&&(i=ly(u,i||"")),qy(r,a,s,i,n)}else j5(r,a,s,s[Xt],s[o+1],s[o+1]=L5(e,t,i),n,o)}}function eT(e,t){return t>=e.expandoStartIndex}function tT(e,t,i,n){let r=e.data;if(r[i+1]===null){let o=r[Ys()],s=eT(e,i);iT(o,n)&&t===null&&!s&&(t=!1),t=N5(r,o,t,n),I5(r,o,t,i,s,n)}}function N5(e,t,i,n){let r=x8(e),o=n?t.residualClasses:t.residualStyles;if(r===null)(n?t.classBindings:t.styleBindings)===0&&(i=oy(null,e,t,i,n),i=_d(i,t.attrs,n),o=null);else{let s=t.directiveStylingLast;if(s===-1||e[s]!==r)if(i=oy(r,e,t,i,n),o===null){let u=P5(e,t,n);u!==void 0&&Array.isArray(u)&&(u=oy(null,e,t,u[1],n),u=_d(u,t.attrs,n),F5(e,t,n,u))}else o=z5(e,t,n)}return o!==void 0&&(n?t.residualClasses=o:t.residualStyles=o),i}function P5(e,t,i){let n=i?t.classBindings:t.styleBindings;if(rl(n)!==0)return e[Zs(n)]}function F5(e,t,i,n){let r=i?t.classBindings:t.styleBindings;e[Zs(r)]=n}function z5(e,t,i){let n,r=t.directiveEnd;for(let o=1+t.directiveStylingLast;o<r;o++){let s=e[o].hostAttrs;n=_d(n,s,i)}return _d(n,t.attrs,i)}function oy(e,t,i,n,r){let o=null,s=i.directiveEnd,a=i.directiveStylingLast;for(a===-1?a=i.directiveStart:a++;a<s&&(o=t[a],n=_d(n,o.hostAttrs,r),o!==e);)a++;return e!==null&&(i.directiveStylingLast=a),n}function _d(e,t,i){let n=i?1:2,r=-1;if(t!==null)for(let o=0;o<t.length;o++){let s=t[o];typeof s=="number"?r=s:r===n&&(Array.isArray(e)||(e=e===void 0?[]:["",e]),r0(e,s,i?!0:t[++o]))}return e===void 0?null:e}function L5(e,t,i){if(i==null||i==="")return ii;let n=[],r=Dp(i);if(Array.isArray(r))for(let o=0;o<r.length;o++)e(n,r[o],!0);else if(typeof r=="object")for(let o in r)r.hasOwnProperty(o)&&e(n,o,r[o]);else typeof r=="string"&&t(n,r);return n}function B5(e,t,i){let n=String(t);n!==""&&!n.includes(" ")&&r0(e,n,i)}function j5(e,t,i,n,r,o,s,a){r===kr&&(r=ii);let u=0,c=0,f=0<r.length?r[0]:null,p=0<o.length?o[0]:null;for(;f!==null||p!==null;){let m=u<r.length?r[u+1]:void 0,v=c<o.length?o[c+1]:void 0,b=null,w;f===p?(u+=2,c+=2,m!==v&&(b=p,w=v)):p===null||f!==null&&f<p?(u+=2,b=f):(c+=2,b=p,w=v),b!==null&&nT(e,t,i,n,b,w,s,a),f=u<r.length?r[u]:null,p=c<o.length?o[c]:null}}function nT(e,t,i,n,r,o,s,a){if(!(t.type&3))return;let u=e.data,c=u[a+1],f=E5(c)?AS(u,t,i,r,rl(c),s):void 0;if(!cp(f)){cp(o)||x5(c)&&(o=AS(u,null,i,r,a,s));let p=bD(Ys(),i);CW(n,s,p,r,o)}}function AS(e,t,i,n,r,o){let s=t===null,a;for(;r>0;){let u=e[r],c=Array.isArray(u),f=c?u[1]:u,p=f===null,m=i[r+1];m===kr&&(m=p?ii:void 0);let v=p?Zb(m,n):f===n?m:void 0;if(c&&!cp(v)&&(v=Zb(u,n)),cp(v)&&(a=v,s))return a;let b=e[r+1];r=s?Zs(b):rl(b)}if(t!==null){let u=o?t.residualClasses:t.residualStyles;u!=null&&(a=Zb(u,n))}return a}function cp(e){return e!==void 0}function V5(e,t){return e==null||e===""||(typeof t=="string"?e=e+t:typeof e=="object"&&(e=oi(Dp(e)))),e}function iT(e,t){return(e.flags&(t?8:16))!==0}function hn(e,t){Lo("NgControlFlow");let i=ht(),n=sl(),r=i[n]!==kr?i[n]:-1,o=r!==-1?RS(i,gi+r):void 0,s=0;if(jo(i,n,e)){let a=_t(null);try{if(o!==void 0&&tq(o,s),e!==-1){let u=gi+e,c=RS(i,u),f=U5(i[ot],u),p=tp(c,f.tView.ssrId),m=A0(i,f,t,{dehydratedView:p});R0(c,m,s,Xh(f,p))}}finally{_t(a)}}else if(o!==void 0){let a=eq(o,s);a!==void 0&&(a[Oi]=t)}}function RS(e,t){return e[t]}function U5(e,t){return u0(e,t)}function H5(e,t,i,n,r,o){let s=t.consts,a=Xa(s,r),u=ll(t,e,2,n,a);return $0(t,i,u,Xa(s,o)),u.attrs!==null&&rp(u,u.attrs,!1),u.mergedAttrs!==null&&rp(u,u.mergedAttrs,!0),t.queries!==null&&t.queries.elementStart(t,u),u}function N(e,t,i,n){let r=ht(),o=an(),s=gi+e,a=r[Xt],u=o.firstCreatePass?H5(s,o,r,t,i,n):o.data[s],c=W5(o,r,u,a,t,e);r[s]=c;let f=wp(u);return Qs(u,!0),h2(a,c,u),!v5(u)&&Ep()&&Tp(o,r,c,u),d8()===0&&Oo(c,r),f8(),f&&(S0(o,r,u),I0(o,u,r)),n!==null&&D0(r,u),N}function O(){let e=Ln();d0()?f0():(e=e.parent,Qs(e,!1));let t=e;p8(t)&&m8(),h8();let i=an();return i.firstCreatePass&&(Sp(i,e),l0(e)&&i.queries.elementEnd(e)),t.classesWithoutHost!=null&&$8(t)&&qy(i,t,ht(),t.classesWithoutHost,!0),t.stylesWithoutHost!=null&&k8(t)&&qy(i,t,ht(),t.stylesWithoutHost,!1),O}function G(e,t,i,n){return N(e,t,i,n),O(),G}var W5=(e,t,i,n,r,o)=>(Ip(!0),r2(n,r,I8()));function q5(e,t,i,n,r){let o=t.consts,s=Xa(o,n),a=ll(t,e,8,"ng-container",s);s!==null&&rp(a,s,!0);let u=Xa(o,r);return $0(t,i,a,u),t.queries!==null&&t.queries.elementStart(t,a),a}function Mr(e,t,i){let n=ht(),r=an(),o=e+gi,s=r.firstCreatePass?q5(o,r,n,t,i):r.data[o];Qs(s,!0);let a=G5(r,n,s,e);return n[o]=a,Ep()&&Tp(r,n,a,s),Oo(a,n),wp(s)&&(S0(r,n,s),I0(r,s,n)),i!=null&&D0(n,s),Mr}function Ar(){let e=Ln(),t=an();return d0()?f0():(e=e.parent,Qs(e,!1)),t.firstCreatePass&&(Sp(t,e),l0(e)&&t.queries.elementEnd(e)),Ar}function li(e,t,i){return Mr(e,t,i),Ar(),li}var G5=(e,t,i,n)=>(Ip(!0),lW(t[Xt],""));function qt(){return ht()}function cl(e,t,i){let n=ht(),r=sl();if(jo(n,r,t)){let o=an(),s=yd();Ap(o,s,n,e,t,n[Xt],i,!0)}return cl}var dp="en-US";var K5=dp;function Z5(e){typeof e=="string"&&(K5=e.toLowerCase().replace(/_/g,"-"))}var Q5=(e,t,i)=>{};function Ce(e,t,i,n){let r=ht(),o=an(),s=Ln();return rT(o,r,r[Xt],s,e,t,n),Ce}function Y5(e,t,i,n){let r=e.cleanup;if(r!=null)for(let o=0;o<r.length-1;o+=2){let s=r[o];if(s===i&&r[o+1]===n){let a=t[Hh],u=r[o+2];return a.length>u?a[u]:null}typeof s=="string"&&(o+=2)}return null}function rT(e,t,i,n,r,o,s){let a=wp(n),c=e.firstCreatePass&&E2(e),f=t[Oi],p=C2(t),m=!0;if(n.type&3||s){let w=Pi(n,t),C=s?s(w):w,x=p.length,y=s?S=>s($r(S[n.index])):n.index,I=null;if(!s&&a&&(I=Y5(e,t,r,n.index)),I!==null){let S=I.__ngLastListenerFn__||I;S.__ngNextListenerFn__=o,I.__ngLastListenerFn__=o,m=!1}else{o=NS(n,t,f,o),Q5(w,r,o);let S=i.listen(C,r,o);p.push(o,S),c&&c.push(r,y,x,x+1)}}else o=NS(n,t,f,o);let v=n.outputs,b;if(m&&v!==null&&(b=v[r])){let w=b.length;if(w)for(let C=0;C<w;C+=2){let x=b[C],y=b[C+1],T=t[x][y].subscribe(o),$=p.length;p.push(o,T),c&&c.push(r,n.index,$,-($+1))}}}function OS(e,t,i,n){let r=_t(null);try{return Sr(6,t,i),i(n)!==!1}catch(o){return I2(e,o),!1}finally{Sr(7,t,i),_t(r)}}function NS(e,t,i,n){return function r(o){if(o===Function)return n;let s=e.componentOffset>-1?Po(e.index,t):t;O0(s,5);let a=OS(t,i,n,o),u=r.__ngNextListenerFn__;for(;u;)a=OS(t,i,u,o)&&a,u=u.__ngNextListenerFn__;return a}}function je(e=1){return E8(e)}function J5(e,t){let i=null,n=A6(e);for(let r=0;r<t.length;r++){let o=t[r];if(o==="*"){i=r;continue}if(n===null?eD(e,o,!0):N6(n,o))return r}return i}function Bn(e){let t=ht()[Ni][_i];if(!t.projection){let i=e?e.length:1,n=t.projection=C6(i,null),r=n.slice(),o=t.child;for(;o!==null;){if(o.type!==128){let s=e?J5(o,e):0;s!==null&&(r[s]?r[s].projectionNext=o:n[s]=o,r[s]=o)}o=o.next}}}function Dt(e,t=0,i,n,r,o){let s=ht(),a=an(),u=n?e+1:null;u!==null&&Q2(s,a,u,n,r,o,null,i);let c=ll(a,gi+e,16,null,i||null);c.projection===null&&(c.projection=t),f0();let p=!s[hd]||ID();s[Ni][_i].projection[c.projection]===null&&u!==null?X5(s,a,u):p&&(c.flags&32)!==32&&wW(a,s,c)}function X5(e,t,i){let n=gi+i,r=t.data[n],o=e[n],s=tp(o,r.tView.ssrId),a=A0(e,r,void 0,{dehydratedView:s});R0(o,a,0,Xh(r,s))}function Ed(e,t,i){return oT(e,"",t,"",i),Ed}function oT(e,t,i,n,r){let o=ht(),s=Y2(o,t,i,n);if(s!==kr){let a=an(),u=yd();Ap(a,u,o,e,s,o[Xt],r,!1)}return oT}function _n(e,t,i,n){V2(e,t,i,n)}function Tn(e,t,i){Kq(e,t,i)}function vt(e){let t=ht(),i=an(),n=h0();Cp(n+1);let r=L0(i,n);if(e.dirty&&a8(t)===((r.metadata.flags&2)===2)){if(r.matches===null)e.reset([]);else{let o=H2(t,n);e.reset(o,GD),e.notifyOnChanges()}return!0}return!1}function bt(){return z0(ht(),h0())}function sT(e,t,i,n,r){e5(t,V2(e,i,n,r))}function aT(e=1){Cp(h0()+e)}function B0(e){let t=_8();return s8(t,gi+e)}function K(e,t=""){let i=ht(),n=an(),r=e+gi,o=n.firstCreatePass?ll(n,r,1,t,null):n.data[r],s=eG(n,i,o,t,e);i[r]=s,Ep()&&Tp(n,i,s,o),Qs(o,!1)}var eG=(e,t,i,n,r)=>(Ip(!0),sW(t[Xt],n));function fe(e){return dt("",e,""),fe}function dt(e,t,i){let n=ht(),r=Y2(n,e,t,i);return r!==kr&&QW(n,Ys(),r),dt}function dl(e,t,i){q2(t)&&(t=t());let n=ht(),r=sl();if(jo(n,r,t)){let o=an(),s=yd();Ap(o,s,n,e,t,n[Xt],i,!1)}return dl}function Id(e,t){let i=q2(e);return i&&e.set(t),i}function fl(e,t){let i=ht(),n=an(),r=Ln();return rT(n,i,i[Xt],r,e,t),fl}function tG(e,t,i){let n=an();if(n.firstCreatePass){let r=Ro(e);Gy(i,n.data,n.blueprint,r,!0),Gy(t,n.data,n.blueprint,r,!1)}}function Gy(e,t,i,n,r){if(e=ni(e),Array.isArray(e))for(let o=0;o<e.length;o++)Gy(e[o],t,i,n,r);else{let o=an(),s=ht(),a=Ln(),u=Qa(e)?e:ni(e.provide),c=cD(e),f=a.providerIndexes&1048575,p=a.directiveStart,m=a.providerIndexes>>20;if(Qa(e)||!e.multi){let v=new qs(c,r,V),b=ay(u,t,r?f:f+m,p);b===-1?(xy(Zh(a,s),o,u),sy(o,e,t.length),t.push(u),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),i.push(v),s.push(v)):(i[b]=v,s[b]=v)}else{let v=ay(u,t,f+m,p),b=ay(u,t,f,f+m),w=v>=0&&i[v],C=b>=0&&i[b];if(r&&!C||!r&&!w){xy(Zh(a,s),o,u);let x=rG(r?iG:nG,i.length,r,n,c);!r&&C&&(i[b].providerFactory=x),sy(o,e,t.length,0),t.push(u),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),i.push(x),s.push(x)}else{let x=lT(i[r?b:v],c,!r&&n);sy(o,e,v>-1?v:b,x)}!r&&n&&C&&i[b].componentProviders++}}}function sy(e,t,i,n){let r=Qa(t),o=q6(t);if(r||o){let u=(o?ni(t.useClass):t).prototype.ngOnDestroy;if(u){let c=e.destroyHooks||(e.destroyHooks=[]);if(!r&&t.multi){let f=c.indexOf(i);f===-1?c.push(i,[n,u]):c[f+1].push(n,u)}else c.push(i,u)}}}function lT(e,t,i){return i&&e.componentProviders++,e.multi.push(t)-1}function ay(e,t,i,n){for(let r=i;r<n;r++)if(t[r]===e)return r;return-1}function nG(e,t,i,n){return Ky(this.multi,[])}function iG(e,t,i,n){let r=this.multi,o;if(this.providerFactory){let s=this.providerFactory.componentProviders,a=Gs(i,i[ot],this.providerFactory.index,n);o=a.slice(0,s),Ky(r,o);for(let u=s;u<a.length;u++)o.push(a[u])}else o=[],Ky(r,o);return o}function Ky(e,t){for(let i=0;i<e.length;i++){let n=e[i];t.push(n())}return t}function rG(e,t,i,n,r){let o=new qs(e,i,V);return o.multi=[],o.index=t,o.componentProviders=0,lT(o,r,n&&!i),o}function Gt(e,t=[]){return i=>{i.providersResolver=(n,r)=>tG(n,r?r(e):e,t)}}var oG=(()=>{let t=class t{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n)){let r=aD(!1,n.type),o=r.length>0?Np([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n,o)}return this.cachedInjectors.get(n)}ngOnDestroy(){try{for(let n of this.cachedInjectors.values())n!==null&&n.destroy()}finally{this.cachedInjectors.clear()}}};t.\u0275prov=be({token:t,providedIn:"environment",factory:()=>new t(me(si))});let e=t;return e})();function nn(e){Lo("NgStandalone"),e.getStandaloneInjector=t=>t.get(oG).getOrCreateStandaloneInjector(e)}function uT(e,t){return Op(e,t)}var Rh=null;function sG(e){Rh!==null&&(e.defaultEncapsulation!==Rh.defaultEncapsulation||e.preserveWhitespaces!==Rh.preserveWhitespaces)||(Rh=e)}var Pp=(()=>{let t=class t{log(n){console.log(n)}warn(n){console.warn(n)}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"platform"});let e=t;return e})();var j0=new _e(""),Sd=new _e(""),Fp=(()=>{let t=class t{constructor(n,r,o){this._ngZone=n,this.registry=r,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,V0||(aG(o),o.addToWindow(r)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Re.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}isStable(){return this._isZoneStable&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;this._callbacks.length!==0;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb()}});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>r.updateCb&&r.updateCb(n)?(clearTimeout(r.timeoutId),!1):!0)}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,o){let s=-1;r&&r>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(a=>a.timeoutId!==s),n()},r)),this._callbacks.push({doneCb:n,timeoutId:s,updateCb:o})}whenStable(n,r,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,o),this._runCallbacksIfReady()}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,r,o){return[]}};t.\u0275fac=function(r){return new(r||t)(me(Re),me(zp),me(Sd))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})(),zp=(()=>{let t=class t{constructor(){this._applications=new Map}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return V0?.findTestabilityInTree(this,n,r)??null}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"platform"});let e=t;return e})();function aG(e){V0=e}var V0;function Xs(e){return!!e&&typeof e.then=="function"}function cT(e){return!!e&&typeof e.subscribe=="function"}var Lp=new _e(""),dT=(()=>{let t=class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,r)=>{this.resolve=n,this.reject=r}),this.appInits=ne(Lp,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let n=[];for(let o of this.appInits){let s=o();if(Xs(s))n.push(s);else if(cT(s)){let a=new Promise((u,c)=>{s.subscribe({complete:u,error:c})});n.push(a)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{r()}).catch(o=>{this.reject(o)}),n.length===0&&r(),this.initialized=!0}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),Bp=new _e("");function lG(){CI(()=>{throw new ke(600,!1)})}function uG(e){return e.isBoundToModule}var cG=10;function dG(e,t,i){try{let n=i();return Xs(n)?n.catch(r=>{throw t.runOutsideAngular(()=>e.handleError(r)),r}):n}catch(n){throw t.runOutsideAngular(()=>e.handleError(n)),n}}function fT(e,t){return Array.isArray(t)?t.reduce(fT,e):ie(ie({},e),t)}var Vo=(()=>{let t=class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=ne(qD),this.afterRenderEffectManager=ne(F0),this.zonelessEnabled=ne(A2),this.externalTestViews=new Set,this.beforeRender=new lt,this.afterTick=new lt,this.componentTypes=[],this.components=[],this.isStable=ne(zo).hasPendingTasks.pipe(We(n=>!n)),this._injector=ne(si)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,r){let o=n instanceof np;if(!this._injector.get(dT).done){let v=!o&&iD(n),b=!1;throw new ke(405,b)}let a;o?a=n:a=this._injector.get(tl).resolveComponentFactory(n),this.componentTypes.push(a.componentType);let u=uG(a)?void 0:this._injector.get(No),c=r||a.selector,f=a.create(fn.NULL,[],c,u),p=f.location.nativeElement,m=f.injector.get(j0,null);return m?.registerApplication(p),f.onDestroy(()=>{this.detachView(f.hostView),Lh(this.components,f),m?.unregisterApplication(p)}),this._loadComponent(f),f}tick(){this._tick(!0)}_tick(n){if(this._runningTick)throw new ke(101,!1);let r=_t(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(n)}catch(o){this.internalErrorHandler(o)}finally{this._runningTick=!1,_t(r),this.afterTick.next()}}detectChangesInAttachedViews(n){let r=null;this._injector.destroyed||(r=this._injector.get(nl,null,{optional:!0}));let o=0,s=this.afterRenderEffectManager;for(;o<cG;){let a=o===0;if(n||!a){this.beforeRender.next(a);for(let{_lView:u,notifyErrorHandler:c}of this._views)fG(u,c,a,this.zonelessEnabled)}else r?.begin?.(),r?.end?.();if(o++,s.executeInternalCallbacks(),!this.allViews.some(({_lView:u})=>md(u))&&(s.execute(),!this.allViews.some(({_lView:u})=>md(u))))break}}attachView(n){let r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){let r=n;Lh(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);let r=this._injector.get(Bp,[]);[...this._bootstrapListeners,...r].forEach(o=>o(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>Lh(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new ke(406,!1);let n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function Lh(e,t){let i=e.indexOf(t);i>-1&&e.splice(i,1)}function fG(e,t,i,n){if(!i&&!md(e))return;T2(e,t,i&&!n?0:1)}var Zy=class{constructor(t,i){this.ngModuleFactory=t,this.componentFactories=i}},jp=(()=>{let t=class t{compileModuleSync(n){return new up(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){let r=this.compileModuleSync(n),o=rD(n),s=n2(o.declarations).reduce((a,u)=>{let c=Ao(u);return c&&a.push(new il(c)),a},[]);return new Zy(r,s)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),hG=new _e("");function pG(e,t,i){let n=new up(i);return Promise.resolve(n)}function PS(e){for(let t=e.length-1;t>=0;t--)if(e[t]!==void 0)return e[t]}var mG=(()=>{let t=class t{constructor(){this.zone=ne(Re),this.changeDetectionScheduler=ne(el),this.applicationRef=ne(Vo)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function gG({ngZoneFactory:e,ignoreChangesOutsideZone:t}){return e??=()=>new Re(hT()),[{provide:Re,useFactory:e},{provide:Za,multi:!0,useFactory:()=>{let i=ne(mG,{optional:!0});return()=>i.initialize()}},{provide:Za,multi:!0,useFactory:()=>{let i=ne(vG);return()=>{i.initialize()}}},{provide:qD,useFactory:_G},t===!0?{provide:R2,useValue:!0}:[]]}function _G(){let e=ne(Re),t=ne(sr);return i=>e.runOutsideAngular(()=>t.handleError(i))}function hT(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}var vG=(()=>{let t=class t{constructor(){this.subscription=new Wt,this.initialized=!1,this.zone=ne(Re),this.pendingTasks=ne(zo)}initialize(){if(this.initialized)return;this.initialized=!0;let n=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(n=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Re.assertNotInAngularZone(),queueMicrotask(()=>{n!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(n),n=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Re.assertInAngularZone(),n??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var bG=(()=>{let t=class t{constructor(){this.appRef=ne(Vo),this.taskService=ne(zo),this.ngZone=ne(Re),this.zonelessEnabled=ne(A2),this.disableScheduling=ne(R2,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new Wt,this.cancelScheduledCallback=null,this.shouldRefreshViews=!1,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof ip||!this.zoneIsDefined)}notify(n){if(!this.zonelessEnabled&&n===5)return;switch(n){case 3:case 2:case 0:case 4:case 5:case 1:{this.shouldRefreshViews=!0;break}case 8:case 7:case 6:case 9:default:}if(!this.shouldScheduleTick())return;let r=this.useMicrotaskScheduler?ES:O2;this.pendingRenderTaskId=this.taskService.add(),this.zoneIsDefined?Zone.root.run(()=>{this.cancelScheduledCallback=r(()=>{this.tick(this.shouldRefreshViews)})}):this.cancelScheduledCallback=r(()=>{this.tick(this.shouldRefreshViews)})}shouldScheduleTick(){return!(this.disableScheduling||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Re.isInAngularZone())}tick(n){if(this.runningTick||this.appRef.destroyed)return;let r=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick(n)},void 0,this.schedulerTickApplyArgs)}catch(o){throw this.taskService.remove(r),o}finally{this.cleanup()}this.useMicrotaskScheduler=!0,ES(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(r)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.shouldRefreshViews=!1,this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let n=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(n)}}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function yG(){return typeof $localize<"u"&&$localize.locale||dp}var Vp=new _e("",{providedIn:"root",factory:()=>ne(Vp,ut.Optional|ut.SkipSelf)||yG()});var pT=new _e(""),mT=(()=>{let t=class t{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){let o=Dq(r?.ngZone,hT({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return o.run(()=>{let s=r?.ignoreChangesOutsideZone,a=m5(n.moduleType,this.injector,[...gG({ngZoneFactory:()=>o,ignoreChangesOutsideZone:s}),{provide:el,useExisting:bG}]),u=a.injector.get(sr,null);return o.runOutsideAngular(()=>{let c=o.onError.subscribe({next:f=>{u.handleError(f)}});a.onDestroy(()=>{Lh(this._modules,a),c.unsubscribe()})}),dG(u,o,()=>{let c=a.injector.get(dT);return c.runInitializers(),c.donePromise.then(()=>{let f=a.injector.get(Vp,dp);return Z5(f||dp),this._moduleDoBootstrap(a),a})})})}bootstrapModule(n,r=[]){let o=fT({},r);return pG(this.injector,o,n).then(s=>this.bootstrapModuleFactory(s,o))}_moduleDoBootstrap(n){let r=n.injector.get(Vo);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(o=>r.bootstrap(o));else if(n.instance.ngDoBootstrap)n.instance.ngDoBootstrap(r);else throw new ke(-403,!1);this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ke(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());let n=this._injector.get(pT,null);n&&(n.forEach(r=>r()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}};t.\u0275fac=function(r){return new(r||t)(me(fn))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"platform"});let e=t;return e})(),ud=null,gT=new _e("");function wG(e){if(ud&&!ud.get(gT,!1))throw new ke(400,!1);lG(),ud=e;let t=e.get(mT);return EG(e),t}function U0(e,t,i=[]){let n=`Platform: ${t}`,r=new _e(n);return(o=[])=>{let s=_T();if(!s||s.injector.get(gT,!1)){let a=[...i,...o,{provide:r,useValue:!0}];e?e(a):wG(xG(a,n))}return CG(r)}}function xG(e=[],t){return fn.create({name:t,providers:[{provide:vp,useValue:"platform"},{provide:pT,useValue:new Set([()=>ud=null])},...e]})}function CG(e){let t=_T();if(!t)throw new ke(401,!1);return t}function _T(){return ud?.get(mT)??null}function EG(e){e.get(v0,null)?.forEach(i=>i())}var Kn=(()=>{let t=class t{};t.__NG_ELEMENT_ID__=IG;let e=t;return e})();function IG(e){return SG(Ln(),ht(),(e&16)===16)}function SG(e,t,i){if(yp(e)&&!i){let n=Po(e.index,t);return new Ks(n,n)}else if(e.type&175){let n=t[Ni];return new Ks(n,t)}return null}var Qy=class{constructor(){}supports(t){return Z2(t)}create(t){return new Yy(t)}},DG=(e,t)=>t,Yy=class{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||DG}forEachItem(t){let i;for(i=this._itHead;i!==null;i=i._next)t(i)}forEachOperation(t){let i=this._itHead,n=this._removalsHead,r=0,o=null;for(;i||n;){let s=!n||i&&i.currentIndex<FS(n,r,o)?i:n,a=FS(s,r,o),u=s.currentIndex;if(s===n)r--,n=n._nextRemoved;else if(i=i._next,s.previousIndex==null)r++;else{o||(o=[]);let c=a-r,f=u-r;if(c!=f){for(let m=0;m<c;m++){let v=m<o.length?o[m]:o[m]=0,b=v+m;f<=b&&b<c&&(o[m]=v+1)}let p=s.previousIndex;o[p]=f-c}}a!==u&&t(s,a,u)}}forEachPreviousItem(t){let i;for(i=this._previousItHead;i!==null;i=i._nextPrevious)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;i!==null;i=i._nextAdded)t(i)}forEachMovedItem(t){let i;for(i=this._movesHead;i!==null;i=i._nextMoved)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;i!==null;i=i._nextRemoved)t(i)}forEachIdentityChange(t){let i;for(i=this._identityChangesHead;i!==null;i=i._nextIdentityChange)t(i)}diff(t){if(t==null&&(t=[]),!Z2(t))throw new ke(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let i=this._itHead,n=!1,r,o,s;if(Array.isArray(t)){this.length=t.length;for(let a=0;a<this.length;a++)o=t[a],s=this._trackByFn(a,o),i===null||!Object.is(i.trackById,s)?(i=this._mismatch(i,o,s,a),n=!0):(n&&(i=this._verifyReinsertion(i,o,s,a)),Object.is(i.item,o)||this._addIdentityChange(i,o)),i=i._next}else r=0,g5(t,a=>{s=this._trackByFn(r,a),i===null||!Object.is(i.trackById,s)?(i=this._mismatch(i,a,s,r),n=!0):(n&&(i=this._verifyReinsertion(i,a,s,r)),Object.is(i.item,a)||this._addIdentityChange(i,a)),i=i._next,r++}),this.length=r;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;t!==null;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;t!==null;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;t!==null;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,i,n,r){let o;return t===null?o=this._itTail:(o=t._prev,this._remove(t)),t=this._unlinkedRecords===null?null:this._unlinkedRecords.get(n,null),t!==null?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._reinsertAfter(t,o,r)):(t=this._linkedRecords===null?null:this._linkedRecords.get(n,r),t!==null?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._moveAfter(t,o,r)):t=this._addAfter(new Jy(i,n),o,r)),t}_verifyReinsertion(t,i,n,r){let o=this._unlinkedRecords===null?null:this._unlinkedRecords.get(n,null);return o!==null?t=this._reinsertAfter(o,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;t!==null;){let i=t._next;this._addToRemovals(this._unlink(t)),t=i}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,i,n){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(t);let r=t._prevRemoved,o=t._nextRemoved;return r===null?this._removalsHead=o:r._nextRemoved=o,o===null?this._removalsTail=r:o._prevRemoved=r,this._insertAfter(t,i,n),this._addToMoves(t,n),t}_moveAfter(t,i,n){return this._unlink(t),this._insertAfter(t,i,n),this._addToMoves(t,n),t}_addAfter(t,i,n){return this._insertAfter(t,i,n),this._additionsTail===null?this._additionsTail=this._additionsHead=t:this._additionsTail=this._additionsTail._nextAdded=t,t}_insertAfter(t,i,n){let r=i===null?this._itHead:i._next;return t._next=r,t._prev=i,r===null?this._itTail=t:r._prev=t,i===null?this._itHead=t:i._next=t,this._linkedRecords===null&&(this._linkedRecords=new fp),this._linkedRecords.put(t),t.currentIndex=n,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){this._linkedRecords!==null&&this._linkedRecords.remove(t);let i=t._prev,n=t._next;return i===null?this._itHead=n:i._next=n,n===null?this._itTail=i:n._prev=i,t}_addToMoves(t,i){return t.previousIndex===i||(this._movesTail===null?this._movesTail=this._movesHead=t:this._movesTail=this._movesTail._nextMoved=t),t}_addToRemovals(t){return this._unlinkedRecords===null&&(this._unlinkedRecords=new fp),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,i){return t.item=i,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=t:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=t,t}},Jy=class{constructor(t,i){this.item=t,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},Xy=class{constructor(){this._head=null,this._tail=null}add(t){this._head===null?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,i){let n;for(n=this._head;n!==null;n=n._nextDup)if((i===null||i<=n.currentIndex)&&Object.is(n.trackById,t))return n;return null}remove(t){let i=t._prevDup,n=t._nextDup;return i===null?this._head=n:i._nextDup=n,n===null?this._tail=i:n._prevDup=i,this._head===null}},fp=class{constructor(){this.map=new Map}put(t){let i=t.trackById,n=this.map.get(i);n||(n=new Xy,this.map.set(i,n)),n.add(t)}get(t,i){let n=t,r=this.map.get(n);return r?r.get(t,i):null}remove(t){let i=t.trackById;return this.map.get(i).remove(t)&&this.map.delete(i),t}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function FS(e,t,i){let n=e.previousIndex;if(n===null)return n;let r=0;return i&&n<i.length&&(r=i[n]),n+t+r}function zS(){return new co([new Qy])}var co=(()=>{let t=class t{constructor(n){this.factories=n}static create(n,r){if(r!=null){let o=r.factories.slice();n=n.concat(o)}return new t(n)}static extend(n){return{provide:t,useFactory:r=>t.create(n,r||zS()),deps:[[t,new n0,new gp]]}}find(n){let r=this.factories.find(o=>o.supports(n));if(r!=null)return r;throw new ke(901,!1)}};t.\u0275prov=be({token:t,providedIn:"root",factory:zS});let e=t;return e})();var vT=U0(null,"core",[]),bT=(()=>{let t=class t{constructor(n){}};t.\u0275fac=function(r){return new(r||t)(me(Vo))},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({});let e=t;return e})();var yT=new _e("");function Ut(e){return typeof e=="boolean"?e:e!=null&&e!=="false"}function Dd(e,t=NaN){return!isNaN(parseFloat(e))&&!isNaN(Number(e))?Number(e):t}function fo(e,t){Lo("NgSignals");let i=kb(e);return t?.equal&&(i[Xi].equal=t.equal),i}function Rr(e){let t=_t(null);try{return e()}finally{_t(t)}}function wT(e){let t=Ao(e);if(!t)return null;let i=new il(t);return{get selector(){return i.selector},get type(){return i.componentType},get inputs(){return i.inputs},get outputs(){return i.outputs},get ngContentSelectors(){return i.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}var IT=null;function Or(){return IT}function ST(e){IT??=e}var Up=class{};var yt=new _e(""),Z0=(()=>{let t=class t{historyGo(n){throw new Error("")}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:()=>ne($G),providedIn:"platform"});let e=t;return e})(),DT=new _e(""),$G=(()=>{let t=class t extends Z0{constructor(){super(),this._doc=ne(yt),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Or().getBaseHref(this._doc)}onPopState(n){let r=Or().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){let r=Or().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,r,o){this._history.pushState(n,r,o)}replaceState(n,r,o){this._history.replaceState(n,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:()=>new t,providedIn:"platform"});let e=t;return e})();function Q0(e,t){if(e.length==0)return t;if(t.length==0)return e;let i=0;return e.endsWith("/")&&i++,t.startsWith("/")&&i++,i==2?e+t.substring(1):i==1?e+t:e+"/"+t}function xT(e){let t=e.match(/#|\?|$/),i=t&&t.index||e.length,n=i-(e[i-1]==="/"?1:0);return e.slice(0,n)+e.slice(i)}function ho(e){return e&&e[0]!=="?"?"?"+e:e}var ea=(()=>{let t=class t{historyGo(n){throw new Error("")}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:()=>ne(Y0),providedIn:"root"});let e=t;return e})(),TT=new _e(""),Y0=(()=>{let t=class t extends ea{constructor(n,r){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??ne(yt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return Q0(this._baseHref,n)}path(n=!1){let r=this._platformLocation.pathname+ho(this._platformLocation.search),o=this._platformLocation.hash;return o&&n?`${r}${o}`:r}pushState(n,r,o,s){let a=this.prepareExternalUrl(o+ho(s));this._platformLocation.pushState(n,r,a)}replaceState(n,r,o,s){let a=this.prepareExternalUrl(o+ho(s));this._platformLocation.replaceState(n,r,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}};t.\u0275fac=function(r){return new(r||t)(me(Z0),me(TT,8))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),$T=(()=>{let t=class t extends ea{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],r!=null&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash??"#";return r.length>0?r.substring(1):r}prepareExternalUrl(n){let r=Q0(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,o,s){let a=this.prepareExternalUrl(o+ho(s));a.length==0&&(a=this._platformLocation.pathname),this._platformLocation.pushState(n,r,a)}replaceState(n,r,o,s){let a=this.prepareExternalUrl(o+ho(s));a.length==0&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}};t.\u0275fac=function(r){return new(r||t)(me(Z0),me(TT,8))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})(),zi=(()=>{let t=class t{constructor(n){this._subject=new Tt,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;let r=this._locationStrategy.getBaseHref();this._basePath=AG(xT(CT(r))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+ho(r))}normalize(n){return t.stripTrailingSlash(MG(this._basePath,CT(n)))}prepareExternalUrl(n){return n&&n[0]!=="/"&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",o=null){this._locationStrategy.pushState(o,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+ho(r)),o)}replaceState(n,r="",o=null){this._locationStrategy.replaceState(o,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+ho(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(o=>o(n,r))}subscribe(n,r,o){return this._subject.subscribe({next:n,error:r,complete:o})}};t.normalizeQueryParams=ho,t.joinWithSlash=Q0,t.stripTrailingSlash=xT,t.\u0275fac=function(r){return new(r||t)(me(ea))},t.\u0275prov=be({token:t,factory:()=>kG(),providedIn:"root"});let e=t;return e})();function kG(){return new zi(me(ea))}function MG(e,t){if(!e||!t.startsWith(e))return t;let i=t.substring(e.length);return i===""||["/",";","?","#"].includes(i[0])?i:t}function CT(e){return e.replace(/\/index.html$/,"")}function AG(e){if(new RegExp("^(https?:)?//").test(e)){let[,i]=e.split(/\/\/[^\/]+/);return i}return e}function Wp(e,t){t=encodeURIComponent(t);for(let i of e.split(";")){let n=i.indexOf("="),[r,o]=n==-1?[i,""]:[i.slice(0,n),i.slice(n+1)];if(r.trim()===t)return decodeURIComponent(o)}return null}var Zn=(()=>{let t=class t{constructor(n,r){this._viewContainer=n,this._context=new W0,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){ET("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){ET("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,r){return!0}};t.\u0275fac=function(r){return new(r||t)(V(ai),V(Hn))},t.\u0275dir=Me({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let e=t;return e})(),W0=class{constructor(){this.$implicit=null,this.ngIf=null}};function ET(e,t){if(!!!(!t||t.createEmbeddedView))throw new Error(`${e} must be a TemplateRef, but received '${oi(t)}'.`)}var kT=(()=>{let t=class t{constructor(n){this._viewContainerRef=n,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(n){if(this._shouldRecreateView(n)){let r=this._viewContainerRef;if(this._viewRef&&r.remove(r.indexOf(this._viewRef)),!this.ngTemplateOutlet){this._viewRef=null;return}let o=this._createContextForwardProxy();this._viewRef=r.createEmbeddedView(this.ngTemplateOutlet,o,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(n){return!!n.ngTemplateOutlet||!!n.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(n,r,o)=>this.ngTemplateOutletContext?Reflect.set(this.ngTemplateOutletContext,r,o):!1,get:(n,r,o)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,r,o)}})}};t.\u0275fac=function(r){return new(r||t)(V(ai))},t.\u0275dir=Me({type:t,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Wn]});let e=t;return e})();var pl=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({});let e=t;return e})(),J0="browser",RG="server";function X0(e){return e===J0}function qp(e){return e===RG}var MT=(()=>{let t=class t{};t.\u0275prov=be({token:t,providedIn:"root",factory:()=>X0(ne(Fi))?new q0(ne(yt),window):new G0});let e=t;return e})(),q0=class{constructor(t,i){this.document=t,this.window=i,this.offset=()=>[0,0]}setOffset(t){Array.isArray(t)?this.offset=()=>t:this.offset=t}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(t){this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){let i=OG(this.document,t);i&&(this.scrollToElement(i),i.focus())}setHistoryScrollRestoration(t){this.window.history.scrollRestoration=t}scrollToElement(t){let i=t.getBoundingClientRect(),n=i.left+this.window.pageXOffset,r=i.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(n-o[0],r-o[1])}};function OG(e,t){let i=e.getElementById(t)||e.getElementsByName(t)[0];if(i)return i;if(typeof e.createTreeWalker=="function"&&e.body&&typeof e.body.attachShadow=="function"){let n=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT),r=n.currentNode;for(;r;){let o=r.shadowRoot;if(o){let s=o.getElementById(t)||o.querySelector(`[name="${t}"]`);if(s)return s}r=n.nextNode()}}return null}var G0=class{setOffset(t){}getScrollPosition(){return[0,0]}scrollToPosition(t){}scrollToAnchor(t){}setHistoryScrollRestoration(t){}},hl=class{};var $d=class{},Kp=class{},Kt=class e{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?typeof t=="string"?this.lazyInit=()=>{this.headers=new Map,t.split(`
`).forEach(i=>{let n=i.indexOf(":");if(n>0){let r=i.slice(0,n),o=r.toLowerCase(),s=i.slice(n+1).trim();this.maybeSetNormalizedName(r,o),this.headers.has(o)?this.headers.get(o).push(s):this.headers.set(o,[s])}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((i,n)=>{this.setHeaderEntries(n,i)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([i,n])=>{this.setHeaderEntries(i,n)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();let i=this.headers.get(t.toLowerCase());return i&&i.length>0?i[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,i){return this.clone({name:t,value:i,op:"a"})}set(t,i){return this.clone({name:t,value:i,op:"s"})}delete(t,i){return this.clone({name:t,value:i,op:"d"})}maybeSetNormalizedName(t,i){this.normalizedNames.has(i)||this.normalizedNames.set(i,t)}init(){this.lazyInit&&(this.lazyInit instanceof e?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(i=>{this.headers.set(i,t.headers.get(i)),this.normalizedNames.set(i,t.normalizedNames.get(i))})}clone(t){let i=new e;return i.lazyInit=this.lazyInit&&this.lazyInit instanceof e?this.lazyInit:this,i.lazyUpdate=(this.lazyUpdate||[]).concat([t]),i}applyUpdate(t){let i=t.name.toLowerCase();switch(t.op){case"a":case"s":let n=t.value;if(typeof n=="string"&&(n=[n]),n.length===0)return;this.maybeSetNormalizedName(t.name,i);let r=(t.op==="a"?this.headers.get(i):void 0)||[];r.push(...n),this.headers.set(i,r);break;case"d":let o=t.value;if(!o)this.headers.delete(i),this.normalizedNames.delete(i);else{let s=this.headers.get(i);if(!s)return;s=s.filter(a=>o.indexOf(a)===-1),s.length===0?(this.headers.delete(i),this.normalizedNames.delete(i)):this.headers.set(i,s)}break}}setHeaderEntries(t,i){let n=(Array.isArray(i)?i:[i]).map(o=>o.toString()),r=t.toLowerCase();this.headers.set(r,n),this.maybeSetNormalizedName(t,r)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(i=>t(this.normalizedNames.get(i),this.headers.get(i)))}};var tw=class{encodeKey(t){return AT(t)}encodeValue(t){return AT(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}};function NG(e,t){let i=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(r=>{let o=r.indexOf("="),[s,a]=o==-1?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,o)),t.decodeValue(r.slice(o+1))],u=i.get(s)||[];u.push(a),i.set(s,u)}),i}var PG=/%(\d[a-f0-9])/gi,FG={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function AT(e){return encodeURIComponent(e).replace(PG,(t,i)=>FG[i]??t)}function Gp(e){return`${e}`}var Ho=class e{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new tw,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=NG(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(i=>{let n=t.fromObject[i],r=Array.isArray(n)?n.map(Gp):[Gp(n)];this.map.set(i,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();let i=this.map.get(t);return i?i[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,i){return this.clone({param:t,value:i,op:"a"})}appendAll(t){let i=[];return Object.keys(t).forEach(n=>{let r=t[n];Array.isArray(r)?r.forEach(o=>{i.push({param:n,value:o,op:"a"})}):i.push({param:n,value:r,op:"a"})}),this.clone(i)}set(t,i){return this.clone({param:t,value:i,op:"s"})}delete(t,i){return this.clone({param:t,value:i,op:"d"})}toString(){return this.init(),this.keys().map(t=>{let i=this.encoder.encodeKey(t);return this.map.get(t).map(n=>i+"="+this.encoder.encodeValue(n)).join("&")}).filter(t=>t!=="").join("&")}clone(t){let i=new e({encoder:this.encoder});return i.cloneFrom=this.cloneFrom||this,i.updates=(this.updates||[]).concat(t),i}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":let i=(t.op==="a"?this.map.get(t.param):void 0)||[];i.push(Gp(t.value)),this.map.set(t.param,i);break;case"d":if(t.value!==void 0){let n=this.map.get(t.param)||[],r=n.indexOf(Gp(t.value));r!==-1&&n.splice(r,1),n.length>0?this.map.set(t.param,n):this.map.delete(t.param)}else{this.map.delete(t.param);break}}}),this.cloneFrom=this.updates=null)}};var nw=class{constructor(){this.map=new Map}set(t,i){return this.map.set(t,i),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}};function zG(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function RT(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function OT(e){return typeof Blob<"u"&&e instanceof Blob}function NT(e){return typeof FormData<"u"&&e instanceof FormData}function LG(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}var Td=class e{constructor(t,i,n,r){this.url=i,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase();let o;if(zG(this.method)||r?(this.body=n!==void 0?n:null,o=r):o=n,o&&(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params),this.transferCache=o.transferCache),this.headers??=new Kt,this.context??=new nw,!this.params)this.params=new Ho,this.urlWithParams=i;else{let s=this.params.toString();if(s.length===0)this.urlWithParams=i;else{let a=i.indexOf("?"),u=a===-1?"?":a<i.length-1?"&":"";this.urlWithParams=i+u+s}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||RT(this.body)||OT(this.body)||NT(this.body)||LG(this.body)?this.body:this.body instanceof Ho?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||NT(this.body)?null:OT(this.body)?this.body.type||null:RT(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Ho?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(t={}){let i=t.method||this.method,n=t.url||this.url,r=t.responseType||this.responseType,o=t.transferCache??this.transferCache,s=t.body!==void 0?t.body:this.body,a=t.withCredentials??this.withCredentials,u=t.reportProgress??this.reportProgress,c=t.headers||this.headers,f=t.params||this.params,p=t.context??this.context;return t.setHeaders!==void 0&&(c=Object.keys(t.setHeaders).reduce((m,v)=>m.set(v,t.setHeaders[v]),c)),t.setParams&&(f=Object.keys(t.setParams).reduce((m,v)=>m.set(v,t.setParams[v]),f)),new e(i,n,s,{params:f,headers:c,context:p,reportProgress:u,responseType:r,withCredentials:a,transferCache:o})}},Wo=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(Wo||{}),kd=class{constructor(t,i=200,n="OK"){this.headers=t.headers||new Kt,this.status=t.status!==void 0?t.status:i,this.statusText=t.statusText||n,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}},Zp=class e extends kd{constructor(t={}){super(t),this.type=Wo.ResponseHeader}clone(t={}){return new e({headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},Md=class e extends kd{constructor(t={}){super(t),this.type=Wo.Response,this.body=t.body!==void 0?t.body:null}clone(t={}){return new e({body:t.body!==void 0?t.body:this.body,headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},Uo=class extends kd{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${t.url||"(unknown url)"}`:this.message=`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}},LT=200,BG=204;function ew(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials,transferCache:e.transferCache}}var Ci=(()=>{let t=class t{constructor(n){this.handler=n}request(n,r,o={}){let s;if(n instanceof Td)s=n;else{let c;o.headers instanceof Kt?c=o.headers:c=new Kt(o.headers);let f;o.params&&(o.params instanceof Ho?f=o.params:f=new Ho({fromObject:o.params})),s=new Td(n,r,o.body!==void 0?o.body:null,{headers:c,context:o.context,params:f,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache})}let a=Ne(s).pipe(no(c=>this.handler.handle(c)));if(n instanceof Td||o.observe==="events")return a;let u=a.pipe(mn(c=>c instanceof Md));switch(o.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return u.pipe(We(c=>{if(c.body!==null&&!(c.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return c.body}));case"blob":return u.pipe(We(c=>{if(c.body!==null&&!(c.body instanceof Blob))throw new Error("Response is not a Blob.");return c.body}));case"text":return u.pipe(We(c=>{if(c.body!==null&&typeof c.body!="string")throw new Error("Response is not a string.");return c.body}));case"json":default:return u.pipe(We(c=>c.body))}case"response":return u;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(n,r={}){return this.request("DELETE",n,r)}get(n,r={}){return this.request("GET",n,r)}head(n,r={}){return this.request("HEAD",n,r)}jsonp(n,r){return this.request("JSONP",n,{params:new Ho().append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,r={}){return this.request("OPTIONS",n,r)}patch(n,r,o={}){return this.request("PATCH",n,ew(o,r))}post(n,r,o={}){return this.request("POST",n,ew(o,r))}put(n,r,o={}){return this.request("PUT",n,ew(o,r))}};t.\u0275fac=function(r){return new(r||t)(me($d))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})(),jG=/^\)\]\}',?\n/,VG="X-Request-URL";function PT(e){if(e.url)return e.url;let t=VG.toLocaleLowerCase();return e.headers.get(t)}var UG=(()=>{let t=class t{constructor(){this.fetchImpl=ne(iw,{optional:!0})?.fetch??fetch.bind(globalThis),this.ngZone=ne(Re)}handle(n){return new st(r=>{let o=new AbortController;return this.doRequest(n,o.signal,r).then(rw,s=>r.error(new Uo({error:s}))),()=>o.abort()})}doRequest(n,r,o){return J(this,null,function*(){let s=this.createRequestInit(n),a;try{let b=this.ngZone.runOutsideAngular(()=>this.fetchImpl(n.urlWithParams,ie({signal:r},s)));HG(b),o.next({type:Wo.Sent}),a=yield b}catch(b){o.error(new Uo({error:b,status:b.status??0,statusText:b.statusText,url:n.urlWithParams,headers:b.headers}));return}let u=new Kt(a.headers),c=a.statusText,f=PT(a)??n.urlWithParams,p=a.status,m=null;if(n.reportProgress&&o.next(new Zp({headers:u,status:p,statusText:c,url:f})),a.body){let b=a.headers.get("content-length"),w=[],C=a.body.getReader(),x=0,y,I,S=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>J(this,null,function*(){for(;;){let{done:$,value:k}=yield C.read();if($)break;if(w.push(k),x+=k.length,n.reportProgress){I=n.responseType==="text"?(I??"")+(y??=new TextDecoder).decode(k,{stream:!0}):void 0;let P=()=>o.next({type:Wo.DownloadProgress,total:b?+b:void 0,loaded:x,partialText:I});S?S.run(P):P()}}}));let T=this.concatChunks(w,x);try{let $=a.headers.get("Content-Type")??"";m=this.parseBody(n,T,$)}catch($){o.error(new Uo({error:$,headers:new Kt(a.headers),status:a.status,statusText:a.statusText,url:PT(a)??n.urlWithParams}));return}}p===0&&(p=m?LT:0),p>=200&&p<300?(o.next(new Md({body:m,headers:u,status:p,statusText:c,url:f})),o.complete()):o.error(new Uo({error:m,headers:u,status:p,statusText:c,url:f}))})}parseBody(n,r,o){switch(n.responseType){case"json":let s=new TextDecoder().decode(r).replace(jG,"");return s===""?null:JSON.parse(s);case"text":return new TextDecoder().decode(r);case"blob":return new Blob([r],{type:o});case"arraybuffer":return r.buffer}}createRequestInit(n){let r={},o=n.withCredentials?"include":void 0;if(n.headers.forEach((s,a)=>r[s]=a.join(",")),n.headers.has("Accept")||(r.Accept="application/json, text/plain, */*"),!n.headers.has("Content-Type")){let s=n.detectContentTypeHeader();s!==null&&(r["Content-Type"]=s)}return{body:n.serializeBody(),method:n.method,headers:r,credentials:o}}concatChunks(n,r){let o=new Uint8Array(r),s=0;for(let a of n)o.set(a,s),s+=a.length;return o}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})(),iw=class{};function rw(){}function HG(e){e.then(rw,rw)}function WG(e,t){return t(e)}function qG(e,t,i){return(n,r)=>xi(i,()=>t(n,o=>e(o,r)))}var BT=new _e(""),GG=new _e(""),KG=new _e("",{providedIn:"root",factory:()=>!0});var FT=(()=>{let t=class t extends $d{constructor(n,r){super(),this.backend=n,this.injector=r,this.chain=null,this.pendingTasks=ne(zo),this.contributeToStability=ne(KG)}handle(n){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(BT),...this.injector.get(GG,[])]));this.chain=r.reduceRight((o,s)=>qG(o,s,this.injector),WG)}if(this.contributeToStability){let r=this.pendingTasks.add();return this.chain(n,o=>this.backend.handle(o)).pipe(Ls(()=>this.pendingTasks.remove(r)))}else return this.chain(n,r=>this.backend.handle(r))}};t.\u0275fac=function(r){return new(r||t)(me(Kp),me(si))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})();var ZG=/^\)\]\}',?\n/;function QG(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}var zT=(()=>{let t=class t{constructor(n){this.xhrFactory=n}handle(n){if(n.method==="JSONP")throw new ke(-2800,!1);let r=this.xhrFactory;return(r.\u0275loadImpl?jt(r.\u0275loadImpl()):Ne(null)).pipe(ti(()=>new st(s=>{let a=r.build();if(a.open(n.method,n.urlWithParams),n.withCredentials&&(a.withCredentials=!0),n.headers.forEach((C,x)=>a.setRequestHeader(C,x.join(","))),n.headers.has("Accept")||a.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){let C=n.detectContentTypeHeader();C!==null&&a.setRequestHeader("Content-Type",C)}if(n.responseType){let C=n.responseType.toLowerCase();a.responseType=C!=="json"?C:"text"}let u=n.serializeBody(),c=null,f=()=>{if(c!==null)return c;let C=a.statusText||"OK",x=new Kt(a.getAllResponseHeaders()),y=QG(a)||n.url;return c=new Zp({headers:x,status:a.status,statusText:C,url:y}),c},p=()=>{let{headers:C,status:x,statusText:y,url:I}=f(),S=null;x!==BG&&(S=typeof a.response>"u"?a.responseText:a.response),x===0&&(x=S?LT:0);let T=x>=200&&x<300;if(n.responseType==="json"&&typeof S=="string"){let $=S;S=S.replace(ZG,"");try{S=S!==""?JSON.parse(S):null}catch(k){S=$,T&&(T=!1,S={error:k,text:S})}}T?(s.next(new Md({body:S,headers:C,status:x,statusText:y,url:I||void 0})),s.complete()):s.error(new Uo({error:S,headers:C,status:x,statusText:y,url:I||void 0}))},m=C=>{let{url:x}=f(),y=new Uo({error:C,status:a.status||0,statusText:a.statusText||"Unknown Error",url:x||void 0});s.error(y)},v=!1,b=C=>{v||(s.next(f()),v=!0);let x={type:Wo.DownloadProgress,loaded:C.loaded};C.lengthComputable&&(x.total=C.total),n.responseType==="text"&&a.responseText&&(x.partialText=a.responseText),s.next(x)},w=C=>{let x={type:Wo.UploadProgress,loaded:C.loaded};C.lengthComputable&&(x.total=C.total),s.next(x)};return a.addEventListener("load",p),a.addEventListener("error",m),a.addEventListener("timeout",m),a.addEventListener("abort",m),n.reportProgress&&(a.addEventListener("progress",b),u!==null&&a.upload&&a.upload.addEventListener("progress",w)),a.send(u),s.next({type:Wo.Sent}),()=>{a.removeEventListener("error",m),a.removeEventListener("abort",m),a.removeEventListener("load",p),a.removeEventListener("timeout",m),n.reportProgress&&(a.removeEventListener("progress",b),u!==null&&a.upload&&a.upload.removeEventListener("progress",w)),a.readyState!==a.DONE&&a.abort()}})))}};t.\u0275fac=function(r){return new(r||t)(me(hl))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})(),jT=new _e(""),YG="XSRF-TOKEN",JG=new _e("",{providedIn:"root",factory:()=>YG}),XG="X-XSRF-TOKEN",e9=new _e("",{providedIn:"root",factory:()=>XG}),Qp=class{},t9=(()=>{let t=class t{constructor(n,r,o){this.doc=n,this.platform=r,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=Wp(n,this.cookieName),this.lastCookieString=n),this.lastToken}};t.\u0275fac=function(r){return new(r||t)(me(yt),me(Fi),me(JG))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})();function n9(e,t){let i=e.url.toLowerCase();if(!ne(jT)||e.method==="GET"||e.method==="HEAD"||i.startsWith("http://")||i.startsWith("https://"))return t(e);let n=ne(Qp).getToken(),r=ne(e9);return n!=null&&!e.headers.has(r)&&(e=e.clone({headers:e.headers.set(r,n)})),t(e)}function VT(...e){let t=[Ci,zT,FT,{provide:$d,useExisting:FT},{provide:Kp,useFactory:()=>ne(UG,{optional:!0})??ne(zT)},{provide:BT,useValue:n9,multi:!0},{provide:jT,useValue:!0},{provide:Qp,useClass:t9}];for(let i of e)t.push(...i.\u0275providers);return _p(t)}var aw=class extends Up{constructor(){super(...arguments),this.supportsDOMEvents=!0}},lw=class e extends aw{static makeCurrent(){ST(new e)}onAndCancel(t,i,n){return t.addEventListener(i,n),()=>{t.removeEventListener(i,n)}}dispatchEvent(t,i){t.dispatchEvent(i)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,i){return i=i||this.getDefaultDocument(),i.createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,i){return i==="window"?window:i==="document"?t:i==="body"?t.body:null}getBaseHref(t){let i=i9();return i==null?null:r9(i)}resetBaseElement(){Ad=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Wp(document.cookie,t)}},Ad=null;function i9(){return Ad=Ad||document.querySelector("base"),Ad?Ad.getAttribute("href"):null}function r9(e){return new URL(e,document.baseURI).pathname}var uw=class{addToWindow(t){or.getAngularTestability=(n,r=!0)=>{let o=t.findTestabilityInTree(n,r);if(o==null)throw new ke(5103,!1);return o},or.getAllAngularTestabilities=()=>t.getAllTestabilities(),or.getAllAngularRootElements=()=>t.getAllRootElements();let i=n=>{let r=or.getAllAngularTestabilities(),o=r.length,s=function(){o--,o==0&&n()};r.forEach(a=>{a.whenStable(s)})};or.frameworkStabilizers||(or.frameworkStabilizers=[]),or.frameworkStabilizers.push(i)}findTestabilityInTree(t,i,n){if(i==null)return null;let r=t.getTestability(i);return r??(n?Or().isShadowRoot(i)?this.findTestabilityInTree(t,i.host,!0):this.findTestabilityInTree(t,i.parentElement,!0):null)}},o9=(()=>{let t=class t{build(){return new XMLHttpRequest}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})(),Yp=new _e(""),qT=(()=>{let t=class t{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(o=>{o.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,r,o){return this._findPluginFor(r).addEventListener(n,r,o)}getZone(){return this._zone}_findPluginFor(n){let r=this._eventNameToPlugin.get(n);if(r)return r;if(r=this._plugins.find(s=>s.supports(n)),!r)throw new ke(5101,!1);return this._eventNameToPlugin.set(n,r),r}};t.\u0275fac=function(r){return new(r||t)(me(Yp),me(Re))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})(),Rd=class{constructor(t){this._doc=t}},ow="ng-app-id",GT=(()=>{let t=class t{constructor(n,r,o,s={}){this.doc=n,this.appId=r,this.nonce=o,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=qp(s),this.resetHostNodes()}addStyles(n){for(let r of n)this.changeUsageCount(r,1)===1&&this.onStyleAdded(r)}removeStyles(n){for(let r of n)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){let n=this.styleNodesInDOM;n&&(n.forEach(r=>r.remove()),n.clear());for(let r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(let r of this.getAllStyles())this.addStyleToHost(n,r)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(let r of this.hostNodes)this.addStyleToHost(r,n)}onStyleRemoved(n){let r=this.styleRef;r.get(n)?.elements?.forEach(o=>o.remove()),r.delete(n)}collectServerRenderedStyles(){let n=this.doc.head?.querySelectorAll(`style[${ow}="${this.appId}"]`);if(n?.length){let r=new Map;return n.forEach(o=>{o.textContent!=null&&r.set(o.textContent,o)}),r}return null}changeUsageCount(n,r){let o=this.styleRef;if(o.has(n)){let s=o.get(n);return s.usage+=r,s.usage}return o.set(n,{usage:r,elements:[]}),r}getStyleElement(n,r){let o=this.styleNodesInDOM,s=o?.get(r);if(s?.parentNode===n)return o.delete(r),s.removeAttribute(ow),s;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=r,this.platformIsServer&&a.setAttribute(ow,this.appId),n.appendChild(a),a}}addStyleToHost(n,r){let o=this.getStyleElement(n,r),s=this.styleRef,a=s.get(r)?.elements;a?a.push(o):s.set(r,{elements:[o],usage:1})}resetHostNodes(){let n=this.hostNodes;n.clear(),n.add(this.doc.head)}};t.\u0275fac=function(r){return new(r||t)(me(yt),me(wd),me(xd,8),me(Fi))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})(),sw={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},dw=/%COMP%/g,KT="%COMP%",s9=`_nghost-${KT}`,a9=`_ngcontent-${KT}`,l9=!0,u9=new _e("",{providedIn:"root",factory:()=>l9});function c9(e){return a9.replace(dw,e)}function d9(e){return s9.replace(dw,e)}function ZT(e,t){return t.map(i=>i.replace(dw,e))}var UT=(()=>{let t=class t{constructor(n,r,o,s,a,u,c,f=null){this.eventManager=n,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=s,this.doc=a,this.platformId=u,this.ngZone=c,this.nonce=f,this.rendererByCompId=new Map,this.platformIsServer=qp(u),this.defaultRenderer=new Od(n,a,c,this.platformIsServer)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Tr.ShadowDom&&(r=Ae(ie({},r),{encapsulation:Tr.Emulated}));let o=this.getOrCreateRenderer(n,r);return o instanceof Jp?o.applyToHost(n):o instanceof Nd&&o.applyStyles(),o}getOrCreateRenderer(n,r){let o=this.rendererByCompId,s=o.get(r.id);if(!s){let a=this.doc,u=this.ngZone,c=this.eventManager,f=this.sharedStylesHost,p=this.removeStylesOnCompDestroy,m=this.platformIsServer;switch(r.encapsulation){case Tr.Emulated:s=new Jp(c,f,r,this.appId,p,a,u,m);break;case Tr.ShadowDom:return new cw(c,f,n,r,a,u,this.nonce,m);default:s=new Nd(c,f,r,p,a,u,m);break}o.set(r.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}};t.\u0275fac=function(r){return new(r||t)(me(qT),me(GT),me(wd),me(u9),me(yt),me(Fi),me(Re),me(xd))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})(),Od=class{constructor(t,i,n,r){this.eventManager=t,this.doc=i,this.ngZone=n,this.platformIsServer=r,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(t,i){return i?this.doc.createElementNS(sw[i]||i,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,i){(HT(t)?t.content:t).appendChild(i)}insertBefore(t,i,n){t&&(HT(t)?t.content:t).insertBefore(i,n)}removeChild(t,i){t&&t.removeChild(i)}selectRootElement(t,i){let n=typeof t=="string"?this.doc.querySelector(t):t;if(!n)throw new ke(-5104,!1);return i||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,i,n,r){if(r){i=r+":"+i;let o=sw[r];o?t.setAttributeNS(o,i,n):t.setAttribute(i,n)}else t.setAttribute(i,n)}removeAttribute(t,i,n){if(n){let r=sw[n];r?t.removeAttributeNS(r,i):t.removeAttribute(`${n}:${i}`)}else t.removeAttribute(i)}addClass(t,i){t.classList.add(i)}removeClass(t,i){t.classList.remove(i)}setStyle(t,i,n,r){r&(oo.DashCase|oo.Important)?t.style.setProperty(i,n,r&oo.Important?"important":""):t.style[i]=n}removeStyle(t,i,n){n&oo.DashCase?t.style.removeProperty(i):t.style[i]=""}setProperty(t,i,n){t!=null&&(t[i]=n)}setValue(t,i){t.nodeValue=i}listen(t,i,n){if(typeof t=="string"&&(t=Or().getGlobalEventTarget(this.doc,t),!t))throw new Error(`Unsupported event target ${t} for event ${i}`);return this.eventManager.addEventListener(t,i,this.decoratePreventDefault(n))}decoratePreventDefault(t){return i=>{if(i==="__ngUnwrap__")return t;(this.platformIsServer?this.ngZone.runGuarded(()=>t(i)):t(i))===!1&&i.preventDefault()}}};function HT(e){return e.tagName==="TEMPLATE"&&e.content!==void 0}var cw=class extends Od{constructor(t,i,n,r,o,s,a,u){super(t,o,s,u),this.sharedStylesHost=i,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let c=ZT(r.id,r.styles);for(let f of c){let p=document.createElement("style");a&&p.setAttribute("nonce",a),p.textContent=f,this.shadowRoot.appendChild(p)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,i){return super.appendChild(this.nodeOrShadowRoot(t),i)}insertBefore(t,i,n){return super.insertBefore(this.nodeOrShadowRoot(t),i,n)}removeChild(t,i){return super.removeChild(this.nodeOrShadowRoot(t),i)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Nd=class extends Od{constructor(t,i,n,r,o,s,a,u){super(t,o,s,a),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=r,this.styles=u?ZT(u,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Jp=class extends Nd{constructor(t,i,n,r,o,s,a,u){let c=r+"-"+n.id;super(t,i,n,o,s,a,u,c),this.contentAttr=c9(c),this.hostAttr=d9(c)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,i){let n=super.createElement(t,i);return super.setAttribute(n,this.contentAttr,""),n}},f9=(()=>{let t=class t extends Rd{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,o){return n.addEventListener(r,o,!1),()=>this.removeEventListener(n,r,o)}removeEventListener(n,r,o){return n.removeEventListener(r,o)}};t.\u0275fac=function(r){return new(r||t)(me(yt))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})(),h9=(()=>{let t=class t extends Rd{constructor(n){super(n),this.delegate=ne(yT,{optional:!0})}supports(n){return this.delegate?this.delegate.supports(n):!1}addEventListener(n,r,o){return this.delegate.addEventListener(n,r,o)}removeEventListener(n,r,o){return this.delegate.removeEventListener(n,r,o)}};t.\u0275fac=function(r){return new(r||t)(me(yt))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})(),WT=["alt","control","meta","shift"],p9={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},m9={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey},g9=(()=>{let t=class t extends Rd{constructor(n){super(n)}supports(n){return t.parseEventName(n)!=null}addEventListener(n,r,o){let s=t.parseEventName(r),a=t.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Or().onAndCancel(n,s.domEventName,a))}static parseEventName(n){let r=n.toLowerCase().split("."),o=r.shift();if(r.length===0||!(o==="keydown"||o==="keyup"))return null;let s=t._normalizeKey(r.pop()),a="",u=r.indexOf("code");if(u>-1&&(r.splice(u,1),a="code."),WT.forEach(f=>{let p=r.indexOf(f);p>-1&&(r.splice(p,1),a+=f+".")}),a+=s,r.length!=0||s.length===0)return null;let c={};return c.domEventName=o,c.fullKey=a,c}static matchEventFullKeyCode(n,r){let o=p9[n.key]||n.key,s="";return r.indexOf("code.")>-1&&(o=n.code,s="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),WT.forEach(a=>{if(a!==o){let u=m9[a];u(n)&&(s+=a+".")}}),s+=o,s===r)}static eventCallback(n,r,o){return s=>{t.matchEventFullKeyCode(s,n)&&o.runGuarded(()=>r(s))}}static _normalizeKey(n){return n==="esc"?"escape":n}};t.\u0275fac=function(r){return new(r||t)(me(yt))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})();function _9(){lw.makeCurrent()}function v9(){return new sr}function b9(){return XD(document),document}var y9=[{provide:Fi,useValue:J0},{provide:v0,useValue:_9,multi:!0},{provide:yt,useFactory:b9,deps:[]}],QT=U0(vT,"browser",y9),w9=new _e(""),x9=[{provide:Sd,useClass:uw,deps:[]},{provide:j0,useClass:Fp,deps:[Re,zp,Sd]},{provide:Fp,useClass:Fp,deps:[Re,zp,Sd]}],C9=[{provide:vp,useValue:"root"},{provide:sr,useFactory:v9,deps:[]},{provide:Yp,useClass:f9,multi:!0,deps:[yt,Re,Fi]},{provide:Yp,useClass:g9,multi:!0,deps:[yt]},{provide:Yp,useClass:h9,multi:!0},UT,GT,qT,{provide:nl,useExisting:UT},{provide:hl,useClass:o9,deps:[]},[]],YT=(()=>{let t=class t{constructor(n){}static withServerTransition(n){return{ngModule:t,providers:[{provide:wd,useValue:n.appId}]}}};t.\u0275fac=function(r){return new(r||t)(me(w9,12))},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({providers:[...C9,...x9],imports:[pl,bT]});let e=t;return e})();var JT=(()=>{let t=class t{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}};t.\u0275fac=function(r){return new(r||t)(me(yt))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var a$=(()=>{let t=class t{constructor(n,r){this._renderer=n,this._elementRef=r,this.onChange=o=>{},this.onTouched=()=>{}}setProperty(n,r){this._renderer.setProperty(this._elementRef.nativeElement,n,r)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}};t.\u0275fac=function(r){return new(r||t)(V(ul),V(Je))},t.\u0275dir=Me({type:t});let e=t;return e})(),E9=(()=>{let t=class t extends a${};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275dir=Me({type:t,features:[Pt]});let e=t;return e})(),um=new _e("");var I9={provide:um,useExisting:so(()=>vl),multi:!0};function S9(){let e=Or()?Or().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}var D9=new _e(""),vl=(()=>{let t=class t extends a${constructor(n,r,o){super(n,r),this._compositionMode=o,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!S9())}writeValue(n){let r=n??"";this.setProperty("value",r)}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}};t.\u0275fac=function(r){return new(r||t)(V(ul),V(Je),V(D9,8))},t.\u0275dir=Me({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,o){r&1&&Ce("input",function(a){return o._handleInput(a.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(a){return o._compositionEnd(a.target.value)})},features:[Gt([I9]),Pt]});let e=t;return e})();function qo(e){return e==null||(typeof e=="string"||Array.isArray(e))&&e.length===0}function l$(e){return e!=null&&typeof e.length=="number"}var gw=new _e(""),_w=new _e(""),T9=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,em=class{static min(t){return $9(t)}static max(t){return k9(t)}static required(t){return M9(t)}static requiredTrue(t){return A9(t)}static email(t){return R9(t)}static minLength(t){return O9(t)}static maxLength(t){return N9(t)}static pattern(t){return P9(t)}static nullValidator(t){return u$(t)}static compose(t){return m$(t)}static composeAsync(t){return g$(t)}};function $9(e){return t=>{if(qo(t.value)||qo(e))return null;let i=parseFloat(t.value);return!isNaN(i)&&i<e?{min:{min:e,actual:t.value}}:null}}function k9(e){return t=>{if(qo(t.value)||qo(e))return null;let i=parseFloat(t.value);return!isNaN(i)&&i>e?{max:{max:e,actual:t.value}}:null}}function M9(e){return qo(e.value)?{required:!0}:null}function A9(e){return e.value===!0?null:{required:!0}}function R9(e){return qo(e.value)||T9.test(e.value)?null:{email:!0}}function O9(e){return t=>qo(t.value)||!l$(t.value)?null:t.value.length<e?{minlength:{requiredLength:e,actualLength:t.value.length}}:null}function N9(e){return t=>l$(t.value)&&t.value.length>e?{maxlength:{requiredLength:e,actualLength:t.value.length}}:null}function P9(e){if(!e)return u$;let t,i;return typeof e=="string"?(i="",e.charAt(0)!=="^"&&(i+="^"),i+=e,e.charAt(e.length-1)!=="$"&&(i+="$"),t=new RegExp(i)):(i=e.toString(),t=e),n=>{if(qo(n.value))return null;let r=n.value;return t.test(r)?null:{pattern:{requiredPattern:i,actualValue:r}}}}function u$(e){return null}function c$(e){return e!=null}function d$(e){return Xs(e)?jt(e):e}function f$(e){let t={};return e.forEach(i=>{t=i!=null?ie(ie({},t),i):t}),Object.keys(t).length===0?null:t}function h$(e,t){return t.map(i=>i(e))}function F9(e){return!e.validate}function p$(e){return e.map(t=>F9(t)?t:i=>t.validate(i))}function m$(e){if(!e)return null;let t=e.filter(c$);return t.length==0?null:function(i){return f$(h$(i,t))}}function vw(e){return e!=null?m$(p$(e)):null}function g$(e){if(!e)return null;let t=e.filter(c$);return t.length==0?null:function(i){let n=h$(i,t).map(d$);return Vb(n).pipe(We(f$))}}function bw(e){return e!=null?g$(p$(e)):null}function e$(e,t){return e===null?[t]:Array.isArray(e)?[...e,t]:[e,t]}function _$(e){return e._rawValidators}function v$(e){return e._rawAsyncValidators}function fw(e){return e?Array.isArray(e)?e:[e]:[]}function tm(e,t){return Array.isArray(e)?e.includes(t):e===t}function t$(e,t){let i=fw(t);return fw(e).forEach(r=>{tm(i,r)||i.push(r)}),i}function n$(e,t){return fw(t).filter(i=>!tm(e,i))}var nm=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=vw(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=bw(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,i){return this.control?this.control.hasError(t,i):!1}getError(t,i){return this.control?this.control.getError(t,i):null}},ta=class extends nm{get formDirective(){return null}get path(){return null}},na=class extends nm{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},hw=class{constructor(t){this._cd=t}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},z9={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},sue=Ae(ie({},z9),{"[class.ng-submitted]":"isSubmitted"}),cm=(()=>{let t=class t extends hw{constructor(n){super(n)}};t.\u0275fac=function(r){return new(r||t)(V(na,2))},t.\u0275dir=Me({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,o){r&2&&Nt("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},features:[Pt]});let e=t;return e})();var Pd="VALID",Xp="INVALID",gl="PENDING",Fd="DISABLED",Go=class{},im=class extends Go{constructor(t,i){super(),this.value=t,this.source=i}},Ld=class extends Go{constructor(t,i){super(),this.pristine=t,this.source=i}},Bd=class extends Go{constructor(t,i){super(),this.touched=t,this.source=i}},_l=class extends Go{constructor(t,i){super(),this.status=t,this.source=i}},pw=class extends Go{constructor(t){super(),this.source=t}},mw=class extends Go{constructor(t){super(),this.source=t}};function b$(e){return(dm(e)?e.validators:e)||null}function L9(e){return Array.isArray(e)?vw(e):e||null}function y$(e,t){return(dm(t)?t.asyncValidators:e)||null}function B9(e){return Array.isArray(e)?bw(e):e||null}function dm(e){return e!=null&&!Array.isArray(e)&&typeof e=="object"}function j9(e,t,i){let n=e.controls;if(!(t?Object.keys(n):n).length)throw new ke(1e3,"");if(!n[i])throw new ke(1001,"")}function V9(e,t,i){e._forEachChild((n,r)=>{if(i[r]===void 0)throw new ke(1002,"")})}var rm=class{constructor(t,i){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=fo(()=>this.statusReactive()),this.statusReactive=Js(void 0),this._pristine=fo(()=>this.pristineReactive()),this.pristineReactive=Js(!0),this._touched=fo(()=>this.touchedReactive()),this.touchedReactive=Js(!1),this._events=new lt,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(i)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get status(){return Rr(this.statusReactive)}set status(t){Rr(()=>this.statusReactive.set(t))}get valid(){return this.status===Pd}get invalid(){return this.status===Xp}get pending(){return this.status==gl}get disabled(){return this.status===Fd}get enabled(){return this.status!==Fd}get pristine(){return Rr(this.pristineReactive)}set pristine(t){Rr(()=>this.pristineReactive.set(t))}get dirty(){return!this.pristine}get touched(){return Rr(this.touchedReactive)}set touched(t){Rr(()=>this.touchedReactive.set(t))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(t$(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(t$(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(n$(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(n$(t,this._rawAsyncValidators))}hasValidator(t){return tm(this._rawValidators,t)}hasAsyncValidator(t){return tm(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){let i=this.touched===!1;this.touched=!0;let n=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsTouched(Ae(ie({},t),{sourceControl:n})),i&&t.emitEvent!==!1&&this._events.next(new Bd(!0,n))}markAllAsTouched(t={}){this.markAsTouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(i=>i.markAllAsTouched(t))}markAsUntouched(t={}){let i=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=t.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:n})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,n),i&&t.emitEvent!==!1&&this._events.next(new Bd(!1,n))}markAsDirty(t={}){let i=this.pristine===!0;this.pristine=!1;let n=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsDirty(Ae(ie({},t),{sourceControl:n})),i&&t.emitEvent!==!1&&this._events.next(new Ld(!1,n))}markAsPristine(t={}){let i=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=t.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:t.emitEvent})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t,n),i&&t.emitEvent!==!1&&this._events.next(new Ld(!0,n))}markAsPending(t={}){this.status=gl;let i=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new _l(this.status,i)),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.markAsPending(Ae(ie({},t),{sourceControl:i}))}disable(t={}){let i=this._parentMarkedDirty(t.onlySelf);this.status=Fd,this.errors=null,this._forEachChild(r=>{r.disable(Ae(ie({},t),{onlySelf:!0}))}),this._updateValue();let n=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new im(this.value,n)),this._events.next(new _l(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Ae(ie({},t),{skipPristineCheck:i}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(t={}){let i=this._parentMarkedDirty(t.onlySelf);this.status=Pd,this._forEachChild(n=>{n.enable(Ae(ie({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Ae(ie({},t),{skipPristineCheck:i}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(t,i){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine({},i),this._parent._updateTouched({},i))}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Pd||this.status===gl)&&this._runAsyncValidator(n,t.emitEvent)}let i=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new im(this.value,i)),this._events.next(new _l(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(Ae(ie({},t),{sourceControl:i}))}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(i=>i._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Fd:Pd}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t,i){if(this.asyncValidator){this.status=gl,this._hasOwnPendingAsyncValidator={emitEvent:i!==!1};let n=d$(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:i,shouldHaveEmitted:t})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let t=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,t}return!1}setErrors(t,i={}){this.errors=t,this._updateControlsErrors(i.emitEvent!==!1,this,i.shouldHaveEmitted)}get(t){let i=t;return i==null||(Array.isArray(i)||(i=i.split(".")),i.length===0)?null:i.reduce((n,r)=>n&&n._find(r),this)}getError(t,i){let n=i?this.get(i):this;return n&&n.errors?n.errors[t]:null}hasError(t,i){return!!this.getError(t,i)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t,i,n){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),(t||n)&&this._events.next(new _l(this.status,i)),this._parent&&this._parent._updateControlsErrors(t,i,n)}_initObservables(){this.valueChanges=new Tt,this.statusChanges=new Tt}_calculateStatus(){return this._allControlsDisabled()?Fd:this.errors?Xp:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(gl)?gl:this._anyControlsHaveStatus(Xp)?Xp:Pd}_anyControlsHaveStatus(t){return this._anyControls(i=>i.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t,i){let n=!this._anyControlsDirty(),r=this.pristine!==n;this.pristine=n,this._parent&&!t.onlySelf&&this._parent._updatePristine(t,i),r&&this._events.next(new Ld(this.pristine,i))}_updateTouched(t={},i){this.touched=this._anyControlsTouched(),this._events.next(new Bd(this.touched,i)),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,i)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){dm(t)&&t.updateOn!=null&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){let i=this._parent&&this._parent.dirty;return!t&&!!i&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=L9(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=B9(this._rawAsyncValidators)}},om=class extends rm{constructor(t,i,n){super(b$(i),y$(n,i)),this.controls=t,this._initObservables(),this._setUpdateStrategy(i),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,i){return this.controls[t]?this.controls[t]:(this.controls[t]=i,i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange),i)}addControl(t,i,n={}){this.registerControl(t,i),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(t,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}setControl(t,i,n={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],i&&this.registerControl(t,i),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,i={}){V9(this,!0,t),Object.keys(t).forEach(n=>{j9(this,!0,n),this.controls[n].setValue(t[n],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i)}patchValue(t,i={}){t!=null&&(Object.keys(t).forEach(n=>{let r=this.controls[n];r&&r.patchValue(t[n],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i))}reset(t={},i={}){this._forEachChild((n,r)=>{n.reset(t?t[r]:null,{onlySelf:!0,emitEvent:i.emitEvent})}),this._updatePristine(i,this),this._updateTouched(i,this),this.updateValueAndValidity(i)}getRawValue(){return this._reduceChildren({},(t,i,n)=>(t[n]=i.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(i,n)=>n._syncPendingControls()?!0:i);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(i=>{let n=this.controls[i];n&&t(n,i)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(let[i,n]of Object.entries(this.controls))if(this.contains(i)&&t(n))return!0;return!1}_reduceValue(){let t={};return this._reduceChildren(t,(i,n,r)=>((n.enabled||this.disabled)&&(i[r]=n.value),i))}_reduceChildren(t,i){let n=t;return this._forEachChild((r,o)=>{n=i(n,r,o)}),n}_allControlsDisabled(){for(let t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}};var fm=new _e("CallSetDisabledState",{providedIn:"root",factory:()=>yw}),yw="always";function U9(e,t){return[...t.path,e]}function sm(e,t,i=yw){ww(e,t),t.valueAccessor.writeValue(e.value),(e.disabled||i==="always")&&t.valueAccessor.setDisabledState?.(e.disabled),W9(e,t),G9(e,t),q9(e,t),H9(e,t)}function i$(e,t,i=!0){let n=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(n),t.valueAccessor.registerOnTouched(n)),lm(e,t),e&&(t._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function am(e,t){e.forEach(i=>{i.registerOnValidatorChange&&i.registerOnValidatorChange(t)})}function H9(e,t){if(t.valueAccessor.setDisabledState){let i=n=>{t.valueAccessor.setDisabledState(n)};e.registerOnDisabledChange(i),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(i)})}}function ww(e,t){let i=_$(e);t.validator!==null?e.setValidators(e$(i,t.validator)):typeof i=="function"&&e.setValidators([i]);let n=v$(e);t.asyncValidator!==null?e.setAsyncValidators(e$(n,t.asyncValidator)):typeof n=="function"&&e.setAsyncValidators([n]);let r=()=>e.updateValueAndValidity();am(t._rawValidators,r),am(t._rawAsyncValidators,r)}function lm(e,t){let i=!1;if(e!==null){if(t.validator!==null){let r=_$(e);if(Array.isArray(r)&&r.length>0){let o=r.filter(s=>s!==t.validator);o.length!==r.length&&(i=!0,e.setValidators(o))}}if(t.asyncValidator!==null){let r=v$(e);if(Array.isArray(r)&&r.length>0){let o=r.filter(s=>s!==t.asyncValidator);o.length!==r.length&&(i=!0,e.setAsyncValidators(o))}}}let n=()=>{};return am(t._rawValidators,n),am(t._rawAsyncValidators,n),i}function W9(e,t){t.valueAccessor.registerOnChange(i=>{e._pendingValue=i,e._pendingChange=!0,e._pendingDirty=!0,e.updateOn==="change"&&w$(e,t)})}function q9(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,e.updateOn==="blur"&&e._pendingChange&&w$(e,t),e.updateOn!=="submit"&&e.markAsTouched()})}function w$(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function G9(e,t){let i=(n,r)=>{t.valueAccessor.writeValue(n),r&&t.viewToModelUpdate(n)};e.registerOnChange(i),t._registerOnDestroy(()=>{e._unregisterOnChange(i)})}function x$(e,t){e==null,ww(e,t)}function K9(e,t){return lm(e,t)}function Z9(e,t){if(!e.hasOwnProperty("model"))return!1;let i=e.model;return i.isFirstChange()?!0:!Object.is(t,i.currentValue)}function Q9(e){return Object.getPrototypeOf(e.constructor)===E9}function C$(e,t){e._syncPendingControls(),t.forEach(i=>{let n=i.control;n.updateOn==="submit"&&n._pendingChange&&(i.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}function Y9(e,t){if(!t)return null;Array.isArray(t);let i,n,r;return t.forEach(o=>{o.constructor===vl?i=o:Q9(o)?n=o:r=o}),r||n||i||null}function J9(e,t){let i=e.indexOf(t);i>-1&&e.splice(i,1)}var X9={provide:ta,useExisting:so(()=>xw)},zd=Promise.resolve(),xw=(()=>{let t=class t extends ta{get submitted(){return Rr(this.submittedReactive)}constructor(n,r,o){super(),this.callSetDisabledState=o,this._submitted=fo(()=>this.submittedReactive()),this.submittedReactive=Js(!1),this._directives=new Set,this.ngSubmit=new Tt,this.form=new om({},vw(n),bw(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){zd.then(()=>{let r=this._findContainer(n.path);n.control=r.registerControl(n.name,n.control),sm(n.control,n,this.callSetDisabledState),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){zd.then(()=>{let r=this._findContainer(n.path);r&&r.removeControl(n.name),this._directives.delete(n)})}addFormGroup(n){zd.then(()=>{let r=this._findContainer(n.path),o=new om({});x$(o,n),r.registerControl(n.name,o),o.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){zd.then(()=>{let r=this._findContainer(n.path);r&&r.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,r){zd.then(()=>{this.form.get(n.path).setValue(r)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submittedReactive.set(!0),C$(this.form,this._directives),this.ngSubmit.emit(n),n?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}};t.\u0275fac=function(r){return new(r||t)(V(gw,10),V(_w,10),V(fm,8))},t.\u0275dir=Me({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,o){r&1&&Ce("submit",function(a){return o.onSubmit(a)})("reset",function(){return o.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Gt([X9]),Pt]});let e=t;return e})();function r$(e,t){let i=e.indexOf(t);i>-1&&e.splice(i,1)}function o$(e){return typeof e=="object"&&e!==null&&Object.keys(e).length===2&&"value"in e&&"disabled"in e}var E$=class extends rm{constructor(t=null,i,n){super(b$(i),y$(n,i)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(i),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),dm(i)&&(i.nonNullable||i.initialValueIsDefault)&&(o$(t)?this.defaultValue=t.value:this.defaultValue=t)}setValue(t,i={}){this.value=this._pendingValue=t,this._onChange.length&&i.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,i.emitViewToModelChange!==!1)),this.updateValueAndValidity(i)}patchValue(t,i={}){this.setValue(t,i)}reset(t=this.defaultValue,i={}){this._applyFormState(t),this.markAsPristine(i),this.markAsUntouched(i),this.setValue(this.value,i),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){r$(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){r$(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(t){o$(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};var e7=e=>e instanceof E$;var t7={provide:na,useExisting:so(()=>jd)},s$=Promise.resolve(),jd=(()=>{let t=class t extends na{constructor(n,r,o,s,a,u){super(),this._changeDetectorRef=a,this.callSetDisabledState=u,this.control=new E$,this._registered=!1,this.name="",this.update=new Tt,this._parent=n,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=Y9(this,s)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){let r=n.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),Z9(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){sm(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(n){s$.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(n){let r=n.isDisabled.currentValue,o=r!==0&&Ut(r);s$.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(n){return this._parent?U9(n,this._parent):[n]}};t.\u0275fac=function(r){return new(r||t)(V(ta,9),V(gw,10),V(_w,10),V(um,10),V(Kn,8),V(fm,8))},t.\u0275dir=Me({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Gt([t7]),Pt,Wn]});let e=t;return e})();var n7={provide:ta,useExisting:so(()=>Cw)},Cw=(()=>{let t=class t extends ta{get submitted(){return Rr(this._submittedReactive)}set submitted(n){this._submittedReactive.set(n)}constructor(n,r,o){super(),this.callSetDisabledState=o,this._submitted=fo(()=>this._submittedReactive()),this._submittedReactive=Js(!1),this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Tt,this._setValidators(n),this._setAsyncValidators(r)}ngOnChanges(n){this._checkFormPresent(),n.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(lm(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(n){let r=this.form.get(n.path);return sm(r,n,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(n),r}getControl(n){return this.form.get(n.path)}removeControl(n){i$(n.control||null,n,!1),J9(this.directives,n)}addFormGroup(n){this._setUpFormContainer(n)}removeFormGroup(n){this._cleanUpFormContainer(n)}getFormGroup(n){return this.form.get(n.path)}addFormArray(n){this._setUpFormContainer(n)}removeFormArray(n){this._cleanUpFormContainer(n)}getFormArray(n){return this.form.get(n.path)}updateModel(n,r){this.form.get(n.path).setValue(r)}onSubmit(n){return this._submittedReactive.set(!0),C$(this.form,this.directives),this.ngSubmit.emit(n),this.form._events.next(new pw(this.control)),n?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this._submittedReactive.set(!1),this.form._events.next(new mw(this.form))}_updateDomValue(){this.directives.forEach(n=>{let r=n.control,o=this.form.get(n.path);r!==o&&(i$(r||null,n),e7(o)&&(sm(o,n,this.callSetDisabledState),n.control=o))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(n){let r=this.form.get(n.path);x$(r,n),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(n){if(this.form){let r=this.form.get(n.path);r&&K9(r,n)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){ww(this.form,this),this._oldForm&&lm(this._oldForm,this)}_checkFormPresent(){this.form}};t.\u0275fac=function(r){return new(r||t)(V(gw,10),V(_w,10),V(fm,8))},t.\u0275dir=Me({type:t,selectors:[["","formGroup",""]],hostBindings:function(r,o){r&1&&Ce("submit",function(a){return o.onSubmit(a)})("reset",function(){return o.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Gt([n7]),Pt,Wn]});let e=t;return e})();var i7=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({});let e=t;return e})();var I$=(()=>{let t=class t{static withConfig(n){return{ngModule:t,providers:[{provide:fm,useValue:n.callSetDisabledState??yw}]}}};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({imports:[i7]});let e=t;return e})();var Sw;try{Sw=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Sw=!1}var Ht=(()=>{let t=class t{constructor(n){this._platformId=n,this.isBrowser=this._platformId?X0(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||Sw)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};t.\u0275fac=function(r){return new(r||t)(me(Fi))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var bl,S$=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function Dw(){if(bl)return bl;if(typeof document!="object"||!document)return bl=new Set(S$),bl;let e=document.createElement("input");return bl=new Set(S$.filter(t=>(e.setAttribute("type",t),e.type===t))),bl}var Vd;function r7(){if(Vd==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Vd=!0}))}finally{Vd=Vd||!1}return Vd}function Ko(e){return r7()?e:!!e.capture}var Iw;function o7(){if(Iw==null){let e=typeof document<"u"?document.head:null;Iw=!!(e&&(e.createShadowRoot||e.attachShadow))}return Iw}function D$(e){if(o7()){let t=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}function mo(e){return e.composedPath?e.composedPath()[0]:e.target}function T$(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function ia(e){return e!=null&&`${e}`!="false"}function Tw(e){return Array.isArray(e)?e:[e]}function Nr(e){return e instanceof Je?e.nativeElement:e}var s7=(()=>{let t=class t{create(n){return typeof MutationObserver>"u"?null:new MutationObserver(n)}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var $$=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({providers:[s7]});let e=t;return e})();var k$=new Set,ra,a7=(()=>{let t=class t{constructor(n,r){this._platform=n,this._nonce=r,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):u7}matchMedia(n){return(this._platform.WEBKIT||this._platform.BLINK)&&l7(n,this._nonce),this._matchMedia(n)}};t.\u0275fac=function(r){return new(r||t)(me(Ht),me(xd,8))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function l7(e,t){if(!k$.has(e))try{ra||(ra=document.createElement("style"),t&&ra.setAttribute("nonce",t),ra.setAttribute("type","text/css"),document.head.appendChild(ra)),ra.sheet&&(ra.sheet.insertRule(`@media ${e} {body{ }}`,0),k$.add(e))}catch(i){console.error(i)}}function u7(e){return{matches:e==="all"||e==="",media:e,addListener:()=>{},removeListener:()=>{}}}var A$=(()=>{let t=class t{constructor(n,r){this._mediaMatcher=n,this._zone=r,this._queries=new Map,this._destroySubject=new lt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(n){return M$(Tw(n)).some(o=>this._registerQuery(o).mql.matches)}observe(n){let o=M$(Tw(n)).map(a=>this._registerQuery(a).observable),s=zs(o);return s=Io(s.pipe(tr(1)),s.pipe(ad(1),Sh(0))),s.pipe(We(a=>{let u={matches:!1,breakpoints:{}};return a.forEach(({matches:c,query:f})=>{u.matches=u.matches||c,u.breakpoints[f]=c}),u}))}_registerQuery(n){if(this._queries.has(n))return this._queries.get(n);let r=this._mediaMatcher.matchMedia(n),s={observable:new st(a=>{let u=c=>this._zone.run(()=>a.next(c));return r.addListener(u),()=>{r.removeListener(u)}}).pipe(ja(r),We(({matches:a})=>({query:n,matches:a})),zn(this._destroySubject)),mql:r};return this._queries.set(n,s),s}};t.\u0275fac=function(r){return new(r||t)(me(a7),me(Re))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function M$(e){return e.map(t=>t.split(",")).reduce((t,i)=>t.concat(i)).map(t=>t.trim())}function kw(e){return e.buttons===0||e.detail===0}function Mw(e){let t=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!!t&&t.identifier===-1&&(t.radiusX==null||t.radiusX===1)&&(t.radiusY==null||t.radiusY===1)}var c7=new _e("cdk-input-modality-detector-options"),d7={ignoreKeys:[18,17,224,91,16]},N$=650,yl=Ko({passive:!0,capture:!0}),f7=(()=>{let t=class t{get mostRecentModality(){return this._modality.value}constructor(n,r,o,s){this._platform=n,this._mostRecentTarget=null,this._modality=new dn(null),this._lastTouchMs=0,this._onKeydown=a=>{this._options?.ignoreKeys?.some(u=>u===a.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=mo(a))},this._onMousedown=a=>{Date.now()-this._lastTouchMs<N$||(this._modality.next(kw(a)?"keyboard":"mouse"),this._mostRecentTarget=mo(a))},this._onTouchstart=a=>{if(Mw(a)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=mo(a)},this._options=ie(ie({},d7),s),this.modalityDetected=this._modality.pipe(ad(1)),this.modalityChanged=this.modalityDetected.pipe(Dh()),n.isBrowser&&r.runOutsideAngular(()=>{o.addEventListener("keydown",this._onKeydown,yl),o.addEventListener("mousedown",this._onMousedown,yl),o.addEventListener("touchstart",this._onTouchstart,yl)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,yl),document.removeEventListener("mousedown",this._onMousedown,yl),document.removeEventListener("touchstart",this._onTouchstart,yl))}};t.\u0275fac=function(r){return new(r||t)(me(Ht),me(Re),me(yt),me(c7,8))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var pm=function(e){return e[e.IMMEDIATE=0]="IMMEDIATE",e[e.EVENTUAL=1]="EVENTUAL",e}(pm||{}),h7=new _e("cdk-focus-monitor-default-options"),hm=Ko({passive:!0,capture:!0}),mm=(()=>{let t=class t{constructor(n,r,o,s,a){this._ngZone=n,this._platform=r,this._inputModalityDetector=o,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new lt,this._rootNodeFocusAndBlurListener=u=>{let c=mo(u);for(let f=c;f;f=f.parentElement)u.type==="focus"?this._onFocus(u,f):this._onBlur(u,f)},this._document=s,this._detectionMode=a?.detectionMode||pm.IMMEDIATE}monitor(n,r=!1){let o=Nr(n);if(!this._platform.isBrowser||o.nodeType!==1)return Ne();let s=D$(o)||this._getDocument(),a=this._elementInfo.get(o);if(a)return r&&(a.checkChildren=!0),a.subject;let u={checkChildren:r,subject:new lt,rootNode:s};return this._elementInfo.set(o,u),this._registerGlobalListeners(u),u.subject}stopMonitoring(n){let r=Nr(n),o=this._elementInfo.get(r);o&&(o.subject.complete(),this._setClasses(r),this._elementInfo.delete(r),this._removeGlobalListeners(o))}focusVia(n,r,o){let s=Nr(n),a=this._getDocument().activeElement;s===a?this._getClosestElementsInfo(s).forEach(([u,c])=>this._originChanged(u,r,c)):(this._setOrigin(r),typeof s.focus=="function"&&s.focus(o))}ngOnDestroy(){this._elementInfo.forEach((n,r)=>this.stopMonitoring(r))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(n){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(n)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:n&&this._isLastInteractionFromInputLabel(n)?"mouse":"program"}_shouldBeAttributedToTouch(n){return this._detectionMode===pm.EVENTUAL||!!n?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(n,r){n.classList.toggle("cdk-focused",!!r),n.classList.toggle("cdk-touch-focused",r==="touch"),n.classList.toggle("cdk-keyboard-focused",r==="keyboard"),n.classList.toggle("cdk-mouse-focused",r==="mouse"),n.classList.toggle("cdk-program-focused",r==="program")}_setOrigin(n,r=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=n,this._originFromTouchInteraction=n==="touch"&&r,this._detectionMode===pm.IMMEDIATE){clearTimeout(this._originTimeoutId);let o=this._originFromTouchInteraction?N$:1;this._originTimeoutId=setTimeout(()=>this._origin=null,o)}})}_onFocus(n,r){let o=this._elementInfo.get(r),s=mo(n);!o||!o.checkChildren&&r!==s||this._originChanged(r,this._getFocusOrigin(s),o)}_onBlur(n,r){let o=this._elementInfo.get(r);!o||o.checkChildren&&n.relatedTarget instanceof Node&&r.contains(n.relatedTarget)||(this._setClasses(r),this._emitOrigin(o,null))}_emitOrigin(n,r){n.subject.observers.length&&this._ngZone.run(()=>n.subject.next(r))}_registerGlobalListeners(n){if(!this._platform.isBrowser)return;let r=n.rootNode,o=this._rootNodeFocusListenerCount.get(r)||0;o||this._ngZone.runOutsideAngular(()=>{r.addEventListener("focus",this._rootNodeFocusAndBlurListener,hm),r.addEventListener("blur",this._rootNodeFocusAndBlurListener,hm)}),this._rootNodeFocusListenerCount.set(r,o+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(zn(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(n){let r=n.rootNode;if(this._rootNodeFocusListenerCount.has(r)){let o=this._rootNodeFocusListenerCount.get(r);o>1?this._rootNodeFocusListenerCount.set(r,o-1):(r.removeEventListener("focus",this._rootNodeFocusAndBlurListener,hm),r.removeEventListener("blur",this._rootNodeFocusAndBlurListener,hm),this._rootNodeFocusListenerCount.delete(r))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(n,r,o){this._setClasses(n,r),this._emitOrigin(o,r),this._lastFocusOrigin=r}_getClosestElementsInfo(n){let r=[];return this._elementInfo.forEach((o,s)=>{(s===n||o.checkChildren&&s.contains(n))&&r.push([s,o])}),r}_isLastInteractionFromInputLabel(n){let{_mostRecentTarget:r,mostRecentModality:o}=this._inputModalityDetector;if(o!=="mouse"||!r||r===n||n.nodeName!=="INPUT"&&n.nodeName!=="TEXTAREA"||n.disabled)return!1;let s=n.labels;if(s){for(let a=0;a<s.length;a++)if(s[a].contains(r))return!0}return!1}};t.\u0275fac=function(r){return new(r||t)(me(Re),me(Ht),me(f7),me(yt,8),me(h7,8))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var oa=function(e){return e[e.NONE=0]="NONE",e[e.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",e[e.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",e}(oa||{}),R$="cdk-high-contrast-black-on-white",O$="cdk-high-contrast-white-on-black",$w="cdk-high-contrast-active",P$=(()=>{let t=class t{constructor(n,r){this._platform=n,this._document=r,this._breakpointSubscription=ne(A$).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return oa.NONE;let n=this._document.createElement("div");n.style.backgroundColor="rgb(1,2,3)",n.style.position="absolute",this._document.body.appendChild(n);let r=this._document.defaultView||window,o=r&&r.getComputedStyle?r.getComputedStyle(n):null,s=(o&&o.backgroundColor||"").replace(/ /g,"");switch(n.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return oa.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return oa.BLACK_ON_WHITE}return oa.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let n=this._document.body.classList;n.remove($w,R$,O$),this._hasCheckedHighContrastMode=!0;let r=this.getHighContrastMode();r===oa.BLACK_ON_WHITE?n.add($w,R$):r===oa.WHITE_ON_BLACK&&n.add($w,O$)}}};t.\u0275fac=function(r){return new(r||t)(me(Ht),me(yt))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var p7=new _e("cdk-dir-doc",{providedIn:"root",factory:m7});function m7(){return ne(yt)}var g7=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function _7(e){let t=e?.toLowerCase()||"";return t==="auto"&&typeof navigator<"u"&&navigator?.language?g7.test(navigator.language)?"rtl":"ltr":t==="rtl"?"rtl":"ltr"}var gm=(()=>{let t=class t{constructor(n){if(this.value="ltr",this.change=new Tt,n){let r=n.body?n.body.dir:null,o=n.documentElement?n.documentElement.dir:null;this.value=_7(r||o||"ltr")}}ngOnDestroy(){this.change.complete()}};t.\u0275fac=function(r){return new(r||t)(me(p7,8))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var wl=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({});let e=t;return e})();var b7=["mat-internal-form-field",""],y7=["*"];function w7(){return!0}var x7=new _e("mat-sanity-checks",{providedIn:"root",factory:w7}),rn=(()=>{let t=class t{constructor(n,r,o){this._sanityChecks=r,this._document=o,this._hasDoneGlobalChecks=!1,n._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(n){return T$()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[n]}};t.\u0275fac=function(r){return new(r||t)(me(P$),me(x7,8),me(yt))},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({imports:[wl,wl]});let e=t;return e})();var vm=class{constructor(t,i,n,r,o){this._defaultMatcher=t,this.ngControl=i,this._parentFormGroup=n,this._parentForm=r,this._stateChanges=o,this.errorState=!1}updateErrorState(){let t=this.errorState,i=this._parentFormGroup||this._parentForm,n=this.matcher||this._defaultMatcher,r=this.ngControl?this.ngControl.control:null,o=n?.isErrorState(r,i)??!1;o!==t&&(this.errorState=o,this._stateChanges.next())}};var G$=(()=>{let t=class t{isErrorState(n,r){return!!(n&&n.invalid&&(n.touched||r&&r.submitted))}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var Li=function(e){return e[e.FADING_IN=0]="FADING_IN",e[e.VISIBLE=1]="VISIBLE",e[e.FADING_OUT=2]="FADING_OUT",e[e.HIDDEN=3]="HIDDEN",e}(Li||{}),Ow=class{constructor(t,i,n,r=!1){this._renderer=t,this.element=i,this.config=n,this._animationForciblyDisabledThroughCss=r,this.state=Li.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},L$=Ko({passive:!0,capture:!0}),Nw=class{constructor(){this._events=new Map,this._delegateEventHandler=t=>{let i=mo(t);i&&this._events.get(t.type)?.forEach((n,r)=>{(r===i||r.contains(i))&&n.forEach(o=>o.handleEvent(t))})}}addHandler(t,i,n,r){let o=this._events.get(i);if(o){let s=o.get(n);s?s.add(r):o.set(n,new Set([r]))}else this._events.set(i,new Map([[n,new Set([r])]])),t.runOutsideAngular(()=>{document.addEventListener(i,this._delegateEventHandler,L$)})}removeHandler(t,i,n){let r=this._events.get(t);if(!r)return;let o=r.get(i);o&&(o.delete(n),o.size===0&&r.delete(i),r.size===0&&(this._events.delete(t),document.removeEventListener(t,this._delegateEventHandler,L$)))}},B$={enterDuration:225,exitDuration:150},C7=800,j$=Ko({passive:!0,capture:!0}),V$=["mousedown","touchstart"],U$=["mouseup","mouseleave","touchend","touchcancel"],Ud=class Ud{constructor(t,i,n,r){this._target=t,this._ngZone=i,this._platform=r,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=Nr(n))}fadeInRipple(t,i,n={}){let r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),o=ie(ie({},B$),n.animation);n.centered&&(t=r.left+r.width/2,i=r.top+r.height/2);let s=n.radius||E7(t,i,r),a=t-r.left,u=i-r.top,c=o.enterDuration,f=document.createElement("div");f.classList.add("mat-ripple-element"),f.style.left=`${a-s}px`,f.style.top=`${u-s}px`,f.style.height=`${s*2}px`,f.style.width=`${s*2}px`,n.color!=null&&(f.style.backgroundColor=n.color),f.style.transitionDuration=`${c}ms`,this._containerElement.appendChild(f);let p=window.getComputedStyle(f),m=p.transitionProperty,v=p.transitionDuration,b=m==="none"||v==="0s"||v==="0s, 0s"||r.width===0&&r.height===0,w=new Ow(this,f,n,b);f.style.transform="scale3d(1, 1, 1)",w.state=Li.FADING_IN,n.persistent||(this._mostRecentTransientRipple=w);let C=null;return!b&&(c||o.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let x=()=>{C&&(C.fallbackTimer=null),clearTimeout(I),this._finishRippleTransition(w)},y=()=>this._destroyRipple(w),I=setTimeout(y,c+100);f.addEventListener("transitionend",x),f.addEventListener("transitioncancel",y),C={onTransitionEnd:x,onTransitionCancel:y,fallbackTimer:I}}),this._activeRipples.set(w,C),(b||!c)&&this._finishRippleTransition(w),w}fadeOutRipple(t){if(t.state===Li.FADING_OUT||t.state===Li.HIDDEN)return;let i=t.element,n=ie(ie({},B$),t.config.animation);i.style.transitionDuration=`${n.exitDuration}ms`,i.style.opacity="0",t.state=Li.FADING_OUT,(t._animationForciblyDisabledThroughCss||!n.exitDuration)&&this._finishRippleTransition(t)}fadeOutAll(){this._getActiveRipples().forEach(t=>t.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(t=>{t.config.persistent||t.fadeOut()})}setupTriggerEvents(t){let i=Nr(t);!this._platform.isBrowser||!i||i===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=i,V$.forEach(n=>{Ud._eventManager.addHandler(this._ngZone,n,i,this)}))}handleEvent(t){t.type==="mousedown"?this._onMousedown(t):t.type==="touchstart"?this._onTouchStart(t):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{U$.forEach(i=>{this._triggerElement.addEventListener(i,this,j$)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(t){t.state===Li.FADING_IN?this._startFadeOutTransition(t):t.state===Li.FADING_OUT&&this._destroyRipple(t)}_startFadeOutTransition(t){let i=t===this._mostRecentTransientRipple,{persistent:n}=t.config;t.state=Li.VISIBLE,!n&&(!i||!this._isPointerDown)&&t.fadeOut()}_destroyRipple(t){let i=this._activeRipples.get(t)??null;this._activeRipples.delete(t),this._activeRipples.size||(this._containerRect=null),t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),t.state=Li.HIDDEN,i!==null&&(t.element.removeEventListener("transitionend",i.onTransitionEnd),t.element.removeEventListener("transitioncancel",i.onTransitionCancel),i.fallbackTimer!==null&&clearTimeout(i.fallbackTimer)),t.element.remove()}_onMousedown(t){let i=kw(t),n=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+C7;!this._target.rippleDisabled&&!i&&!n&&(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))}_onTouchStart(t){if(!this._target.rippleDisabled&&!Mw(t)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let i=t.changedTouches;if(i)for(let n=0;n<i.length;n++)this.fadeInRipple(i[n].clientX,i[n].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(t=>{let i=t.state===Li.VISIBLE||t.config.terminateOnPointerUp&&t.state===Li.FADING_IN;!t.config.persistent&&i&&t.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let t=this._triggerElement;t&&(V$.forEach(i=>Ud._eventManager.removeHandler(i,t,this)),this._pointerUpEventsRegistered&&(U$.forEach(i=>t.removeEventListener(i,this,j$)),this._pointerUpEventsRegistered=!1))}};Ud._eventManager=new Nw;var Pw=Ud;function E7(e,t,i){let n=Math.max(Math.abs(e-i.left),Math.abs(e-i.right)),r=Math.max(Math.abs(t-i.top),Math.abs(t-i.bottom));return Math.sqrt(n*n+r*r)}var K$=new _e("mat-ripple-global-options"),Fw=(()=>{let t=class t{get disabled(){return this._disabled}set disabled(n){n&&this.fadeOutAllNonPersistent(),this._disabled=n,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(n){this._trigger=n,this._setupTriggerEventsIfEnabled()}constructor(n,r,o,s,a){this._elementRef=n,this._animationMode=a,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=s||{},this._rippleRenderer=new Pw(this,r,n,o)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:ie(ie(ie({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(n,r=0,o){return typeof n=="number"?this._rippleRenderer.fadeInRipple(n,r,ie(ie({},this.rippleConfig),o)):this._rippleRenderer.fadeInRipple(0,0,ie(ie({},this.rippleConfig),n))}};t.\u0275fac=function(r){return new(r||t)(V(Je),V(Re),V(Ht),V(K$,8),V(uo,8))},t.\u0275dir=Me({type:t,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(r,o){r&2&&Nt("mat-ripple-unbounded",o.unbounded)},inputs:{color:[0,"matRippleColor","color"],unbounded:[0,"matRippleUnbounded","unbounded"],centered:[0,"matRippleCentered","centered"],radius:[0,"matRippleRadius","radius"],animation:[0,"matRippleAnimation","animation"],disabled:[0,"matRippleDisabled","disabled"],trigger:[0,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let e=t;return e})(),bm=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({imports:[rn,rn]});let e=t;return e})();var H$={capture:!0},W$=["focus","mousedown","mouseenter","touchstart"],Aw="mat-ripple-loader-uninitialized",Rw="mat-ripple-loader-class-name",q$="mat-ripple-loader-centered",_m="mat-ripple-loader-disabled",Z$=(()=>{let t=class t{constructor(){this._document=ne(yt,{optional:!0}),this._animationMode=ne(uo,{optional:!0}),this._globalRippleOptions=ne(K$,{optional:!0}),this._platform=ne(Ht),this._ngZone=ne(Re),this._hosts=new Map,this._onInteraction=n=>{let r=mo(n);if(r instanceof HTMLElement){let o=r.closest(`[${Aw}="${this._globalRippleOptions?.namespace??""}"]`);o&&this._createRipple(o)}},this._ngZone.runOutsideAngular(()=>{for(let n of W$)this._document?.addEventListener(n,this._onInteraction,H$)})}ngOnDestroy(){let n=this._hosts.keys();for(let r of n)this.destroyRipple(r);for(let r of W$)this._document?.removeEventListener(r,this._onInteraction,H$)}configureRipple(n,r){n.setAttribute(Aw,this._globalRippleOptions?.namespace??""),(r.className||!n.hasAttribute(Rw))&&n.setAttribute(Rw,r.className||""),r.centered&&n.setAttribute(q$,""),r.disabled&&n.setAttribute(_m,"")}getRipple(n){return this._hosts.get(n)||this._createRipple(n)}setDisabled(n,r){let o=this._hosts.get(n);if(o){o.disabled=r;return}r?n.setAttribute(_m,""):n.removeAttribute(_m)}_createRipple(n){if(!this._document)return;let r=this._hosts.get(n);if(r)return r;n.querySelector(".mat-ripple")?.remove();let o=this._document.createElement("span");o.classList.add("mat-ripple",n.getAttribute(Rw)),n.append(o);let s=new Fw(new Je(o),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return s._isInitialized=!0,s.trigger=n,s.centered=n.hasAttribute(q$),s.disabled=n.hasAttribute(_m),this.attachRipple(n,s),s}attachRipple(n,r){n.removeAttribute(Aw),this._hosts.set(n,r)}destroyRipple(n){let r=this._hosts.get(n);r&&(r.ngOnDestroy(),this._hosts.delete(n))}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),Q$=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=Oe({type:t,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(r,o){r&2&&Nt("mdc-form-field--align-end",o.labelPosition==="before")},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[nn],attrs:b7,ngContentSelectors:y7,decls:1,vars:0,template:function(r,o){r&1&&(Bn(),Dt(0))},styles:[".mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-flex;align-items:center;vertical-align:middle}.mat-internal-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mat-internal-form-field>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end .mdc-form-field--align-end label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0}"],encapsulation:2,changeDetection:0});let e=t;return e})();var S7=["*",[["mat-toolbar-row"]]],D7=["*","mat-toolbar-row"],T7=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275dir=Me({type:t,selectors:[["mat-toolbar-row"]],hostAttrs:[1,"mat-toolbar-row"],exportAs:["matToolbarRow"],standalone:!0});let e=t;return e})(),Mt=(()=>{let t=class t{constructor(n,r,o){this._elementRef=n,this._platform=r,this._document=o}ngAfterViewInit(){this._platform.isBrowser&&(this._checkToolbarMixedModes(),this._toolbarRows.changes.subscribe(()=>this._checkToolbarMixedModes()))}_checkToolbarMixedModes(){this._toolbarRows.length}};t.\u0275fac=function(r){return new(r||t)(V(Je),V(Ht),V(yt))},t.\u0275cmp=Oe({type:t,selectors:[["mat-toolbar"]],contentQueries:function(r,o,s){if(r&1&&_n(s,T7,5),r&2){let a;vt(a=bt())&&(o._toolbarRows=a)}},hostAttrs:[1,"mat-toolbar"],hostVars:6,hostBindings:function(r,o){r&2&&(Cd(o.color?"mat-"+o.color:""),Nt("mat-toolbar-multiple-rows",o._toolbarRows.length>0)("mat-toolbar-single-row",o._toolbarRows.length===0))},inputs:{color:"color"},exportAs:["matToolbar"],standalone:!0,features:[nn],ngContentSelectors:D7,decls:2,vars:0,template:function(r,o){r&1&&(Bn(S7),Dt(0),Dt(1,1))},styles:[".mat-toolbar{background:var(--mat-toolbar-container-background-color);color:var(--mat-toolbar-container-text-color)}.mat-toolbar,.mat-toolbar h1,.mat-toolbar h2,.mat-toolbar h3,.mat-toolbar h4,.mat-toolbar h5,.mat-toolbar h6{font-family:var(--mat-toolbar-title-text-font);font-size:var(--mat-toolbar-title-text-size);line-height:var(--mat-toolbar-title-text-line-height);font-weight:var(--mat-toolbar-title-text-weight);letter-spacing:var(--mat-toolbar-title-text-tracking);margin:0}.cdk-high-contrast-active .mat-toolbar{outline:solid 1px}.mat-toolbar .mat-form-field-underline,.mat-toolbar .mat-form-field-ripple,.mat-toolbar .mat-focused .mat-form-field-ripple{background-color:currentColor}.mat-toolbar .mat-form-field-label,.mat-toolbar .mat-focused .mat-form-field-label,.mat-toolbar .mat-select-value,.mat-toolbar .mat-select-arrow,.mat-toolbar .mat-form-field.mat-focused .mat-select-arrow{color:inherit}.mat-toolbar .mat-input-element{caret-color:currentColor}.mat-toolbar .mat-mdc-button-base.mat-mdc-button-base.mat-unthemed{--mdc-text-button-label-text-color:var(--mat-toolbar-container-text-color);--mdc-outlined-button-label-text-color:var(--mat-toolbar-container-text-color)}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap;height:var(--mat-toolbar-standard-height)}@media(max-width: 599px){.mat-toolbar-row,.mat-toolbar-single-row{height:var(--mat-toolbar-mobile-height)}}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%;min-height:var(--mat-toolbar-standard-height)}@media(max-width: 599px){.mat-toolbar-multiple-rows{min-height:var(--mat-toolbar-mobile-height)}}"],encapsulation:2,changeDetection:0});let e=t;return e})();var Y$=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({imports:[rn,rn]});let e=t;return e})();var J$=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({imports:[rn,rn]});let e=t;return e})();var $7=["mat-button",""],k7=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],M7=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var A7=new _e("MAT_BUTTON_CONFIG");var R7=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab-base","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mat-mdc-fab-base","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],O7=(()=>{let t=class t{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(n){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,n)}get disableRipple(){return this._disableRipple}set disableRipple(n){this._disableRipple=n,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(n){this._disabled=n,this._updateRippleDisabled()}constructor(n,r,o,s){this._elementRef=n,this._platform=r,this._ngZone=o,this._animationMode=s,this._focusMonitor=ne(mm),this._rippleLoader=ne(Z$),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let a=ne(A7,{optional:!0}),u=n.nativeElement,c=u.classList;this.disabledInteractive=a?.disabledInteractive??!1,this.color=a?.color??null,this._rippleLoader?.configureRipple(u,{className:"mat-mdc-button-ripple"});for(let{attribute:f,mdcClasses:p}of R7)u.hasAttribute(f)&&c.add(...p)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(n="program",r){n?this._focusMonitor.focusVia(this._elementRef.nativeElement,n,r):this._elementRef.nativeElement.focus(r)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};t.\u0275fac=function(r){kp()},t.\u0275dir=Me({type:t,inputs:{color:"color",disableRipple:[2,"disableRipple","disableRipple",Ut],disabled:[2,"disabled","disabled",Ut],ariaDisabled:[2,"aria-disabled","ariaDisabled",Ut],disabledInteractive:[2,"disabledInteractive","disabledInteractive",Ut]},features:[gn]});let e=t;return e})();var Ft=(()=>{let t=class t extends O7{constructor(n,r,o,s){super(n,r,o,s)}};t.\u0275fac=function(r){return new(r||t)(V(Je),V(Ht),V(Re),V(uo,8))},t.\u0275cmp=Oe({type:t,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(r,o){r&2&&(Gn("disabled",o._getDisabledAttribute())("aria-disabled",o._getAriaDisabled()),Cd(o.color?"mat-"+o.color:""),Nt("mat-mdc-button-disabled",o.disabled)("mat-mdc-button-disabled-interactive",o.disabledInteractive)("_mat-animation-noopable",o._animationMode==="NoopAnimations")("mat-unthemed",!o.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Pt,nn],attrs:$7,ngContentSelectors:M7,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(r,o){r&1&&(Bn(k7),G(0,"span",0),Dt(1),N(2,"span",1),Dt(3,1),O(),Dt(4,2),G(5,"span",2)(6,"span",3)),r&2&&Nt("mdc-button__ripple",!o._isFab)("mdc-fab__ripple",o._isFab)},styles:['.mat-mdc-button-base{text-decoration:none}.mdc-button{-webkit-user-select:none;user-select:none;position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0);padding:0 8px}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__label{position:relative}.mat-mdc-button{padding:0 var(--mat-text-button-horizontal-padding, 8px);height:var(--mdc-text-button-container-height);font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);text-transform:var(--mdc-text-button-label-text-transform);font-weight:var(--mdc-text-button-label-text-weight)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button,.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 var(--mat-filled-button-horizontal-padding, 16px);height:var(--mdc-filled-button-container-height);font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);text-transform:var(--mdc-filled-button-label-text-transform);font-weight:var(--mdc-filled-button-label-text-weight)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color);background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button,.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow);height:var(--mdc-protected-button-container-height);font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);text-transform:var(--mdc-protected-button-label-text-transform);font-weight:var(--mdc-protected-button-label-text-weight)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color);background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button,.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 var(--mat-outlined-button-horizontal-padding, 15px);height:var(--mdc-outlined-button-container-height);font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);text-transform:var(--mdc-outlined-button-label-text-transform);font-weight:var(--mdc-outlined-button-label-text-weight);border-radius:var(--mdc-outlined-button-container-shape);border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color);border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button .mdc-button__ripple{border-width:var(--mdc-outlined-button-outline-width);border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-button .mat-icon,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-unelevated-button .mat-icon,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-raised-button .mat-icon,.mat-mdc-outlined-button .mdc-button__label,.mat-mdc-outlined-button .mat-icon{z-index:1;position:relative}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let e=t;return e})();var X$=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({imports:[rn,bm,rn]});let e=t;return e})();function ym(e){return e&&typeof e.connect=="function"&&!(e instanceof Co)}var xl=function(e){return e[e.REPLACED=0]="REPLACED",e[e.INSERTED=1]="INSERTED",e[e.MOVED=2]="MOVED",e[e.REMOVED=3]="REMOVED",e}(xl||{}),Hd=new _e("_ViewRepeater"),Cl=class{applyChanges(t,i,n,r,o){t.forEachOperation((s,a,u)=>{let c,f;if(s.previousIndex==null){let p=n(s,a,u);c=i.createEmbeddedView(p.templateRef,p.context,p.index),f=xl.INSERTED}else u==null?(i.remove(a),f=xl.REMOVED):(c=i.get(a),i.move(c,u),f=xl.MOVED);o&&o({context:c?.context,operation:f,record:s})})}detach(){}};var ek=(()=>{let t=class t{constructor(){this._listeners=[]}notify(n,r){for(let o of this._listeners)o(n,r)}listen(n){return this._listeners.push(n),()=>{this._listeners=this._listeners.filter(r=>n!==r)}}ngOnDestroy(){this._listeners=[]}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var F7=20,nk=(()=>{let t=class t{constructor(n,r,o){this._platform=n,this._change=new lt,this._changeListener=s=>{this._change.next(s)},this._document=o,r.runOutsideAngular(()=>{if(n.isBrowser){let s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let n=this._getWindow();n.removeEventListener("resize",this._changeListener),n.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let n={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),n}getViewportRect(){let n=this.getViewportScrollPosition(),{width:r,height:o}=this.getViewportSize();return{top:n.top,left:n.left,bottom:n.top+o,right:n.left+r,height:o,width:r}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let n=this._document,r=this._getWindow(),o=n.documentElement,s=o.getBoundingClientRect(),a=-s.top||n.body.scrollTop||r.scrollY||o.scrollTop||0,u=-s.left||n.body.scrollLeft||r.scrollX||o.scrollLeft||0;return{top:a,left:u}}change(n=F7){return n>0?this._change.pipe(Hb(n)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let n=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:n.innerWidth,height:n.innerHeight}:{width:0,height:0}}};t.\u0275fac=function(r){return new(r||t)(me(Ht),me(Re),me(yt,8))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var tk=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({});let e=t;return e})(),ik=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({imports:[wl,tk,wl,tk]});let e=t;return e})();var B7=[[["caption"]],[["colgroup"],["col"]],"*"],j7=["caption","colgroup, col","*"];function V7(e,t){e&1&&Dt(0,2)}function U7(e,t){e&1&&(N(0,"thead",0),li(1,1),O(),N(2,"tbody",0),li(3,2)(4,3),O(),N(5,"tfoot",0),li(6,4),O())}function H7(e,t){e&1&&li(0,1)(1,2)(2,3)(3,4)}var lr=new _e("CDK_TABLE");var Sm=(()=>{let t=class t{constructor(n){this.template=n}};t.\u0275fac=function(r){return new(r||t)(V(Hn))},t.\u0275dir=Me({type:t,selectors:[["","cdkCellDef",""]],standalone:!0});let e=t;return e})(),Dm=(()=>{let t=class t{constructor(n){this.template=n}};t.\u0275fac=function(r){return new(r||t)(V(Hn))},t.\u0275dir=Me({type:t,selectors:[["","cdkHeaderCellDef",""]],standalone:!0});let e=t;return e})(),sk=(()=>{let t=class t{constructor(n){this.template=n}};t.\u0275fac=function(r){return new(r||t)(V(Hn))},t.\u0275dir=Me({type:t,selectors:[["","cdkFooterCellDef",""]],standalone:!0});let e=t;return e})(),El=(()=>{let t=class t{get name(){return this._name}set name(n){this._setNameInput(n)}get sticky(){return this._sticky}set sticky(n){n!==this._sticky&&(this._sticky=n,this._hasStickyChanged=!0)}get stickyEnd(){return this._stickyEnd}set stickyEnd(n){n!==this._stickyEnd&&(this._stickyEnd=n,this._hasStickyChanged=!0)}constructor(n){this._table=n,this._hasStickyChanged=!1,this._sticky=!1,this._stickyEnd=!1}hasStickyChanged(){let n=this._hasStickyChanged;return this.resetStickyChanged(),n}resetStickyChanged(){this._hasStickyChanged=!1}_updateColumnCssClassName(){this._columnCssClassName=[`cdk-column-${this.cssClassFriendlyName}`]}_setNameInput(n){n&&(this._name=n,this.cssClassFriendlyName=n.replace(/[^a-z0-9_-]/gi,"-"),this._updateColumnCssClassName())}};t.\u0275fac=function(r){return new(r||t)(V(lr,8))},t.\u0275dir=Me({type:t,selectors:[["","cdkColumnDef",""]],contentQueries:function(r,o,s){if(r&1&&(_n(s,Sm,5),_n(s,Dm,5),_n(s,sk,5)),r&2){let a;vt(a=bt())&&(o.cell=a.first),vt(a=bt())&&(o.headerCell=a.first),vt(a=bt())&&(o.footerCell=a.first)}},inputs:{name:[0,"cdkColumnDef","name"],sticky:[2,"sticky","sticky",Ut],stickyEnd:[2,"stickyEnd","stickyEnd",Ut]},standalone:!0,features:[Gt([{provide:"MAT_SORT_HEADER_COLUMN_DEF",useExisting:t}]),gn]});let e=t;return e})(),xm=class{constructor(t,i){i.nativeElement.classList.add(...t._columnCssClassName)}},ak=(()=>{let t=class t extends xm{constructor(n,r){super(n,r)}};t.\u0275fac=function(r){return new(r||t)(V(El),V(Je))},t.\u0275dir=Me({type:t,selectors:[["cdk-header-cell"],["th","cdk-header-cell",""]],hostAttrs:["role","columnheader",1,"cdk-header-cell"],standalone:!0,features:[Pt]});let e=t;return e})();var lk=(()=>{let t=class t extends xm{constructor(n,r){super(n,r);let o=n._table?._getCellRole();o&&r.nativeElement.setAttribute("role",o)}};t.\u0275fac=function(r){return new(r||t)(V(El),V(Je))},t.\u0275dir=Me({type:t,selectors:[["cdk-cell"],["td","cdk-cell",""]],hostAttrs:[1,"cdk-cell"],standalone:!0,features:[Pt]});let e=t;return e})(),Cm=class{constructor(){this.tasks=[],this.endTasks=[]}},Em=new _e("_COALESCED_STYLE_SCHEDULER"),Lw=(()=>{let t=class t{constructor(n){this._currentSchedule=null,this._ngZone=ne(Re)}schedule(n){this._createScheduleIfNeeded(),this._currentSchedule.tasks.push(n)}scheduleEnd(n){this._createScheduleIfNeeded(),this._currentSchedule.endTasks.push(n)}_createScheduleIfNeeded(){this._currentSchedule||(this._currentSchedule=new Cm,this._ngZone.runOutsideAngular(()=>queueMicrotask(()=>{for(;this._currentSchedule.tasks.length||this._currentSchedule.endTasks.length;){let n=this._currentSchedule;this._currentSchedule=new Cm;for(let r of n.tasks)r();for(let r of n.endTasks)r()}this._currentSchedule=null})))}};t.\u0275fac=function(r){return new(r||t)(me(Re))},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})();var Bw=(()=>{let t=class t{constructor(n,r){this.template=n,this._differs=r}ngOnChanges(n){if(!this._columnsDiffer){let r=n.columns&&n.columns.currentValue||[];this._columnsDiffer=this._differs.find(r).create(),this._columnsDiffer.diff(r)}}getColumnsDiff(){return this._columnsDiffer.diff(this.columns)}extractCellTemplate(n){return this instanceof Wd?n.headerCell.template:this instanceof jw?n.footerCell.template:n.cell.template}};t.\u0275fac=function(r){return new(r||t)(V(Hn),V(co))},t.\u0275dir=Me({type:t,features:[Wn]});let e=t;return e})(),Wd=(()=>{let t=class t extends Bw{get sticky(){return this._sticky}set sticky(n){n!==this._sticky&&(this._sticky=n,this._hasStickyChanged=!0)}constructor(n,r,o){super(n,r),this._table=o,this._hasStickyChanged=!1,this._sticky=!1}ngOnChanges(n){super.ngOnChanges(n)}hasStickyChanged(){let n=this._hasStickyChanged;return this.resetStickyChanged(),n}resetStickyChanged(){this._hasStickyChanged=!1}};t.\u0275fac=function(r){return new(r||t)(V(Hn),V(co),V(lr,8))},t.\u0275dir=Me({type:t,selectors:[["","cdkHeaderRowDef",""]],inputs:{columns:[0,"cdkHeaderRowDef","columns"],sticky:[2,"cdkHeaderRowDefSticky","sticky",Ut]},standalone:!0,features:[gn,Pt,Wn]});let e=t;return e})(),jw=(()=>{let t=class t extends Bw{get sticky(){return this._sticky}set sticky(n){n!==this._sticky&&(this._sticky=n,this._hasStickyChanged=!0)}constructor(n,r,o){super(n,r),this._table=o,this._hasStickyChanged=!1,this._sticky=!1}ngOnChanges(n){super.ngOnChanges(n)}hasStickyChanged(){let n=this._hasStickyChanged;return this.resetStickyChanged(),n}resetStickyChanged(){this._hasStickyChanged=!1}};t.\u0275fac=function(r){return new(r||t)(V(Hn),V(co),V(lr,8))},t.\u0275dir=Me({type:t,selectors:[["","cdkFooterRowDef",""]],inputs:{columns:[0,"cdkFooterRowDef","columns"],sticky:[2,"cdkFooterRowDefSticky","sticky",Ut]},standalone:!0,features:[gn,Pt,Wn]});let e=t;return e})(),Tm=(()=>{let t=class t extends Bw{constructor(n,r,o){super(n,r),this._table=o}};t.\u0275fac=function(r){return new(r||t)(V(Hn),V(co),V(lr,8))},t.\u0275dir=Me({type:t,selectors:[["","cdkRowDef",""]],inputs:{columns:[0,"cdkRowDefColumns","columns"],when:[0,"cdkRowDefWhen","when"]},standalone:!0,features:[Pt]});let e=t;return e})(),sa=(()=>{let t=class t{constructor(n){this._viewContainer=n,t.mostRecentCellOutlet=this}ngOnDestroy(){t.mostRecentCellOutlet===this&&(t.mostRecentCellOutlet=null)}};t.mostRecentCellOutlet=null,t.\u0275fac=function(r){return new(r||t)(V(ai))},t.\u0275dir=Me({type:t,selectors:[["","cdkCellOutlet",""]],standalone:!0});let e=t;return e})(),Vw=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=Oe({type:t,selectors:[["cdk-header-row"],["tr","cdk-header-row",""]],hostAttrs:["role","row",1,"cdk-header-row"],standalone:!0,features:[nn],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(r,o){r&1&&li(0,0)},dependencies:[sa],encapsulation:2});let e=t;return e})();var Uw=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=Oe({type:t,selectors:[["cdk-row"],["tr","cdk-row",""]],hostAttrs:["role","row",1,"cdk-row"],standalone:!0,features:[nn],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(r,o){r&1&&li(0,0)},dependencies:[sa],encapsulation:2});let e=t;return e})(),uk=(()=>{let t=class t{constructor(n){this.templateRef=n,this._contentClassName="cdk-no-data-row"}};t.\u0275fac=function(r){return new(r||t)(V(Hn))},t.\u0275dir=Me({type:t,selectors:[["ng-template","cdkNoDataRow",""]],standalone:!0});let e=t;return e})(),rk=["top","bottom","left","right"],zw=class{constructor(t,i,n,r,o=!0,s=!0,a){this._isNativeHtmlTable=t,this._stickCellCss=i,this.direction=n,this._coalescedStyleScheduler=r,this._isBrowser=o,this._needsPositionStickyOnElement=s,this._positionListener=a,this._cachedCellWidths=[],this._borderCellCss={top:`${i}-border-elem-top`,bottom:`${i}-border-elem-bottom`,left:`${i}-border-elem-left`,right:`${i}-border-elem-right`}}clearStickyPositioning(t,i){let n=[];for(let r of t)if(r.nodeType===r.ELEMENT_NODE){n.push(r);for(let o=0;o<r.children.length;o++)n.push(r.children[o])}this._coalescedStyleScheduler.schedule(()=>{for(let r of n)this._removeStickyStyle(r,i)})}updateStickyColumns(t,i,n,r=!0){if(!t.length||!this._isBrowser||!(i.some(o=>o)||n.some(o=>o))){this._positionListener&&(this._positionListener.stickyColumnsUpdated({sizes:[]}),this._positionListener.stickyEndColumnsUpdated({sizes:[]}));return}this._coalescedStyleScheduler.schedule(()=>{let o=t[0],s=o.children.length,a=this._getCellWidths(o,r),u=this._getStickyStartColumnPositions(a,i),c=this._getStickyEndColumnPositions(a,n),f=i.lastIndexOf(!0),p=n.indexOf(!0),m=this.direction==="rtl",v=m?"right":"left",b=m?"left":"right";for(let w of t)for(let C=0;C<s;C++){let x=w.children[C];i[C]&&this._addStickyStyle(x,v,u[C],C===f),n[C]&&this._addStickyStyle(x,b,c[C],C===p)}this._positionListener&&(this._positionListener.stickyColumnsUpdated({sizes:f===-1?[]:a.slice(0,f+1).map((w,C)=>i[C]?w:null)}),this._positionListener.stickyEndColumnsUpdated({sizes:p===-1?[]:a.slice(p).map((w,C)=>n[C+p]?w:null).reverse()}))})}stickRows(t,i,n){this._isBrowser&&this._coalescedStyleScheduler.schedule(()=>{let r=n==="bottom"?t.slice().reverse():t,o=n==="bottom"?i.slice().reverse():i,s=[],a=[],u=[];for(let f=0,p=0;f<r.length;f++){if(!o[f])continue;s[f]=p;let m=r[f];u[f]=this._isNativeHtmlTable?Array.from(m.children):[m];let v=m.getBoundingClientRect().height;p+=v,a[f]=v}let c=o.lastIndexOf(!0);for(let f=0;f<r.length;f++){if(!o[f])continue;let p=s[f],m=f===c;for(let v of u[f])this._addStickyStyle(v,n,p,m)}n==="top"?this._positionListener?.stickyHeaderRowsUpdated({sizes:a,offsets:s,elements:u}):this._positionListener?.stickyFooterRowsUpdated({sizes:a,offsets:s,elements:u})})}updateStickyFooterContainer(t,i){this._isNativeHtmlTable&&this._coalescedStyleScheduler.schedule(()=>{let n=t.querySelector("tfoot");n&&(i.some(r=>!r)?this._removeStickyStyle(n,["bottom"]):this._addStickyStyle(n,"bottom",0,!1))})}_removeStickyStyle(t,i){for(let r of i)t.style[r]="",t.classList.remove(this._borderCellCss[r]);rk.some(r=>i.indexOf(r)===-1&&t.style[r])?t.style.zIndex=this._getCalculatedZIndex(t):(t.style.zIndex="",this._needsPositionStickyOnElement&&(t.style.position=""),t.classList.remove(this._stickCellCss))}_addStickyStyle(t,i,n,r){t.classList.add(this._stickCellCss),r&&t.classList.add(this._borderCellCss[i]),t.style[i]=`${n}px`,t.style.zIndex=this._getCalculatedZIndex(t),this._needsPositionStickyOnElement&&(t.style.cssText+="position: -webkit-sticky; position: sticky; ")}_getCalculatedZIndex(t){let i={top:100,bottom:10,left:1,right:1},n=0;for(let r of rk)t.style[r]&&(n+=i[r]);return n?`${n}`:""}_getCellWidths(t,i=!0){if(!i&&this._cachedCellWidths.length)return this._cachedCellWidths;let n=[],r=t.children;for(let o=0;o<r.length;o++){let s=r[o];n.push(s.getBoundingClientRect().width)}return this._cachedCellWidths=n,n}_getStickyStartColumnPositions(t,i){let n=[],r=0;for(let o=0;o<t.length;o++)i[o]&&(n[o]=r,r+=t[o]);return n}_getStickyEndColumnPositions(t,i){let n=[],r=0;for(let o=t.length;o>0;o--)i[o]&&(n[o]=r,r+=t[o]);return n}};var Im=new _e("CDK_SPL");var Hw=(()=>{let t=class t{constructor(n,r){this.viewContainer=n,this.elementRef=r;let o=ne(lr);o._rowOutlet=this,o._outletAssigned()}};t.\u0275fac=function(r){return new(r||t)(V(ai),V(Je))},t.\u0275dir=Me({type:t,selectors:[["","rowOutlet",""]],standalone:!0});let e=t;return e})(),Ww=(()=>{let t=class t{constructor(n,r){this.viewContainer=n,this.elementRef=r;let o=ne(lr);o._headerRowOutlet=this,o._outletAssigned()}};t.\u0275fac=function(r){return new(r||t)(V(ai),V(Je))},t.\u0275dir=Me({type:t,selectors:[["","headerRowOutlet",""]],standalone:!0});let e=t;return e})(),qw=(()=>{let t=class t{constructor(n,r){this.viewContainer=n,this.elementRef=r;let o=ne(lr);o._footerRowOutlet=this,o._outletAssigned()}};t.\u0275fac=function(r){return new(r||t)(V(ai),V(Je))},t.\u0275dir=Me({type:t,selectors:[["","footerRowOutlet",""]],standalone:!0});let e=t;return e})(),Gw=(()=>{let t=class t{constructor(n,r){this.viewContainer=n,this.elementRef=r;let o=ne(lr);o._noDataRowOutlet=this,o._outletAssigned()}};t.\u0275fac=function(r){return new(r||t)(V(ai),V(Je))},t.\u0275dir=Me({type:t,selectors:[["","noDataRowOutlet",""]],standalone:!0});let e=t;return e})();var Kw=(()=>{let t=class t{_getCellRole(){if(this._cellRoleInternal===void 0){let n=this._elementRef.nativeElement.getAttribute("role"),r=n==="grid"||n==="treegrid"?"gridcell":"cell";this._cellRoleInternal=this._isNativeHtmlTable&&r==="cell"?null:r}return this._cellRoleInternal}get trackBy(){return this._trackByFn}set trackBy(n){this._trackByFn=n}get dataSource(){return this._dataSource}set dataSource(n){this._dataSource!==n&&this._switchDataSource(n)}get multiTemplateDataRows(){return this._multiTemplateDataRows}set multiTemplateDataRows(n){this._multiTemplateDataRows=n,this._rowOutlet&&this._rowOutlet.viewContainer.length&&(this._forceRenderDataRows(),this.updateStickyColumnStyles())}get fixedLayout(){return this._fixedLayout}set fixedLayout(n){this._fixedLayout=n,this._forceRecalculateCellWidths=!0,this._stickyColumnStylesNeedReset=!0}constructor(n,r,o,s,a,u,c,f,p,m,v,b){this._differs=n,this._changeDetectorRef=r,this._elementRef=o,this._dir=a,this._platform=c,this._viewRepeater=f,this._coalescedStyleScheduler=p,this._viewportRuler=m,this._stickyPositioningListener=v,this._onDestroy=new lt,this._columnDefsByName=new Map,this._customColumnDefs=new Set,this._customRowDefs=new Set,this._customHeaderRowDefs=new Set,this._customFooterRowDefs=new Set,this._headerRowDefChanged=!0,this._footerRowDefChanged=!0,this._stickyColumnStylesNeedReset=!0,this._forceRecalculateCellWidths=!0,this._cachedRenderRowsMap=new Map,this.stickyCssClass="cdk-table-sticky",this.needsPositionStickyOnElement=!0,this._isShowingNoDataRow=!1,this._hasAllOutlets=!1,this._hasInitialized=!1,this._cellRoleInternal=void 0,this._multiTemplateDataRows=!1,this._fixedLayout=!1,this.contentChanged=new Tt,this.viewChange=new dn({start:0,end:Number.MAX_VALUE}),this._injector=ne(fn),s||o.nativeElement.setAttribute("role","table"),this._document=u,this._isServer=!c.isBrowser,this._isNativeHtmlTable=o.nativeElement.nodeName==="TABLE"}ngOnInit(){this._setupStickyStyler(),this._dataDiffer=this._differs.find([]).create((n,r)=>this.trackBy?this.trackBy(r.dataIndex,r.data):r),this._viewportRuler.change().pipe(zn(this._onDestroy)).subscribe(()=>{this._forceRecalculateCellWidths=!0})}ngAfterContentInit(){this._hasInitialized=!0}ngAfterContentChecked(){this._canRender()&&this._render()}ngOnDestroy(){[this._rowOutlet?.viewContainer,this._headerRowOutlet?.viewContainer,this._footerRowOutlet?.viewContainer,this._cachedRenderRowsMap,this._customColumnDefs,this._customRowDefs,this._customHeaderRowDefs,this._customFooterRowDefs,this._columnDefsByName].forEach(n=>{n?.clear()}),this._headerRowDefs=[],this._footerRowDefs=[],this._defaultRowDef=null,this._onDestroy.next(),this._onDestroy.complete(),ym(this.dataSource)&&this.dataSource.disconnect(this)}renderRows(){this._renderRows=this._getAllRenderRows();let n=this._dataDiffer.diff(this._renderRows);if(!n){this._updateNoDataRow(),this.contentChanged.next();return}let r=this._rowOutlet.viewContainer;this._viewRepeater.applyChanges(n,r,(o,s,a)=>this._getEmbeddedViewArgs(o.item,a),o=>o.item.data,o=>{o.operation===xl.INSERTED&&o.context&&this._renderCellTemplateForItem(o.record.item.rowDef,o.context)}),this._updateRowIndexContext(),n.forEachIdentityChange(o=>{let s=r.get(o.currentIndex);s.context.$implicit=o.item.data}),this._updateNoDataRow(),Bo(()=>{this.updateStickyColumnStyles()},{injector:this._injector}),this.contentChanged.next()}addColumnDef(n){this._customColumnDefs.add(n)}removeColumnDef(n){this._customColumnDefs.delete(n)}addRowDef(n){this._customRowDefs.add(n)}removeRowDef(n){this._customRowDefs.delete(n)}addHeaderRowDef(n){this._customHeaderRowDefs.add(n),this._headerRowDefChanged=!0}removeHeaderRowDef(n){this._customHeaderRowDefs.delete(n),this._headerRowDefChanged=!0}addFooterRowDef(n){this._customFooterRowDefs.add(n),this._footerRowDefChanged=!0}removeFooterRowDef(n){this._customFooterRowDefs.delete(n),this._footerRowDefChanged=!0}setNoDataRow(n){this._customNoDataRow=n}updateStickyHeaderRowStyles(){let n=this._getRenderedRows(this._headerRowOutlet);if(this._isNativeHtmlTable){let o=ok(this._headerRowOutlet,"thead");o&&(o.style.display=n.length?"":"none")}let r=this._headerRowDefs.map(o=>o.sticky);this._stickyStyler.clearStickyPositioning(n,["top"]),this._stickyStyler.stickRows(n,r,"top"),this._headerRowDefs.forEach(o=>o.resetStickyChanged())}updateStickyFooterRowStyles(){let n=this._getRenderedRows(this._footerRowOutlet);if(this._isNativeHtmlTable){let o=ok(this._footerRowOutlet,"tfoot");o&&(o.style.display=n.length?"":"none")}let r=this._footerRowDefs.map(o=>o.sticky);this._stickyStyler.clearStickyPositioning(n,["bottom"]),this._stickyStyler.stickRows(n,r,"bottom"),this._stickyStyler.updateStickyFooterContainer(this._elementRef.nativeElement,r),this._footerRowDefs.forEach(o=>o.resetStickyChanged())}updateStickyColumnStyles(){let n=this._getRenderedRows(this._headerRowOutlet),r=this._getRenderedRows(this._rowOutlet),o=this._getRenderedRows(this._footerRowOutlet);(this._isNativeHtmlTable&&!this._fixedLayout||this._stickyColumnStylesNeedReset)&&(this._stickyStyler.clearStickyPositioning([...n,...r,...o],["left","right"]),this._stickyColumnStylesNeedReset=!1),n.forEach((s,a)=>{this._addStickyColumnStyles([s],this._headerRowDefs[a])}),this._rowDefs.forEach(s=>{let a=[];for(let u=0;u<r.length;u++)this._renderRows[u].rowDef===s&&a.push(r[u]);this._addStickyColumnStyles(a,s)}),o.forEach((s,a)=>{this._addStickyColumnStyles([s],this._footerRowDefs[a])}),Array.from(this._columnDefsByName.values()).forEach(s=>s.resetStickyChanged())}_outletAssigned(){!this._hasAllOutlets&&this._rowOutlet&&this._headerRowOutlet&&this._footerRowOutlet&&this._noDataRowOutlet&&(this._hasAllOutlets=!0,this._canRender()&&this._render())}_canRender(){return this._hasAllOutlets&&this._hasInitialized}_render(){this._cacheRowDefs(),this._cacheColumnDefs(),!this._headerRowDefs.length&&!this._footerRowDefs.length&&this._rowDefs.length;let r=this._renderUpdatedColumns()||this._headerRowDefChanged||this._footerRowDefChanged;this._stickyColumnStylesNeedReset=this._stickyColumnStylesNeedReset||r,this._forceRecalculateCellWidths=r,this._headerRowDefChanged&&(this._forceRenderHeaderRows(),this._headerRowDefChanged=!1),this._footerRowDefChanged&&(this._forceRenderFooterRows(),this._footerRowDefChanged=!1),this.dataSource&&this._rowDefs.length>0&&!this._renderChangeSubscription?this._observeRenderChanges():this._stickyColumnStylesNeedReset&&this.updateStickyColumnStyles(),this._checkStickyStates()}_getAllRenderRows(){let n=[],r=this._cachedRenderRowsMap;this._cachedRenderRowsMap=new Map;for(let o=0;o<this._data.length;o++){let s=this._data[o],a=this._getRenderRowsForData(s,o,r.get(s));this._cachedRenderRowsMap.has(s)||this._cachedRenderRowsMap.set(s,new WeakMap);for(let u=0;u<a.length;u++){let c=a[u],f=this._cachedRenderRowsMap.get(c.data);f.has(c.rowDef)?f.get(c.rowDef).push(c):f.set(c.rowDef,[c]),n.push(c)}}return n}_getRenderRowsForData(n,r,o){return this._getRowDefs(n,r).map(a=>{let u=o&&o.has(a)?o.get(a):[];if(u.length){let c=u.shift();return c.dataIndex=r,c}else return{data:n,rowDef:a,dataIndex:r}})}_cacheColumnDefs(){this._columnDefsByName.clear(),wm(this._getOwnDefs(this._contentColumnDefs),this._customColumnDefs).forEach(r=>{this._columnDefsByName.has(r.name),this._columnDefsByName.set(r.name,r)})}_cacheRowDefs(){this._headerRowDefs=wm(this._getOwnDefs(this._contentHeaderRowDefs),this._customHeaderRowDefs),this._footerRowDefs=wm(this._getOwnDefs(this._contentFooterRowDefs),this._customFooterRowDefs),this._rowDefs=wm(this._getOwnDefs(this._contentRowDefs),this._customRowDefs);let n=this._rowDefs.filter(r=>!r.when);!this.multiTemplateDataRows&&n.length>1,this._defaultRowDef=n[0]}_renderUpdatedColumns(){let n=(a,u)=>a||!!u.getColumnsDiff(),r=this._rowDefs.reduce(n,!1);r&&this._forceRenderDataRows();let o=this._headerRowDefs.reduce(n,!1);o&&this._forceRenderHeaderRows();let s=this._footerRowDefs.reduce(n,!1);return s&&this._forceRenderFooterRows(),r||o||s}_switchDataSource(n){this._data=[],ym(this.dataSource)&&this.dataSource.disconnect(this),this._renderChangeSubscription&&(this._renderChangeSubscription.unsubscribe(),this._renderChangeSubscription=null),n||(this._dataDiffer&&this._dataDiffer.diff([]),this._rowOutlet&&this._rowOutlet.viewContainer.clear()),this._dataSource=n}_observeRenderChanges(){if(!this.dataSource)return;let n;ym(this.dataSource)?n=this.dataSource.connect(this):Fs(this.dataSource)?n=this.dataSource:Array.isArray(this.dataSource)&&(n=Ne(this.dataSource)),this._renderChangeSubscription=n.pipe(zn(this._onDestroy)).subscribe(r=>{this._data=r||[],this.renderRows()})}_forceRenderHeaderRows(){this._headerRowOutlet.viewContainer.length>0&&this._headerRowOutlet.viewContainer.clear(),this._headerRowDefs.forEach((n,r)=>this._renderRow(this._headerRowOutlet,n,r)),this.updateStickyHeaderRowStyles()}_forceRenderFooterRows(){this._footerRowOutlet.viewContainer.length>0&&this._footerRowOutlet.viewContainer.clear(),this._footerRowDefs.forEach((n,r)=>this._renderRow(this._footerRowOutlet,n,r)),this.updateStickyFooterRowStyles()}_addStickyColumnStyles(n,r){let o=Array.from(r.columns||[]).map(u=>{let c=this._columnDefsByName.get(u);return c}),s=o.map(u=>u.sticky),a=o.map(u=>u.stickyEnd);this._stickyStyler.updateStickyColumns(n,s,a,!this._fixedLayout||this._forceRecalculateCellWidths)}_getRenderedRows(n){let r=[];for(let o=0;o<n.viewContainer.length;o++){let s=n.viewContainer.get(o);r.push(s.rootNodes[0])}return r}_getRowDefs(n,r){if(this._rowDefs.length==1)return[this._rowDefs[0]];let o=[];if(this.multiTemplateDataRows)o=this._rowDefs.filter(s=>!s.when||s.when(r,n));else{let s=this._rowDefs.find(a=>a.when&&a.when(r,n))||this._defaultRowDef;s&&o.push(s)}return o.length,o}_getEmbeddedViewArgs(n,r){let o=n.rowDef,s={$implicit:n.data};return{templateRef:o.template,context:s,index:r}}_renderRow(n,r,o,s={}){let a=n.viewContainer.createEmbeddedView(r.template,s,o);return this._renderCellTemplateForItem(r,s),a}_renderCellTemplateForItem(n,r){for(let o of this._getCellTemplates(n))sa.mostRecentCellOutlet&&sa.mostRecentCellOutlet._viewContainer.createEmbeddedView(o,r);this._changeDetectorRef.markForCheck()}_updateRowIndexContext(){let n=this._rowOutlet.viewContainer;for(let r=0,o=n.length;r<o;r++){let a=n.get(r).context;a.count=o,a.first=r===0,a.last=r===o-1,a.even=r%2===0,a.odd=!a.even,this.multiTemplateDataRows?(a.dataIndex=this._renderRows[r].dataIndex,a.renderIndex=r):a.index=this._renderRows[r].dataIndex}}_getCellTemplates(n){return!n||!n.columns?[]:Array.from(n.columns,r=>{let o=this._columnDefsByName.get(r);return n.extractCellTemplate(o)})}_forceRenderDataRows(){this._dataDiffer.diff([]),this._rowOutlet.viewContainer.clear(),this.renderRows()}_checkStickyStates(){let n=(r,o)=>r||o.hasStickyChanged();this._headerRowDefs.reduce(n,!1)&&this.updateStickyHeaderRowStyles(),this._footerRowDefs.reduce(n,!1)&&this.updateStickyFooterRowStyles(),Array.from(this._columnDefsByName.values()).reduce(n,!1)&&(this._stickyColumnStylesNeedReset=!0,this.updateStickyColumnStyles())}_setupStickyStyler(){let n=this._dir?this._dir.value:"ltr";this._stickyStyler=new zw(this._isNativeHtmlTable,this.stickyCssClass,n,this._coalescedStyleScheduler,this._platform.isBrowser,this.needsPositionStickyOnElement,this._stickyPositioningListener),(this._dir?this._dir.change:Ne()).pipe(zn(this._onDestroy)).subscribe(r=>{this._stickyStyler.direction=r,this.updateStickyColumnStyles()})}_getOwnDefs(n){return n.filter(r=>!r._table||r._table===this)}_updateNoDataRow(){let n=this._customNoDataRow||this._noDataRow;if(!n)return;let r=this._rowOutlet.viewContainer.length===0;if(r===this._isShowingNoDataRow)return;let o=this._noDataRowOutlet.viewContainer;if(r){let s=o.createEmbeddedView(n.templateRef),a=s.rootNodes[0];s.rootNodes.length===1&&a?.nodeType===this._document.ELEMENT_NODE&&(a.setAttribute("role","row"),a.classList.add(n._contentClassName))}else o.clear();this._isShowingNoDataRow=r,this._changeDetectorRef.markForCheck()}};t.\u0275fac=function(r){return new(r||t)(V(co),V(Kn),V(Je),Fo("role"),V(gm,8),V(yt),V(Ht),V(Hd),V(Em),V(nk),V(Im,12),V(Re,8))},t.\u0275cmp=Oe({type:t,selectors:[["cdk-table"],["table","cdk-table",""]],contentQueries:function(r,o,s){if(r&1&&(_n(s,uk,5),_n(s,El,5),_n(s,Tm,5),_n(s,Wd,5),_n(s,jw,5)),r&2){let a;vt(a=bt())&&(o._noDataRow=a.first),vt(a=bt())&&(o._contentColumnDefs=a),vt(a=bt())&&(o._contentRowDefs=a),vt(a=bt())&&(o._contentHeaderRowDefs=a),vt(a=bt())&&(o._contentFooterRowDefs=a)}},hostAttrs:[1,"cdk-table"],hostVars:2,hostBindings:function(r,o){r&2&&Nt("cdk-table-fixed-layout",o.fixedLayout)},inputs:{trackBy:"trackBy",dataSource:"dataSource",multiTemplateDataRows:[2,"multiTemplateDataRows","multiTemplateDataRows",Ut],fixedLayout:[2,"fixedLayout","fixedLayout",Ut]},outputs:{contentChanged:"contentChanged"},exportAs:["cdkTable"],standalone:!0,features:[Gt([{provide:lr,useExisting:t},{provide:Hd,useClass:Cl},{provide:Em,useClass:Lw},{provide:Im,useValue:null}]),gn,nn],ngContentSelectors:j7,decls:5,vars:2,consts:[["role","rowgroup"],["headerRowOutlet",""],["rowOutlet",""],["noDataRowOutlet",""],["footerRowOutlet",""]],template:function(r,o){r&1&&(Bn(B7),Dt(0),Dt(1,1),Ze(2,V7,1,0)(3,U7,7,0)(4,H7,4,0)),r&2&&(U(2),hn(o._isServer?2:-1),U(),hn(o._isNativeHtmlTable?3:4))},dependencies:[Ww,Hw,Gw,qw],styles:[".cdk-table-fixed-layout{table-layout:fixed}"],encapsulation:2});let e=t;return e})();function wm(e,t){return e.concat(Array.from(t))}function ok(e,t){let i=t.toUpperCase(),n=e.viewContainer.element.nativeElement;for(;n;){let r=n.nodeType===1?n.nodeName:null;if(r===i)return n;if(r==="TABLE")break;n=n.parentNode}return null}var ck=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({imports:[ik]});let e=t;return e})();var W7=[[["caption"]],[["colgroup"],["col"]],"*"],q7=["caption","colgroup, col","*"];function G7(e,t){e&1&&Dt(0,2)}function K7(e,t){e&1&&(N(0,"thead",0),li(1,1),O(),N(2,"tbody",2),li(3,3)(4,4),O(),N(5,"tfoot",0),li(6,5),O())}function Z7(e,t){e&1&&li(0,1)(1,3)(2,4)(3,5)}var Zo=(()=>{let t=class t extends Kw{constructor(){super(...arguments),this.stickyCssClass="mat-mdc-table-sticky",this.needsPositionStickyOnElement=!1}};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275cmp=Oe({type:t,selectors:[["mat-table"],["table","mat-table",""]],hostAttrs:[1,"mat-mdc-table","mdc-data-table__table"],hostVars:2,hostBindings:function(r,o){r&2&&Nt("mdc-table-fixed-layout",o.fixedLayout)},exportAs:["matTable"],standalone:!0,features:[Gt([{provide:Kw,useExisting:t},{provide:lr,useExisting:t},{provide:Em,useClass:Lw},{provide:Hd,useClass:Cl},{provide:Im,useValue:null}]),Pt,nn],ngContentSelectors:q7,decls:5,vars:2,consts:[["role","rowgroup"],["headerRowOutlet",""],["role","rowgroup",1,"mdc-data-table__content"],["rowOutlet",""],["noDataRowOutlet",""],["footerRowOutlet",""]],template:function(r,o){r&1&&(Bn(W7),Dt(0),Dt(1,1),Ze(2,G7,1,0)(3,K7,7,0)(4,Z7,4,0)),r&2&&(U(2),hn(o._isServer?2:-1),U(),hn(o._isNativeHtmlTable?3:4))},dependencies:[Ww,Hw,Gw,qw],styles:[".mat-mdc-table-sticky{position:sticky !important}mat-table{display:block}mat-header-row{min-height:56px}mat-row,mat-footer-row{min-height:48px}mat-row,mat-header-row,mat-footer-row{display:flex;border-width:0;border-bottom-width:1px;border-style:solid;align-items:center;box-sizing:border-box}mat-cell:first-of-type,mat-header-cell:first-of-type,mat-footer-cell:first-of-type{padding-left:24px}[dir=rtl] mat-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:first-of-type:not(:only-of-type){padding-left:0;padding-right:24px}mat-cell:last-of-type,mat-header-cell:last-of-type,mat-footer-cell:last-of-type{padding-right:24px}[dir=rtl] mat-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:last-of-type:not(:only-of-type){padding-right:0;padding-left:24px}mat-cell,mat-header-cell,mat-footer-cell{flex:1;display:flex;align-items:center;overflow:hidden;word-wrap:break-word;min-height:inherit}.mat-mdc-table{min-width:100%;border:0;border-spacing:0;table-layout:auto;white-space:normal;background-color:var(--mat-table-background-color)}.mdc-data-table__cell{box-sizing:border-box;overflow:hidden;text-align:left;text-overflow:ellipsis}[dir=rtl] .mdc-data-table__cell{text-align:right}.mdc-data-table__cell,.mdc-data-table__header-cell{padding:0 16px}.mat-mdc-header-row{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;height:var(--mat-table-header-container-height, 56px);color:var(--mat-table-header-headline-color, rgba(0, 0, 0, 0.87));font-family:var(--mat-table-header-headline-font, Roboto, sans-serif);line-height:var(--mat-table-header-headline-line-height);font-size:var(--mat-table-header-headline-size, 14px);font-weight:var(--mat-table-header-headline-weight, 500)}.mat-mdc-row{height:var(--mat-table-row-item-container-height, 52px);color:var(--mat-table-row-item-label-text-color, rgba(0, 0, 0, 0.87))}.mat-mdc-row,.mdc-data-table__content{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-table-row-item-label-text-font, Roboto, sans-serif);line-height:var(--mat-table-row-item-label-text-line-height);font-size:var(--mat-table-row-item-label-text-size, 14px);font-weight:var(--mat-table-row-item-label-text-weight)}.mat-mdc-footer-row{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;height:var(--mat-table-footer-container-height, 52px);color:var(--mat-table-row-item-label-text-color, rgba(0, 0, 0, 0.87));font-family:var(--mat-table-footer-supporting-text-font, Roboto, sans-serif);line-height:var(--mat-table-footer-supporting-text-line-height);font-size:var(--mat-table-footer-supporting-text-size, 14px);font-weight:var(--mat-table-footer-supporting-text-weight);letter-spacing:var(--mat-table-footer-supporting-text-tracking)}.mat-mdc-header-cell{border-bottom-color:var(--mat-table-row-item-outline-color, rgba(0, 0, 0, 0.12));border-bottom-width:var(--mat-table-row-item-outline-width, 1px);border-bottom-style:solid;letter-spacing:var(--mat-table-header-headline-tracking);font-weight:inherit;line-height:inherit;box-sizing:border-box;text-overflow:ellipsis;overflow:hidden;outline:none;text-align:left}[dir=rtl] .mat-mdc-header-cell{text-align:right}.mat-mdc-cell{border-bottom-color:var(--mat-table-row-item-outline-color, rgba(0, 0, 0, 0.12));border-bottom-width:var(--mat-table-row-item-outline-width, 1px);border-bottom-style:solid;letter-spacing:var(--mat-table-row-item-label-text-tracking);line-height:inherit}.mdc-data-table__row:last-child .mat-mdc-cell{border-bottom:none}.mat-mdc-footer-cell{letter-spacing:var(--mat-table-row-item-label-text-tracking)}mat-row.mat-mdc-row,mat-header-row.mat-mdc-header-row,mat-footer-row.mat-mdc-footer-row{border-bottom:none}.mat-mdc-table tbody,.mat-mdc-table tfoot,.mat-mdc-table thead,.mat-mdc-cell,.mat-mdc-footer-cell,.mat-mdc-header-row,.mat-mdc-row,.mat-mdc-footer-row,.mat-mdc-table .mat-mdc-header-cell{background:inherit}.mat-mdc-table mat-header-row.mat-mdc-header-row,.mat-mdc-table mat-row.mat-mdc-row,.mat-mdc-table mat-footer-row.mat-mdc-footer-cell{height:unset}mat-header-cell.mat-mdc-header-cell,mat-cell.mat-mdc-cell,mat-footer-cell.mat-mdc-footer-cell{align-self:stretch}"],encapsulation:2});let e=t;return e})(),$m=(()=>{let t=class t extends Sm{};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275dir=Me({type:t,selectors:[["","matCellDef",""]],standalone:!0,features:[Gt([{provide:Sm,useExisting:t}]),Pt]});let e=t;return e})(),km=(()=>{let t=class t extends Dm{};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275dir=Me({type:t,selectors:[["","matHeaderCellDef",""]],standalone:!0,features:[Gt([{provide:Dm,useExisting:t}]),Pt]});let e=t;return e})();var Mm=(()=>{let t=class t extends El{get name(){return this._name}set name(n){this._setNameInput(n)}_updateColumnCssClassName(){super._updateColumnCssClassName(),this._columnCssClassName.push(`mat-column-${this.cssClassFriendlyName}`)}};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275dir=Me({type:t,selectors:[["","matColumnDef",""]],inputs:{name:[0,"matColumnDef","name"]},standalone:!0,features:[Gt([{provide:El,useExisting:t},{provide:"MAT_SORT_HEADER_COLUMN_DEF",useExisting:t}]),Pt]});let e=t;return e})(),Am=(()=>{let t=class t extends ak{};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275dir=Me({type:t,selectors:[["mat-header-cell"],["th","mat-header-cell",""]],hostAttrs:["role","columnheader",1,"mat-mdc-header-cell","mdc-data-table__header-cell"],standalone:!0,features:[Pt]});let e=t;return e})();var Rm=(()=>{let t=class t extends lk{};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275dir=Me({type:t,selectors:[["mat-cell"],["td","mat-cell",""]],hostAttrs:[1,"mat-mdc-cell","mdc-data-table__cell"],standalone:!0,features:[Pt]});let e=t;return e})();var Om=(()=>{let t=class t extends Wd{};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275dir=Me({type:t,selectors:[["","matHeaderRowDef",""]],inputs:{columns:[0,"matHeaderRowDef","columns"],sticky:[2,"matHeaderRowDefSticky","sticky",Ut]},standalone:!0,features:[Gt([{provide:Wd,useExisting:t}]),gn,Pt]});let e=t;return e})();var Nm=(()=>{let t=class t extends Tm{};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275dir=Me({type:t,selectors:[["","matRowDef",""]],inputs:{columns:[0,"matRowDefColumns","columns"],when:[0,"matRowDefWhen","when"]},standalone:!0,features:[Gt([{provide:Tm,useExisting:t}]),Pt]});let e=t;return e})(),Pm=(()=>{let t=class t extends Vw{};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275cmp=Oe({type:t,selectors:[["mat-header-row"],["tr","mat-header-row",""]],hostAttrs:["role","row",1,"mat-mdc-header-row","mdc-data-table__header-row"],exportAs:["matHeaderRow"],standalone:!0,features:[Gt([{provide:Vw,useExisting:t}]),Pt,nn],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(r,o){r&1&&li(0,0)},dependencies:[sa],encapsulation:2});let e=t;return e})();var Fm=(()=>{let t=class t extends Uw{};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275cmp=Oe({type:t,selectors:[["mat-row"],["tr","mat-row",""]],hostAttrs:["role","row",1,"mat-mdc-row","mdc-data-table__row"],exportAs:["matRow"],standalone:!0,features:[Gt([{provide:Uw,useExisting:t}]),Pt,nn],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(r,o){r&1&&li(0,0)},dependencies:[sa],encapsulation:2});let e=t;return e})();var dk=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({imports:[rn,ck,rn]});let e=t;return e})();var Zw=class{constructor(t){this._box=t,this._destroyed=new lt,this._resizeSubject=new lt,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(i=>this._resizeSubject.next(i)))}observe(t){return this._elementObservables.has(t)||this._elementObservables.set(t,new st(i=>{let n=this._resizeSubject.subscribe(i);return this._resizeObserver?.observe(t,{box:this._box}),()=>{this._resizeObserver?.unobserve(t),n.unsubscribe(),this._elementObservables.delete(t)}}).pipe(mn(i=>i.some(n=>n.target===t)),$h({bufferSize:1,refCount:!0}),zn(this._destroyed))),this._elementObservables.get(t)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}},hk=(()=>{let t=class t{constructor(){this._observers=new Map,this._ngZone=ne(Re),typeof ResizeObserver<"u"}ngOnDestroy(){for(let[,n]of this._observers)n.destroy();this._observers.clear(),typeof ResizeObserver<"u"}observe(n,r){let o=r?.box||"content-box";return this._observers.has(o)||this._observers.set(o,new Zw(o)),this._observers.get(o).observe(n)}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var Il=function(e){return e[e.State=0]="State",e[e.Transition=1]="Transition",e[e.Sequence=2]="Sequence",e[e.Group=3]="Group",e[e.Animate=4]="Animate",e[e.Keyframes=5]="Keyframes",e[e.Style=6]="Style",e[e.Trigger=7]="Trigger",e[e.Reference=8]="Reference",e[e.AnimateChild=9]="AnimateChild",e[e.AnimateRef=10]="AnimateRef",e[e.Query=11]="Query",e[e.Stagger=12]="Stagger",e}(Il||{});function pk(e,t){return{type:Il.Trigger,name:e,definitions:t,options:{}}}function mk(e,t=null){return{type:Il.Animate,styles:t,timings:e}}function Qw(e){return{type:Il.Style,styles:e,offset:null}}function gk(e,t,i){return{type:Il.State,name:e,styles:t,options:i}}function _k(e,t,i=null){return{type:Il.Transition,expr:e,animation:t,options:i}}var Q7=["notch"],Y7=["matFormFieldNotchedOutline",""],J7=["*"],X7=["textField"],eK=["iconPrefixContainer"],tK=["textPrefixContainer"],nK=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],iK=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];function rK(e,t){e&1&&G(0,"span",19)}function oK(e,t){if(e&1&&(N(0,"label",18),Dt(1,1),Ze(2,rK,1,0,"span",19),O()),e&2){let i=je(2);Be("floating",i._shouldLabelFloat())("monitorResize",i._hasOutline())("id",i._labelId),Gn("for",i._control.disableAutomaticLabeling?null:i._control.id),U(2),hn(!i.hideRequiredMarker&&i._control.required?2:-1)}}function sK(e,t){if(e&1&&Ze(0,oK,3,5,"label",18),e&2){let i=je();hn(i._hasFloatingLabel()?0:-1)}}function aK(e,t){e&1&&G(0,"div",5)}function lK(e,t){}function uK(e,t){if(e&1&&Ze(0,lK,0,0,"ng-template",11),e&2){je(2);let i=B0(1);Be("ngTemplateOutlet",i)}}function cK(e,t){if(e&1&&(N(0,"div",7),Ze(1,uK,1,1,null,11),O()),e&2){let i=je();Be("matFormFieldNotchedOutlineOpen",i._shouldLabelFloat()),U(),hn(i._forceDisplayInfixLabel()?-1:1)}}function dK(e,t){e&1&&(N(0,"div",8,2),Dt(2,2),O())}function fK(e,t){e&1&&(N(0,"div",9,3),Dt(2,3),O())}function hK(e,t){}function pK(e,t){if(e&1&&Ze(0,hK,0,0,"ng-template",11),e&2){je();let i=B0(1);Be("ngTemplateOutlet",i)}}function mK(e,t){e&1&&(N(0,"div",12),Dt(1,4),O())}function gK(e,t){e&1&&(N(0,"div",13),Dt(1,5),O())}function _K(e,t){e&1&&G(0,"div",14)}function vK(e,t){if(e&1&&(N(0,"div",16),Dt(1,6),O()),e&2){let i=je();Be("@transitionMessages",i._subscriptAnimationState)}}function bK(e,t){if(e&1&&(N(0,"mat-hint",20),K(1),O()),e&2){let i=je(2);Be("id",i._hintLabelId),U(),fe(i.hintLabel)}}function yK(e,t){if(e&1&&(N(0,"div",17),Ze(1,bK,2,2,"mat-hint",20),Dt(2,7),G(3,"div",21),Dt(4,8),O()),e&2){let i=je();Be("@transitionMessages",i._subscriptAnimationState),U(),hn(i.hintLabel?1:-1)}}var Pr=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275dir=Me({type:t,selectors:[["mat-label"]],standalone:!0});let e=t;return e})();var wK=new _e("MatError");var xK=0,vk=(()=>{let t=class t{constructor(){this.align="start",this.id=`mat-mdc-hint-${xK++}`}};t.\u0275fac=function(r){return new(r||t)},t.\u0275dir=Me({type:t,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(r,o){r&2&&(cl("id",o.id),Gn("align",null),Nt("mat-mdc-form-field-hint-end",o.align==="end"))},inputs:{align:"align",id:"id"},standalone:!0});let e=t;return e})(),CK=new _e("MatPrefix");var EK=new _e("MatSuffix");var Sk=new _e("FloatingLabelParent"),bk=(()=>{let t=class t{get floating(){return this._floating}set floating(n){this._floating=n,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(n){this._monitorResize=n,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(n){this._elementRef=n,this._floating=!1,this._monitorResize=!1,this._resizeObserver=ne(hk),this._ngZone=ne(Re),this._parent=ne(Sk),this._resizeSubscription=new Wt}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return IK(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}};t.\u0275fac=function(r){return new(r||t)(V(Je))},t.\u0275dir=Me({type:t,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(r,o){r&2&&Nt("mdc-floating-label--float-above",o.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"},standalone:!0});let e=t;return e})();function IK(e){let t=e;if(t.offsetParent!==null)return t.scrollWidth;let i=t.cloneNode(!0);i.style.setProperty("position","absolute"),i.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(i);let n=i.scrollWidth;return i.remove(),n}var yk="mdc-line-ripple--active",zm="mdc-line-ripple--deactivating",wk=(()=>{let t=class t{constructor(n,r){this._elementRef=n,this._handleTransitionEnd=o=>{let s=this._elementRef.nativeElement.classList,a=s.contains(zm);o.propertyName==="opacity"&&a&&s.remove(yk,zm)},r.runOutsideAngular(()=>{n.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){let n=this._elementRef.nativeElement.classList;n.remove(zm),n.add(yk)}deactivate(){this._elementRef.nativeElement.classList.add(zm)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}};t.\u0275fac=function(r){return new(r||t)(V(Je),V(Re))},t.\u0275dir=Me({type:t,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"],standalone:!0});let e=t;return e})(),xk=(()=>{let t=class t{constructor(n,r){this._elementRef=n,this._ngZone=r,this.open=!1}ngAfterViewInit(){let n=this._elementRef.nativeElement.querySelector(".mdc-floating-label");n?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),typeof requestAnimationFrame=="function"&&(n.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>n.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(n){!this.open||!n?this._notch.nativeElement.style.width="":this._notch.nativeElement.style.width=`calc(${n}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`}};t.\u0275fac=function(r){return new(r||t)(V(Je),V(Re))},t.\u0275cmp=Oe({type:t,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(r,o){if(r&1&&Tn(Q7,5),r&2){let s;vt(s=bt())&&(o._notch=s.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(r,o){r&2&&Nt("mdc-notched-outline--notched",o.open)},inputs:{open:[0,"matFormFieldNotchedOutlineOpen","open"]},standalone:!0,features:[nn],attrs:Y7,ngContentSelectors:J7,decls:5,vars:0,consts:[["notch",""],[1,"mat-mdc-notch-piece","mdc-notched-outline__leading"],[1,"mat-mdc-notch-piece","mdc-notched-outline__notch"],[1,"mat-mdc-notch-piece","mdc-notched-outline__trailing"]],template:function(r,o){r&1&&(Bn(),G(0,"div",1),N(1,"div",2,0),Dt(3),O(),G(4,"div",3))},encapsulation:2,changeDetection:0});let e=t;return e})(),SK={transitionMessages:pk("transitionMessages",[gk("enter",Qw({opacity:1,transform:"translateY(0%)"})),_k("void => enter",[Qw({opacity:0,transform:"translateY(-5px)"}),mk("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},Yw=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275dir=Me({type:t});let e=t;return e})();var Jw=new _e("MatFormField"),DK=new _e("MAT_FORM_FIELD_DEFAULT_OPTIONS"),Ck=0,Ek="fill",TK="auto",Ik="fixed",$K="translateY(-50%)",Lm=(()=>{let t=class t{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(n){this._hideRequiredMarker=ia(n)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||TK}set floatLabel(n){n!==this._floatLabel&&(this._floatLabel=n,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(n){let r=this._appearance,o=n||this._defaults?.appearance||Ek;this._appearance=o,this._appearance==="outline"&&this._appearance!==r&&(this._needsOutlineLabelOffsetUpdate=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||Ik}set subscriptSizing(n){this._subscriptSizing=n||this._defaults?.subscriptSizing||Ik}get hintLabel(){return this._hintLabel}set hintLabel(n){this._hintLabel=n,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(n){this._explicitFormFieldControl=n}constructor(n,r,o,s,a,u,c,f){this._elementRef=n,this._changeDetectorRef=r,this._dir=s,this._platform=a,this._defaults=u,this._animationMode=c,this._labelChild=K2(Pr),this._hideRequiredMarker=!1,this.color="primary",this._appearance=Ek,this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId=`mat-mdc-form-field-label-${Ck++}`,this._hintLabelId=`mat-mdc-hint-${Ck++}`,this._subscriptAnimationState="",this._destroyed=new lt,this._isFocused=null,this._needsOutlineLabelOffsetUpdate=!1,this._injector=ne(fn),this.getLabelId=fo(()=>this._hasFloatingLabel()?this._labelId:null),this._hasFloatingLabel=fo(()=>!!this._labelChild()),u&&(u.appearance&&(this.appearance=u.appearance),this._hideRequiredMarker=!!u?.hideRequiredMarker,u.color&&(this.color=u.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){let n=this._control;n.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${n.controlType}`),n.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),n.ngControl&&n.ngControl.valueChanges&&n.ngControl.valueChanges.pipe(zn(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(n=>!n._isText),this._hasTextPrefix=!!this._prefixChildren.find(n=>n._isText),this._hasIconSuffix=!!this._suffixChildren.find(n=>!n._isText),this._hasTextSuffix=!!this._suffixChildren.find(n=>n._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),Ub(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){this._control}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||this._isFocused===null)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdate=!0),P0(()=>{this._needsOutlineLabelOffsetUpdate&&(this._needsOutlineLabelOffsetUpdate=!1,this._updateOutlineLabelOffset())},{injector:this._injector}),this._dir.change.pipe(zn(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdate=!0)}_shouldAlwaysFloat(){return this.floatLabel==="always"}_hasOutline(){return this.appearance==="outline"}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_shouldLabelFloat(){return this._hasFloatingLabel()?this._control.shouldLabelFloat||this._shouldAlwaysFloat():!1}_shouldForward(n){let r=this._control?this._control.ngControl:null;return r&&r[n]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){!this._hasOutline()||!this._floatingLabel||!this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(0):this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth())}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){this._hintChildren}_syncDescribedByIds(){if(this._control){let n=[];if(this._control.userAriaDescribedBy&&typeof this._control.userAriaDescribedBy=="string"&&n.push(...this._control.userAriaDescribedBy.split(" ")),this._getDisplayedMessages()==="hint"){let r=this._hintChildren?this._hintChildren.find(s=>s.align==="start"):null,o=this._hintChildren?this._hintChildren.find(s=>s.align==="end"):null;r?n.push(r.id):this._hintLabel&&n.push(this._hintLabelId),o&&n.push(o.id)}else this._errorChildren&&n.push(...this._errorChildren.map(r=>r.id));this._control.setDescribedByIds(n)}}_updateOutlineLabelOffset(){if(!this._hasOutline()||!this._floatingLabel)return;let n=this._floatingLabel.element;if(!(this._iconPrefixContainer||this._textPrefixContainer)){n.style.transform="";return}if(!this._isAttachedToDom()){this._needsOutlineLabelOffsetUpdate=!0;return}let r=this._iconPrefixContainer?.nativeElement,o=this._textPrefixContainer?.nativeElement,s=r?.getBoundingClientRect().width??0,a=o?.getBoundingClientRect().width??0,u=this._dir.value==="rtl"?"-1":"1",c=`${s+a}px`,p=`calc(${u} * (${c} + var(--mat-mdc-form-field-label-offset-x, 0px)))`;n.style.transform=`var(
        --mat-mdc-form-field-label-transform,
        ${$K} translateX(${p})
    )`}_isAttachedToDom(){let n=this._elementRef.nativeElement;if(n.getRootNode){let r=n.getRootNode();return r&&r!==n}return document.documentElement.contains(n)}};t.\u0275fac=function(r){return new(r||t)(V(Je),V(Kn),V(Re),V(gm),V(Ht),V(DK,8),V(uo,8),V(yt))},t.\u0275cmp=Oe({type:t,selectors:[["mat-form-field"]],contentQueries:function(r,o,s){if(r&1&&(sT(s,o._labelChild,Pr,5),_n(s,Yw,5),_n(s,CK,5),_n(s,EK,5),_n(s,wK,5),_n(s,vk,5)),r&2){aT();let a;vt(a=bt())&&(o._formFieldControl=a.first),vt(a=bt())&&(o._prefixChildren=a),vt(a=bt())&&(o._suffixChildren=a),vt(a=bt())&&(o._errorChildren=a),vt(a=bt())&&(o._hintChildren=a)}},viewQuery:function(r,o){if(r&1&&(Tn(X7,5),Tn(eK,5),Tn(tK,5),Tn(bk,5),Tn(xk,5),Tn(wk,5)),r&2){let s;vt(s=bt())&&(o._textField=s.first),vt(s=bt())&&(o._iconPrefixContainer=s.first),vt(s=bt())&&(o._textPrefixContainer=s.first),vt(s=bt())&&(o._floatingLabel=s.first),vt(s=bt())&&(o._notchedOutline=s.first),vt(s=bt())&&(o._lineRipple=s.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(r,o){r&2&&Nt("mat-mdc-form-field-label-always-float",o._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",o._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",o._hasIconSuffix)("mat-form-field-invalid",o._control.errorState)("mat-form-field-disabled",o._control.disabled)("mat-form-field-autofilled",o._control.autofilled)("mat-form-field-no-animations",o._animationMode==="NoopAnimations")("mat-form-field-appearance-fill",o.appearance=="fill")("mat-form-field-appearance-outline",o.appearance=="outline")("mat-form-field-hide-placeholder",o._hasFloatingLabel()&&!o._shouldLabelFloat())("mat-focused",o._control.focused)("mat-primary",o.color!=="accent"&&o.color!=="warn")("mat-accent",o.color==="accent")("mat-warn",o.color==="warn")("ng-untouched",o._shouldForward("untouched"))("ng-touched",o._shouldForward("touched"))("ng-pristine",o._shouldForward("pristine"))("ng-dirty",o._shouldForward("dirty"))("ng-valid",o._shouldForward("valid"))("ng-invalid",o._shouldForward("invalid"))("ng-pending",o._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],standalone:!0,features:[Gt([{provide:Jw,useExisting:t},{provide:Sk,useExisting:t}]),nn],ngContentSelectors:iK,decls:18,vars:21,consts:[["labelTemplate",""],["textField",""],["iconPrefixContainer",""],["textPrefixContainer",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],[1,"mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],[1,"mat-mdc-form-field-icon-prefix"],[1,"mat-mdc-form-field-text-prefix"],[1,"mat-mdc-form-field-infix"],[3,"ngTemplateOutlet"],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align"],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[3,"id"],[1,"mat-mdc-form-field-hint-spacer"]],template:function(r,o){if(r&1){let s=qt();Bn(nK),Ze(0,sK,1,1,"ng-template",null,0,uT),N(2,"div",4,1),Ce("click",function(u){return Ct(s),Et(o._control.onContainerClick(u))}),Ze(4,aK,1,0,"div",5),N(5,"div",6),Ze(6,cK,2,2,"div",7)(7,dK,3,0,"div",8)(8,fK,3,0,"div",9),N(9,"div",10),Ze(10,pK,1,1,null,11),Dt(11),O(),Ze(12,mK,2,0,"div",12)(13,gK,2,0,"div",13),O(),Ze(14,_K,1,0,"div",14),O(),N(15,"div",15),Ze(16,vK,2,1,"div",16)(17,yK,5,2,"div",17),O()}if(r&2){let s;U(2),Nt("mdc-text-field--filled",!o._hasOutline())("mdc-text-field--outlined",o._hasOutline())("mdc-text-field--no-label",!o._hasFloatingLabel())("mdc-text-field--disabled",o._control.disabled)("mdc-text-field--invalid",o._control.errorState),U(2),hn(!o._hasOutline()&&!o._control.disabled?4:-1),U(2),hn(o._hasOutline()?6:-1),U(),hn(o._hasIconPrefix?7:-1),U(),hn(o._hasTextPrefix?8:-1),U(2),hn(!o._hasOutline()||o._forceDisplayInfixLabel()?10:-1),U(2),hn(o._hasTextSuffix?12:-1),U(),hn(o._hasIconSuffix?13:-1),U(),hn(o._hasOutline()?-1:14),U(),Nt("mat-mdc-form-field-subscript-dynamic-size",o.subscriptSizing==="dynamic"),U(),hn((s=o._getDisplayedMessages())==="error"?16:s==="hint"?17:-1)}},dependencies:[bk,xk,kT,wk,vk],styles:['.mdc-text-field{display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field__input{width:100%;min-width:0;border:none;border-radius:0;background:none;padding:0;-moz-appearance:none;-webkit-appearance:none;height:28px}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}.mdc-text-field__input::placeholder{opacity:0}.mdc-text-field__input::-moz-placeholder{opacity:0}.mdc-text-field__input::-webkit-input-placeholder{opacity:0}.mdc-text-field__input:-ms-input-placeholder{opacity:0}.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}.mdc-text-field--no-label .mdc-text-field__input::-moz-placeholder,.mdc-text-field--focused .mdc-text-field__input::-moz-placeholder{opacity:1}.mdc-text-field--no-label .mdc-text-field__input::-webkit-input-placeholder,.mdc-text-field--focused .mdc-text-field__input::-webkit-input-placeholder{opacity:1}.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}.mdc-text-field--outlined .mdc-text-field__input,.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color);caret-color:var(--mdc-filled-text-field-caret-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::-moz-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::-webkit-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color);caret-color:var(--mdc-outlined-text-field-caret-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::-moz-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::-webkit-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--disabled .cdk-high-contrast-active .mdc-text-field__input{background-color:Window}.mdc-text-field--filled{height:56px;border-bottom-right-radius:0;border-bottom-left-radius:0;border-top-left-radius:var(--mdc-filled-text-field-container-shape);border-top-right-radius:var(--mdc-filled-text-field-container-shape)}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color)}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--outlined{height:56px;overflow:visible;padding-left:16px;padding-right:16px}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape));padding-left:max(16px,var(--mdc-outlined-text-field-container-shape) + 4px)}[dir=rtl] .mdc-text-field--outlined{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape) + 4px);padding-left:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-floating-label{position:absolute;left:0;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label{right:0;left:auto;transform-origin:right top;text-align:right}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:auto}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label{left:auto;right:4px}.mdc-text-field--filled .mdc-floating-label{left:16px;right:auto}[dir=rtl] .mdc-text-field--filled .mdc-floating-label{left:auto;right:16px}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.cdk-high-contrast-active .mdc-text-field--disabled .mdc-floating-label{z-index:1}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label{color:var(--mdc-filled-text-field-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label{color:var(--mdc-filled-text-field-focus-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label{color:var(--mdc-filled-text-field-hover-label-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid .mdc-floating-label{color:var(--mdc-filled-text-field-error-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid.mdc-text-field--focused .mdc-floating-label{color:var(--mdc-filled-text-field-error-focus-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--disabled):hover .mdc-floating-label{color:var(--mdc-filled-text-field-error-hover-label-text-color)}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font);font-size:var(--mdc-filled-text-field-label-text-size);font-weight:var(--mdc-filled-text-field-label-text-weight);letter-spacing:var(--mdc-filled-text-field-label-text-tracking)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label{color:var(--mdc-outlined-text-field-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label{color:var(--mdc-outlined-text-field-focus-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label{color:var(--mdc-outlined-text-field-hover-label-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid .mdc-floating-label{color:var(--mdc-outlined-text-field-error-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid.mdc-text-field--focused .mdc-floating-label{color:var(--mdc-outlined-text-field-error-focus-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--disabled):hover .mdc-floating-label{color:var(--mdc-outlined-text-field-error-hover-label-text-color)}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font);font-size:var(--mdc-outlined-text-field-label-text-size);font-weight:var(--mdc-outlined-text-field-label-text-weight);letter-spacing:var(--mdc-outlined-text-field-label-text-tracking)}.mdc-floating-label--float-above{cursor:auto;transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1);font-size:.75rem}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline{text-align:right}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mat-mdc-notch-piece{box-sizing:border-box;height:100%;pointer-events:none;border-top:1px solid;border-bottom:1px solid}.mdc-text-field--focused .mat-mdc-notch-piece{border-width:2px}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-outline-color);border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-focus-outline-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-error-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--focused):hover .mdc-notched-outline .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-error-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid.mdc-text-field--focused .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-error-focus-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mat-mdc-notch-piece{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;border-top-right-radius:0;border-bottom-right-radius:0;width:12px;border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-outlined-text-field-container-shape))}}[dir=rtl] .mdc-notched-outline__leading{border-left:none;border-right:1px solid;border-bottom-left-radius:0;border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape)}.mdc-notched-outline__trailing{flex-grow:1;border-left:none;border-right:1px solid;border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape)}[dir=rtl] .mdc-notched-outline__trailing{border-left:1px solid;border-right:none;border-top-right-radius:0;border-bottom-right-radius:0;border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}.mdc-notched-outline__notch{flex:0 0 auto;width:auto;max-width:calc(100% - 24px)}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-outlined-text-field-container-shape))*2)}}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1;border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color)}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color)}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-text-field--disabled{pointer-events:none}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all;will-change:auto}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto;will-change:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:1px solid rgba(0,0,0,0)}[dir=rtl] .mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:none;border-right:1px solid rgba(0,0,0,0)}.mat-mdc-form-field-infix{min-height:var(--mat-form-field-container-height);padding-top:var(--mat-form-field-filled-with-label-container-padding-top);padding-bottom:var(--mat-form-field-filled-with-label-container-padding-bottom)}.mdc-text-field--outlined .mat-mdc-form-field-infix,.mdc-text-field--no-label .mat-mdc-form-field-infix{padding-top:var(--mat-form-field-container-vertical-padding);padding-bottom:var(--mat-form-field-container-vertical-padding)}.mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:calc(var(--mat-form-field-container-height)/2)}.mdc-text-field--filled .mat-mdc-floating-label{display:var(--mat-form-field-filled-label-display, block)}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY(calc(calc(6.75px + var(--mat-form-field-container-height) / 2) * -1)) scale(var(--mat-mdc-form-field-floating-label-scale, 0.75));transform:var(--mat-mdc-form-field-label-transform)}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block;color:var(--mat-form-field-error-text-color)}.mat-mdc-form-field-subscript-wrapper,.mat-mdc-form-field-bottom-align::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-subscript-text-font);line-height:var(--mat-form-field-subscript-text-line-height);font-size:var(--mat-form-field-subscript-text-size);letter-spacing:var(--mat-form-field-subscript-text-tracking);font-weight:var(--mat-form-field-subscript-text-weight)}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none;background-color:var(--mat-form-field-state-layer-color)}.mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-hover-state-layer-opacity)}.mat-mdc-form-field.mat-focused .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-focus-state-layer-opacity)}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option{color:var(--mat-form-field-select-option-text-color)}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option:disabled{color:var(--mat-form-field-select-disabled-option-text-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none;color:var(--mat-form-field-enabled-select-arrow-color)}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select.mat-focused .mat-mdc-form-field-infix::after{color:var(--mat-form-field-focus-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select.mat-form-field-disabled .mat-mdc-form-field-infix::after{color:var(--mat-form-field-disabled-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font);line-height:var(--mat-form-field-container-text-line-height);font-size:var(--mat-form-field-container-text-size);letter-spacing:var(--mat-form-field-container-text-tracking);font-weight:var(--mat-form-field-container-text-weight)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size)*var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%;z-index:0}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:0 12px;box-sizing:content-box}.mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-leading-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-disabled-leading-icon-color)}.mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-trailing-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-disabled-trailing-icon-color)}.mat-form-field-invalid .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-trailing-icon-color)}.mat-form-field-invalid:not(.mat-focused):not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-hover-trailing-icon-color)}.mat-form-field-invalid.mat-focused .mat-mdc-text-field-wrapper .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-focus-trailing-icon-color)}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::-moz-placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::-webkit-input-placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--no-label .mdc-text-field__input::placeholder,.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--focused .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--no-label .mdc-text-field__input::-moz-placeholder,.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--focused .mdc-text-field__input::-moz-placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--no-label .mdc-text-field__input::-webkit-input-placeholder,.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--focused .mdc-text-field__input::-webkit-input-placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[SK.transitionMessages]},changeDetection:0});let e=t;return e})(),qd=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({imports:[rn,pl,$$,rn]});let e=t;return e})();var Dk=Ko({passive:!0}),Tk=(()=>{let t=class t{constructor(n,r){this._platform=n,this._ngZone=r,this._monitoredElements=new Map}monitor(n){if(!this._platform.isBrowser)return Fn;let r=Nr(n),o=this._monitoredElements.get(r);if(o)return o.subject;let s=new lt,a="cdk-text-field-autofilled",u=c=>{c.animationName==="cdk-text-field-autofill-start"&&!r.classList.contains(a)?(r.classList.add(a),this._ngZone.run(()=>s.next({target:c.target,isAutofilled:!0}))):c.animationName==="cdk-text-field-autofill-end"&&r.classList.contains(a)&&(r.classList.remove(a),this._ngZone.run(()=>s.next({target:c.target,isAutofilled:!1})))};return this._ngZone.runOutsideAngular(()=>{r.addEventListener("animationstart",u,Dk),r.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(r,{subject:s,unlisten:()=>{r.removeEventListener("animationstart",u,Dk)}}),s}stopMonitoring(n){let r=Nr(n),o=this._monitoredElements.get(r);o&&(o.unlisten(),o.subject.complete(),r.classList.remove("cdk-text-field-autofill-monitored"),r.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(r))}ngOnDestroy(){this._monitoredElements.forEach((n,r)=>this.stopMonitoring(r))}};t.\u0275fac=function(r){return new(r||t)(me(Ht),me(Re))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var $k=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({});let e=t;return e})();var MK=new _e("MAT_INPUT_VALUE_ACCESSOR"),AK=["button","checkbox","file","hidden","image","radio","range","reset","submit"],RK=0,jm=(()=>{let t=class t{get disabled(){return this._disabled}set disabled(n){this._disabled=ia(n),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(n){this._id=n||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(em.required)??!1}set required(n){this._required=ia(n)}get type(){return this._type}set type(n){this._type=n||"text",this._validateType(),!this._isTextarea&&Dw().has(this._type)&&(this._elementRef.nativeElement.type=this._type),this._ensureWheelDefaultBehavior()}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(n){this._errorStateTracker.matcher=n}get value(){return this._inputValueAccessor.value}set value(n){n!==this.value&&(this._inputValueAccessor.value=n,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(n){this._readonly=ia(n)}get errorState(){return this._errorStateTracker.errorState}set errorState(n){this._errorStateTracker.errorState=n}constructor(n,r,o,s,a,u,c,f,p,m){this._elementRef=n,this._platform=r,this.ngControl=o,this._autofillMonitor=f,this._ngZone=p,this._formField=m,this._uid=`mat-input-${RK++}`,this._webkitBlinkWheelListenerAttached=!1,this.focused=!1,this.stateChanges=new lt,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(w=>Dw().has(w)),this._iOSKeyupListener=w=>{let C=w.target;!C.value&&C.selectionStart===0&&C.selectionEnd===0&&(C.setSelectionRange(1,1),C.setSelectionRange(0,0))},this._webkitBlinkWheelListener=()=>{};let v=this._elementRef.nativeElement,b=v.nodeName.toLowerCase();this._inputValueAccessor=c||v,this._previousNativeValue=this.value,this.id=this.id,r.IOS&&p.runOutsideAngular(()=>{n.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._errorStateTracker=new vm(u,o,a,s,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect=b==="select",this._isTextarea=b==="textarea",this._isInFormField=!!m,this._isNativeSelect&&(this.controlType=v.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(n=>{this.autofilled=n.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener),this._webkitBlinkWheelListenerAttached&&this._elementRef.nativeElement.removeEventListener("wheel",this._webkitBlinkWheelListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),this.ngControl.disabled!==null&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(n){this._elementRef.nativeElement.focus(n)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(n){n!==this.focused&&(this.focused=n,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){let n=this._elementRef.nativeElement.value;this._previousNativeValue!==n&&(this._previousNativeValue=n,this.stateChanges.next())}_dirtyCheckPlaceholder(){let n=this._getPlaceholder();if(n!==this._previousPlaceholder){let r=this._elementRef.nativeElement;this._previousPlaceholder=n,n?r.setAttribute("placeholder",n):r.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){AK.indexOf(this._type)>-1}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let n=this._elementRef.nativeElement.validity;return n&&n.badInput}get empty(){return!this._isNeverEmpty()&&!this._elementRef.nativeElement.value&&!this._isBadInput()&&!this.autofilled}get shouldLabelFloat(){if(this._isNativeSelect){let n=this._elementRef.nativeElement,r=n.options[0];return this.focused||n.multiple||!this.empty||!!(n.selectedIndex>-1&&r&&r.label)}else return this.focused||!this.empty}setDescribedByIds(n){n.length?this._elementRef.nativeElement.setAttribute("aria-describedby",n.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){let n=this._elementRef.nativeElement;return this._isNativeSelect&&(n.multiple||n.size>1)}_ensureWheelDefaultBehavior(){!this._webkitBlinkWheelListenerAttached&&this._type==="number"&&(this._platform.BLINK||this._platform.WEBKIT)&&(this._ngZone.runOutsideAngular(()=>{this._elementRef.nativeElement.addEventListener("wheel",this._webkitBlinkWheelListener)}),this._webkitBlinkWheelListenerAttached=!0),this._webkitBlinkWheelListenerAttached&&this._type!=="number"&&(this._elementRef.nativeElement.removeEventListener("wheel",this._webkitBlinkWheelListener),this._webkitBlinkWheelListenerAttached=!0)}};t.\u0275fac=function(r){return new(r||t)(V(Je),V(Ht),V(na,10),V(xw,8),V(Cw,8),V(G$),V(MK,10),V(Tk),V(Re),V(Jw,8))},t.\u0275dir=Me({type:t,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(r,o){r&1&&Ce("focus",function(){return o._focusChanged(!0)})("blur",function(){return o._focusChanged(!1)})("input",function(){return o._onInput()}),r&2&&(cl("id",o.id)("disabled",o.disabled)("required",o.required),Gn("name",o.name||null)("readonly",o.readonly&&!o._isNativeSelect||null)("aria-invalid",o.empty&&o.required?null:o.errorState)("aria-required",o.required)("id",o.id),Nt("mat-input-server",o._isServer)("mat-mdc-form-field-textarea-control",o._isInFormField&&o._isTextarea)("mat-mdc-form-field-input-control",o._isInFormField)("mdc-text-field__input",o._isInFormField)("mat-mdc-native-select-inline",o._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[0,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],standalone:!0,features:[Gt([{provide:Yw,useExisting:t}]),Wn]});let e=t;return e})(),kk=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({imports:[rn,qd,qd,$k,rn]});let e=t;return e})();var OK=["input"],NK=["formField"],PK=["*"],Ak=0,Vm=class{constructor(t,i){this.source=t,this.value=i}},FK={provide:um,useExisting:so(()=>Xw),multi:!0},Rk=new _e("MatRadioGroup"),zK=new _e("mat-radio-default-options",{providedIn:"root",factory:LK});function LK(){return{color:"accent"}}var Xw=(()=>{let t=class t{get name(){return this._name}set name(n){this._name=n,this._updateRadioButtonNames()}get labelPosition(){return this._labelPosition}set labelPosition(n){this._labelPosition=n==="before"?"before":"after",this._markRadiosForCheck()}get value(){return this._value}set value(n){this._value!==n&&(this._value=n,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}get selected(){return this._selected}set selected(n){this._selected=n,this.value=n?n.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(n){this._disabled=n,this._markRadiosForCheck()}get required(){return this._required}set required(n){this._required=n,this._markRadiosForCheck()}constructor(n){this._changeDetector=n,this._value=null,this._name=`mat-radio-group-${Ak++}`,this._selected=null,this._isInitialized=!1,this._labelPosition="after",this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this.onTouched=()=>{},this.change=new Tt}ngAfterContentInit(){this._isInitialized=!0,this._buttonChanges=this._radios.changes.subscribe(()=>{this.selected&&!this._radios.find(n=>n===this.selected)&&(this._selected=null)})}ngOnDestroy(){this._buttonChanges?.unsubscribe()}_touch(){this.onTouched&&this.onTouched()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(n=>{n.name=this.name,n._markForCheck()})}_updateSelectedRadioFromValue(){let n=this._selected!==null&&this._selected.value===this._value;this._radios&&!n&&(this._selected=null,this._radios.forEach(r=>{r.checked=this.value===r.value,r.checked&&(this._selected=r)}))}_emitChangeEvent(){this._isInitialized&&this.change.emit(new Vm(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(n=>n._markForCheck())}writeValue(n){this.value=n,this._changeDetector.markForCheck()}registerOnChange(n){this._controlValueAccessorChangeFn=n}registerOnTouched(n){this.onTouched=n}setDisabledState(n){this.disabled=n,this._changeDetector.markForCheck()}};t.\u0275fac=function(r){return new(r||t)(V(Kn))},t.\u0275dir=Me({type:t,selectors:[["mat-radio-group"]],contentQueries:function(r,o,s){if(r&1&&_n(s,Um,5),r&2){let a;vt(a=bt())&&(o._radios=a)}},hostAttrs:["role","radiogroup",1,"mat-mdc-radio-group"],inputs:{color:"color",name:"name",labelPosition:"labelPosition",value:"value",selected:"selected",disabled:[2,"disabled","disabled",Ut],required:[2,"required","required",Ut]},outputs:{change:"change"},exportAs:["matRadioGroup"],standalone:!0,features:[Gt([FK,{provide:Rk,useExisting:t}]),gn]});let e=t;return e})(),Um=(()=>{let t=class t{get checked(){return this._checked}set checked(n){this._checked!==n&&(this._checked=n,n&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!n&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),n&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(n){this._value!==n&&(this._value=n,this.radioGroup!==null&&(this.checked||(this.checked=this.radioGroup.value===n),this.checked&&(this.radioGroup.selected=this)))}get labelPosition(){return this._labelPosition||this.radioGroup&&this.radioGroup.labelPosition||"after"}set labelPosition(n){this._labelPosition=n}get disabled(){return this._disabled||this.radioGroup!==null&&this.radioGroup.disabled}set disabled(n){this._setDisabled(n)}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(n){this._required=n}get color(){return this._color||this.radioGroup&&this.radioGroup.color||this._providerOverride&&this._providerOverride.color||"accent"}set color(n){this._color=n}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(n,r,o,s,a,u,c,f){this._elementRef=r,this._changeDetector=o,this._focusMonitor=s,this._radioDispatcher=a,this._providerOverride=c,this._uniqueId=`mat-radio-${++Ak}`,this.id=this._uniqueId,this.disableRipple=!1,this.tabIndex=0,this.change=new Tt,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this._injector=ne(fn),this.radioGroup=n,this._noopAnimations=u==="NoopAnimations",f&&(this.tabIndex=Dd(f,0))}focus(n,r){r?this._focusMonitor.focusVia(this._inputElement,r,n):this._inputElement.nativeElement.focus(n)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name),this._removeUniqueSelectionListener=this._radioDispatcher.listen((n,r)=>{n!==this.id&&r===this.name&&(this.checked=!1)})}ngDoCheck(){this._updateTabIndex()}ngAfterViewInit(){this._updateTabIndex(),this._focusMonitor.monitor(this._elementRef,!0).subscribe(n=>{!n&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new Vm(this,this._value))}_isRippleDisabled(){return this.disableRipple||this.disabled}_onInputClick(n){n.stopPropagation()}_onInputInteraction(n){if(n.stopPropagation(),!this.checked&&!this.disabled){let r=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),r&&this.radioGroup._emitChangeEvent())}}_onTouchTargetClick(n){this._onInputInteraction(n),this.disabled||this._inputElement.nativeElement.focus()}_setDisabled(n){this._disabled!==n&&(this._disabled=n,this._changeDetector.markForCheck())}_updateTabIndex(){let n=this.radioGroup,r;if(!n||!n.selected||this.disabled?r=this.tabIndex:r=n.selected===this?this.tabIndex:-1,r!==this._previousTabIndex){let o=this._inputElement?.nativeElement;o&&(o.setAttribute("tabindex",r+""),this._previousTabIndex=r,Bo(()=>{queueMicrotask(()=>{n&&n.selected&&n.selected!==this&&document.activeElement===o&&(n.selected?._inputElement.nativeElement.focus(),document.activeElement===o&&this._inputElement.nativeElement.blur())})},{injector:this._injector}))}}};t.\u0275fac=function(r){return new(r||t)(V(Rk,8),V(Je),V(Kn),V(mm),V(ek),V(uo,8),V(zK,8),Fo("tabindex"))},t.\u0275cmp=Oe({type:t,selectors:[["mat-radio-button"]],viewQuery:function(r,o){if(r&1&&(Tn(OK,5),Tn(NK,7,Je)),r&2){let s;vt(s=bt())&&(o._inputElement=s.first),vt(s=bt())&&(o._rippleTrigger=s.first)}},hostAttrs:[1,"mat-mdc-radio-button"],hostVars:15,hostBindings:function(r,o){r&1&&Ce("focus",function(){return o._inputElement.nativeElement.focus()}),r&2&&(Gn("id",o.id)("tabindex",null)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),Nt("mat-primary",o.color==="primary")("mat-accent",o.color==="accent")("mat-warn",o.color==="warn")("mat-mdc-radio-checked",o.checked)("_mat-animation-noopable",o._noopAnimations))},inputs:{id:"id",name:"name",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[0,"aria-describedby","ariaDescribedby"],disableRipple:[2,"disableRipple","disableRipple",Ut],tabIndex:[2,"tabIndex","tabIndex",n=>n==null?0:Dd(n)],checked:[2,"checked","checked",Ut],value:"value",labelPosition:"labelPosition",disabled:[2,"disabled","disabled",Ut],required:[2,"required","required",Ut],color:"color"},outputs:{change:"change"},exportAs:["matRadioButton"],standalone:!0,features:[gn,nn],ngContentSelectors:PK,decls:13,vars:16,consts:[["formField",""],["input",""],["mat-internal-form-field","",3,"labelPosition"],[1,"mdc-radio"],[1,"mat-mdc-radio-touch-target",3,"click"],["type","radio",1,"mdc-radio__native-control",3,"change","id","checked","disabled","required"],[1,"mdc-radio__background"],[1,"mdc-radio__outer-circle"],[1,"mdc-radio__inner-circle"],["mat-ripple","",1,"mat-radio-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mat-ripple-element","mat-radio-persistent-ripple"],[1,"mdc-label",3,"for"]],template:function(r,o){if(r&1){let s=qt();Bn(),N(0,"div",2,0)(2,"div",3)(3,"div",4),Ce("click",function(u){return Ct(s),Et(o._onTouchTargetClick(u))}),O(),N(4,"input",5,1),Ce("change",function(u){return Ct(s),Et(o._onInputInteraction(u))}),O(),N(6,"div",6),G(7,"div",7)(8,"div",8),O(),N(9,"div",9),G(10,"div",10),O()(),N(11,"label",11),Dt(12),O()()}r&2&&(Be("labelPosition",o.labelPosition),U(2),Nt("mdc-radio--disabled",o.disabled),U(2),Be("id",o.inputId)("checked",o.checked)("disabled",o.disabled)("required",o.required),Gn("name",o.name)("value",o.value)("aria-label",o.ariaLabel)("aria-labelledby",o.ariaLabelledby)("aria-describedby",o.ariaDescribedby),U(5),Be("matRippleTrigger",o._rippleTrigger.nativeElement)("matRippleDisabled",o._isRippleDisabled())("matRippleCentered",!0),U(2),Be("for",o.inputId))},dependencies:[Fw,Q$],styles:['.mat-mdc-radio-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-radio-button .mdc-radio{display:inline-block;position:relative;flex:0 0 auto;box-sizing:content-box;width:20px;height:20px;cursor:pointer;will-change:opacity,transform,border-color,color;padding:calc((var(--mdc-radio-state-layer-size) - 20px)/2)}.mat-mdc-radio-button .mdc-radio:hover .mdc-radio__native-control:not([disabled]):not(:focus)~.mdc-radio__background::before{opacity:.04;transform:scale(1)}.mat-mdc-radio-button .mdc-radio:hover .mdc-radio__native-control:not([disabled])~.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-unselected-hover-icon-color)}.mat-mdc-radio-button .mdc-radio:hover .mdc-radio__native-control:enabled:checked+.mdc-radio__background .mdc-radio__outer-circle,.mat-mdc-radio-button .mdc-radio:hover .mdc-radio__native-control:enabled:checked+.mdc-radio__background .mdc-radio__inner-circle{border-color:var(--mdc-radio-selected-hover-icon-color)}.mat-mdc-radio-button .mdc-radio:active .mdc-radio__native-control:enabled:not(:checked)+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-unselected-pressed-icon-color)}.mat-mdc-radio-button .mdc-radio:active .mdc-radio__native-control:enabled:checked+.mdc-radio__background .mdc-radio__outer-circle,.mat-mdc-radio-button .mdc-radio:active .mdc-radio__native-control:enabled:checked+.mdc-radio__background .mdc-radio__inner-circle{border-color:var(--mdc-radio-selected-pressed-icon-color)}.mat-mdc-radio-button .mdc-radio__background{display:inline-block;position:relative;box-sizing:border-box;width:20px;height:20px}.mat-mdc-radio-button .mdc-radio__background::before{position:absolute;transform:scale(0, 0);border-radius:50%;opacity:0;pointer-events:none;content:"";transition:opacity 90ms cubic-bezier(0.4, 0, 0.6, 1),transform 90ms cubic-bezier(0.4, 0, 0.6, 1);width:var(--mdc-radio-state-layer-size);height:var(--mdc-radio-state-layer-size);top:calc(-1*(var(--mdc-radio-state-layer-size) - 20px)/2);left:calc(-1*(var(--mdc-radio-state-layer-size) - 20px)/2)}.mat-mdc-radio-button .mdc-radio__outer-circle{position:absolute;top:0;left:0;box-sizing:border-box;width:100%;height:100%;border-width:2px;border-style:solid;border-radius:50%;transition:border-color 90ms cubic-bezier(0.4, 0, 0.6, 1)}.mat-mdc-radio-button .mdc-radio__inner-circle{position:absolute;top:0;left:0;box-sizing:border-box;width:100%;height:100%;transform:scale(0, 0);border-width:10px;border-style:solid;border-radius:50%;transition:transform 90ms cubic-bezier(0.4, 0, 0.6, 1),border-color 90ms cubic-bezier(0.4, 0, 0.6, 1)}.mat-mdc-radio-button .mdc-radio__native-control{position:absolute;margin:0;padding:0;opacity:0;top:0;right:0;left:0;cursor:inherit;z-index:1;width:var(--mdc-radio-state-layer-size);height:var(--mdc-radio-state-layer-size)}.mat-mdc-radio-button .mdc-radio__native-control:checked+.mdc-radio__background,.mat-mdc-radio-button .mdc-radio__native-control:disabled+.mdc-radio__background{transition:opacity 90ms cubic-bezier(0, 0, 0.2, 1),transform 90ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-radio-button .mdc-radio__native-control:checked+.mdc-radio__background .mdc-radio__outer-circle,.mat-mdc-radio-button .mdc-radio__native-control:disabled+.mdc-radio__background .mdc-radio__outer-circle{transition:border-color 90ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-radio-button .mdc-radio__native-control:checked+.mdc-radio__background .mdc-radio__inner-circle,.mat-mdc-radio-button .mdc-radio__native-control:disabled+.mdc-radio__background .mdc-radio__inner-circle{transition:transform 90ms cubic-bezier(0, 0, 0.2, 1),border-color 90ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-radio-button .mdc-radio__native-control:focus+.mdc-radio__background::before{transform:scale(1);opacity:.12;transition:opacity 90ms cubic-bezier(0, 0, 0.2, 1),transform 90ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-radio-button .mdc-radio__native-control:disabled:not(:checked)+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-disabled-unselected-icon-color);opacity:var(--mdc-radio-disabled-unselected-icon-opacity)}.mat-mdc-radio-button .mdc-radio__native-control:disabled+.mdc-radio__background{cursor:default}.mat-mdc-radio-button .mdc-radio__native-control:disabled+.mdc-radio__background .mdc-radio__inner-circle,.mat-mdc-radio-button .mdc-radio__native-control:disabled+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-disabled-selected-icon-color);opacity:var(--mdc-radio-disabled-selected-icon-opacity)}.mat-mdc-radio-button .mdc-radio__native-control:enabled:not(:checked)+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-unselected-icon-color)}.mat-mdc-radio-button .mdc-radio__native-control:enabled:checked+.mdc-radio__background .mdc-radio__outer-circle,.mat-mdc-radio-button .mdc-radio__native-control:enabled:checked+.mdc-radio__background .mdc-radio__inner-circle{border-color:var(--mdc-radio-selected-icon-color)}.mat-mdc-radio-button .mdc-radio__native-control:enabled:focus:checked+.mdc-radio__background .mdc-radio__inner-circle,.mat-mdc-radio-button .mdc-radio__native-control:enabled:focus:checked+.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-selected-focus-icon-color)}.mat-mdc-radio-button .mdc-radio__native-control:checked+.mdc-radio__background .mdc-radio__inner-circle{transform:scale(0.5);transition:transform 90ms cubic-bezier(0, 0, 0.2, 1),border-color 90ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-radio-button .mdc-radio--disabled{cursor:default;pointer-events:none}.mat-mdc-radio-button._mat-animation-noopable .mdc-radio__background::before,.mat-mdc-radio-button._mat-animation-noopable .mdc-radio__outer-circle,.mat-mdc-radio-button._mat-animation-noopable .mdc-radio__inner-circle{transition:none !important}.mat-mdc-radio-button .mdc-radio__background::before{background-color:var(--mat-radio-ripple-color)}.mat-mdc-radio-button.mat-mdc-radio-checked .mdc-radio__background::before{background-color:var(--mat-radio-checked-ripple-color)}.mat-mdc-radio-button.mat-mdc-radio-checked .mat-ripple-element{background-color:var(--mat-radio-checked-ripple-color)}.mat-mdc-radio-button .mat-internal-form-field{color:var(--mat-radio-label-text-color);font-family:var(--mat-radio-label-text-font);line-height:var(--mat-radio-label-text-line-height);font-size:var(--mat-radio-label-text-size);letter-spacing:var(--mat-radio-label-text-tracking);font-weight:var(--mat-radio-label-text-weight)}.mat-mdc-radio-button .mdc-radio--disabled+label{color:var(--mat-radio-disabled-label-color)}.mat-mdc-radio-button .mat-radio-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:50%}.mat-mdc-radio-button .mat-radio-ripple .mat-ripple-element{opacity:.14}.mat-mdc-radio-button .mat-radio-ripple::before{border-radius:50%}.mat-mdc-radio-button .mdc-radio .mdc-radio__native-control:focus:enabled:not(:checked)~.mdc-radio__background .mdc-radio__outer-circle{border-color:var(--mdc-radio-unselected-focus-icon-color, black)}.mat-mdc-radio-button.cdk-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-radio-touch-target{position:absolute;top:50%;left:50%;height:48px;width:48px;transform:translate(-50%, -50%);display:var(--mat-radio-touch-target-display)}[dir=rtl] .mat-mdc-radio-touch-target{left:auto;right:50%;transform:translate(50%, -50%)}'],encapsulation:2,changeDetection:0});let e=t;return e})(),Ok=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({imports:[rn,pl,bm,Um,rn]});let e=t;return e})();var at="primary",lf=Symbol("RouteTitle"),rx=class{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){let i=this.params[t];return Array.isArray(i)?i[0]:i}return null}getAll(t){if(this.has(t)){let i=this.params[t];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}};function Ml(e){return new rx(e)}function jK(e,t,i){let n=i.path.split("/");if(n.length>e.length||i.pathMatch==="full"&&(t.hasChildren()||n.length<e.length))return null;let r={};for(let o=0;o<n.length;o++){let s=n[o],a=e[o];if(s[0]===":")r[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:e.slice(0,n.length),posParams:r}}function VK(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!Fr(e[i],t[i]))return!1;return!0}function Fr(e,t){let i=e?ox(e):void 0,n=t?ox(t):void 0;if(!i||!n||i.length!=n.length)return!1;let r;for(let o=0;o<i.length;o++)if(r=i[o],!Wk(e[r],t[r]))return!1;return!0}function ox(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function Wk(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;let i=[...e].sort(),n=[...t].sort();return i.every((r,o)=>n[o]===r)}else return e===t}function qk(e){return e.length>0?e[e.length-1]:null}function Jo(e){return Fs(e)?e:Xs(e)?jt(Promise.resolve(e)):Ne(e)}var UK={exact:Kk,subset:Zk},Gk={exact:HK,subset:WK,ignored:()=>!0};function Nk(e,t,i){return UK[i.paths](e.root,t.root,i.matrixParams)&&Gk[i.queryParams](e.queryParams,t.queryParams)&&!(i.fragment==="exact"&&e.fragment!==t.fragment)}function HK(e,t){return Fr(e,t)}function Kk(e,t,i){if(!la(e.segments,t.segments)||!qm(e.segments,t.segments,i)||e.numberOfChildren!==t.numberOfChildren)return!1;for(let n in t.children)if(!e.children[n]||!Kk(e.children[n],t.children[n],i))return!1;return!0}function WK(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(i=>Wk(e[i],t[i]))}function Zk(e,t,i){return Qk(e,t,t.segments,i)}function Qk(e,t,i,n){if(e.segments.length>i.length){let r=e.segments.slice(0,i.length);return!(!la(r,i)||t.hasChildren()||!qm(r,i,n))}else if(e.segments.length===i.length){if(!la(e.segments,i)||!qm(e.segments,i,n))return!1;for(let r in t.children)if(!e.children[r]||!Zk(e.children[r],t.children[r],n))return!1;return!0}else{let r=i.slice(0,e.segments.length),o=i.slice(e.segments.length);return!la(e.segments,r)||!qm(e.segments,r,n)||!e.children[at]?!1:Qk(e.children[at],t,o,n)}}function qm(e,t,i){return t.every((n,r)=>Gk[i](e[r].parameters,n.parameters))}var _o=class{constructor(t=new At([],{}),i={},n=null){this.root=t,this.queryParams=i,this.fragment=n}get queryParamMap(){return this._queryParamMap??=Ml(this.queryParams),this._queryParamMap}toString(){return KK.serialize(this)}},At=class{constructor(t,i){this.segments=t,this.children=i,this.parent=null,Object.values(i).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Gm(this)}},aa=class{constructor(t,i){this.path=t,this.parameters=i}get parameterMap(){return this._parameterMap??=Ml(this.parameters),this._parameterMap}toString(){return Jk(this)}};function qK(e,t){return la(e,t)&&e.every((i,n)=>Fr(i.parameters,t[n].parameters))}function la(e,t){return e.length!==t.length?!1:e.every((i,n)=>i.path===t[n].path)}function GK(e,t){let i=[];return Object.entries(e.children).forEach(([n,r])=>{n===at&&(i=i.concat(t(r,n)))}),Object.entries(e.children).forEach(([n,r])=>{n!==at&&(i=i.concat(t(r,n)))}),i}var uf=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:()=>new Al,providedIn:"root"});let e=t;return e})(),Al=class{parse(t){let i=new ax(t);return new _o(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(t){let i=`/${Gd(t.root,!0)}`,n=YK(t.queryParams),r=typeof t.fragment=="string"?`#${ZK(t.fragment)}`:"";return`${i}${n}${r}`}},KK=new Al;function Gm(e){return e.segments.map(t=>Jk(t)).join("/")}function Gd(e,t){if(!e.hasChildren())return Gm(e);if(t){let i=e.children[at]?Gd(e.children[at],!1):"",n=[];return Object.entries(e.children).forEach(([r,o])=>{r!==at&&n.push(`${r}:${Gd(o,!1)}`)}),n.length>0?`${i}(${n.join("//")})`:i}else{let i=GK(e,(n,r)=>r===at?[Gd(e.children[at],!1)]:[`${r}:${Gd(n,!1)}`]);return Object.keys(e.children).length===1&&e.children[at]!=null?`${Gm(e)}/${i[0]}`:`${Gm(e)}/(${i.join("//")})`}}function Yk(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Hm(e){return Yk(e).replace(/%3B/gi,";")}function ZK(e){return encodeURI(e)}function sx(e){return Yk(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Km(e){return decodeURIComponent(e)}function Pk(e){return Km(e.replace(/\+/g,"%20"))}function Jk(e){return`${sx(e.path)}${QK(e.parameters)}`}function QK(e){return Object.entries(e).map(([t,i])=>`;${sx(t)}=${sx(i)}`).join("")}function YK(e){let t=Object.entries(e).map(([i,n])=>Array.isArray(n)?n.map(r=>`${Hm(i)}=${Hm(r)}`).join("&"):`${Hm(i)}=${Hm(n)}`).filter(i=>i);return t.length?`?${t.join("&")}`:""}var JK=/^[^\/()?;#]+/;function ex(e){let t=e.match(JK);return t?t[0]:""}var XK=/^[^\/()?;=#]+/;function eZ(e){let t=e.match(XK);return t?t[0]:""}var tZ=/^[^=?&#]+/;function nZ(e){let t=e.match(tZ);return t?t[0]:""}var iZ=/^[^&#]+/;function rZ(e){let t=e.match(iZ);return t?t[0]:""}var ax=class{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new At([],{}):new At([],this.parseChildren())}parseQueryParams(){let t={};if(this.consumeOptional("?"))do this.parseQueryParam(t);while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(i).length>0)&&(n[at]=new At(t,i)),n}parseSegment(){let t=ex(this.remaining);if(t===""&&this.peekStartsWith(";"))throw new ke(4009,!1);return this.capture(t),new aa(Km(t),this.parseMatrixParams())}parseMatrixParams(){let t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){let i=eZ(this.remaining);if(!i)return;this.capture(i);let n="";if(this.consumeOptional("=")){let r=ex(this.remaining);r&&(n=r,this.capture(n))}t[Km(i)]=Km(n)}parseQueryParam(t){let i=nZ(this.remaining);if(!i)return;this.capture(i);let n="";if(this.consumeOptional("=")){let s=rZ(this.remaining);s&&(n=s,this.capture(n))}let r=Pk(i),o=Pk(n);if(t.hasOwnProperty(r)){let s=t[r];Array.isArray(s)||(s=[s],t[r]=s),s.push(o)}else t[r]=o}parseParens(t){let i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let n=ex(this.remaining),r=this.remaining[n.length];if(r!=="/"&&r!==")"&&r!==";")throw new ke(4010,!1);let o;n.indexOf(":")>-1?(o=n.slice(0,n.indexOf(":")),this.capture(o),this.capture(":")):t&&(o=at);let s=this.parseChildren();i[o]=Object.keys(s).length===1?s[at]:new At([],s),this.consumeOptional("//")}return i}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return this.peekStartsWith(t)?(this.remaining=this.remaining.substring(t.length),!0):!1}capture(t){if(!this.consumeOptional(t))throw new ke(4011,!1)}};function Xk(e){return e.segments.length>0?new At([],{[at]:e}):e}function eM(e){let t={};for(let[n,r]of Object.entries(e.children)){let o=eM(r);if(n===at&&o.segments.length===0&&o.hasChildren())for(let[s,a]of Object.entries(o.children))t[s]=a;else(o.segments.length>0||o.hasChildren())&&(t[n]=o)}let i=new At(e.segments,t);return oZ(i)}function oZ(e){if(e.numberOfChildren===1&&e.children[at]){let t=e.children[at];return new At(e.segments.concat(t.segments),t.children)}return e}function Xd(e){return e instanceof _o}function sZ(e,t,i=null,n=null){let r=tM(e);return nM(r,t,i,n)}function tM(e){let t;function i(o){let s={};for(let u of o.children){let c=i(u);s[u.outlet]=c}let a=new At(o.url,s);return o===e&&(t=a),a}let n=i(e.root),r=Xk(n);return t??r}function nM(e,t,i,n){let r=e;for(;r.parent;)r=r.parent;if(t.length===0)return tx(r,r,r,i,n);let o=aZ(t);if(o.toRoot())return tx(r,r,new At([],{}),i,n);let s=lZ(o,r,e),a=s.processChildren?Qd(s.segmentGroup,s.index,o.commands):rM(s.segmentGroup,s.index,o.commands);return tx(r,s.segmentGroup,a,i,n)}function Zm(e){return typeof e=="object"&&e!=null&&!e.outlets&&!e.segmentPath}function ef(e){return typeof e=="object"&&e!=null&&e.outlets}function tx(e,t,i,n,r){let o={};n&&Object.entries(n).forEach(([u,c])=>{o[u]=Array.isArray(c)?c.map(f=>`${f}`):`${c}`});let s;e===t?s=i:s=iM(e,t,i);let a=Xk(eM(s));return new _o(a,o,r)}function iM(e,t,i){let n={};return Object.entries(e.children).forEach(([r,o])=>{o===t?n[r]=i:n[r]=iM(o,t,i)}),new At(e.segments,n)}var Qm=class{constructor(t,i,n){if(this.isAbsolute=t,this.numberOfDoubleDots=i,this.commands=n,t&&n.length>0&&Zm(n[0]))throw new ke(4003,!1);let r=n.find(ef);if(r&&r!==qk(n))throw new ke(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function aZ(e){if(typeof e[0]=="string"&&e.length===1&&e[0]==="/")return new Qm(!0,0,e);let t=0,i=!1,n=e.reduce((r,o,s)=>{if(typeof o=="object"&&o!=null){if(o.outlets){let a={};return Object.entries(o.outlets).forEach(([u,c])=>{a[u]=typeof c=="string"?c.split("/"):c}),[...r,{outlets:a}]}if(o.segmentPath)return[...r,o.segmentPath]}return typeof o!="string"?[...r,o]:s===0?(o.split("/").forEach((a,u)=>{u==0&&a==="."||(u==0&&a===""?i=!0:a===".."?t++:a!=""&&r.push(a))}),r):[...r,o]},[]);return new Qm(i,t,n)}var Tl=class{constructor(t,i,n){this.segmentGroup=t,this.processChildren=i,this.index=n}};function lZ(e,t,i){if(e.isAbsolute)return new Tl(t,!0,0);if(!i)return new Tl(t,!1,NaN);if(i.parent===null)return new Tl(i,!0,0);let n=Zm(e.commands[0])?0:1,r=i.segments.length-1+n;return uZ(i,r,e.numberOfDoubleDots)}function uZ(e,t,i){let n=e,r=t,o=i;for(;o>r;){if(o-=r,n=n.parent,!n)throw new ke(4005,!1);r=n.segments.length}return new Tl(n,!1,r-o)}function cZ(e){return ef(e[0])?e[0].outlets:{[at]:e}}function rM(e,t,i){if(e??=new At([],{}),e.segments.length===0&&e.hasChildren())return Qd(e,t,i);let n=dZ(e,t,i),r=i.slice(n.commandIndex);if(n.match&&n.pathIndex<e.segments.length){let o=new At(e.segments.slice(0,n.pathIndex),{});return o.children[at]=new At(e.segments.slice(n.pathIndex),e.children),Qd(o,0,r)}else return n.match&&r.length===0?new At(e.segments,{}):n.match&&!e.hasChildren()?lx(e,t,i):n.match?Qd(e,0,r):lx(e,t,i)}function Qd(e,t,i){if(i.length===0)return new At(e.segments,{});{let n=cZ(i),r={};if(Object.keys(n).some(o=>o!==at)&&e.children[at]&&e.numberOfChildren===1&&e.children[at].segments.length===0){let o=Qd(e.children[at],t,i);return new At(e.segments,o.children)}return Object.entries(n).forEach(([o,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(r[o]=rM(e.children[o],t,s))}),Object.entries(e.children).forEach(([o,s])=>{n[o]===void 0&&(r[o]=s)}),new At(e.segments,r)}}function dZ(e,t,i){let n=0,r=t,o={match:!1,pathIndex:0,commandIndex:0};for(;r<e.segments.length;){if(n>=i.length)return o;let s=e.segments[r],a=i[n];if(ef(a))break;let u=`${a}`,c=n<i.length-1?i[n+1]:null;if(r>0&&u===void 0)break;if(u&&c&&typeof c=="object"&&c.outlets===void 0){if(!zk(u,c,s))return o;n+=2}else{if(!zk(u,{},s))return o;n++}r++}return{match:!0,pathIndex:r,commandIndex:n}}function lx(e,t,i){let n=e.segments.slice(0,t),r=0;for(;r<i.length;){let o=i[r];if(ef(o)){let u=fZ(o.outlets);return new At(n,u)}if(r===0&&Zm(i[0])){let u=e.segments[t];n.push(new aa(u.path,Fk(i[0]))),r++;continue}let s=ef(o)?o.outlets[at]:`${o}`,a=r<i.length-1?i[r+1]:null;s&&a&&Zm(a)?(n.push(new aa(s,Fk(a))),r+=2):(n.push(new aa(s,{})),r++)}return new At(n,{})}function fZ(e){let t={};return Object.entries(e).forEach(([i,n])=>{typeof n=="string"&&(n=[n]),n!==null&&(t[i]=lx(new At([],{}),0,n))}),t}function Fk(e){let t={};return Object.entries(e).forEach(([i,n])=>t[i]=`${n}`),t}function zk(e,t,i){return e==i.path&&Fr(t,i.parameters)}var Yd="imperative",$n=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}($n||{}),Bi=class{constructor(t,i){this.id=t,this.url=i}},Rl=class extends Bi{constructor(t,i,n="imperative",r=null){super(t,i),this.type=$n.NavigationStart,this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},vo=class extends Bi{constructor(t,i,n){super(t,i),this.urlAfterRedirects=n,this.type=$n.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Ii=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(Ii||{}),Ym=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(Ym||{}),go=class extends Bi{constructor(t,i,n,r){super(t,i),this.reason=n,this.code=r,this.type=$n.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Qo=class extends Bi{constructor(t,i,n,r){super(t,i),this.reason=n,this.code=r,this.type=$n.NavigationSkipped}},tf=class extends Bi{constructor(t,i,n,r){super(t,i),this.error=n,this.target=r,this.type=$n.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Jm=class extends Bi{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=$n.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},ux=class extends Bi{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=$n.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},cx=class extends Bi{constructor(t,i,n,r,o){super(t,i),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=o,this.type=$n.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},dx=class extends Bi{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=$n.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},fx=class extends Bi{constructor(t,i,n,r){super(t,i),this.urlAfterRedirects=n,this.state=r,this.type=$n.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},hx=class{constructor(t){this.route=t,this.type=$n.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},px=class{constructor(t){this.route=t,this.type=$n.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},mx=class{constructor(t){this.snapshot=t,this.type=$n.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},gx=class{constructor(t){this.snapshot=t,this.type=$n.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},_x=class{constructor(t){this.snapshot=t,this.type=$n.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},vx=class{constructor(t){this.snapshot=t,this.type=$n.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Xm=class{constructor(t,i,n){this.routerEvent=t,this.position=i,this.anchor=n,this.type=$n.Scroll}toString(){let t=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${t}')`}},nf=class{},Ol=class{constructor(t,i){this.url=t,this.navigationBehaviorOptions=i}};function hZ(e,t){return e.providers&&!e._injector&&(e._injector=Np(e.providers,t,`Route: ${e.path}`)),e._injector??t}function ur(e){return e.outlet||at}function pZ(e,t){let i=e.filter(n=>ur(n)===t);return i.push(...e.filter(n=>ur(n)!==t)),i}function cf(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){let i=t.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}var bx=class{get injector(){return cf(this.route?.snapshot)??this.rootInjector}set injector(t){}constructor(t){this.rootInjector=t,this.outlet=null,this.route=null,this.children=new df(this.rootInjector),this.attachRef=null}},df=(()=>{let t=class t{constructor(n){this.rootInjector=n,this.contexts=new Map}onChildOutletCreated(n,r){let o=this.getOrCreateContext(n);o.outlet=r,this.contexts.set(n,o)}onChildOutletDestroyed(n){let r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new bx(this.rootInjector),this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}};t.\u0275fac=function(r){return new(r||t)(me(si))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),eg=class{constructor(t){this._root=t}get root(){return this._root.value}parent(t){let i=this.pathFromRoot(t);return i.length>1?i[i.length-2]:null}children(t){let i=yx(t,this._root);return i?i.children.map(n=>n.value):[]}firstChild(t){let i=yx(t,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(t){let i=wx(t,this._root);return i.length<2?[]:i[i.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return wx(t,this._root).map(i=>i.value)}};function yx(e,t){if(e===t.value)return t;for(let i of t.children){let n=yx(e,i);if(n)return n}return null}function wx(e,t){if(e===t.value)return[t];for(let i of t.children){let n=wx(e,i);if(n.length)return n.unshift(t),n}return[]}var Ei=class{constructor(t,i){this.value=t,this.children=i}toString(){return`TreeNode(${this.value})`}};function Dl(e){let t={};return e&&e.children.forEach(i=>t[i.value.outlet]=i),t}var tg=class extends eg{constructor(t,i){super(t),this.snapshot=i,kx(this,t)}toString(){return this.snapshot.toString()}};function oM(e){let t=mZ(e),i=new dn([new aa("",{})]),n=new dn({}),r=new dn({}),o=new dn({}),s=new dn(""),a=new Yo(i,n,o,s,r,at,e,t.root);return a.snapshot=t.root,new tg(new Ei(a,[]),t)}function mZ(e){let t={},i={},n={},r="",o=new $l([],t,n,r,i,at,e,null,{});return new ig("",new Ei(o,[]))}var Yo=class{constructor(t,i,n,r,o,s,a,u){this.urlSubject=t,this.paramsSubject=i,this.queryParamsSubject=n,this.fragmentSubject=r,this.dataSubject=o,this.outlet=s,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(We(c=>c[lf]))??Ne(void 0),this.url=t,this.params=i,this.queryParams=n,this.fragment=r,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(We(t=>Ml(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(We(t=>Ml(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function ng(e,t,i="emptyOnly"){let n,{routeConfig:r}=e;return t!==null&&(i==="always"||r?.path===""||!t.component&&!t.routeConfig?.loadComponent)?n={params:ie(ie({},t.params),e.params),data:ie(ie({},t.data),e.data),resolve:ie(ie(ie(ie({},e.data),t.data),r?.data),e._resolvedData)}:n={params:ie({},e.params),data:ie({},e.data),resolve:ie(ie({},e.data),e._resolvedData??{})},r&&aM(r)&&(n.resolve[lf]=r.title),n}var $l=class{get title(){return this.data?.[lf]}constructor(t,i,n,r,o,s,a,u,c){this.url=t,this.params=i,this.queryParams=n,this.fragment=r,this.data=o,this.outlet=s,this.component=a,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Ml(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Ml(this.queryParams),this._queryParamMap}toString(){let t=this.url.map(n=>n.toString()).join("/"),i=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${t}', path:'${i}')`}},ig=class extends eg{constructor(t,i){super(i),this.url=t,kx(this,i)}toString(){return sM(this._root)}};function kx(e,t){t.value._routerState=e,t.children.forEach(i=>kx(e,i))}function sM(e){let t=e.children.length>0?` { ${e.children.map(sM).join(", ")} } `:"";return`${e.value}${t}`}function nx(e){if(e.snapshot){let t=e.snapshot,i=e._futureSnapshot;e.snapshot=i,Fr(t.queryParams,i.queryParams)||e.queryParamsSubject.next(i.queryParams),t.fragment!==i.fragment&&e.fragmentSubject.next(i.fragment),Fr(t.params,i.params)||e.paramsSubject.next(i.params),VK(t.url,i.url)||e.urlSubject.next(i.url),Fr(t.data,i.data)||e.dataSubject.next(i.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function xx(e,t){let i=Fr(e.params,t.params)&&qK(e.url,t.url),n=!e.parent!=!t.parent;return i&&!n&&(!e.parent||xx(e.parent,t.parent))}function aM(e){return typeof e.title=="string"||e.title===null}var Mx=(()=>{let t=class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=at,this.activateEvents=new Tt,this.deactivateEvents=new Tt,this.attachEvents=new Tt,this.detachEvents=new Tt,this.parentContexts=ne(df),this.location=ne(ai),this.changeDetector=ne(Kn),this.inputBinder=ne(lg,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){let{firstChange:r,previousValue:o}=n.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ke(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ke(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ke(4012,!1);this.location.detach();let n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){let n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new ke(4013,!1);this._activatedRoute=n;let o=this.location,a=n.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,c=new Cx(n,u,o.injector);this.activated=o.createComponent(a,{index:o.length,injector:c,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};t.\u0275fac=function(r){return new(r||t)},t.\u0275dir=Me({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Wn]});let e=t;return e})(),Cx=class e{__ngOutletInjector(t){return new e(this.route,this.childContexts,t)}constructor(t,i,n){this.route=t,this.childContexts=i,this.parent=n}get(t,i){return t===Yo?this.route:t===df?this.childContexts:this.parent.get(t,i)}},lg=new _e(""),Lk=(()=>{let t=class t{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){let{activatedRoute:r}=n,o=zs([r.queryParams,r.params,r.data]).pipe(ti(([s,a,u],c)=>(u=ie(ie(ie({},s),a),u),c===0?Ne(u):Promise.resolve(u)))).subscribe(s=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==r||r.component===null){this.unsubscribeFromRouteData(n);return}let a=wT(r.component);if(!a){this.unsubscribeFromRouteData(n);return}for(let{templateName:u}of a.inputs)n.activatedComponentRef.setInput(u,s[u])});this.outletDataSubscriptions.set(n,o)}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})();function gZ(e,t,i){let n=rf(e,t._root,i?i._root:void 0);return new tg(n,t)}function rf(e,t,i){if(i&&e.shouldReuseRoute(t.value,i.value.snapshot)){let n=i.value;n._futureSnapshot=t.value;let r=_Z(e,t,i);return new Ei(n,r)}else{if(e.shouldAttach(t.value)){let o=e.retrieve(t.value);if(o!==null){let s=o.route;return s.value._futureSnapshot=t.value,s.children=t.children.map(a=>rf(e,a)),s}}let n=vZ(t.value),r=t.children.map(o=>rf(e,o));return new Ei(n,r)}}function _Z(e,t,i){return t.children.map(n=>{for(let r of i.children)if(e.shouldReuseRoute(n.value,r.value.snapshot))return rf(e,n,r);return rf(e,n)})}function vZ(e){return new Yo(new dn(e.url),new dn(e.params),new dn(e.queryParams),new dn(e.fragment),new dn(e.data),e.outlet,e.component,e)}var of=class{constructor(t,i){this.redirectTo=t,this.navigationBehaviorOptions=i}},lM="ngNavigationCancelingError";function rg(e,t){let{redirectTo:i,navigationBehaviorOptions:n}=Xd(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=uM(!1,Ii.Redirect);return r.url=i,r.navigationBehaviorOptions=n,r}function uM(e,t){let i=new Error(`NavigationCancelingError: ${e||""}`);return i[lM]=!0,i.cancellationCode=t,i}function bZ(e){return cM(e)&&Xd(e.url)}function cM(e){return!!e&&e[lM]}var yZ=(e,t,i,n)=>We(r=>(new Ex(t,r.targetRouterState,r.currentRouterState,i,n).activate(e),r)),Ex=class{constructor(t,i,n,r,o){this.routeReuseStrategy=t,this.futureState=i,this.currState=n,this.forwardEvent=r,this.inputBindingEnabled=o}activate(t){let i=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,n,t),nx(this.futureState.root),this.activateChildRoutes(i,n,t)}deactivateChildRoutes(t,i,n){let r=Dl(i);t.children.forEach(o=>{let s=o.value.outlet;this.deactivateRoutes(o,r[s],n),delete r[s]}),Object.values(r).forEach(o=>{this.deactivateRouteAndItsChildren(o,n)})}deactivateRoutes(t,i,n){let r=t.value,o=i?i.value:null;if(r===o)if(r.component){let s=n.getContext(r.outlet);s&&this.deactivateChildRoutes(t,i,s.children)}else this.deactivateChildRoutes(t,i,n);else o&&this.deactivateRouteAndItsChildren(i,n)}deactivateRouteAndItsChildren(t,i){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,i):this.deactivateRouteAndOutlet(t,i)}detachAndStoreRouteSubtree(t,i){let n=i.getContext(t.value.outlet),r=n&&t.value.component?n.children:i,o=Dl(t);for(let s of Object.values(o))this.deactivateRouteAndItsChildren(s,r);if(n&&n.outlet){let s=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:s,route:t,contexts:a})}}deactivateRouteAndOutlet(t,i){let n=i.getContext(t.value.outlet),r=n&&t.value.component?n.children:i,o=Dl(t);for(let s of Object.values(o))this.deactivateRouteAndItsChildren(s,r);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(t,i,n){let r=Dl(i);t.children.forEach(o=>{this.activateRoutes(o,r[o.value.outlet],n),this.forwardEvent(new vx(o.value.snapshot))}),t.children.length&&this.forwardEvent(new gx(t.value.snapshot))}activateRoutes(t,i,n){let r=t.value,o=i?i.value:null;if(nx(r),r===o)if(r.component){let s=n.getOrCreateContext(r.outlet);this.activateChildRoutes(t,i,s.children)}else this.activateChildRoutes(t,i,n);else if(r.component){let s=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){let a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),nx(a.route.value),this.activateChildRoutes(t,null,s.children)}else s.attachRef=null,s.route=r,s.outlet&&s.outlet.activateWith(r,s.injector),this.activateChildRoutes(t,null,s.children)}else this.activateChildRoutes(t,null,n)}},og=class{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}},kl=class{constructor(t,i){this.component=t,this.route=i}};function wZ(e,t,i){let n=e._root,r=t?t._root:null;return Kd(n,r,i,[n.value])}function xZ(e){let t=e.routeConfig?e.routeConfig.canActivateChild:null;return!t||t.length===0?null:{node:e,guards:t}}function Pl(e,t){let i=Symbol(),n=t.get(e,i);return n===i?typeof e=="function"&&!jS(e)?e:t.get(e):n}function Kd(e,t,i,n,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=Dl(t);return e.children.forEach(s=>{CZ(s,o[s.value.outlet],i,n.concat([s.value]),r),delete o[s.value.outlet]}),Object.entries(o).forEach(([s,a])=>Jd(a,i.getContext(s),r)),r}function CZ(e,t,i,n,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=e.value,s=t?t.value:null,a=i?i.getContext(e.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){let u=EZ(s,o,o.routeConfig.runGuardsAndResolvers);u?r.canActivateChecks.push(new og(n)):(o.data=s.data,o._resolvedData=s._resolvedData),o.component?Kd(e,t,a?a.children:null,n,r):Kd(e,t,i,n,r),u&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new kl(a.outlet.component,s))}else s&&Jd(t,a,r),r.canActivateChecks.push(new og(n)),o.component?Kd(e,null,a?a.children:null,n,r):Kd(e,null,i,n,r);return r}function EZ(e,t,i){if(typeof i=="function")return i(e,t);switch(i){case"pathParamsChange":return!la(e.url,t.url);case"pathParamsOrQueryParamsChange":return!la(e.url,t.url)||!Fr(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!xx(e,t)||!Fr(e.queryParams,t.queryParams);case"paramsChange":default:return!xx(e,t)}}function Jd(e,t,i){let n=Dl(e),r=e.value;Object.entries(n).forEach(([o,s])=>{r.component?t?Jd(s,t.children.getContext(o),i):Jd(s,null,i):Jd(s,t,i)}),r.component?t&&t.outlet&&t.outlet.isActivated?i.canDeactivateChecks.push(new kl(t.outlet.component,r)):i.canDeactivateChecks.push(new kl(null,r)):i.canDeactivateChecks.push(new kl(null,r))}function ff(e){return typeof e=="function"}function IZ(e){return typeof e=="boolean"}function SZ(e){return e&&ff(e.canLoad)}function DZ(e){return e&&ff(e.canActivate)}function TZ(e){return e&&ff(e.canActivateChild)}function $Z(e){return e&&ff(e.canDeactivate)}function kZ(e){return e&&ff(e.canMatch)}function dM(e){return e instanceof to||e?.name==="EmptyError"}var Wm=Symbol("INITIAL_VALUE");function Nl(){return ti(e=>zs(e.map(t=>t.pipe(tr(1),ja(Wm)))).pipe(We(t=>{for(let i of t)if(i!==!0){if(i===Wm)return Wm;if(i===!1||MZ(i))return i}return!0}),mn(t=>t!==Wm),tr(1)))}function MZ(e){return Xd(e)||e instanceof of}function AZ(e,t){return pn(i=>{let{targetSnapshot:n,currentSnapshot:r,guards:{canActivateChecks:o,canDeactivateChecks:s}}=i;return s.length===0&&o.length===0?Ne(Ae(ie({},i),{guardsResult:!0})):RZ(s,n,r,e).pipe(pn(a=>a&&IZ(a)?OZ(n,o,e,t):Ne(a)),We(a=>Ae(ie({},i),{guardsResult:a})))})}function RZ(e,t,i,n){return jt(e).pipe(pn(r=>LZ(r.component,r.route,i,t,n)),Ir(r=>r!==!0,!0))}function OZ(e,t,i,n){return jt(t).pipe(no(r=>Io(PZ(r.route.parent,n),NZ(r.route,n),zZ(e,r.path,i),FZ(e,r.route,i))),Ir(r=>r!==!0,!0))}function NZ(e,t){return e!==null&&t&&t(new _x(e)),Ne(!0)}function PZ(e,t){return e!==null&&t&&t(new mx(e)),Ne(!0)}function FZ(e,t,i){let n=t.routeConfig?t.routeConfig.canActivate:null;if(!n||n.length===0)return Ne(!0);let r=n.map(o=>Ih(()=>{let s=cf(t)??i,a=Pl(o,s),u=DZ(a)?a.canActivate(t,e):xi(s,()=>a(t,e));return Jo(u).pipe(Ir())}));return Ne(r).pipe(Nl())}function zZ(e,t,i){let n=t[t.length-1],o=t.slice(0,t.length-1).reverse().map(s=>xZ(s)).filter(s=>s!==null).map(s=>Ih(()=>{let a=s.guards.map(u=>{let c=cf(s.node)??i,f=Pl(u,c),p=TZ(f)?f.canActivateChild(n,e):xi(c,()=>f(n,e));return Jo(p).pipe(Ir())});return Ne(a).pipe(Nl())}));return Ne(o).pipe(Nl())}function LZ(e,t,i,n,r){let o=t&&t.routeConfig?t.routeConfig.canDeactivate:null;if(!o||o.length===0)return Ne(!0);let s=o.map(a=>{let u=cf(t)??r,c=Pl(a,u),f=$Z(c)?c.canDeactivate(e,t,i,n):xi(u,()=>c(e,t,i,n));return Jo(f).pipe(Ir())});return Ne(s).pipe(Nl())}function BZ(e,t,i,n){let r=t.canLoad;if(r===void 0||r.length===0)return Ne(!0);let o=r.map(s=>{let a=Pl(s,e),u=SZ(a)?a.canLoad(t,i):xi(e,()=>a(t,i));return Jo(u)});return Ne(o).pipe(Nl(),fM(n))}function fM(e){return Fb(Cn(t=>{if(typeof t!="boolean")throw rg(e,t)}),We(t=>t===!0))}function jZ(e,t,i,n){let r=t.canMatch;if(!r||r.length===0)return Ne(!0);let o=r.map(s=>{let a=Pl(s,e),u=kZ(a)?a.canMatch(t,i):xi(e,()=>a(t,i));return Jo(u)});return Ne(o).pipe(Nl(),fM(n))}var sf=class{constructor(t){this.segmentGroup=t||null}},af=class extends Error{constructor(t){super(),this.urlTree=t}};function Sl(e){return La(new sf(e))}function VZ(e){return La(new ke(4e3,!1))}function UZ(e){return La(uM(!1,Ii.GuardRejected))}var Ix=class{constructor(t,i){this.urlSerializer=t,this.urlTree=i}lineralizeSegments(t,i){let n=[],r=i.root;for(;;){if(n=n.concat(r.segments),r.numberOfChildren===0)return Ne(n);if(r.numberOfChildren>1||!r.children[at])return VZ(`${t.redirectTo}`);r=r.children[at]}}applyRedirectCommands(t,i,n,r,o){if(typeof i!="string"){let a=i,{queryParams:u,fragment:c,routeConfig:f,url:p,outlet:m,params:v,data:b,title:w}=r,C=xi(o,()=>a({params:v,data:b,queryParams:u,fragment:c,routeConfig:f,url:p,outlet:m,title:w}));if(C instanceof _o)throw new af(C);i=C}let s=this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),t,n);if(i[0]==="/")throw new af(s);return s}applyRedirectCreateUrlTree(t,i,n,r){let o=this.createSegmentGroup(t,i.root,n,r);return new _o(o,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(t,i){let n={};return Object.entries(t).forEach(([r,o])=>{if(typeof o=="string"&&o[0]===":"){let a=o.substring(1);n[r]=i[a]}else n[r]=o}),n}createSegmentGroup(t,i,n,r){let o=this.createSegments(t,i.segments,n,r),s={};return Object.entries(i.children).forEach(([a,u])=>{s[a]=this.createSegmentGroup(t,u,n,r)}),new At(o,s)}createSegments(t,i,n,r){return i.map(o=>o.path[0]===":"?this.findPosParam(t,o,r):this.findOrReturn(o,n))}findPosParam(t,i,n){let r=n[i.path.substring(1)];if(!r)throw new ke(4001,!1);return r}findOrReturn(t,i){let n=0;for(let r of i){if(r.path===t.path)return i.splice(n),r;n++}return t}},Sx={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function HZ(e,t,i,n,r){let o=Ax(e,t,i);return o.matched?(n=hZ(t,n),jZ(n,t,i,r).pipe(We(s=>s===!0?o:ie({},Sx)))):Ne(o)}function Ax(e,t,i){if(t.path==="**")return WZ(i);if(t.path==="")return t.pathMatch==="full"&&(e.hasChildren()||i.length>0)?ie({},Sx):{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};let r=(t.matcher||jK)(i,e,t);if(!r)return ie({},Sx);let o={};Object.entries(r.posParams??{}).forEach(([a,u])=>{o[a]=u.path});let s=r.consumed.length>0?ie(ie({},o),r.consumed[r.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:r.consumed,remainingSegments:i.slice(r.consumed.length),parameters:s,positionalParamSegments:r.posParams??{}}}function WZ(e){return{matched:!0,parameters:e.length>0?qk(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}function Bk(e,t,i,n){return i.length>0&&KZ(e,i,n)?{segmentGroup:new At(t,GZ(n,new At(i,e.children))),slicedSegments:[]}:i.length===0&&ZZ(e,i,n)?{segmentGroup:new At(e.segments,qZ(e,i,n,e.children)),slicedSegments:i}:{segmentGroup:new At(e.segments,e.children),slicedSegments:i}}function qZ(e,t,i,n){let r={};for(let o of i)if(ug(e,t,o)&&!n[ur(o)]){let s=new At([],{});r[ur(o)]=s}return ie(ie({},n),r)}function GZ(e,t){let i={};i[at]=t;for(let n of e)if(n.path===""&&ur(n)!==at){let r=new At([],{});i[ur(n)]=r}return i}function KZ(e,t,i){return i.some(n=>ug(e,t,n)&&ur(n)!==at)}function ZZ(e,t,i){return i.some(n=>ug(e,t,n))}function ug(e,t,i){return(e.hasChildren()||t.length>0)&&i.pathMatch==="full"?!1:i.path===""}function QZ(e,t,i,n){return ur(e)!==n&&(n===at||!ug(t,i,e))?!1:Ax(t,e,i).matched}function YZ(e,t,i){return t.length===0&&!e.children[i]}var Dx=class{};function JZ(e,t,i,n,r,o,s="emptyOnly"){return new Tx(e,t,i,n,r,s,o).recognize()}var XZ=31,Tx=class{constructor(t,i,n,r,o,s,a){this.injector=t,this.configLoader=i,this.rootComponentType=n,this.config=r,this.urlTree=o,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new Ix(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(t){return new ke(4002,`'${t.segmentGroup}'`)}recognize(){let t=Bk(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(We(({children:i,rootSnapshot:n})=>{let r=new Ei(n,i),o=new ig("",r),s=sZ(n,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(s),{state:o,tree:s}}))}match(t){let i=new $l([],Object.freeze({}),Object.freeze(ie({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),at,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,t,at,i).pipe(We(n=>({children:n,rootSnapshot:i})),So(n=>{if(n instanceof af)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof sf?this.noMatchError(n):n}))}processSegmentGroup(t,i,n,r,o){return n.segments.length===0&&n.hasChildren()?this.processChildren(t,i,n,o):this.processSegment(t,i,n,n.segments,r,!0,o).pipe(We(s=>s instanceof Ei?[s]:[]))}processChildren(t,i,n,r){let o=[];for(let s of Object.keys(n.children))s==="primary"?o.unshift(s):o.push(s);return jt(o).pipe(no(s=>{let a=n.children[s],u=pZ(i,s);return this.processSegmentGroup(t,u,a,s,r)}),Gb((s,a)=>(s.push(...a),s)),Do(null),qb(),pn(s=>{if(s===null)return Sl(n);let a=hM(s);return eQ(a),Ne(a)}))}processSegment(t,i,n,r,o,s,a){return jt(i).pipe(no(u=>this.processSegmentAgainstRoute(u._injector??t,i,u,n,r,o,s,a).pipe(So(c=>{if(c instanceof sf)return Ne(null);throw c}))),Ir(u=>!!u),So(u=>{if(dM(u))return YZ(n,r,o)?Ne(new Dx):Sl(n);throw u}))}processSegmentAgainstRoute(t,i,n,r,o,s,a,u){return QZ(n,r,o,s)?n.redirectTo===void 0?this.matchSegmentAgainstRoute(t,r,n,o,s,u):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(t,r,i,n,o,s,u):Sl(r):Sl(r)}expandSegmentAgainstRouteUsingRedirect(t,i,n,r,o,s,a){let{matched:u,parameters:c,consumedSegments:f,positionalParamSegments:p,remainingSegments:m}=Ax(i,r,o);if(!u)return Sl(i);typeof r.redirectTo=="string"&&r.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>XZ&&(this.allowRedirects=!1));let v=new $l(o,c,Object.freeze(ie({},this.urlTree.queryParams)),this.urlTree.fragment,jk(r),ur(r),r.component??r._loadedComponent??null,r,Vk(r)),b=ng(v,a,this.paramsInheritanceStrategy);v.params=Object.freeze(b.params),v.data=Object.freeze(b.data);let w=this.applyRedirects.applyRedirectCommands(f,r.redirectTo,p,v,t);return this.applyRedirects.lineralizeSegments(r,w).pipe(pn(C=>this.processSegment(t,n,i,C.concat(m),s,!1,a)))}matchSegmentAgainstRoute(t,i,n,r,o,s){let a=HZ(i,n,r,t,this.urlSerializer);return n.path==="**"&&(i.children={}),a.pipe(ti(u=>u.matched?(t=n._injector??t,this.getChildConfig(t,n,r).pipe(ti(({routes:c})=>{let f=n._loadedInjector??t,{parameters:p,consumedSegments:m,remainingSegments:v}=u,b=new $l(m,p,Object.freeze(ie({},this.urlTree.queryParams)),this.urlTree.fragment,jk(n),ur(n),n.component??n._loadedComponent??null,n,Vk(n)),w=ng(b,s,this.paramsInheritanceStrategy);b.params=Object.freeze(w.params),b.data=Object.freeze(w.data);let{segmentGroup:C,slicedSegments:x}=Bk(i,m,v,c);if(x.length===0&&C.hasChildren())return this.processChildren(f,c,C,b).pipe(We(I=>new Ei(b,I)));if(c.length===0&&x.length===0)return Ne(new Ei(b,[]));let y=ur(n)===o;return this.processSegment(f,c,C,x,y?at:o,!0,b).pipe(We(I=>new Ei(b,I instanceof Ei?[I]:[])))}))):Sl(i)))}getChildConfig(t,i,n){return i.children?Ne({routes:i.children,injector:t}):i.loadChildren?i._loadedRoutes!==void 0?Ne({routes:i._loadedRoutes,injector:i._loadedInjector}):BZ(t,i,n,this.urlSerializer).pipe(pn(r=>r?this.configLoader.loadChildren(t,i).pipe(Cn(o=>{i._loadedRoutes=o.routes,i._loadedInjector=o.injector})):UZ(i))):Ne({routes:[],injector:t})}};function eQ(e){e.sort((t,i)=>t.value.outlet===at?-1:i.value.outlet===at?1:t.value.outlet.localeCompare(i.value.outlet))}function tQ(e){let t=e.value.routeConfig;return t&&t.path===""}function hM(e){let t=[],i=new Set;for(let n of e){if(!tQ(n)){t.push(n);continue}let r=t.find(o=>n.value.routeConfig===o.value.routeConfig);r!==void 0?(r.children.push(...n.children),i.add(r)):t.push(n)}for(let n of i){let r=hM(n.children);t.push(new Ei(n.value,r))}return t.filter(n=>!i.has(n))}function jk(e){return e.data||{}}function Vk(e){return e.resolve||{}}function nQ(e,t,i,n,r,o){return pn(s=>JZ(e,t,i,n,s.extractedUrl,r,o).pipe(We(({state:a,tree:u})=>Ae(ie({},s),{targetSnapshot:a,urlAfterRedirects:u}))))}function iQ(e,t){return pn(i=>{let{targetSnapshot:n,guards:{canActivateChecks:r}}=i;if(!r.length)return Ne(i);let o=new Set(r.map(u=>u.route)),s=new Set;for(let u of o)if(!s.has(u))for(let c of pM(u))s.add(c);let a=0;return jt(s).pipe(no(u=>o.has(u)?rQ(u,n,e,t):(u.data=ng(u,u.parent,e).resolve,Ne(void 0))),Cn(()=>a++),Ba(1),pn(u=>a===s.size?Ne(i):Fn))})}function pM(e){let t=e.children.map(i=>pM(i)).flat();return[e,...t]}function rQ(e,t,i,n){let r=e.routeConfig,o=e._resolve;return r?.title!==void 0&&!aM(r)&&(o[lf]=r.title),oQ(o,e,t,n).pipe(We(s=>(e._resolvedData=s,e.data=ng(e,e.parent,i).resolve,null)))}function oQ(e,t,i,n){let r=ox(e);if(r.length===0)return Ne({});let o={};return jt(r).pipe(pn(s=>sQ(e[s],t,i,n).pipe(Ir(),Cn(a=>{if(a instanceof of)throw rg(new Al,a);o[s]=a}))),Ba(1),Wb(o),So(s=>dM(s)?Fn:La(s)))}function sQ(e,t,i,n){let r=cf(t)??n,o=Pl(e,r),s=o.resolve?o.resolve(t,i):xi(r,()=>o(t,i));return Jo(s)}function ix(e){return ti(t=>{let i=e(t);return i?jt(i).pipe(We(()=>t)):Ne(t)})}var mM=(()=>{let t=class t{buildTitle(n){let r,o=n.root;for(;o!==void 0;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(s=>s.outlet===at);return r}getResolvedTitleForRoute(n){return n.data[lf]}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:()=>ne(aQ),providedIn:"root"});let e=t;return e})(),aQ=(()=>{let t=class t extends mM{constructor(n){super(),this.title=n}updateTitle(n){let r=this.buildTitle(n);r!==void 0&&this.title.setTitle(r)}};t.\u0275fac=function(r){return new(r||t)(me(JT))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),hf=new _e("",{providedIn:"root",factory:()=>({})}),lQ=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=Oe({type:t,selectors:[["ng-component"]],standalone:!0,features:[nn],decls:1,vars:0,template:function(r,o){r&1&&G(0,"router-outlet")},dependencies:[Mx],encapsulation:2});let e=t;return e})();function Rx(e){let t=e.children&&e.children.map(Rx),i=t?Ae(ie({},e),{children:t}):ie({},e);return!i.component&&!i.loadComponent&&(t||i.loadChildren)&&i.outlet&&i.outlet!==at&&(i.component=lQ),i}var sg=new _e(""),Ox=(()=>{let t=class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ne(jp)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Ne(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);let r=Jo(n.loadComponent()).pipe(We(gM),Cn(s=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=s}),Ls(()=>{this.componentLoaders.delete(n)})),o=new Co(r,()=>new lt).pipe(Fa());return this.componentLoaders.set(n,o),o}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Ne({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let s=uQ(r,this.compiler,n,this.onLoadEndListener).pipe(Ls(()=>{this.childrenLoaders.delete(r)})),a=new Co(s,()=>new lt).pipe(Fa());return this.childrenLoaders.set(r,a),a}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function uQ(e,t,i,n){return Jo(e.loadChildren()).pipe(We(gM),pn(r=>r instanceof gd||Array.isArray(r)?Ne(r):jt(t.compileModuleAsync(r))),We(r=>{n&&n(e);let o,s,a=!1;return Array.isArray(r)?(s=r,a=!0):(o=r.create(i).injector,s=o.get(sg,[],{optional:!0,self:!0}).flat()),{routes:s.map(Rx),injector:o}}))}function cQ(e){return e&&typeof e=="object"&&"default"in e}function gM(e){return cQ(e)?e.default:e}var Nx=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:()=>ne(dQ),providedIn:"root"});let e=t;return e})(),dQ=(()=>{let t=class t{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,r){return n}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),_M=new _e(""),vM=new _e("");function fQ(e,t,i){let n=e.get(vM),r=e.get(yt);return e.get(Re).runOutsideAngular(()=>{if(!r.startViewTransition||n.skipNextTransition)return n.skipNextTransition=!1,new Promise(c=>setTimeout(c));let o,s=new Promise(c=>{o=c}),a=r.startViewTransition(()=>(o(),hQ(e))),{onViewTransitionCreated:u}=n;return u&&xi(e,()=>u({transition:a,from:t,to:i})),s})}function hQ(e){return new Promise(t=>{Bo({read:()=>setTimeout(t)},{injector:e})})}var pQ=new _e(""),Px=(()=>{let t=class t{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new lt,this.transitionAbortSubject=new lt,this.configLoader=ne(Ox),this.environmentInjector=ne(si),this.urlSerializer=ne(uf),this.rootContexts=ne(df),this.location=ne(zi),this.inputBindingEnabled=ne(lg,{optional:!0})!==null,this.titleStrategy=ne(mM),this.options=ne(hf,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=ne(Nx),this.createViewTransition=ne(_M,{optional:!0}),this.navigationErrorHandler=ne(pQ,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Ne(void 0),this.rootComponentType=null;let n=o=>this.events.next(new hx(o)),r=o=>this.events.next(new px(o));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=n}complete(){this.transitions?.complete()}handleNavigationRequest(n){let r=++this.navigationId;this.transitions?.next(Ae(ie(ie({},this.transitions.value),n),{id:r}))}setupNavigations(n,r,o){return this.transitions=new dn({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Yd,restoredState:null,currentSnapshot:o.snapshot,targetSnapshot:null,currentRouterState:o,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(mn(s=>s.id!==0),We(s=>Ae(ie({},s),{extractedUrl:this.urlHandlingStrategy.extract(s.rawUrl)})),ti(s=>{let a=!1,u=!1;return Ne(s).pipe(ti(c=>{if(this.navigationId>s.id)return this.cancelNavigationTransition(s,"",Ii.SupersededByNewNavigation),Fn;this.currentTransition=s,this.currentNavigation={id:c.id,initialUrl:c.rawUrl,extractedUrl:c.extractedUrl,targetBrowserUrl:typeof c.extras.browserUrl=="string"?this.urlSerializer.parse(c.extras.browserUrl):c.extras.browserUrl,trigger:c.source,extras:c.extras,previousNavigation:this.lastSuccessfulNavigation?Ae(ie({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let f=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),p=c.extras.onSameUrlNavigation??n.onSameUrlNavigation;if(!f&&p!=="reload"){let m="";return this.events.next(new Qo(c.id,this.urlSerializer.serialize(c.rawUrl),m,Ym.IgnoredSameUrlNavigation)),c.resolve(!1),Fn}if(this.urlHandlingStrategy.shouldProcessUrl(c.rawUrl))return Ne(c).pipe(ti(m=>{let v=this.transitions?.getValue();return this.events.next(new Rl(m.id,this.urlSerializer.serialize(m.extractedUrl),m.source,m.restoredState)),v!==this.transitions?.getValue()?Fn:Promise.resolve(m)}),nQ(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),Cn(m=>{s.targetSnapshot=m.targetSnapshot,s.urlAfterRedirects=m.urlAfterRedirects,this.currentNavigation=Ae(ie({},this.currentNavigation),{finalUrl:m.urlAfterRedirects});let v=new Jm(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(v)}));if(f&&this.urlHandlingStrategy.shouldProcessUrl(c.currentRawUrl)){let{id:m,extractedUrl:v,source:b,restoredState:w,extras:C}=c,x=new Rl(m,this.urlSerializer.serialize(v),b,w);this.events.next(x);let y=oM(this.rootComponentType).snapshot;return this.currentTransition=s=Ae(ie({},c),{targetSnapshot:y,urlAfterRedirects:v,extras:Ae(ie({},C),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=v,Ne(s)}else{let m="";return this.events.next(new Qo(c.id,this.urlSerializer.serialize(c.extractedUrl),m,Ym.IgnoredByUrlHandlingStrategy)),c.resolve(!1),Fn}}),Cn(c=>{let f=new ux(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(f)}),We(c=>(this.currentTransition=s=Ae(ie({},c),{guards:wZ(c.targetSnapshot,c.currentSnapshot,this.rootContexts)}),s)),AZ(this.environmentInjector,c=>this.events.next(c)),Cn(c=>{if(s.guardsResult=c.guardsResult,c.guardsResult&&typeof c.guardsResult!="boolean")throw rg(this.urlSerializer,c.guardsResult);let f=new cx(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot,!!c.guardsResult);this.events.next(f)}),mn(c=>c.guardsResult?!0:(this.cancelNavigationTransition(c,"",Ii.GuardRejected),!1)),ix(c=>{if(c.guards.canActivateChecks.length)return Ne(c).pipe(Cn(f=>{let p=new dx(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(p)}),ti(f=>{let p=!1;return Ne(f).pipe(iQ(this.paramsInheritanceStrategy,this.environmentInjector),Cn({next:()=>p=!0,complete:()=>{p||this.cancelNavigationTransition(f,"",Ii.NoDataFromResolver)}}))}),Cn(f=>{let p=new fx(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(p)}))}),ix(c=>{let f=p=>{let m=[];p.routeConfig?.loadComponent&&!p.routeConfig._loadedComponent&&m.push(this.configLoader.loadComponent(p.routeConfig).pipe(Cn(v=>{p.component=v}),We(()=>{})));for(let v of p.children)m.push(...f(v));return m};return zs(f(c.targetSnapshot.root)).pipe(Do(null),tr(1))}),ix(()=>this.afterPreactivation()),ti(()=>{let{currentSnapshot:c,targetSnapshot:f}=s,p=this.createViewTransition?.(this.environmentInjector,c.root,f.root);return p?jt(p).pipe(We(()=>s)):Ne(s)}),We(c=>{let f=gZ(n.routeReuseStrategy,c.targetSnapshot,c.currentRouterState);return this.currentTransition=s=Ae(ie({},c),{targetRouterState:f}),this.currentNavigation.targetRouterState=f,s}),Cn(()=>{this.events.next(new nf)}),yZ(this.rootContexts,n.routeReuseStrategy,c=>this.events.next(c),this.inputBindingEnabled),tr(1),Cn({next:c=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new vo(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects))),this.titleStrategy?.updateTitle(c.targetRouterState.snapshot),c.resolve(!0)},complete:()=>{a=!0}}),zn(this.transitionAbortSubject.pipe(Cn(c=>{throw c}))),Ls(()=>{!a&&!u&&this.cancelNavigationTransition(s,"",Ii.SupersededByNewNavigation),this.currentTransition?.id===s.id&&(this.currentNavigation=null,this.currentTransition=null)}),So(c=>{if(u=!0,cM(c))this.events.next(new go(s.id,this.urlSerializer.serialize(s.extractedUrl),c.message,c.cancellationCode)),bZ(c)?this.events.next(new Ol(c.url,c.navigationBehaviorOptions)):s.resolve(!1);else{let f=new tf(s.id,this.urlSerializer.serialize(s.extractedUrl),c,s.targetSnapshot??void 0);try{let p=xi(this.environmentInjector,()=>this.navigationErrorHandler?.(f));if(p instanceof of){let{message:m,cancellationCode:v}=rg(this.urlSerializer,p);this.events.next(new go(s.id,this.urlSerializer.serialize(s.extractedUrl),m,v)),this.events.next(new Ol(p.redirectTo,p.navigationBehaviorOptions))}else{this.events.next(f);let m=n.errorHandler(c);s.resolve(!!m)}}catch(p){this.options.resolveNavigationPromiseOnError?s.resolve(!1):s.reject(p)}}return Fn}))}))}cancelNavigationTransition(n,r,o){let s=new go(n.id,this.urlSerializer.serialize(n.extractedUrl),r,o);this.events.next(s),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let n=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return n.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function mQ(e){return e!==Yd}var gQ=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:()=>ne(_Q),providedIn:"root"});let e=t;return e})(),$x=class{shouldDetach(t){return!1}store(t,i){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,i){return t.routeConfig===i.routeConfig}},_Q=(()=>{let t=class t extends $x{};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),bM=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:()=>ne(vQ),providedIn:"root"});let e=t;return e})(),vQ=(()=>{let t=class t extends bM{constructor(){super(...arguments),this.location=ne(zi),this.urlSerializer=ne(uf),this.options=ne(hf,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=ne(Nx),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new _o,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=oM(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(r=>{r.type==="popstate"&&n(r.url,r.state)})}handleRouterEvent(n,r){if(n instanceof Rl)this.stateMemento=this.createStateMemento();else if(n instanceof Qo)this.rawUrlTree=r.initialUrl;else if(n instanceof Jm){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let o=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??o,r)}}else n instanceof nf?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):n instanceof go&&(n.code===Ii.GuardRejected||n.code===Ii.NoDataFromResolver)?this.restoreHistory(r):n instanceof tf?this.restoreHistory(r,!0):n instanceof vo&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,r){let o=n instanceof _o?this.urlSerializer.serialize(n):n;if(this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl){let s=this.browserPageId,a=ie(ie({},r.extras.state),this.generateNgRouterState(r.id,s));this.location.replaceState(o,"",a)}else{let s=ie(ie({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(o,"",s)}}restoreHistory(n,r=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,s=this.currentPageId-o;s!==0?this.location.historyGo(s):this.currentUrlTree===n.finalUrl&&s===0&&(this.resetState(n),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,r){return this.canceledNavigationResolution==="computed"?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=qn(t)))(o||t)}})(),t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),Zd=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(Zd||{});function yM(e,t){e.events.pipe(mn(i=>i instanceof vo||i instanceof go||i instanceof tf||i instanceof Qo),We(i=>i instanceof vo||i instanceof Qo?Zd.COMPLETE:(i instanceof go?i.code===Ii.Redirect||i.code===Ii.SupersededByNewNavigation:!1)?Zd.REDIRECTING:Zd.FAILED),mn(i=>i!==Zd.REDIRECTING),tr(1)).subscribe(()=>{t()})}function bQ(e){throw e}var yQ={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},wQ={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},ft=(()=>{let t=class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=ne(Pp),this.stateManager=ne(bM),this.options=ne(hf,{optional:!0})||{},this.pendingTasks=ne(zo),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=ne(Px),this.urlSerializer=ne(uf),this.location=ne(zi),this.urlHandlingStrategy=ne(Nx),this._events=new lt,this.errorHandler=this.options.errorHandler||bQ,this.navigated=!1,this.routeReuseStrategy=ne(gQ),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=ne(sg,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!ne(lg,{optional:!0}),this.eventsSubscription=new Wt,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let n=this.navigationTransitions.events.subscribe(r=>{try{let o=this.navigationTransitions.currentTransition,s=this.navigationTransitions.currentNavigation;if(o!==null&&s!==null){if(this.stateManager.handleRouterEvent(r,s),r instanceof go&&r.code!==Ii.Redirect&&r.code!==Ii.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof vo)this.navigated=!0;else if(r instanceof Ol){let a=r.navigationBehaviorOptions,u=this.urlHandlingStrategy.merge(r.url,o.currentRawUrl),c=ie({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||mQ(o.source)},a);this.scheduleNavigation(u,Yd,null,c,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}CQ(r)&&this._events.next(r)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Yd,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(n,"popstate",r)},0)})}navigateToSyncWithBrowser(n,r,o){let s={replaceUrl:!0},a=o?.navigationId?o:null;if(o){let c=ie({},o);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(s.state=c)}let u=this.parseUrl(n);this.scheduleNavigation(u,r,a,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(Rx),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,r={}){let{relativeTo:o,queryParams:s,fragment:a,queryParamsHandling:u,preserveFragment:c}=r,f=c?this.currentUrlTree.fragment:a,p=null;switch(u){case"merge":p=ie(ie({},this.currentUrlTree.queryParams),s);break;case"preserve":p=this.currentUrlTree.queryParams;break;default:p=s||null}p!==null&&(p=this.removeEmptyProps(p));let m;try{let v=o?o.snapshot:this.routerState.snapshot.root;m=tM(v)}catch{(typeof n[0]!="string"||n[0][0]!=="/")&&(n=[]),m=this.currentUrlTree.root}return nM(m,n,p,f??null)}navigateByUrl(n,r={skipLocationChange:!1}){let o=Xd(n)?n:this.parseUrl(n),s=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(s,Yd,null,r)}navigate(n,r={skipLocationChange:!1}){return xQ(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.urlSerializer.parse("/")}}isActive(n,r){let o;if(r===!0?o=ie({},yQ):r===!1?o=ie({},wQ):o=r,Xd(n))return Nk(this.currentUrlTree,n,o);let s=this.parseUrl(n);return Nk(this.currentUrlTree,s,o)}removeEmptyProps(n){return Object.entries(n).reduce((r,[o,s])=>(s!=null&&(r[o]=s),r),{})}scheduleNavigation(n,r,o,s,a){if(this.disposed)return Promise.resolve(!1);let u,c,f;a?(u=a.resolve,c=a.reject,f=a.promise):f=new Promise((m,v)=>{u=m,c=v});let p=this.pendingTasks.add();return yM(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(p))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:s,resolve:u,reject:c,promise:f,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),f.catch(m=>Promise.reject(m))}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function xQ(e){for(let t=0;t<e.length;t++)if(e[t]==null)throw new ke(4008,!1)}function CQ(e){return!(e instanceof nf)&&!(e instanceof Ol)}var ag=class{};var EQ=(()=>{let t=class t{constructor(n,r,o,s,a){this.router=n,this.injector=o,this.preloadingStrategy=s,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(mn(n=>n instanceof vo),no(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){let o=[];for(let s of r){s.providers&&!s._injector&&(s._injector=Np(s.providers,n,`Route: ${s.path}`));let a=s._injector??n,u=s._loadedInjector??a;(s.loadChildren&&!s._loadedRoutes&&s.canLoad===void 0||s.loadComponent&&!s._loadedComponent)&&o.push(this.preloadConfig(a,s)),(s.children||s._loadedRoutes)&&o.push(this.processRoutes(u,s.children??s._loadedRoutes))}return jt(o).pipe(Eo())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let o;r.loadChildren&&r.canLoad===void 0?o=this.loader.loadChildren(n,r):o=Ne(null);let s=o.pipe(pn(a=>a===null?Ne(void 0):(r._loadedRoutes=a.routes,r._loadedInjector=a.injector,this.processRoutes(a.injector??n,a.routes))));if(r.loadComponent&&!r._loadedComponent){let a=this.loader.loadComponent(r);return jt([s,a]).pipe(Eo())}else return s})}};t.\u0275fac=function(r){return new(r||t)(me(ft),me(jp),me(si),me(ag),me(Ox))},t.\u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})(),wM=new _e(""),IQ=(()=>{let t=class t{constructor(n,r,o,s,a={}){this.urlSerializer=n,this.transitions=r,this.viewportScroller=o,this.zone=s,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration||="disabled",a.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof Rl?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof vo?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof Qo&&n.code===Ym.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof Xm&&(n.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(n.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Xm(n,this.lastSource==="popstate"?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};t.\u0275fac=function(r){kp()},t.\u0275prov=be({token:t,factory:t.\u0275fac});let e=t;return e})();function SQ(e){return e.routerState.root}function pf(e,t){return{\u0275kind:e,\u0275providers:t}}function DQ(){let e=ne(fn);return t=>{let i=e.get(Vo);if(t!==i.components[0])return;let n=e.get(ft),r=e.get(xM);e.get(Fx)===1&&n.initialNavigation(),e.get(CM,null,ut.Optional)?.setUpPreloading(),e.get(wM,null,ut.Optional)?.init(),n.resetRootComponentType(i.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}var xM=new _e("",{factory:()=>new lt}),Fx=new _e("",{providedIn:"root",factory:()=>1});function TQ(){return pf(2,[{provide:Fx,useValue:0},{provide:Lp,multi:!0,deps:[fn],useFactory:t=>{let i=t.get(DT,Promise.resolve());return()=>i.then(()=>new Promise(n=>{let r=t.get(ft),o=t.get(xM);yM(r,()=>{n(!0)}),t.get(Px).afterPreactivation=()=>(n(!0),o.closed?Ne(void 0):o),r.initialNavigation()}))}}])}function $Q(){return pf(3,[{provide:Lp,multi:!0,useFactory:()=>{let t=ne(ft);return()=>{t.setUpLocationChangeListener()}}},{provide:Fx,useValue:2}])}var CM=new _e("");function kQ(e){return pf(0,[{provide:CM,useExisting:EQ},{provide:ag,useExisting:e}])}function MQ(){return pf(8,[Lk,{provide:lg,useExisting:Lk}])}function AQ(e){let t=[{provide:_M,useValue:fQ},{provide:vM,useValue:ie({skipNextTransition:!!e?.skipInitialTransition},e)}];return pf(9,t)}var Uk=new _e("ROUTER_FORROOT_GUARD"),RQ=[zi,{provide:uf,useClass:Al},ft,df,{provide:Yo,useFactory:SQ,deps:[ft]},Ox,[]],zx=(()=>{let t=class t{constructor(n){}static forRoot(n,r){return{ngModule:t,providers:[RQ,[],{provide:sg,multi:!0,useValue:n},{provide:Uk,useFactory:FQ,deps:[[ft,new gp,new n0]]},{provide:hf,useValue:r||{}},r?.useHash?NQ():PQ(),OQ(),r?.preloadingStrategy?kQ(r.preloadingStrategy).\u0275providers:[],r?.initialNavigation?zQ(r):[],r?.bindToComponentInputs?MQ().\u0275providers:[],r?.enableViewTransitions?AQ().\u0275providers:[],LQ()]}}static forChild(n){return{ngModule:t,providers:[{provide:sg,multi:!0,useValue:n}]}}};t.\u0275fac=function(r){return new(r||t)(me(Uk,8))},t.\u0275mod=Ge({type:t}),t.\u0275inj=qe({});let e=t;return e})();function OQ(){return{provide:wM,useFactory:()=>{let e=ne(MT),t=ne(Re),i=ne(hf),n=ne(Px),r=ne(uf);return i.scrollOffset&&e.setOffset(i.scrollOffset),new IQ(r,n,e,t,i)}}}function NQ(){return{provide:ea,useClass:$T}}function PQ(){return{provide:ea,useClass:Y0}}function FQ(e){return"guarded"}function zQ(e){return[e.initialNavigation==="disabled"?$Q().\u0275providers:[],e.initialNavigation==="enabledBlocking"?TQ().\u0275providers:[]]}var Hk=new _e("");function LQ(){return[{provide:Hk,useFactory:DQ},{provide:Bp,multi:!0,useExisting:Hk}]}function EM(){DeviceMotionEvent&&typeof DeviceMotionEvent.requestPermission=="function"&&DeviceMotionEvent.requestPermission()}var Rt=(()=>{class e{isAndroid;isIos;isSafari;isAuthenticated;isReconstructed;isFootLeft;isFootRight;isFirstFoot;isSheetA4;isSheetUS;isEnglishLanguage;feetAccesstoken;right_footMeasurements;right_objFootMeasurements;left_footMeasurements;left_objFootMeasurements;userAge;userGender;input1;input2;input3;input4;input5;arr_product_codes=[];arr_request_codes=[];request_code;urlWebReturn;rr_error_code;rr_recommend_code;rr_product_code;rr_size_right;rr_size_left;rr_size_common;isAvailableRight;isAvailableLeft;isOppositePending;flagRedirect2external;ml_model;constructor(){this.isAndroid=!1,this.isIos=!1,this.isSafari=!1,this.isAuthenticated=!1,this.isReconstructed=!1,this.isFootLeft=!1,this.isFootRight=!1,this.isFirstFoot=!1,this.isSheetA4=!1,this.isSheetUS=!1,this.isEnglishLanguage=!1,this.feetAccesstoken="",this.right_footMeasurements="",this.left_footMeasurements="",this.userAge="",this.userGender="",this.request_code="",this.urlWebReturn="",this.rr_error_code="",this.rr_recommend_code="",this.rr_product_code="",this.rr_size_right="",this.rr_size_left="",this.rr_size_common="",this.isAvailableRight=!1,this.isAvailableLeft=!1,this.isOppositePending=!1,this.flagRedirect2external=!1,this.ml_model=new Blob}webservice_client_id(){return""}webservice_client_secret(){return""}webservice_username(){return""}webservice_password(){return""}webservice_grant_type(){return""}webservice_license_code(){return""}webservice_device(){return""}webservice_base_url(){return""}set_the_inputs(i){if(localStorage.removeItem("feet_input5"),localStorage.removeItem("feet_input4"),localStorage.removeItem("feet_input3"),localStorage.removeItem("feet_input2"),localStorage.removeItem("feet_input1"),i.length>4){var n=i[4];this.input5=n.replace("input5=","");let c=new String(this.input5).toString();localStorage.setItem("feet_input5",c)}else this.input5=null;if(i.length>3){var r=i[3];this.input4=r.replace("input4=","");let c=new String(this.input4).toString();this.set_url_webReturn(c),localStorage.setItem("feet_input4",c)}else this.input4=null;if(i.length>2){var o=i[2];this.input3=o.replace("input3=","");let c=new String(this.input3).toString();this.set_product_code(c),localStorage.setItem("feet_input3",c)}else this.input3=null;if(i.length>1){var s=i[1];this.input2=s.replace("input2=","");let c=new String(this.input2).toString();localStorage.setItem("feet_input2",c)}else this.input2=null;if(i.length>0){var a=i[0];this.input1=a.replace("input1=","");let c=new String(this.input1).toString();localStorage.setItem("feet_input1",c)}else this.input1=null}the_input1(){return localStorage.getItem("feet_input1")}the_input2(){return localStorage.getItem("feet_input2")}the_input3(){return localStorage.getItem("feet_input3")}the_input4(){return localStorage.getItem("feet_input4")}the_input5(){return localStorage.getItem("feet_input5")}set_feet_accesstoken(i){this.feetAccesstoken=i}feet_accesstoken(){return this.feetAccesstoken}set_right_foot_measurements(i){this.right_footMeasurements=i}right_foot_measurements(){return this.right_footMeasurements}set_right_obj_footMeasurements(i){this.right_objFootMeasurements=i}right_obj_footMeasurements(){return this.right_objFootMeasurements}set_left_foot_measurements(i){this.left_footMeasurements=i}left_foot_measurements(){return this.left_footMeasurements}set_left_obj_footMeasurements(i){this.left_objFootMeasurements=i}left_obj_footMeasurements(){return this.left_objFootMeasurements}set_isEnglish(i){this.isEnglishLanguage=i,localStorage.removeItem("feet_is_english"),i?localStorage.setItem("feet_is_english","TRUE"):localStorage.setItem("feet_is_english","FALSE")}is_english(){return(localStorage.getItem("feet_is_english")||'""')==="TRUE"}set_isAndroid(i){this.isAndroid=i}set_isIos(i){this.isIos=i}set_isSafari(i){this.isSafari=i}is_android(){return this.isAndroid}is_ios(){return this.isIos}is_safari(){return this.isSafari}set_isAuthenticated(i){this.isAuthenticated=i}is_authenticated(){return this.isAuthenticated}set_isReconstructed(i){this.isReconstructed=i}is_reconstructed(){return this.isReconstructed}set_isFootLeft(i){this.isFootLeft=i}is_footLeft(){return this.isFootLeft}set_isFootRight(i){this.isFootRight=i}is_footRight(){return this.isFootRight}set_isFirstFoot(i){this.isFirstFoot=i}is_firstFoot(){return this.isFirstFoot}set_isSheetA4(i){this.isSheetA4=i}is_sheetA4(){return this.isSheetA4}set_isSheetUS(i){this.isSheetUS=i}is_sheetUS(){return this.isSheetUS}feet_sheetmodel(){return this.isSheetUS?"2":this.isSheetA4?"1":"0"}feet_foottype(){return this.isFootRight?"2":this.isFootLeft?"1":"0"}set_userAge(i){let n=new String(i);this.userAge=n.toString()}user_age(){return this.userAge}set_userGender(i){i==="1"?(console.log("ES HOMBRE"),this.userGender="male"):i==="2"&&(console.log("ES MUJER"),this.userGender="female")}user_gender(){return this.userGender}set_url_webReturn(i){i.startsWith("http")?this.urlWebReturn=i:this.urlWebReturn="https://"+i,localStorage.removeItem("feet_url_web_return"),localStorage.setItem("feet_url_web_return",this.urlWebReturn)}get_url_webReturn(){return localStorage.getItem("feet_url_web_return")||'""'}set_product_code(i){this.arr_product_codes=[],this.arr_product_codes.push(i)}the_arr_product_codes(){let i=localStorage.getItem("feet_input3")||'""';return this.set_product_code(i),this.arr_product_codes}set_request_code(i){localStorage.removeItem("feet_request_code"),localStorage.setItem("feet_request_code",i)}set_request_codeBis(i){this.request_code=i,this.arr_request_codes=[],this.arr_request_codes.push(i)}the_arr_request_codes(){let i=localStorage.getItem("feet_request_code")||'""';return this.set_request_codeBis(i),this.arr_request_codes}the_request_code(){let i=localStorage.getItem("feet_request_code")||'""';return this.set_request_codeBis(i),this.request_code}set_isAvailableRight(i){this.isAvailableRight=i}is_availableRight(){return this.isAvailableRight}set_isAvailableLeft(i){this.isAvailableLeft=i}is_availableLeft(){return this.isAvailableLeft}set_isOppositePending(i){this.isOppositePending=i}is_oppositePending(){return this.isOppositePending}set_flagRedirect2external(i){this.flagRedirect2external=i}get_flagRedirect2external(){return this.flagRedirect2external}text_app(){return" SCANFEET"}text_es(){return"ES"}text_en(){return"EN"}text_bilingueLanguage01(){return"SELECCIONA IDIOMA / SELECT LANGUAGE"}text_bilingueLanguage02(){return"ES = ESPA\xD1OL   ,   EN = ENGLISH"}text_autorizando(){return this.is_english()?"Authorizing...":"Autorizando..."}text_autorizadoOk(){return this.is_english()?"Authorized OK":"Autorizado OK"}text_autorizadoError(){return this.is_english()?"ERROR in authorization":"ERROR en autorizaci\xF3n"}text_left(){return this.is_english()?"Left":"Izquierdo"}text_right(){return this.is_english()?"Right":"Derecho"}text_threePhotos(){return this.is_english()?"You will make 3 photos of the foot.":"Vas a hacer 3 fotos del pie."}text_firstPhotoIs(){return this.is_english()?"First photo of the inner side.":"Primera foto de la parte interior."}text_secondPhotoIs(){return this.is_english()?"Second photo of the top side.":"Segunda foto de la parte superior."}text_thirdPhotoIs(){return this.is_english()?"Third photo of the outer side.":"Tercera foto de la parte exterior."}text_firstMobileInLandscape(){return this.is_english()?"And take photos with mobile in landscape":"Y toma fotos con m\xF3vil en apaisado"}text_selectFoot(){return this.is_english()?"Select right foot or left":"Selecciona pie derecho o izquierdo"}text_notAuthorizedToContinue(){return this.is_english()?"Not authorized to continue":"No est\xE1 autorizado para poder continuar"}text_sideInner(){return this.is_english()?" INNER":" INTERIOR"}text_sideTop(){return this.is_english()?" TOP":" SUPERIOR"}text_sideOuter(){return this.is_english()?" OUTER":" EXTERIOR"}text_repeat(){return this.is_english()?"Repeat":"Repetir"}text_confirm(){return this.is_english()?"Confirm":"Confirmar"}text_actionMeasurements(){return this.is_english()?"View measurements":"Ver medidas"}text_reconstructionWait(){return this.is_english()?"Waiting for reconstruction...":"Esperando reconstrucci\xF3n..."}text_reconstructionOk(){return this.is_english()?"Reconstruction":"Reconstrucci\xF3n"}text_reconstructionError(){return this.is_english()?"ERROR in reconstruction":"ERROR en reconstrucci\xF3n"}text_measuresNotAllowed(){return this.is_english()?"Unfinished reconstruction. Measurements are not available.":"La reconstrucci\xF3n no se complet\xF3. No hay medidas disponibles."}text_actionRecommend(){return this.is_english()?"Recommend ":"Recomendar "}text_actionOpposite(){return this.is_english()?"Opposite-Foot":"Pie-Opuesto"}text_reconsInfoPlus1(){return this.is_english()?"Not optimal reconstruction. Repeat the photos.":"La reconstrucci\xF3n no es \xF3ptima. Repite las fotos."}text_reconsInfoPlus2(){return this.is_english()?"Wrong reconstruction. Repeat the photos.":"La reconstrucci\xF3n es err\xF3nea. Repite las fotos."}text_reconsInfoPlus3(){return this.is_english()?"Not enough good images for reconstruction. Repeat the photos.":"No hay suficientes buenas im\xE1genes para la reconstrucci\xF3n. Repite las fotos."}text_reconsInfoPlus4(){return this.is_english()?"The dimensions of the paper sheet specified in the json file input do not match the paper sheet dimensions calculated. Repeat the photos.":"Las dimensiones de la hoja especificadas en el json no coinciden con las dimensiones de la hoja calculada. Repite las fotos."}text_reconsInfoMinus1(){return this.is_english()?"A general error has occurred in the reconstruction process. Repeat the photos.":"Un error general ha ocurrido en el proceso de reconstrucci\xF3n. Repite las fotos."}text_fourCornersOfSheet(){return this.is_english()?"THE 4 CORNERS OF THE SHEET MUST":"LAS 4 ESQUINAS DE LA HOJA DEBEN"}text_fourCornersOfSheetBis(){return this.is_english()?"BE VISIBLE IN EACH PHOTO.":"ESTAR VISIBLES EN CADA FOTO."}text_back(){return this.is_english()?"Back":"Atr\xE1s"}text_continue(){return this.is_english()?"Continue":"Continuar"}text_fill_age(){return this.is_english()?"Fill your age":"Introduce tu edad"}text_select_genre(){return this.is_english()?"Select your genre":"Selecciona tu g\xE9nero"}text_age(){return this.is_english()?"AGE":"EDAD"}text_male(){return this.is_english()?"Male":"Hombre"}text_female(){return this.is_english()?"Female":"Mujer"}text_ageFilledInvalid(){return this.is_english()?"The age entered is not correct":"La edad introducida no es correcta"}text_genderNotSelected(){return this.is_english()?"No gender was selected":"No ha seleccionado su g\xE9nero"}text_recommendWait(){return this.is_english()?"Waiting for size recommendation...":"Esperando recomendaci\xF3n de talla..."}text_recommendOk(){return this.is_english()?"Size recommendation":"Recomendaci\xF3n de talla"}text_recommendError(){return this.is_english()?"ERROR in size recommendation":"ERROR en recomendaci\xF3n de talla"}text_tallaDePie(){return this.is_english()?"SIZE FOOT":"TALLA DE PIE"}text_paraElProducto(){return this.is_english()?"FOR THE PRODUCT CODE":"PARA EL C\xD3DIGO DE PRODUCTO"}text_bilingueProducto(){return"C\xD3DIGO-DE-PRODUCTO / PRODUCT-CODE"}text_newScan(){return this.is_english()?"New-Scan":"Nuevo-Scan"}text_bilingueAnonymous(){return"MODO-INVITADO / ANONYMOUS-MODE"}text_bilingueRegistered(){return"MODO-REGISTRADO / REGISTERED-MODE"}text_recommendCode(){return this.is_english()?"Recommend code":"C\xF3digo de recomendaci\xF3n"}text_requestCode(){return this.is_english()?"Request code":"C\xF3digo de reconstrucci\xF3n"}text_codeusedFilledInvalid(){return this.is_english()?"The code entered is not in the correct format":"El c\xF3digo introducido no tiene un formato correcto"}text_availabler(){return this.is_english()?"Right foot...":"Pie derecho..."}text_availablerOk(){return this.is_english()?"Right foot available":"Pie derecho disponible"}text_availablerError(){return this.is_english()?"No right foot available":"No se dispone de pie derecho"}text_availablel(){return this.is_english()?"Left foot...":"Pie izquierdo..."}text_availablelOk(){return this.is_english()?"Left foot available":"Pie izquierdo disponible"}text_availablelError(){return this.is_english()?"No left foot available":"No se dispone de pie izquierdo"}text_accPreguntaDisponeCodigo(){return this.is_english()?"Did you get reconstruction code?":"\xBFDispone de c\xF3digo de reconstrucci\xF3n?"}text_accPlaceholderCode(){return this.is_english()?"CODE":"CODIGO"}text_accUtilizarCodigo(){return this.is_english()?"Use Code":"Utilizar C\xF3digo"}text_accPreguntaReutilizarUltima(){return this.is_english()?"Reuse last reconstruction?":"\xBFReutilizar la \xFAltima reconstrucci\xF3n?"}text_accReutilizarUltima(){return this.is_english()?"Reuse Last":"Reutilizar Ultima"}text_accPreguntaIniciarNueva(){return this.is_english()?"Start a new reconstruction?":"\xBFIniciar una nueva reconstrucci\xF3n?"}text_accIniciarNueva(){return this.is_english()?"Start New":"Iniciar Nueva"}dataFrom_jsonResponseRecommend(i){let n=JSON.parse(i),r=n.error_code,o=n.recommend_code,s=n.user_recommend,a=new String(r);this.rr_error_code=a.toString(),console.log("str_error_code = "+this.rr_error_code);let u=new String(o);this.rr_recommend_code=u.toString(),console.log("str_recommend_code = "+this.rr_recommend_code);var c=JSON.stringify(s),f=c.replace("[{","{"),p=f.replace("}]","}");let m=JSON.parse(p),v=new String(m.product_code);this.rr_product_code=v.toString(),console.log("str_product_code = "+this.rr_product_code);let b=JSON.stringify(m.recommendation);console.log("str_recommendation = "+b);let w=JSON.parse(b);if(this.isFirstFoot){if(this.isFootRight){let C=w.rightfoot_size,x=new String(C);this.rr_size_right=x.toString(),console.log("SIZE-RIGHT = "+this.rr_size_right)}else if(this.isFootLeft){let C=w.leftfoot_size,x=new String(C);this.rr_size_left=x.toString(),console.log("SIZE-LEFT = "+this.rr_size_left)}}else{let C=w.rightfoot_size,x=new String(C);this.rr_size_right=x.toString(),console.log("SIZE-RIGHT = "+this.rr_size_right);let y=w.leftfoot_size,I=new String(y);this.rr_size_left=I.toString(),console.log("SIZE-LEFT = "+this.rr_size_left)}}the_rr_errorCode(){return this.rr_error_code}the_rr_recommendCode(){return this.rr_recommend_code}the_rr_productCode(){return this.rr_product_code}the_rr_sizeRight(){return this.rr_size_right}the_rr_sizeLeft(){return this.rr_size_left}the_rr_sizeCommon(){return this.rr_size_common}set_ml_model(i){this.ml_model=i}get_ml_model(){return this.ml_model}static \u0275fac=function(n){return new(n||e)};static \u0275prov=be({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Lx=(()=>{class e{router;global_service;platform;activatedRoute;isPortrait=!0;mytext_app;mytext_es;mytext_en;mytext_bilingueProducto="";mytext_input="";mytext_bilingueMode="";mytext_selectLanguage01;mytext_selectLanguage02;blob;constructor(i,n,r,o){this.router=i,this.global_service=n,this.platform=r,this.activatedRoute=o,this.platform.ANDROID?this.global_service.set_isAndroid(!0):this.platform.IOS?this.global_service.set_isIos(!0):this.platform.SAFARI&&this.global_service.set_isSafari(!0),this.mytext_app=n.text_app(),this.mytext_es=n.text_es(),this.mytext_en=n.text_en(),this.mytext_selectLanguage01=n.text_bilingueLanguage01(),this.mytext_selectLanguage02=n.text_bilingueLanguage02()}ngOnInit(){console.log("SCREEN01");let i=this.activatedRoute.snapshot.params.input;if(i!==void 0){let r=new String(i).toString(),o=this.base64url_decode(r),u=new TextDecoder("utf-8",{fatal:!1}).decode(o).split("&");if(this.global_service.set_the_inputs(u),this.global_service.the_input3()!==null){this.mytext_bilingueProducto=this.global_service.text_bilingueProducto();let c=new String(this.global_service.the_input3());this.mytext_input=c.toString()}if(this.global_service.the_input5()!==null){let c=new String(this.global_service.the_input5());this.mytext_bilingueMode=c.toString()}else this.mytext_bilingueMode=this.global_service.text_bilingueAnonymous()}}ngOnDestroy(){}toScreen02es(){this.global_service.set_isEnglish(!1),this.load_ml_model()}toScreen02en(){this.blob===void 0?alert("NO hemos cargado ning\xFAn modelo"):this.blob.size<1e4?alert("NO se ha podido cargar ning\xFAn modelo"):(this.global_service.set_isEnglish(!0),this.router.navigateByUrl("/screen98ml"))}toNextScreen(){EM(),localStorage.getItem("feet_previous")===null?this.router.navigateByUrl("/screen01bis"):this.global_service.the_input5()!==null?this.router.navigateByUrl("/screen01bis"):this.router.navigateByUrl("/screen01acc")}base64url_decode(i){let n=i.length%4;return Uint8Array.from(atob(i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(n===0?0:4-n),"=")),r=>r.charCodeAt(0)).buffer}onOrientationChange(i){this.global_service.is_android()?screen.orientation.type.includes("portrait")?this.isPortrait=!0:screen.orientation.type.includes("landscape")?this.isPortrait=!1:this.isPortrait=!0:this.global_service.is_ios()?window.innerHeight>window.innerWidth?this.isPortrait=!1:this.isPortrait=!0:this.global_service.is_safari()?window.innerHeight>window.innerWidth?this.isPortrait=!1:this.isPortrait=!0:console.log("orientation-Changed")}load_ml_model(){return J(this,null,function*(){console.log("load_ml_model"),this.blob=yield this.downloadModel(),console.log(this.blob.size),this.blob.size<1e4?alert("ML-model NOT loaded"):(console.log(this.blob.type),this.global_service.set_ml_model(this.blob),alert("ML-model LOADED"))})}downloadModel(){return J(this,null,function*(){let i;try{return i=yield(yield fetch("/camerafeet1/assets/models/mnist.onnx")).blob(),i}catch(n){return console.log(n),i=new Blob,i}})}onFileSelected(i){let n=i.target.files[0];n?this.blob=new Blob([n],{type:"application/octet-stream"}):this.blob=new Blob,console.log(this.blob.size),this.blob.size<1e4?alert("ML-model NOT loaded"):(this.global_service.set_ml_model(this.blob),alert("ML-model LOADED"))}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt),V(Ht),V(Yo))};static \u0275cmp=Oe({type:e,selectors:[["app-screen01"]],hostBindings:function(n,r){n&1&&Ce("orientationchange",function(s){return r.onOrientationChange(s)},!1,t2)},decls:38,vars:4,consts:[[1,"custom-toolbar"],[1,"example-fill-remaining-space"],[1,"span-custom"],[1,"span-custom-codeprod"],[1,"custom-div-splash"],["src","assets/images/splash.png",1,"custom-img-splash"],["type","file",3,"change"],[2,"width","140px"],["mat-button","",2,"background-color","blue","color","white","width","120px",3,"click"]],template:function(n,r){n&1&&(N(0,"mat-toolbar",0)(1,"span"),K(2),O(),G(3,"span",1),O(),G(4,"br")(5,"br")(6,"br")(7,"br")(8,"br"),N(9,"span",2),K(10),O(),G(11,"br"),N(12,"span",3),K(13),O(),G(14,"br"),N(15,"span",2),K(16),O(),G(17,"br")(18,"br"),N(19,"div",4),G(20,"img",5),O(),N(21,"span",2),K(22,"\xA0"),O(),N(23,"span",2),K(24,"\xA0"),O(),N(25,"div",4)(26,"input",6),Ce("change",function(s){return r.onFileSelected(s)}),O()(),N(27,"span",2),K(28,"\xA0"),O(),N(29,"span",2),K(30,"\xA0"),O(),G(31,"br"),N(32,"div",4)(33,"table")(34,"tr")(35,"td",7)(36,"button",8),Ce("click",function(){return r.toScreen02en()}),K(37,"Testear-Modelo"),O()()()()()),n&2&&(U(2),dt("",r.mytext_app,"-47"),U(8),fe(r.mytext_bilingueProducto),U(3),fe(r.mytext_input),U(3),fe(r.mytext_bilingueMode))},dependencies:[Mt,Ft],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.span-custom[_ngcontent-%COMP%]{width:100%;font-weight:700;font-size:14px;text-align:center;display:block}.span-custom-codeprod[_ngcontent-%COMP%]{width:100%;font-weight:700;font-size:26px;text-align:center;display:block;background-color:#ecec}.custom-div-splash[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#fff}.custom-img-splash[_ngcontent-%COMP%]{width:240px;height:240px}"]})}return e})();function IM(){let e=localStorage.getItem("feet_url_target");window.location.href=e}var SM=(()=>{class e{router;global_service;data_used_code;mytext_app;mytext_codeusedFilledInvalid;mytext_accPreguntaDisponeCodigo;mytext_accPlaceholderCode;mytext_accUtilizarCodigo;mytext_accPreguntaReutilizarUltima;mytext_accReutilizarUltima;mytext_accPreguntaIniciarNueva;mytext_accIniciarNueva;constructor(i,n){this.router=i,this.global_service=n,this.mytext_app=n.text_app(),this.mytext_codeusedFilledInvalid=n.text_codeusedFilledInvalid(),this.mytext_accPreguntaDisponeCodigo=n.text_accPreguntaDisponeCodigo(),this.mytext_accPlaceholderCode=n.text_accPlaceholderCode(),this.mytext_accUtilizarCodigo=n.text_accUtilizarCodigo(),this.mytext_accPreguntaReutilizarUltima=n.text_accPreguntaReutilizarUltima(),this.mytext_accReutilizarUltima=n.text_accReutilizarUltima(),this.mytext_accPreguntaIniciarNueva=n.text_accPreguntaIniciarNueva(),this.mytext_accIniciarNueva=n.text_accIniciarNueva()}ngOnInit(){}ngAfterViewInit(){this.global_service.get_flagRedirect2external()===!0&&(this.global_service.set_flagRedirect2external(!1),IM())}ngOnDestroy(){}check_dataUsedCode(){if(this.data_used_code===void 0)return console.log("Es UNDEFINED"),!1;let n=new String(this.data_used_code).trim();return n.length===0?(console.log("Est\xE1 VACIO"),!1):n.length!==6?(console.log("Longitud incorrecta"),!1):(this.global_service.set_request_code(n.toUpperCase()),!0)}actionUtilizarCodigo(){if(!this.check_dataUsedCode()){alert(this.mytext_codeusedFilledInvalid);return}this.router.navigateByUrl("/screen21acc")}actionReutilizarUltima(){this.router.navigateByUrl("/screen31acc")}actionIniciarNueva(){this.router.navigateByUrl("/screen01bis")}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt))};static \u0275cmp=Oe({type:e,selectors:[["app-screen01acc"]],decls:38,vars:9,consts:[[1,"custom-toolbar"],[1,"example-fill-remaining-space"],[1,"custom-div-centered-bold"],[1,"custom-div-centered"],["appearance","fill"],["matInput","",2,"text-align","center",3,"ngModelChange","ngModel","placeholder"],["mat-button","",2,"background-color","blue","color","white","width","180px",3,"click"],["src","assets/images/lineh.png",1,"custom-img-line"]],template:function(n,r){n&1&&(N(0,"mat-toolbar",0)(1,"span"),K(2),O(),G(3,"span",1),O(),G(4,"br")(5,"br")(6,"br")(7,"br")(8,"br"),N(9,"div",2)(10,"mat-label"),K(11),O()(),G(12,"br"),N(13,"div",3)(14,"mat-form-field",4)(15,"input",5),fl("ngModelChange",function(s){return Id(r.data_used_code,s)||(r.data_used_code=s),s}),O()()(),G(16,"br"),N(17,"div",3)(18,"button",6),Ce("click",function(){return r.actionUtilizarCodigo()}),K(19),O()(),N(20,"div",3),G(21,"img",7),O(),N(22,"div",2)(23,"mat-label"),K(24),O()(),G(25,"br"),N(26,"div",3)(27,"button",6),Ce("click",function(){return r.actionReutilizarUltima()}),K(28),O()(),N(29,"div",3),G(30,"img",7),O(),N(31,"div",2)(32,"mat-label"),K(33),O()(),G(34,"br"),N(35,"div",3)(36,"button",6),Ce("click",function(){return r.actionIniciarNueva()}),K(37),O()()),n&2&&(U(2),fe(r.mytext_app),U(9),fe(r.mytext_accPreguntaDisponeCodigo),U(4),Ed("placeholder",r.mytext_accPlaceholderCode),dl("ngModel",r.data_used_code),U(4),fe(r.mytext_accUtilizarCodigo),U(5),fe(r.mytext_accPreguntaReutilizarUltima),U(4),fe(r.mytext_accReutilizarUltima),U(5),fe(r.mytext_accPreguntaIniciarNueva),U(4),fe(r.mytext_accIniciarNueva))},dependencies:[vl,cm,jd,Mt,Ft,Lm,Pr,jm],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.custom-div-centered[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#fff}.custom-div-centered-bold[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#fff;font-weight:700}.custom-img-line[_ngcontent-%COMP%]{width:480px;height:60px}"]})}return e})();var DM=(()=>{class e{router;global_service;mytext_app;mytext_confirm;mytext_fill_age;mytext_select_genre;mytext_age;mytext_male;mytext_female;mytext_ageFilledInvalid;mytext_genderNotSelected;data_age;selectedGender=0;constructor(i,n){this.router=i,this.global_service=n,this.mytext_app=n.text_app(),this.mytext_confirm=n.text_confirm(),this.mytext_fill_age=n.text_fill_age(),this.mytext_select_genre=n.text_select_genre(),this.mytext_age=n.text_age(),this.mytext_male=n.text_male(),this.mytext_female=n.text_female(),this.mytext_ageFilledInvalid=n.text_ageFilledInvalid(),this.mytext_genderNotSelected=n.text_genderNotSelected()}ngOnInit(){}ngOnDestroy(){}check_data_age(){return this.data_age===void 0?(console.log("Es UNDEFINED"),!1):typeof+this.data_age!="number"||isNaN(+this.data_age)?(console.log("NO es correcto"),!1):new String(this.data_age).length===0?(console.log("Est\xE1 VACIO"),!1):!0}toScreen02(){if(console.log(this.selectedGender),!this.check_data_age()){alert(this.mytext_ageFilledInvalid);return}if(this.global_service.set_userAge(this.data_age),this.selectedGender===0){alert(this.mytext_genderNotSelected);return}this.global_service.set_userGender(this.selectedGender),this.router.navigateByUrl("/screen02")}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt))};static \u0275cmp=Oe({type:e,selectors:[["app-screen01bis"]],decls:36,vars:9,consts:[[1,"custom-toolbar"],[1,"example-fill-remaining-space"],[1,"custom-div-centered-bold"],[1,"custom-div-centered"],["appearance","fill"],["matInput","",2,"text-align","center",3,"ngModelChange","ngModel","placeholder"],[3,"ngModelChange","ngModel"],["value","1"],["value","2"],["mat-button","",2,"background-color","blue","color","white","width","120px",3,"click"]],template:function(n,r){n&1&&(N(0,"mat-toolbar",0)(1,"span"),K(2),O(),G(3,"span",1),O(),G(4,"br")(5,"br")(6,"br")(7,"br")(8,"br")(9,"br"),N(10,"div",2)(11,"mat-label"),K(12),O()(),G(13,"br"),N(14,"div",3)(15,"mat-form-field",4)(16,"input",5),fl("ngModelChange",function(s){return Id(r.data_age,s)||(r.data_age=s),s}),O()()(),G(17,"br")(18,"br")(19,"br"),N(20,"div",2)(21,"mat-label"),K(22),O()(),G(23,"br"),N(24,"div",3)(25,"mat-radio-group",6),fl("ngModelChange",function(s){return Id(r.selectedGender,s)||(r.selectedGender=s),s}),N(26,"mat-radio-button",7),K(27),O(),N(28,"mat-radio-button",8),K(29),O()()(),G(30,"br")(31,"br")(32,"br"),N(33,"div",3)(34,"button",9),Ce("click",function(){return r.toScreen02()}),K(35),O()()),n&2&&(U(2),fe(r.mytext_app),U(10),fe(r.mytext_fill_age),U(4),Ed("placeholder",r.mytext_age),dl("ngModel",r.data_age),U(6),fe(r.mytext_select_genre),U(3),dl("ngModel",r.selectedGender),U(2),fe(r.mytext_male),U(2),fe(r.mytext_female),U(6),fe(r.mytext_confirm))},dependencies:[vl,cm,jd,Mt,Ft,Lm,Pr,jm,Xw,Um],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.custom-div-centered[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#fff}.custom-div-centered-bold[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#fff;font-weight:700}"]})}return e})();var TM=(()=>{class e{router;global_service;http;divAutorizando;divAutorizadoOk;divAutorizadoError;webservice_requestLoginJson;webservice_base_url;mytext_app;mytext_autorizando;mytext_autorizadoOk;mytext_autorizadoError;mytext_left;mytext_right;mytext_threePhotos;mytext_firstPhotoIs;mytext_secondPhotoIs;mytext_thirdPhotoIs;mytext_fourCornersOfSheet;mytext_fourCornersOfSheetBis;mytext_firstMobileInLandscape;mytext_selectFoot;mytext_notAuthorizedToContinue;constructor(i,n,r){this.router=i,this.global_service=n,this.http=r,this.mytext_app=n.text_app(),this.mytext_autorizando=n.text_autorizando(),this.mytext_autorizadoOk=n.text_autorizadoOk(),this.mytext_autorizadoError=n.text_autorizadoError(),this.mytext_left=n.text_left(),this.mytext_right=n.text_right(),this.mytext_threePhotos=n.text_threePhotos(),this.mytext_firstPhotoIs=n.text_firstPhotoIs(),this.mytext_secondPhotoIs=n.text_secondPhotoIs(),this.mytext_thirdPhotoIs=n.text_thirdPhotoIs(),this.mytext_fourCornersOfSheet=n.text_fourCornersOfSheet(),this.mytext_fourCornersOfSheetBis=n.text_fourCornersOfSheetBis(),this.mytext_firstMobileInLandscape=n.text_firstMobileInLandscape(),this.mytext_selectFoot=n.text_selectFoot(),this.mytext_notAuthorizedToContinue=n.text_notAuthorizedToContinue(),this.webservice_requestLoginJson={client_id:n.webservice_client_id(),client_secret:n.webservice_client_secret(),username:n.webservice_username(),password:n.webservice_password(),grant_type:n.webservice_grant_type(),pass_encript:"1"},this.webservice_base_url=n.webservice_base_url()}ngOnInit(){this.webservice_login()}webservice_login(){this.divAutorizando=document.getElementById("div_autorizando"),this.divAutorizadoOk=document.getElementById("div_autorizado_ok"),this.divAutorizadoError=document.getElementById("div_autorizado_error"),this.divAutorizando.removeAttribute("hidden"),this.divAutorizadoOk.setAttribute("hidden","hidden"),this.divAutorizadoError.setAttribute("hidden","hidden"),this.global_service.set_feet_accesstoken("none"),this.global_service.set_isAuthenticated(!1);let i={headers:new Kt({"Content-Type":"application/x-www-form-urlencoded"})},n=this.webservice_base_url+"/auth/authorize";this.http.post(n,this.webservice_requestLoginJson,i).subscribe({next:r=>this.postResponseOk(r),error:r=>this.postResponseErr(r.message),complete:()=>console.log("http_post done")})}postResponseOk(i){i!==null?(this.divAutorizando.setAttribute("hidden","hidden"),this.divAutorizadoOk.removeAttribute("hidden"),this.global_service.set_feet_accesstoken(i.access_token),this.global_service.set_isAuthenticated(!0),console.log("POST response OK")):(this.divAutorizando.setAttribute("hidden","hidden"),this.divAutorizadoError.removeAttribute("hidden"),console.log("respjson IS null"))}postResponseErr(i){this.divAutorizando.setAttribute("hidden","hidden"),this.divAutorizadoError.removeAttribute("hidden"),console.log("ERROR: "+i)}ngOnDestroy(){}actionScreen02left(){this.global_service.is_authenticated()?(this.global_service.set_isSheetUS(!1),this.global_service.set_isSheetA4(!0),this.global_service.set_isFootLeft(!0),this.global_service.set_isFootRight(!1),this.global_service.set_isFirstFoot(!0),this.router.navigateByUrl("/screen03")):alert(this.mytext_notAuthorizedToContinue)}actionScreen02right(){this.global_service.is_authenticated()?(this.global_service.set_isSheetUS(!1),this.global_service.set_isSheetA4(!0),this.global_service.set_isFootRight(!0),this.global_service.set_isFootLeft(!1),this.global_service.set_isFirstFoot(!0),this.router.navigateByUrl("/screen03")):alert(this.mytext_notAuthorizedToContinue)}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt),V(Ci))};static \u0275cmp=Oe({type:e,selectors:[["app-screen02"]],decls:45,vars:14,consts:[[1,"custom-toolbar"],[1,"example-fill-remaining-space"],["mat-button","","id","left_action",2,"color","white",3,"click"],["mat-button","","id","right_action",2,"color","white",3,"click"],["id","div_autorizando","hidden","hidden",1,"div_message"],["id","div_autorizado_ok",1,"div_message"],["id","div_autorizado_error",1,"div_message"],[1,"span-custom"],[1,"span-custom2"]],template:function(n,r){n&1&&(N(0,"mat-toolbar",0)(1,"span"),K(2),O(),G(3,"span",1),N(4,"button",2),Ce("click",function(){return r.actionScreen02left()}),K(5),O(),N(6,"button",3),Ce("click",function(){return r.actionScreen02right()}),K(7),O()(),G(8,"br")(9,"br")(10,"br")(11,"br"),N(12,"div",4),K(13),O(),N(14,"div",5),K(15),O(),N(16,"div",6),K(17),O(),G(18,"br")(19,"br"),N(20,"span",7),K(21),O(),G(22,"br"),N(23,"span",7),K(24),O(),G(25,"br"),N(26,"span",7),K(27),O(),G(28,"br"),N(29,"span",7),K(30),O(),G(31,"br"),N(32,"span",7),K(33),O(),G(34,"br"),N(35,"span",7),K(36),O(),G(37,"br")(38,"br")(39,"br"),N(40,"span",8),K(41),O(),G(42,"br"),N(43,"span",8),K(44),O()),n&2&&(U(2),fe(r.mytext_app),U(3),dt(" ",r.mytext_left," "),U(2),dt(" ",r.mytext_right," "),U(6),fe(r.mytext_autorizando),U(2),fe(r.mytext_autorizadoOk),U(2),fe(r.mytext_autorizadoError),U(4),fe(r.mytext_threePhotos),U(3),fe(r.mytext_firstPhotoIs),U(3),fe(r.mytext_secondPhotoIs),U(3),fe(r.mytext_thirdPhotoIs),U(3),fe(r.mytext_fourCornersOfSheet),U(3),fe(r.mytext_fourCornersOfSheetBis),U(5),fe(r.mytext_selectFoot),U(3),fe(r.mytext_firstMobileInLandscape))},dependencies:[Mt,Ft],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.div_message[_ngcontent-%COMP%]{width:100%;height:50px;font-size:17px;font-weight:700;text-align:center}.span-custom[_ngcontent-%COMP%]{width:100%;font-size:16px;text-align:center;display:block}.span-custom2[_ngcontent-%COMP%]{width:100%;font-weight:700;font-size:16px;text-align:center;display:block}"]})}return e})();function Bx(){window.addEventListener("devicemotion",kM),navigator.mediaDevices.enumerateDevices().then(HQ).then(WQ).catch(VQ)}function $M(){window.removeEventListener("devicemotion",kM),KQ()}function VQ(e){console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name)}function UQ(e){alert(e.message)}function HQ(e){let t;for(let i=0;i!==e.length;++i){let n=e[i],r=document.createElement("option");if(r.value=n.deviceId,r.text=n.label,n.kind==="videoinput")if(r.text.includes("0,")||r.text==="C\xE1mara trasera"||r.text==="Back Camera"){t=r.value;break}else console.log("Some other kind of source/device: ",n);else console.log("Some other kind of source/device: ",n)}return t}function WQ(e){window.stream&&window.stream.getTracks().forEach(n=>{n.stop()});let t=e,i;t?i={audio:!1,video:{deviceId:{exact:t}}}:i={audio:!1,video:{facingMode:"environment"}},navigator.mediaDevices.getUserMedia(i).then(qQ).catch(UQ)}function qQ(e){let t=document.getElementById("vid_pose1");window.stream=e,t.srcObject=e,t.addEventListener("loadedmetadata",()=>{t.play()});let i=e.getVideoTracks()[0];i.applyConstraints({torch:!0}).then(()=>console.log(i.getSettings().torch))}function kM(e){var t=e.accelerationIncludingGravity.x,i=e.accelerationIncludingGravity.y,n=e.accelerationIncludingGravity.z,r=0;t>9.8?r=9.8:t<-9.8?r=-9.8:r=t;var o=0;i>9.8?o=9.8:i<-9.8?o=-9.8:o=i;var s=0;n>9.8?s=9.8:n<-9.8?s=-9.8:s=n;let a={ac0_0:r,ac1_0:o,ac2_0:s};localStorage.removeItem("feet_pose1"),localStorage.setItem("feet_pose1",JSON.stringify(a)),GQ(r,o,s)}function GQ(e,t,i){let n=document.getElementById("btphoto_pose1a"),r=document.getElementById("btphoto_pose1b");var o=!1,s=Math.asin(e/-9.8)*180/Math.PI;s=Math.abs(s),s>=30&&s<=50&&(o=!0);var a=Math.asin(t/-9.8)*180/Math.PI;a=Math.abs(a),a>10&&(o=!1),o?(n.style.visibility="visible",r.style.visibility="visible"):(n.style.visibility="hidden",r.style.visibility="hidden")}function KQ(){let e=document.getElementById("vid_pose1"),t=document.getElementById("thecanvas1landscape"),i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i.drawImage(e,0,0,t.width,t.height);let n=t.toDataURL("image/jpeg",1),r=ZQ(n);localStorage.removeItem("feet_photo1"),localStorage.setItem("feet_photo1",r)}var ZQ=e=>e.replace("data:","").replace(/^.+,/,"");function YQ(e,t){if(e&1){let i=qt();N(0,"mat-toolbar",5)(1,"span"),K(2),O(),G(3,"span",6),N(4,"button",7),Ce("click",function(){Ct(i);let r=je();return Et(r.repeatInner())}),K(5),O(),N(6,"button",7),Ce("click",function(){Ct(i);let r=je();return Et(r.confirmInner())}),K(7),O()()}if(e&2){let i=je();U(2),fe(i.mytext_sideInner),U(3),dt(" ",i.mytext_repeat," "),U(2),dt(" ",i.mytext_confirm," ")}}function JQ(e,t){e&1&&G(0,"img",11)}function XQ(e,t){e&1&&G(0,"img",12)}function eY(e,t){if(e&1&&(N(0,"div",8),Ze(1,JQ,1,0,"img",9)(2,XQ,1,0,"img",10),O()),e&2){let i=je();U(),Be("ngIf",i.isRight),U(),Be("ngIf",i.isLeft)}}function tY(e,t){if(e&1){let i=qt();N(0,"div",13)(1,"button",14),Ce("click",function(){Ct(i);let r=je();return Et(r.clickPhoto1a())}),G(2,"img",15),O(),G(3,"video",16),N(4,"button",17),Ce("click",function(){Ct(i);let r=je();return Et(r.clickPhoto1b())}),G(5,"img",15),O()()}}var MM=(()=>{class e{router;global_service;isRight;isLeft;isTaking=!0;isTaken=!1;mytext_sideInner;mytext_repeat;mytext_confirm;constructor(i,n){this.router=i,this.global_service=n,this.mytext_sideInner=n.text_sideInner(),this.mytext_repeat=n.text_repeat(),this.mytext_confirm=n.text_confirm(),this.isRight=n.is_footRight(),this.isLeft=n.is_footLeft()}ngOnInit(){Bx()}ngOnDestroy(){}clickPhoto1a(){this.clickPhoto()}clickPhoto1b(){this.clickPhoto()}clickPhoto(){this.isTaking=!1,this.isTaken=!0,$M()}repeatInner(){this.isTaking=!0,this.isTaken=!1,Bx()}confirmInner(){this.router.navigateByUrl("/screen04")}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt))};static \u0275cmp=Oe({type:e,selectors:[["app-screen03"]],decls:9,vars:3,consts:[["class","custom-toolbar",4,"ngIf"],["class","custom-div-helperA",4,"ngIf"],["id","div_vid_pose1","class","custom-div-pose1",4,"ngIf"],["id","div_thecanvas1",1,"custom-div-canvas1"],["id","thecanvas1landscape","width","800","height","600",1,"custom-canvas1"],[1,"custom-toolbar"],[1,"example-fill-remaining-space"],["mat-button","",2,"color","white",3,"click"],[1,"custom-div-helperA"],["class","custom-img-helperA","src","assets/images/helper01.png",4,"ngIf"],["class","custom-img-helperA","src","assets/images/helper04.png",4,"ngIf"],["src","assets/images/helper01.png",1,"custom-img-helperA"],["src","assets/images/helper04.png",1,"custom-img-helperA"],["id","div_vid_pose1",1,"custom-div-pose1"],["id","btphoto_pose1a",1,"custom-img-btphoto1a",3,"click"],["src","assets/images/btphoto.png"],["id","vid_pose1","autoPlay","true","muted","true","playsInline","true"],["id","btphoto_pose1b",1,"custom-img-btphoto1b",3,"click"]],template:function(n,r){n&1&&(Ze(0,YQ,8,3,"mat-toolbar",0)(1,eY,3,2,"div",1)(2,tY,6,0,"div",2),G(3,"br")(4,"br")(5,"br")(6,"br"),N(7,"div",3),G(8,"canvas",4),O()),n&2&&(Be("ngIf",r.isTaken),U(),Be("ngIf",r.isTaking),U(),Be("ngIf",r.isTaking))},dependencies:[Zn,Mt,Ft],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-div-pose1[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:#000}.custom-img-btphoto1a[_ngcontent-%COMP%], .custom-img-btphoto1b[_ngcontent-%COMP%]{display:inline-block;width:10%;height:auto}video[_ngcontent-%COMP%]{display:inline-block;width:80%;height:auto}.custom-div-canvas1[_ngcontent-%COMP%]{display:flex;background-color:#fff;justify-content:center}.custom-div-helperA[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#000}@media only screen and (orientation: portrait){.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.custom-canvas1[_ngcontent-%COMP%]{width:360px;height:270px}.custom-img-helperA[_ngcontent-%COMP%]{width:360px;height:360px}}@media only screen and (orientation: landscape){.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.custom-img-helperA[_ngcontent-%COMP%]{width:0px;height:0px}}"]})}return e})();function jx(){window.addEventListener("devicemotion",RM),navigator.mediaDevices.enumerateDevices().then(rY).then(oY).catch(nY)}function AM(){window.removeEventListener("devicemotion",RM),lY()}function nY(e){console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name)}function iY(e){alert(e.message)}function rY(e){let t;for(let i=0;i!==e.length;++i){let n=e[i],r=document.createElement("option");if(r.value=n.deviceId,r.text=n.label,n.kind==="videoinput")if(r.text.includes("0,")||r.text==="C\xE1mara trasera"||r.text==="Back Camera"){t=r.value;break}else console.log("Some other kind of source/device: ",n);else console.log("Some other kind of source/device: ",n)}return t}function oY(e){window.stream&&window.stream.getTracks().forEach(n=>{n.stop()});let t=e,i;t?i={audio:!1,video:{deviceId:{exact:t}}}:i={audio:!1,video:{facingMode:"environment"}},navigator.mediaDevices.getUserMedia(i).then(sY).catch(iY)}function sY(e){let t=document.getElementById("vid_pose2");window.stream=e,t.srcObject=e,t.addEventListener("loadedmetadata",()=>{t.play()});let i=e.getVideoTracks()[0];i.applyConstraints({torch:!0}).then(()=>console.log(i.getSettings().torch))}function RM(e){var t=e.accelerationIncludingGravity.x,i=e.accelerationIncludingGravity.y,n=e.accelerationIncludingGravity.z,r=0;t>9.8?r=9.8:t<-9.8?r=-9.8:r=t;var o=0;i>9.8?o=9.8:i<-9.8?o=-9.8:o=i;var s=0;n>9.8?s=9.8:n<-9.8?s=-9.8:s=n;let a={ac0_1:r,ac1_1:o,ac2_1:s};localStorage.removeItem("feet_pose2"),localStorage.setItem("feet_pose2",JSON.stringify(a)),aY(r,o,s)}function aY(e,t,i){let n=document.getElementById("btphoto_pose2a"),r=document.getElementById("btphoto_pose2b");var o=!1,s=Math.asin(e/-9.8)*180/Math.PI;s=Math.abs(s),s>=10&&s<=20&&(o=!0);var a=Math.asin(t/-9.8)*180/Math.PI;a=Math.abs(a),a>10&&(o=!1),o?(n.style.visibility="visible",r.style.visibility="visible"):(n.style.visibility="hidden",r.style.visibility="hidden")}function lY(){let e=document.getElementById("vid_pose2"),t=document.getElementById("thecanvas2landscape"),i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i.drawImage(e,0,0,t.width,t.height);let n=t.toDataURL("image/jpeg",1),r=uY(n);localStorage.removeItem("feet_photo2"),localStorage.setItem("feet_photo2",r)}var uY=e=>e.replace("data:","").replace(/^.+,/,"");function dY(e,t){if(e&1){let i=qt();N(0,"mat-toolbar",5)(1,"span"),K(2),O(),G(3,"span",6),N(4,"button",7),Ce("click",function(){Ct(i);let r=je();return Et(r.repeatTop())}),K(5),O(),N(6,"button",7),Ce("click",function(){Ct(i);let r=je();return Et(r.confirmTop())}),K(7),O()()}if(e&2){let i=je();U(2),fe(i.mytext_sideTop),U(3),dt(" ",i.mytext_repeat," "),U(2),dt(" ",i.mytext_confirm," ")}}function fY(e,t){e&1&&G(0,"img",11)}function hY(e,t){e&1&&G(0,"img",12)}function pY(e,t){if(e&1&&(N(0,"div",8),Ze(1,fY,1,0,"img",9)(2,hY,1,0,"img",10),O()),e&2){let i=je();U(),Be("ngIf",i.isRight),U(),Be("ngIf",i.isLeft)}}function mY(e,t){if(e&1){let i=qt();N(0,"div",13)(1,"button",14),Ce("click",function(){Ct(i);let r=je();return Et(r.clickPhoto2a())}),G(2,"img",15),O(),G(3,"video",16),N(4,"button",17),Ce("click",function(){Ct(i);let r=je();return Et(r.clickPhoto2b())}),G(5,"img",15),O()()}}var OM=(()=>{class e{router;global_service;isRight;isLeft;isTaking=!0;isTaken=!1;mytext_sideTop;mytext_repeat;mytext_confirm;constructor(i,n){this.router=i,this.global_service=n,this.mytext_sideTop=n.text_sideTop(),this.mytext_repeat=n.text_repeat(),this.mytext_confirm=n.text_confirm(),this.isRight=n.is_footRight(),this.isLeft=n.is_footLeft()}ngOnInit(){jx()}ngOnDestroy(){}clickPhoto2a(){this.clickPhoto()}clickPhoto2b(){this.clickPhoto()}clickPhoto(){this.isTaking=!1,this.isTaken=!0,AM()}repeatTop(){this.isTaking=!0,this.isTaken=!1,jx()}confirmTop(){this.router.navigateByUrl("/screen05")}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt))};static \u0275cmp=Oe({type:e,selectors:[["app-screen04"]],decls:9,vars:3,consts:[["class","custom-toolbar",4,"ngIf"],["class","custom-div-helperB",4,"ngIf"],["id","div_vid_pose2","class","custom-div-pose2",4,"ngIf"],["id","div_thecanvas2",1,"custom-div-canvas2"],["id","thecanvas2landscape","width","800","height","600",1,"custom-canvas2"],[1,"custom-toolbar"],[1,"example-fill-remaining-space"],["mat-button","",2,"color","white",3,"click"],[1,"custom-div-helperB"],["class","custom-img-helperB","src","assets/images/helper02.png",4,"ngIf"],["class","custom-img-helperB","src","assets/images/helper05.png",4,"ngIf"],["src","assets/images/helper02.png",1,"custom-img-helperB"],["src","assets/images/helper05.png",1,"custom-img-helperB"],["id","div_vid_pose2",1,"custom-div-pose2"],["id","btphoto_pose2a",1,"custom-img-btphoto2a",3,"click"],["src","assets/images/btphoto.png"],["id","vid_pose2","autoPlay","true","muted","true","playsInline","true"],["id","btphoto_pose2b",1,"custom-img-btphoto2b",3,"click"]],template:function(n,r){n&1&&(Ze(0,dY,8,3,"mat-toolbar",0)(1,pY,3,2,"div",1)(2,mY,6,0,"div",2),G(3,"br")(4,"br")(5,"br")(6,"br"),N(7,"div",3),G(8,"canvas",4),O()),n&2&&(Be("ngIf",r.isTaken),U(),Be("ngIf",r.isTaking),U(),Be("ngIf",r.isTaking))},dependencies:[Zn,Mt,Ft],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-div-pose2[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:#000}.custom-img-btphoto2a[_ngcontent-%COMP%], .custom-img-btphoto2b[_ngcontent-%COMP%]{display:inline-block;width:10%;height:auto}video[_ngcontent-%COMP%]{display:inline-block;width:80%;height:auto}.custom-div-canvas2[_ngcontent-%COMP%]{display:flex;background-color:#fff;justify-content:center}.custom-div-helperB[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#000}@media only screen and (orientation: portrait){.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.custom-canvas2[_ngcontent-%COMP%]{width:360px;height:270px}.custom-img-helperB[_ngcontent-%COMP%]{width:360px;height:360px}}@media only screen and (orientation: landscape){.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.custom-img-helperB[_ngcontent-%COMP%]{width:0px;height:0px}}"]})}return e})();function Vx(){window.addEventListener("devicemotion",PM),navigator.mediaDevices.enumerateDevices().then(vY).then(bY).catch(gY)}function NM(){window.removeEventListener("devicemotion",PM),xY()}function gY(e){console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name)}function _Y(e){alert(e.message)}function vY(e){let t;for(let i=0;i!==e.length;++i){let n=e[i],r=document.createElement("option");if(r.value=n.deviceId,r.text=n.label,n.kind==="videoinput")if(r.text.includes("0,")||r.text==="C\xE1mara trasera"||r.text==="Back Camera"){t=r.value;break}else console.log("Some other kind of source/device: ",n);else console.log("Some other kind of source/device: ",n)}return t}function bY(e){window.stream&&window.stream.getTracks().forEach(n=>{n.stop()});let t=e,i;t?i={audio:!1,video:{deviceId:{exact:t}}}:i={audio:!1,video:{facingMode:"environment"}},navigator.mediaDevices.getUserMedia(i).then(yY).catch(_Y)}function yY(e){let t=document.getElementById("vid_pose3");window.stream=e,t.srcObject=e,t.addEventListener("loadedmetadata",()=>{t.play()});let i=e.getVideoTracks()[0];i.applyConstraints({torch:!0}).then(()=>console.log(i.getSettings().torch))}function PM(e){var t=e.accelerationIncludingGravity.x,i=e.accelerationIncludingGravity.y,n=e.accelerationIncludingGravity.z,r=0;t>9.8?r=9.8:t<-9.8?r=-9.8:r=t;var o=0;i>9.8?o=9.8:i<-9.8?o=-9.8:o=i;var s=0;n>9.8?s=9.8:n<-9.8?s=-9.8:s=n;let a={ac0_2:r,ac1_2:o,ac2_2:s};localStorage.removeItem("feet_pose3"),localStorage.setItem("feet_pose3",JSON.stringify(a)),wY(r,o,s)}function wY(e,t,i){let n=document.getElementById("btphoto_pose3a"),r=document.getElementById("btphoto_pose3b");var o=!1,s=Math.asin(e/-9.8)*180/Math.PI;s=Math.abs(s),s>=30&&s<=50&&(o=!0);var a=Math.asin(t/-9.8)*180/Math.PI;a=Math.abs(a),a>10&&(o=!1),o?(n.style.visibility="visible",r.style.visibility="visible"):(n.style.visibility="hidden",r.style.visibility="hidden")}function xY(){let e=document.getElementById("vid_pose3"),t=document.getElementById("thecanvas3landscape"),i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i.drawImage(e,0,0,t.width,t.height);let n=t.toDataURL("image/jpeg",1),r=CY(n);localStorage.removeItem("feet_photo3"),localStorage.setItem("feet_photo3",r)}function FM(){window.stream&&window.stream.getTracks().forEach(e=>{e.stop()})}var CY=e=>e.replace("data:","").replace(/^.+,/,"");function IY(e,t){if(e&1){let i=qt();N(0,"mat-toolbar",5)(1,"span"),K(2),O(),G(3,"span",6),N(4,"button",7),Ce("click",function(){Ct(i);let r=je();return Et(r.repeatOuter())}),K(5),O(),N(6,"button",7),Ce("click",function(){Ct(i);let r=je();return Et(r.confirmOuter())}),K(7),O()()}if(e&2){let i=je();U(2),fe(i.mytext_sideOuter),U(3),dt(" ",i.mytext_repeat," "),U(2),dt(" ",i.mytext_confirm," ")}}function SY(e,t){e&1&&G(0,"img",11)}function DY(e,t){e&1&&G(0,"img",12)}function TY(e,t){if(e&1&&(N(0,"div",8),Ze(1,SY,1,0,"img",9)(2,DY,1,0,"img",10),O()),e&2){let i=je();U(),Be("ngIf",i.isRight),U(),Be("ngIf",i.isLeft)}}function $Y(e,t){if(e&1){let i=qt();N(0,"div",13)(1,"button",14),Ce("click",function(){Ct(i);let r=je();return Et(r.clickPhoto3a())}),G(2,"img",15),O(),G(3,"video",16),N(4,"button",17),Ce("click",function(){Ct(i);let r=je();return Et(r.clickPhoto3b())}),G(5,"img",15),O()()}}var zM=(()=>{class e{router;global_service;isRight;isLeft;isTaking=!0;isTaken=!1;mytext_sideOuter;mytext_repeat;mytext_confirm;constructor(i,n){this.router=i,this.global_service=n,this.mytext_sideOuter=n.text_sideOuter(),this.mytext_repeat=n.text_repeat(),this.mytext_confirm=n.text_confirm(),this.isRight=n.is_footRight(),this.isLeft=n.is_footLeft()}ngOnInit(){Vx()}ngOnDestroy(){}clickPhoto3a(){this.clickPhoto()}clickPhoto3b(){this.clickPhoto()}clickPhoto(){this.isTaking=!1,this.isTaken=!0,NM()}repeatOuter(){this.isTaking=!0,this.isTaken=!1,Vx()}confirmOuter(){FM(),this.router.navigateByUrl("/screen06")}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt))};static \u0275cmp=Oe({type:e,selectors:[["app-screen05"]],decls:9,vars:3,consts:[["class","custom-toolbar",4,"ngIf"],["class","custom-div-helperC",4,"ngIf"],["id","div_vid_pose3","class","custom-div-pose3",4,"ngIf"],["id","div_thecanvas3",1,"custom-div-canvas3"],["id","thecanvas3landscape","width","800","height","600",1,"custom-canvas3"],[1,"custom-toolbar"],[1,"example-fill-remaining-space"],["mat-button","",2,"color","white",3,"click"],[1,"custom-div-helperC"],["class","custom-img-helperC","src","assets/images/helper03.png",4,"ngIf"],["class","custom-img-helperC","src","assets/images/helper06.png",4,"ngIf"],["src","assets/images/helper03.png",1,"custom-img-helperC"],["src","assets/images/helper06.png",1,"custom-img-helperC"],["id","div_vid_pose3",1,"custom-div-pose3"],["id","btphoto_pose3a",1,"custom-img-btphoto3a",3,"click"],["src","assets/images/btphoto.png"],["id","vid_pose3","autoPlay","true","muted","true","playsInline","true"],["id","btphoto_pose3b",1,"custom-img-btphoto3b",3,"click"]],template:function(n,r){n&1&&(Ze(0,IY,8,3,"mat-toolbar",0)(1,TY,3,2,"div",1)(2,$Y,6,0,"div",2),G(3,"br")(4,"br")(5,"br")(6,"br"),N(7,"div",3),G(8,"canvas",4),O()),n&2&&(Be("ngIf",r.isTaken),U(),Be("ngIf",r.isTaking),U(),Be("ngIf",r.isTaking))},dependencies:[Zn,Mt,Ft],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-div-pose3[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:#000}.custom-img-btphoto3a[_ngcontent-%COMP%], .custom-img-btphoto3b[_ngcontent-%COMP%]{display:inline-block;width:10%;height:auto}video[_ngcontent-%COMP%]{display:inline-block;width:80%;height:auto}.custom-div-canvas3[_ngcontent-%COMP%]{display:flex;background-color:#fff;justify-content:center}.custom-div-helperC[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#000}@media only screen and (orientation: portrait){.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.custom-canvas3[_ngcontent-%COMP%]{width:360px;height:270px}.custom-img-helperC[_ngcontent-%COMP%]{width:360px;height:360px}}@media only screen and (orientation: landscape){.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.custom-img-helperC[_ngcontent-%COMP%]{width:0px;height:0px}}"]})}return e})();function kY(e,t){if(e&1){let i=qt();N(0,"button",9),Ce("click",function(){Ct(i);let r=je();return Et(r.actionMeasurements())}),K(1),O()}if(e&2){let i=je();U(),dt(" ",i.mytext_actionMeasurements," ")}}function MY(e,t){if(e&1){let i=qt();N(0,"button",10),Ce("click",function(){Ct(i);let r=je();return Et(r.actionRepeat())}),K(1),O()}if(e&2){let i=je();U(),dt(" ",i.mytext_repeat," ")}}var LM=(()=>{class e{router;global_service;http;flagRepeat=!1;divReconstructionWait;divReconstructionOk;divReconstructionError;mytext_app;mytext_actionMeasurements;mytext_reconstructionWait;mytext_reconstructionOk;mytext_reconstructionError;mytext_measuresNotAllowed;mytext_repeat;mytext_reconsInfoPlus1;mytext_reconsInfoPlus2;mytext_reconsInfoPlus3;mytext_reconsInfoPlus4;mytext_reconsInfoMinus1;mydata_response_error_code;mydata_response_sheet_eval;mydata_response_info;mydata_response_quality;mydata_response_request_code;mydata_log_action;json_input1Content;json_objInput1;json_objInput2;json_objInput3;json_objInput4;json_objFiles;json_objParameters;json_objParametersBis;webservice_requestReconstructionJson;webservice_base_url;constructor(i,n,r){this.router=i,this.global_service=n,this.http=r,this.mytext_app=n.text_app(),this.mytext_actionMeasurements=n.text_actionMeasurements(),this.mytext_reconstructionWait=n.text_reconstructionWait(),this.mytext_reconstructionOk=n.text_reconstructionOk(),this.mytext_reconstructionError=n.text_reconstructionError(),this.mytext_measuresNotAllowed=n.text_measuresNotAllowed(),this.mytext_repeat=n.text_repeat(),this.mytext_reconsInfoPlus1=n.text_reconsInfoPlus1(),this.mytext_reconsInfoPlus2=n.text_reconsInfoPlus2(),this.mytext_reconsInfoPlus3=n.text_reconsInfoPlus3(),this.mytext_reconsInfoPlus4=n.text_reconsInfoPlus4(),this.mytext_reconsInfoMinus1=n.text_reconsInfoMinus1();let o=JSON.parse(localStorage.getItem("feet_pose1")||'""'),s=JSON.parse(localStorage.getItem("feet_pose2")||'""'),a=JSON.parse(localStorage.getItem("feet_pose3")||'""');this.json_input1Content={sheet_model:parseInt(n.feet_sheetmodel(),10),foot_type:parseInt(n.feet_foottype(),10),ac0_0:o.ac0_0,ac1_0:o.ac1_0,ac2_0:o.ac2_0,ac0_1:s.ac0_1,ac1_1:s.ac1_1,ac2_1:s.ac2_1,ac0_2:a.ac0_2,ac1_2:a.ac1_2,ac2_2:a.ac2_2};let u=JSON.stringify(this.json_input1Content),c=btoa(u);this.json_objInput1={extension:"json",content_file:c},this.json_objInput2={extension:"jpg",content_file:localStorage.getItem("feet_photo1")||'""'},this.json_objInput3={extension:"jpg",content_file:localStorage.getItem("feet_photo2")||'""'},this.json_objInput4={extension:"jpg",content_file:localStorage.getItem("feet_photo3")||'""'},this.json_objFiles={input1:this.json_objInput1,input2:this.json_objInput2,input3:this.json_objInput3,input4:this.json_objInput4},this.json_objParameters={age:parseInt(this.global_service.user_age(),10),gender:this.global_service.user_gender()},this.json_objParametersBis={age:parseInt(this.global_service.user_age(),10),gender:this.global_service.user_gender(),request_code:this.global_service.the_request_code()},this.global_service.is_firstFoot()?this.webservice_requestReconstructionJson={files:this.json_objFiles,parameters:this.json_objParameters}:this.webservice_requestReconstructionJson={files:this.json_objFiles,parameters:this.json_objParametersBis},this.webservice_base_url=n.webservice_base_url()}ngOnInit(){this.webservice_reconstruction()}ngOnDestroy(){}actionMeasurements(){this.global_service.is_reconstructed()?this.router.navigateByUrl("/screen07"):alert(this.mytext_measuresNotAllowed)}actionRepeat(){this.router.navigateByUrl("/screen03")}webservice_reconstruction(){this.divReconstructionWait=document.getElementById("div_reconstruction_wait"),this.divReconstructionOk=document.getElementById("div_reconstruction_ok"),this.divReconstructionError=document.getElementById("div_reconstruction_error"),this.divReconstructionWait.removeAttribute("hidden"),this.divReconstructionOk.setAttribute("hidden","hidden"),this.divReconstructionError.setAttribute("hidden","hidden");let i="Bearer "+this.global_service.feet_accesstoken(),n={headers:new Kt({"Content-Type":"application/json",Authorization:i})},r=this.webservice_base_url+"/models/reconstruction";this.global_service.set_isReconstructed(!1),this.global_service.is_firstFoot()?(this.global_service.set_right_foot_measurements("{}"),this.global_service.set_right_obj_footMeasurements(null),this.global_service.set_left_foot_measurements("{}"),this.global_service.set_left_obj_footMeasurements(null)):this.global_service.is_footRight()?(this.global_service.set_right_foot_measurements("{}"),this.global_service.set_right_obj_footMeasurements(null)):(this.global_service.set_left_foot_measurements("{}"),this.global_service.set_left_obj_footMeasurements(null)),this.mydata_response_error_code="",this.mydata_response_sheet_eval="",this.mydata_response_info="",this.mydata_response_quality="",this.mydata_response_request_code="",this.mydata_log_action="",this.http.post(r,this.webservice_requestReconstructionJson,n).subscribe({next:o=>this.postResponseOk(o),error:o=>this.postResponseErr(o.message),complete:()=>console.log("http_post done")})}postResponseOk(i){if(i!==null){this.divReconstructionWait.setAttribute("hidden","hidden"),this.divReconstructionOk.removeAttribute("hidden"),console.log("POST response OK");let u=JSON.stringify(i.error_code);this.mydata_response_error_code=u,this.mydata_response_sheet_eval="Sheet-Eval: "+i.sheet_eval,this.mydata_response_info="Info: "+i.info,this.mydata_response_quality="Quality: "+i.quality,this.mydata_response_request_code="Request-Code: "+i.request_code;let f=new String(i.request_code).toString();this.global_service.set_request_code(f);let p=Number(i.info);if(p.valueOf()===0||p.valueOf()===1)if(u.includes('"1D_MES":0,"3D_MODEL":0')){this.global_service.set_isReconstructed(!0);var n=JSON.stringify(i.parameters),r=n.replace("1D_MES","the1D_MES");let m=JSON.parse(r),v=JSON.stringify(m.the1D_MES);this.global_service.is_footRight()?(this.global_service.set_right_foot_measurements(v),this.global_service.set_right_obj_footMeasurements(m.the1D_MES)):(this.global_service.set_left_foot_measurements(v),this.global_service.set_left_obj_footMeasurements(m.the1D_MES));let b=new Date;var o="",s="";this.global_service.is_english()?(o=b.toLocaleDateString("en-US"),s=b.toLocaleTimeString("en-US")):(o=b.toLocaleDateString("es-ES"),s=b.toLocaleTimeString("es-ES"));var a=o+" "+s+" --> "+f;localStorage.removeItem("feet_previous"),localStorage.setItem("feet_previous",a)}else this.flagRepeat=!0;else p.valueOf()===2?(this.flagRepeat=!0,alert(this.mytext_reconsInfoPlus2)):p.valueOf()===3?(this.flagRepeat=!0,alert(this.mytext_reconsInfoPlus3)):p.valueOf()===4?(this.flagRepeat=!0,alert(this.mytext_reconsInfoPlus4)):p.valueOf()===-1?(this.flagRepeat=!0,alert(this.mytext_reconsInfoMinus1)):this.flagRepeat=!0}else this.divReconstructionWait.setAttribute("hidden","hidden"),this.divReconstructionError.removeAttribute("hidden"),console.log("respjson IS null"),alert("respjson IS null")}postResponseErr(i){this.divReconstructionWait.setAttribute("hidden","hidden"),this.divReconstructionError.removeAttribute("hidden"),console.log("ERROR: "+i),alert(i)}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt),V(Ci))};static \u0275cmp=Oe({type:e,selectors:[["app-screen06"]],decls:37,vars:12,consts:[[1,"custom-toolbar"],[1,"example-fill-remaining-space"],["mat-button","","style","color:white","id","action_measurements",3,"click",4,"ngIf"],["mat-button","","style","color:white","id","action_repeat",3,"click",4,"ngIf"],["id","div_reconstruction_wait","hidden","hidden",1,"div_message"],["id","div_reconstruction_ok",1,"div_message"],["id","div_reconstruction_error",1,"div_message"],[1,"span-custom"],[1,"span-custom2"],["mat-button","","id","action_measurements",2,"color","white",3,"click"],["mat-button","","id","action_repeat",2,"color","white",3,"click"]],template:function(n,r){n&1&&(N(0,"mat-toolbar",0)(1,"span"),K(2),O(),G(3,"span",1),Ze(4,kY,2,1,"button",2)(5,MY,2,1,"button",3),O(),G(6,"br")(7,"br")(8,"br")(9,"br"),N(10,"div",4),K(11),O(),N(12,"div",5),K(13),O(),N(14,"div",6),K(15),O(),G(16,"br")(17,"br"),N(18,"span",7),K(19),O(),G(20,"br"),N(21,"span",7),K(22),O(),G(23,"br"),N(24,"span",7),K(25),O(),G(26,"br"),N(27,"span",7),K(28),O(),G(29,"br")(30,"br")(31,"br"),N(32,"span",8),K(33),O(),G(34,"br"),N(35,"span",7),K(36),O()),n&2&&(U(2),fe(r.mytext_app),U(2),Be("ngIf",!r.flagRepeat),U(),Be("ngIf",r.flagRepeat),U(6),fe(r.mytext_reconstructionWait),U(2),fe(r.mytext_reconstructionOk),U(2),fe(r.mytext_reconstructionError),U(4),fe(r.mydata_response_error_code),U(3),fe(r.mydata_response_sheet_eval),U(3),fe(r.mydata_response_info),U(3),fe(r.mydata_response_quality),U(5),fe(r.mydata_response_request_code),U(3),fe(r.mydata_log_action))},dependencies:[Zn,Mt,Ft],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.div_message[_ngcontent-%COMP%]{width:100%;height:50px;font-size:17px;font-weight:700;text-align:center}.span-custom[_ngcontent-%COMP%]{width:100%;font-size:16px;text-align:center;display:block}.span-custom2[_ngcontent-%COMP%]{width:100%;font-weight:700;font-size:22px;text-align:center;display:block}"]})}return e})();function AY(e,t){if(e&1){let i=qt();N(0,"button",12),Ce("click",function(){Ct(i);let r=je();return Et(r.actionOpposite())}),K(1),O()}if(e&2){let i=je();U(),dt(" ",i.mytext_actionOpposite," ")}}function RY(e,t){e&1&&(N(0,"th",13),K(1," ID "),O())}function OY(e,t){if(e&1&&(N(0,"td",14),K(1),O()),e&2){let i=t.$implicit;U(),dt(" ",i.id," ")}}function NY(e,t){e&1&&(N(0,"th",13),K(1," VAL "),O())}function PY(e,t){if(e&1&&(N(0,"td",14),K(1),O()),e&2){let i=t.$implicit;U(),dt(" ",i.val," ")}}function FY(e,t){e&1&&G(0,"tr",15)}function zY(e,t){e&1&&G(0,"tr",16)}var BM=(()=>{class e{router;global_service;flagFirstFoot=!1;mytext_app;mytext_actionOpposite;mytext_actionRecommend;columnas=["meas-id","meas-val"];measures=[];tabla1;constructor(i,n){this.router=i,this.global_service=n,this.mytext_app=n.text_app(),this.mytext_actionOpposite=n.text_actionOpposite(),this.mytext_actionRecommend=n.text_actionRecommend(),this.flagFirstFoot=n.is_firstFoot();var r="";n.is_footRight()?r=n.right_foot_measurements():r=n.left_foot_measurements();var o=r.replace("{",""),s=o.replace("}","");let a=s.split(","),u=a.length;for(let c=0;c<u;c++){let p=a[c].split(":"),m=p[0],v=p[1],w=parseFloat(v).toFixed(2);if(c===0){let C={id:m,val:w+" mm2"};this.measures.push(C)}else{let C={id:m,val:w+" mm"};this.measures.push(C)}}}ngOnInit(){console.log(this.measures)}ngAfterViewInit(){this.tabla1.renderRows()}ngOnDestroy(){}actionRecommend(){this.router.navigateByUrl("/screen08")}actionOpposite(){this.global_service.set_isFirstFoot(!1);var i=this.global_service.is_footRight();this.global_service.set_isFootRight(!i);var n=this.global_service.is_footLeft();this.global_service.set_isFootLeft(!n),this.router.navigateByUrl("/screen03")}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt))};static \u0275cmp=Oe({type:e,selectors:[["app-screen07"]],viewQuery:function(n,r){if(n&1&&Tn(Zo,5),n&2){let o;vt(o=bt())&&(r.tabla1=o.first)}},decls:21,vars:6,consts:[["tabla1",""],[1,"custom-toolbar"],[1,"example-fill-remaining-space"],["mat-button","","style","color:white","id","action_opposite",3,"click",4,"ngIf"],["mat-button","","id","action_recommend",2,"color","white",3,"click"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","meas-id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","meas-val"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-button","","id","action_opposite",2,"color","white",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(n,r){if(n&1){let o=qt();N(0,"mat-toolbar",1)(1,"span"),K(2),O(),G(3,"span",2),Ze(4,AY,2,1,"button",3),N(5,"button",4),Ce("click",function(){return Ct(o),Et(r.actionRecommend())}),K(6),O()(),G(7,"br")(8,"br")(9,"br")(10,"br"),N(11,"table",5,0),Mr(13,6),Ze(14,RY,2,0,"th",7)(15,OY,2,1,"td",8),Ar(),Mr(16,9),Ze(17,NY,2,0,"th",7)(18,PY,2,1,"td",8),Ar(),Ze(19,FY,1,0,"tr",10)(20,zY,1,0,"tr",11),O()}n&2&&(U(2),fe(r.mytext_app),U(2),Be("ngIf",r.flagFirstFoot),U(2),dt(" ",r.mytext_actionRecommend," "),U(5),Be("dataSource",r.measures),U(8),Be("matHeaderRowDef",r.columnas),U(),Be("matRowDefColumns",r.columnas))},dependencies:[Zn,Mt,Ft,Zo,km,Om,Mm,$m,Nm,Am,Rm,Pm,Fm],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}table[_ngcontent-%COMP%]{width:80%;margin-left:20rem auto;margin-right:20rem auto;background-color:#d3d3d3}.mat-column-meas-id[_ngcontent-%COMP%]{width:30%;text-align:left;font-size:15px;font-weight:700}.mat-column-meas-val[_ngcontent-%COMP%]{width:50%;text-align:left;font-size:17px}"]})}return e})();var jM=(()=>{class e{router;global_service;http;flagRecomOk=!1;divRecommendWait;divRecommendOk;divRecommendError;mytext_app;mytext_newScan;mytext_tallaDePie;mytext_paraElProducto;mytext_recommendWait;mytext_recommendOk;mytext_recommendError;text_log_recommend="";text_log2_recommend="";mytext_requestCode;mytext_recommendCode;mytext_left;mytext_right;mydata_error_code;mydata_request_code;mydata_recommend_code;mydata_user_recommend;json_objParameters;json_objParametersBis;str_theInput5="";webservice_requestRecommendSizeJson;webservice_base_url;constructor(i,n,r){if(this.router=i,this.global_service=n,this.http=r,this.mytext_app=n.text_app(),this.mytext_newScan=n.text_newScan(),this.mytext_tallaDePie=n.text_tallaDePie(),this.mytext_paraElProducto=n.text_paraElProducto(),this.mytext_recommendWait=n.text_recommendWait(),this.mytext_recommendOk=n.text_recommendOk(),this.mytext_recommendError=n.text_recommendError(),this.mytext_requestCode=n.text_requestCode(),this.mytext_recommendCode=n.text_recommendCode(),this.mytext_left=n.text_left(),this.mytext_right=n.text_right(),n.the_input5()!==null){let o=new String(n.the_input5());this.str_theInput5=o.toString()}this.json_objParametersBis={product_code:n.the_arr_product_codes(),request_code:n.the_arr_request_codes(),include_user_profile:"FALSE",recommend_by_foot:"TRUE"},this.json_objParameters={product_code:n.the_arr_product_codes(),request_code:n.the_arr_request_codes(),include_user_profile:"FALSE",recommend_by_foot:"TRUE"},n.the_input5()!==null?this.webservice_requestRecommendSizeJson={parameters:this.json_objParametersBis}:this.webservice_requestRecommendSizeJson={parameters:this.json_objParameters},this.webservice_base_url=n.webservice_base_url()}ngOnInit(){this.webservice_recommendsize()}ngOnDestroy(){}webservice_recommendsize(){this.divRecommendWait=document.getElementById("div_recommend_wait"),this.divRecommendOk=document.getElementById("div_recommend_ok"),this.divRecommendError=document.getElementById("div_recommend_error"),this.divRecommendWait.removeAttribute("hidden"),this.divRecommendOk.setAttribute("hidden","hidden"),this.divRecommendError.setAttribute("hidden","hidden");let i="Bearer "+this.global_service.feet_accesstoken(),n={headers:new Kt({"Content-Type":"application/json",Authorization:i})},r=this.webservice_base_url+"/models/recommendsize";this.text_log_recommend="",this.http.post(r,this.webservice_requestRecommendSizeJson,n).subscribe({next:o=>this.postResponseOk(o),error:o=>this.postResponseErr(o.message),complete:()=>console.log("http_post done")})}postResponseOk(i){if(i!==null){this.divRecommendWait.setAttribute("hidden","hidden"),this.divRecommendOk.removeAttribute("hidden");let n=JSON.stringify(i);this.global_service.dataFrom_jsonResponseRecommend(n);let r=this.global_service.the_rr_errorCode();if(parseInt(r,10)!==0)this.flagRecomOk=!1,this.mydata_error_code="ERROR: "+r,this.mydata_request_code=this.mytext_requestCode+": "+this.global_service.the_request_code(),this.mydata_recommend_code="",this.mydata_user_recommend="",this.text_log_recommend="",this.text_log2_recommend="";else if(this.flagRecomOk=!0,this.mydata_error_code="",this.mydata_request_code=this.mytext_requestCode+": "+this.global_service.the_request_code(),this.mydata_recommend_code=this.mytext_recommendCode+": "+this.global_service.the_rr_recommendCode(),this.mydata_user_recommend="",this.text_log2_recommend=this.global_service.the_rr_productCode(),this.global_service.is_firstFoot())this.global_service.is_footRight()?this.text_log_recommend=this.mytext_right+": "+this.global_service.the_rr_sizeRight():this.global_service.is_footLeft()&&(this.text_log_recommend=this.mytext_left+": "+this.global_service.the_rr_sizeLeft());else{let s=this.mytext_right+": "+this.global_service.the_rr_sizeRight(),a=this.mytext_left+": "+this.global_service.the_rr_sizeLeft();this.text_log_recommend=s+" , "+a}}else this.flagRecomOk=!1,this.divRecommendWait.setAttribute("hidden","hidden"),this.divRecommendError.removeAttribute("hidden"),this.mydata_error_code="respjson IS null",this.mydata_request_code=this.mytext_requestCode+": "+this.global_service.the_request_code(),this.mydata_recommend_code="",this.mydata_user_recommend="",this.text_log_recommend="",this.text_log2_recommend="",alert("respjson IS null")}postResponseErr(i){this.flagRecomOk=!1,this.divRecommendWait.setAttribute("hidden","hidden"),this.divRecommendError.removeAttribute("hidden"),this.mydata_error_code=i,this.mydata_request_code=this.mytext_requestCode+": "+this.global_service.the_request_code(),this.mydata_recommend_code="",this.mydata_user_recommend="",this.text_log_recommend="",this.text_log2_recommend="",alert(i)}toNewScan(){this.global_service.set_flagRedirect2external(!1),this.router.navigateByUrl("/screen01acc")}toWeb(){var i=this.global_service.get_url_webReturn();i=i+"?output1="+this.global_service.the_request_code(),i=i+"&output2="+this.global_service.the_rr_recommendCode(),i=i+"&output3="+encodeURIComponent(this.text_log_recommend),i=i+"&output4="+this.global_service.the_rr_productCode(),this.global_service.the_input5()!==null&&(i=i+"&output5="+encodeURIComponent(this.global_service.webservice_username())),localStorage.removeItem("feet_url_target"),localStorage.setItem("feet_url_target",i),this.global_service.set_flagRedirect2external(!0),this.router.navigateByUrl("/screen01acc")}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt),V(Ci))};static \u0275cmp=Oe({type:e,selectors:[["app-screen08"]],decls:42,vars:12,consts:[[1,"custom-toolbar"],[1,"example-fill-remaining-space"],["mat-button","",2,"color","white",3,"click"],["id","div_recommend_wait","hidden","hidden",1,"div_message"],["id","div_recommend_ok",1,"div_message"],["id","div_recommend_error",1,"div_message"],[1,"span-custom"],[1,"span-custom-log"],[1,"span-custom2"]],template:function(n,r){n&1&&(N(0,"mat-toolbar",0)(1,"span"),K(2),O(),G(3,"span",1),N(4,"button",2),Ce("click",function(){return r.toNewScan()}),K(5),O(),N(6,"button",2),Ce("click",function(){return r.toWeb()}),K(7,"Web"),O()(),G(8,"br")(9,"br")(10,"br")(11,"br"),N(12,"div",3),K(13),O(),N(14,"div",4),K(15),O(),N(16,"div",5),K(17),O(),G(18,"br")(19,"br"),N(20,"span",6),K(21),O(),G(22,"br"),N(23,"span",6),K(24),O(),G(25,"br"),N(26,"span",6),K(27),O(),G(28,"br")(29,"br")(30,"br"),N(31,"span",6),K(32),O(),G(33,"br"),N(34,"span",7),K(35),O(),G(36,"br"),N(37,"span",6),K(38),O(),G(39,"br"),N(40,"span",8),K(41),O()),n&2&&(U(2),fe(r.mytext_app),U(3),fe(r.mytext_newScan),U(8),fe(r.mytext_recommendWait),U(2),fe(r.mytext_recommendOk),U(2),fe(r.mytext_recommendError),U(4),fe(r.mydata_error_code),U(3),fe(r.mydata_request_code),U(3),fe(r.mydata_recommend_code),U(5),fe(r.mytext_tallaDePie),U(3),fe(r.text_log_recommend),U(3),fe(r.mytext_paraElProducto),U(3),fe(r.text_log2_recommend))},dependencies:[Mt,Ft],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.div_message[_ngcontent-%COMP%]{width:100%;height:50px;font-size:17px;font-weight:700;text-align:center}.span-custom[_ngcontent-%COMP%]{width:100%;font-size:16px;text-align:center;display:block}.span-custom2[_ngcontent-%COMP%]{width:100%;font-weight:700;font-size:16px;text-align:center;display:block}.span-custom-log[_ngcontent-%COMP%]{width:100%;font-weight:700;font-size:26px;text-align:center;display:block;background-color:#ecec}"]})}return e})();function LY(e,t){if(e&1){let i=qt();N(0,"button",16),Ce("click",function(){Ct(i);let r=je();return Et(r.actionContinue())}),K(1),O()}if(e&2){let i=je();U(),dt(" ",i.mytext_continue," ")}}var VM=(()=>{class e{router;global_service;http;location;divAutorizando;divAutorizadoOk;divAutorizadoError;divAvailabler;divAvailablerOk;divAvailablerError;divAvailablel;divAvailablelOk;divAvailablelError;webservice_requestLoginJson;webservice_requestRightJson;webservice_requestLeftJson;webservice_base_url;mytext_app;mytext_autorizando;mytext_autorizadoOk;mytext_autorizadoError;mytext_availabler;mytext_availablerOk;mytext_availablerError;mytext_availablel;mytext_availablelOk;mytext_availablelError;mytext_back;mytext_continue;mytext_dataCode;flagSomeAvailable=!1;constructor(i,n,r,o){this.router=i,this.global_service=n,this.http=r,this.location=o,this.mytext_app=n.text_app(),this.mytext_autorizando=n.text_autorizando(),this.mytext_autorizadoOk=n.text_autorizadoOk(),this.mytext_autorizadoError=n.text_autorizadoError(),this.mytext_availabler=n.text_availabler(),this.mytext_availablerOk=n.text_availablerOk(),this.mytext_availablerError=n.text_availablerError(),this.mytext_availablel=n.text_availablel(),this.mytext_availablelOk=n.text_availablelOk(),this.mytext_availablelError=n.text_availablelError(),this.mytext_back=n.text_back(),this.mytext_continue=n.text_continue(),this.mytext_dataCode=n.the_request_code(),this.webservice_requestLoginJson={client_id:n.webservice_client_id(),client_secret:n.webservice_client_secret(),username:n.webservice_username(),password:n.webservice_password(),grant_type:n.webservice_grant_type(),pass_encript:"1"},this.webservice_requestRightJson={request_code:n.the_request_code(),foot_type:2},this.webservice_requestLeftJson={request_code:n.the_request_code(),foot_type:1},this.webservice_base_url=n.webservice_base_url()}ngOnInit(){this.divAutorizando=document.getElementById("div_autorizando"),this.divAutorizadoOk=document.getElementById("div_autorizado_ok"),this.divAutorizadoError=document.getElementById("div_autorizado_error"),this.divAvailabler=document.getElementById("div_availabler"),this.divAvailablerOk=document.getElementById("div_availabler_ok"),this.divAvailablerError=document.getElementById("div_availabler_error"),this.divAvailablel=document.getElementById("div_availablel"),this.divAvailablelOk=document.getElementById("div_availablel_ok"),this.divAvailablelError=document.getElementById("div_availablel_error"),this.global_service.set_isAvailableRight(!1),this.global_service.set_isAvailableLeft(!1),this.flagSomeAvailable=!1,this.webservice_login()}ngOnDestroy(){}webservice_login(){this.divAutorizando.removeAttribute("hidden"),this.global_service.set_feet_accesstoken("none"),this.global_service.set_isAuthenticated(!1);let i={headers:new Kt({"Content-Type":"application/x-www-form-urlencoded"})},n=this.webservice_base_url+"/auth/authorize";this.http.post(n,this.webservice_requestLoginJson,i).subscribe({next:r=>this.postLoginOk(r),error:r=>this.postLoginErr(r.message),complete:()=>this.postLoginComplete()})}postLoginOk(i){i!==null?(this.divAutorizando.setAttribute("hidden","hidden"),this.divAutorizadoOk.removeAttribute("hidden"),this.global_service.set_feet_accesstoken(i.access_token),this.global_service.set_isAuthenticated(!0)):this.postLoginErr("err.login.21")}postLoginErr(i){this.divAutorizando.setAttribute("hidden","hidden"),this.divAutorizadoError.removeAttribute("hidden")}postLoginComplete(){this.global_service.is_authenticated()&&this.webservice_availableLeft()}postLeftErr(i){this.divAvailablel.setAttribute("hidden","hidden"),this.divAvailablelError.removeAttribute("hidden"),console.log(i),this.webservice_availableRight()}postLeftComplete(){console.log("left-COMPLETE"),this.webservice_availableRight()}webservice_availableLeft(){this.divAvailablel.removeAttribute("hidden");let i="Bearer "+this.global_service.feet_accesstoken(),n={headers:new Kt({"Content-Type":"application/json",Authorization:i})},r=this.webservice_base_url+"/models/available3d";this.http.post(r,this.webservice_requestLeftJson,n).subscribe({next:o=>this.postLeftOk(o),error:o=>this.postLeftErr(o.message),complete:()=>this.postLeftComplete()})}postLeftOk(i){if(i!==null){let n=JSON.stringify(i.error_code),r=Number(i.info);r.valueOf()===0||r.valueOf()===1?n.includes('"3D_MODEL":0,"1D_MES":0')?(this.divAvailablel.setAttribute("hidden","hidden"),this.divAvailablelOk.removeAttribute("hidden"),this.global_service.set_isAvailableLeft(!0),this.flagSomeAvailable=!0):this.postLeftErr("Error-01l"):this.postLeftErr("Error-02l")}else this.postLeftErr("Error-03l")}webservice_availableRight(){this.divAvailabler.removeAttribute("hidden");let i="Bearer "+this.global_service.feet_accesstoken(),n={headers:new Kt({"Content-Type":"application/json",Authorization:i})},r=this.webservice_base_url+"/models/available3d";this.http.post(r,this.webservice_requestRightJson,n).subscribe({next:o=>this.postRightOk(o),error:o=>this.postRightErr(o.message),complete:()=>this.postRightComplete()})}postRightOk(i){if(i!==null){let n=JSON.stringify(i.error_code),r=Number(i.info);r.valueOf()===0||r.valueOf()===1?n.includes('"3D_MODEL":0,"1D_MES":0')?(this.divAvailabler.setAttribute("hidden","hidden"),this.divAvailablerOk.removeAttribute("hidden"),this.global_service.set_isAvailableRight(!0),this.flagSomeAvailable=!0):this.postRightErr("Error-01r"):this.postRightErr("Error-02r")}else this.postRightErr("Error-03r")}postRightErr(i){this.divAvailabler.setAttribute("hidden","hidden"),this.divAvailablerError.removeAttribute("hidden"),console.log(i)}postRightComplete(){console.log("right-COMPLETE")}actionBack(){this.location.back()}actionContinue(){this.global_service.is_availableLeft()&&this.global_service.is_availableRight()?this.global_service.set_isFirstFoot(!1):this.global_service.set_isFirstFoot(!0),this.router.navigateByUrl("/screen22acc")}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt),V(Ci),V(zi))};static \u0275cmp=Oe({type:e,selectors:[["app-screen21acc"]],decls:41,vars:13,consts:[[1,"custom-toolbar"],[1,"example-fill-remaining-space"],["mat-button","","id","action_back",2,"color","white",3,"click"],["mat-button","","style","color:white","id","action_continue",3,"click",4,"ngIf"],[1,"custom-div-centered-bold"],[1,"custom-div-centered"],["src","assets/images/lineh.png",1,"custom-img-line"],["id","div_autorizando","hidden","hidden",1,"div_message"],["id","div_autorizado_ok","hidden","hidden",1,"div_message"],["id","div_autorizado_error","hidden","hidden",1,"div_message"],["id","div_availablel","hidden","hidden",1,"div_message"],["id","div_availablel_ok","hidden","hidden",1,"div_message"],["id","div_availablel_error","hidden","hidden",1,"div_message"],["id","div_availabler","hidden","hidden",1,"div_message"],["id","div_availabler_ok","hidden","hidden",1,"div_message"],["id","div_availabler_error","hidden","hidden",1,"div_message"],["mat-button","","id","action_continue",2,"color","white",3,"click"]],template:function(n,r){n&1&&(N(0,"mat-toolbar",0)(1,"span"),K(2),O(),G(3,"span",1),N(4,"button",2),Ce("click",function(){return r.actionBack()}),K(5),O(),Ze(6,LY,2,1,"button",3),O(),G(7,"br")(8,"br")(9,"br")(10,"br")(11,"br"),N(12,"div",4)(13,"mat-label"),K(14),O()(),N(15,"div",5),G(16,"img",6),O(),N(17,"div",7),K(18),O(),N(19,"div",8),K(20),O(),N(21,"div",9),K(22),O(),G(23,"br")(24,"br"),N(25,"div",10),K(26),O(),N(27,"div",11),K(28),O(),N(29,"div",12),K(30),O(),G(31,"br")(32,"br"),N(33,"div",13),K(34),O(),N(35,"div",14),K(36),O(),N(37,"div",15),K(38),O(),G(39,"br")(40,"br")),n&2&&(U(2),fe(r.mytext_app),U(3),dt(" ",r.mytext_back," "),U(),Be("ngIf",r.flagSomeAvailable),U(8),fe(r.mytext_dataCode),U(4),fe(r.mytext_autorizando),U(2),fe(r.mytext_autorizadoOk),U(2),fe(r.mytext_autorizadoError),U(4),fe(r.mytext_availablel),U(2),fe(r.mytext_availablelOk),U(2),fe(r.mytext_availablelError),U(4),fe(r.mytext_availabler),U(2),fe(r.mytext_availablerOk),U(2),fe(r.mytext_availablerError))},dependencies:[Zn,Mt,Ft,Pr],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.div_message[_ngcontent-%COMP%]{width:100%;height:50px;font-size:17px;font-weight:700;text-align:center}.custom-div-centered[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#fff}.custom-div-centered-bold[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#fff;font-weight:700}.custom-img-line[_ngcontent-%COMP%]{width:480px;height:60px}"]})}return e})();function BY(e,t){if(e&1){let i=qt();N(0,"button",12),Ce("click",function(){Ct(i);let r=je();return Et(r.actionContinue())}),K(1),O()}if(e&2){let i=je();U(),dt(" ",i.mytext_continue," ")}}function jY(e,t){e&1&&(N(0,"th",13),K(1," LEFT-IZQUIERDO "),O())}function VY(e,t){if(e&1&&(N(0,"td",14),K(1),O()),e&2){let i=t.$implicit;U(),dt(" ",i.left," ")}}function UY(e,t){e&1&&(N(0,"th",13),K(1," RIGHT-DERECHO "),O())}function HY(e,t){if(e&1&&(N(0,"td",14),K(1),O()),e&2){let i=t.$implicit;U(),dt(" ",i.right," ")}}function WY(e,t){e&1&&G(0,"tr",15)}function qY(e,t){e&1&&G(0,"tr",16)}var UM=(()=>{class e{router;global_service;http;location;mytext_app;webservice_requestGetRightJson;webservice_requestGetLeftJson;webservice_base_url;mytext_dataCode;columnas=["meas-left","meas-right"];measures=[];tabla1;measures_left=[];measures_right=[];mytext_back;mytext_continue;flagSomeAvailable=!1;constructor(i,n,r,o){this.router=i,this.global_service=n,this.http=r,this.location=o,this.mytext_app=n.text_app(),this.mytext_back=n.text_back(),this.mytext_continue=n.text_actionRecommend(),this.mytext_dataCode=n.the_request_code(),this.webservice_requestGetRightJson={request_code:n.the_request_code(),foot_type:2,capabilities:"1D_MES"},this.webservice_requestGetLeftJson={request_code:n.the_request_code(),foot_type:1,capabilities:"1D_MES"},this.webservice_base_url=n.webservice_base_url()}ngOnInit(){this.flagSomeAvailable=!1,this.measures_left=[],this.measures_right=[],this.measures=[],this.global_service.is_availableLeft()&&this.global_service.is_availableRight()?this.global_service.set_isOppositePending(!0):this.global_service.set_isOppositePending(!1),this.global_service.is_availableLeft()?this.webservice_getLeft():this.global_service.is_availableRight()?this.webservice_getRight():alert("ERROR")}ngAfterViewInit(){this.tabla1.renderRows()}ngOnDestroy(){}webservice_getLeft(){let i="Bearer "+this.global_service.feet_accesstoken(),n={headers:new Kt({"Content-Type":"application/json",Authorization:i})},r=this.webservice_base_url+"/models/get3d";this.http.post(r,this.webservice_requestGetLeftJson,n).subscribe({next:o=>this.postLeftOk(o),error:o=>this.postLeftErr(o.message),complete:()=>this.postLeftComplete()})}postLeftErr(i){console.log(i),this.global_service.is_oppositePending()&&(this.global_service.set_isOppositePending(!1),this.webservice_getRight())}postLeftComplete(){console.log("left-COMPLETE"),this.global_service.is_oppositePending()&&(this.global_service.set_isOppositePending(!1),this.webservice_getRight())}webservice_getRight(){let i="Bearer "+this.global_service.feet_accesstoken(),n={headers:new Kt({"Content-Type":"application/json",Authorization:i})},r=this.webservice_base_url+"/models/get3d";this.http.post(r,this.webservice_requestGetRightJson,n).subscribe({next:o=>this.postRightOk(o),error:o=>this.postRightErr(o.message),complete:()=>this.postRightComplete()})}postRightErr(i){console.log(i),this.global_service.is_oppositePending()&&(this.global_service.set_isOppositePending(!1),this.webservice_getLeft())}postRightComplete(){console.log("right-COMPLETE"),this.global_service.is_oppositePending()&&(this.global_service.set_isOppositePending(!1),this.webservice_getLeft())}postRightOk(i){if(i!==null){let n=JSON.stringify(i.error_code),r=Number(i.info);if(r.valueOf()===0||r.valueOf()===1)if(n.includes('"1D_MES":0,"3D_MODEL":0')){let a=JSON.stringify(i.parameters).replace('{"1D_MES":{',"").replace("}}","");this.measures_right=a.split(","),this.flagSomeAvailable=!0,this.refresh_table()}else this.postRightErr("Error-01r");else this.postRightErr("Error-02r")}else this.postRightErr("Error-03r")}postLeftOk(i){if(i!==null){let n=JSON.stringify(i.error_code),r=Number(i.info);if(r.valueOf()===0||r.valueOf()===1)if(n.includes('"1D_MES":0,"3D_MODEL":0')){let a=JSON.stringify(i.parameters).replace('{"1D_MES":{',"").replace("}}","");this.measures_left=a.split(","),this.flagSomeAvailable=!0,this.refresh_table()}else this.postLeftErr("Error-01l");else this.postLeftErr("Error-02l")}else this.postLeftErr("Error-03l")}refresh_table(){let i=this.measures_left.length,n=this.measures_right.length;var r=0;i>n?r=i:r=n,this.measures=[];for(var o=0;o<r;){if(i>0&&n>0){let s=this.measures_left[o],a=14;s.length<a&&(a=s.length);let u=s.substring(0,a),c=this.measures_right[o],f=14;c.length<f&&(f=c.length);let p=c.substring(0,f),m={left:u,right:p};this.measures.push(m)}else if(i===0){let s=this.measures_right[o],a=14;s.length<a&&(a=s.length);let c={left:"",right:s.substring(0,a)};this.measures.push(c)}else if(n===0){let s=this.measures_left[o],a=14;s.length<a&&(a=s.length);let c={left:s.substring(0,a),right:""};this.measures.push(c)}else console.log("unknown");o++}this.tabla1.renderRows()}actionBack(){this.location.back()}actionContinue(){this.global_service.is_availableLeft()&&this.global_service.is_availableRight()?(this.global_service.set_isFirstFoot(!1),this.router.navigateByUrl("/screen08")):this.global_service.is_availableLeft()?(this.global_service.set_isFirstFoot(!0),this.global_service.set_isFootRight(!1),this.global_service.set_isFootLeft(!0),this.router.navigateByUrl("/screen08")):this.global_service.is_availableRight()&&(this.global_service.set_isFirstFoot(!0),this.global_service.set_isFootRight(!0),this.global_service.set_isFootLeft(!1),this.router.navigateByUrl("/screen08"))}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt),V(Ci),V(zi))};static \u0275cmp=Oe({type:e,selectors:[["app-screen22acc"]],viewQuery:function(n,r){if(n&1&&Tn(Zo,5),n&2){let o;vt(o=bt())&&(r.tabla1=o.first)}},decls:21,vars:6,consts:[["tabla1",""],[1,"custom-toolbar"],[1,"example-fill-remaining-space"],["mat-button","","id","action_back",2,"color","white",3,"click"],["mat-button","","style","color:white","id","action_continue",3,"click",4,"ngIf"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","meas-left"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","meas-right"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-button","","id","action_continue",2,"color","white",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(n,r){if(n&1){let o=qt();N(0,"mat-toolbar",1)(1,"span"),K(2),O(),G(3,"span",2),N(4,"button",3),Ce("click",function(){return Ct(o),Et(r.actionBack())}),K(5),O(),Ze(6,BY,2,1,"button",4),O(),G(7,"br")(8,"br")(9,"br")(10,"br"),N(11,"table",5,0),Mr(13,6),Ze(14,jY,2,0,"th",7)(15,VY,2,1,"td",8),Ar(),Mr(16,9),Ze(17,UY,2,0,"th",7)(18,HY,2,1,"td",8),Ar(),Ze(19,WY,1,0,"tr",10)(20,qY,1,0,"tr",11),O()}n&2&&(U(2),fe(r.mytext_app),U(3),dt(" ",r.mytext_back," "),U(),Be("ngIf",r.flagSomeAvailable),U(5),Be("dataSource",r.measures),U(8),Be("matHeaderRowDef",r.columnas),U(),Be("matRowDefColumns",r.columnas))},dependencies:[Zn,Mt,Ft,Zo,km,Om,Mm,$m,Nm,Am,Rm,Pm,Fm],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}table[_ngcontent-%COMP%]{width:80%;margin-left:20rem auto;margin-right:20rem auto;background-color:#d3d3d3}.mat-column-meas-left[_ngcontent-%COMP%], .mat-column-meas-right[_ngcontent-%COMP%]{width:40%;text-align:left;font-size:16px}"]})}return e})();function GY(e,t){if(e&1){let i=qt();N(0,"button",16),Ce("click",function(){Ct(i);let r=je();return Et(r.actionContinue())}),K(1),O()}if(e&2){let i=je();U(),dt(" ",i.mytext_continue," ")}}var HM=(()=>{class e{router;global_service;http;location;divAutorizando;divAutorizadoOk;divAutorizadoError;divAvailabler;divAvailablerOk;divAvailablerError;divAvailablel;divAvailablelOk;divAvailablelError;webservice_requestLoginJson;webservice_requestRightJson;webservice_requestLeftJson;webservice_base_url;mytext_app;mytext_autorizando;mytext_autorizadoOk;mytext_autorizadoError;mytext_availabler;mytext_availablerOk;mytext_availablerError;mytext_availablel;mytext_availablelOk;mytext_availablelError;mytext_back;mytext_continue;mytext_dataCodeDate;flagSomeAvailable=!1;txtLog="";constructor(i,n,r,o){this.router=i,this.global_service=n,this.http=r,this.location=o,this.mytext_app=n.text_app(),this.mytext_autorizando=n.text_autorizando(),this.mytext_autorizadoOk=n.text_autorizadoOk(),this.mytext_autorizadoError=n.text_autorizadoError(),this.mytext_availabler=n.text_availabler(),this.mytext_availablerOk=n.text_availablerOk(),this.mytext_availablerError=n.text_availablerError(),this.mytext_availablel=n.text_availablel(),this.mytext_availablelOk=n.text_availablelOk(),this.mytext_availablelError=n.text_availablelError(),this.mytext_back=n.text_back(),this.mytext_continue=n.text_actionRecommend(),this.mytext_dataCodeDate=localStorage.getItem("feet_previous")||'""',this.webservice_requestLoginJson={client_id:n.webservice_client_id(),client_secret:n.webservice_client_secret(),username:n.webservice_username(),password:n.webservice_password(),grant_type:n.webservice_grant_type(),pass_encript:"1"};let s=this.get_dataCode(this.mytext_dataCodeDate);this.webservice_requestRightJson={request_code:s,foot_type:2},this.webservice_requestLeftJson={request_code:s,foot_type:1},this.webservice_base_url=n.webservice_base_url()}ngOnInit(){this.divAutorizando=document.getElementById("div_autorizando"),this.divAutorizadoOk=document.getElementById("div_autorizado_ok"),this.divAutorizadoError=document.getElementById("div_autorizado_error"),this.divAvailabler=document.getElementById("div_availabler"),this.divAvailablerOk=document.getElementById("div_availabler_ok"),this.divAvailablerError=document.getElementById("div_availabler_error"),this.divAvailablel=document.getElementById("div_availablel"),this.divAvailablelOk=document.getElementById("div_availablel_ok"),this.divAvailablelError=document.getElementById("div_availablel_error"),this.global_service.set_isAvailableRight(!1),this.global_service.set_isAvailableLeft(!1),this.flagSomeAvailable=!1,this.webservice_login()}ngOnDestroy(){}webservice_login(){this.divAutorizando.removeAttribute("hidden"),this.global_service.set_feet_accesstoken("none"),this.global_service.set_isAuthenticated(!1);let i={headers:new Kt({"Content-Type":"application/x-www-form-urlencoded"})},n=this.webservice_base_url+"/auth/authorize";this.http.post(n,this.webservice_requestLoginJson,i).subscribe({next:r=>this.postLoginOk(r),error:r=>this.postLoginErr(r.message),complete:()=>this.postLoginComplete()})}postLoginOk(i){i!==null?(this.divAutorizando.setAttribute("hidden","hidden"),this.divAutorizadoOk.removeAttribute("hidden"),this.global_service.set_feet_accesstoken(i.access_token),this.global_service.set_isAuthenticated(!0)):this.postLoginErr("err.login31")}postLoginErr(i){this.divAutorizando.setAttribute("hidden","hidden"),this.divAutorizadoError.removeAttribute("hidden")}postLoginComplete(){this.global_service.is_authenticated()&&this.webservice_availableLeft()}postLeftErr(i){this.divAvailablel.setAttribute("hidden","hidden"),this.divAvailablelError.removeAttribute("hidden"),console.log(i),this.webservice_availableRight()}postLeftComplete(){console.log("left-COMPLETE"),this.webservice_availableRight()}webservice_availableLeft(){this.divAvailablel.removeAttribute("hidden");let i="Bearer "+this.global_service.feet_accesstoken(),n={headers:new Kt({"Content-Type":"application/json",Authorization:i})},r=this.webservice_base_url+"/models/available3d";this.http.post(r,this.webservice_requestLeftJson,n).subscribe({next:o=>this.postLeftOk(o),error:o=>this.postLeftErr(o.message),complete:()=>this.postLeftComplete()})}postLeftOk(i){if(i!==null){let n=JSON.stringify(i.error_code),r=Number(i.info);r.valueOf()===0||r.valueOf()===1?n.includes('"3D_MODEL":0,"1D_MES":0')?(this.divAvailablel.setAttribute("hidden","hidden"),this.divAvailablelOk.removeAttribute("hidden"),this.global_service.set_isAvailableLeft(!0),this.flagSomeAvailable=!0):this.postLeftErr("Error-01l"):this.postLeftErr("Error-02l")}else this.postLeftErr("Error-03l")}webservice_availableRight(){this.divAvailabler.removeAttribute("hidden");let i="Bearer "+this.global_service.feet_accesstoken(),n={headers:new Kt({"Content-Type":"application/json",Authorization:i})},r=this.webservice_base_url+"/models/available3d";this.http.post(r,this.webservice_requestRightJson,n).subscribe({next:o=>this.postRightOk(o),error:o=>this.postRightErr(o.message),complete:()=>this.postRightComplete()})}postRightOk(i){if(i!==null){let n=JSON.stringify(i.error_code),r=Number(i.info);r.valueOf()===0||r.valueOf()===1?n.includes('"3D_MODEL":0,"1D_MES":0')?(this.divAvailabler.setAttribute("hidden","hidden"),this.divAvailablerOk.removeAttribute("hidden"),this.global_service.set_isAvailableRight(!0),this.flagSomeAvailable=!0):this.postRightErr("Error-01r"):this.postRightErr("Error-02r")}else this.postRightErr("Error-03r")}postRightErr(i){this.divAvailabler.setAttribute("hidden","hidden"),this.divAvailablerError.removeAttribute("hidden"),console.log(i)}postRightComplete(){console.log("right-COMPLETE")}get_dataCode(i){return i.split(" --> ")[1]}actionBack(){this.location.back()}actionContinue(){let i=this.get_dataCode(this.mytext_dataCodeDate);this.global_service.set_request_code(i),this.global_service.is_availableLeft()&&this.global_service.is_availableRight()?(this.global_service.set_isFirstFoot(!1),this.router.navigateByUrl("/screen08")):this.global_service.is_availableLeft()?(this.global_service.set_isFirstFoot(!0),this.global_service.set_isFootRight(!1),this.global_service.set_isFootLeft(!0),this.router.navigateByUrl("/screen08")):this.global_service.is_availableRight()&&(this.global_service.set_isFirstFoot(!0),this.global_service.set_isFootRight(!0),this.global_service.set_isFootLeft(!1),this.router.navigateByUrl("/screen08"))}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt),V(Ci),V(zi))};static \u0275cmp=Oe({type:e,selectors:[["app-screen31acc"]],decls:41,vars:13,consts:[[1,"custom-toolbar"],[1,"example-fill-remaining-space"],["mat-button","","id","action_back",2,"color","white",3,"click"],["mat-button","","style","color:white","id","action_continue",3,"click",4,"ngIf"],[1,"custom-div-centered-bold"],[1,"custom-div-centered"],["src","assets/images/lineh.png",1,"custom-img-line"],["id","div_autorizando","hidden","hidden",1,"div_message"],["id","div_autorizado_ok","hidden","hidden",1,"div_message"],["id","div_autorizado_error","hidden","hidden",1,"div_message"],["id","div_availablel","hidden","hidden",1,"div_message"],["id","div_availablel_ok","hidden","hidden",1,"div_message"],["id","div_availablel_error","hidden","hidden",1,"div_message"],["id","div_availabler","hidden","hidden",1,"div_message"],["id","div_availabler_ok","hidden","hidden",1,"div_message"],["id","div_availabler_error","hidden","hidden",1,"div_message"],["mat-button","","id","action_continue",2,"color","white",3,"click"]],template:function(n,r){n&1&&(N(0,"mat-toolbar",0)(1,"span"),K(2),O(),G(3,"span",1),N(4,"button",2),Ce("click",function(){return r.actionBack()}),K(5),O(),Ze(6,GY,2,1,"button",3),O(),G(7,"br")(8,"br")(9,"br")(10,"br")(11,"br"),N(12,"div",4)(13,"mat-label"),K(14),O()(),N(15,"div",5),G(16,"img",6),O(),N(17,"div",7),K(18),O(),N(19,"div",8),K(20),O(),N(21,"div",9),K(22),O(),G(23,"br")(24,"br"),N(25,"div",10),K(26),O(),N(27,"div",11),K(28),O(),N(29,"div",12),K(30),O(),G(31,"br")(32,"br"),N(33,"div",13),K(34),O(),N(35,"div",14),K(36),O(),N(37,"div",15),K(38),O(),G(39,"br")(40,"br")),n&2&&(U(2),fe(r.mytext_app),U(3),dt(" ",r.mytext_back," "),U(),Be("ngIf",r.flagSomeAvailable),U(8),fe(r.mytext_dataCodeDate),U(4),fe(r.mytext_autorizando),U(2),fe(r.mytext_autorizadoOk),U(2),fe(r.mytext_autorizadoError),U(4),fe(r.mytext_availablel),U(2),fe(r.mytext_availablelOk),U(2),fe(r.mytext_availablelError),U(4),fe(r.mytext_availabler),U(2),fe(r.mytext_availablerOk),U(2),fe(r.mytext_availablerError))},dependencies:[Zn,Mt,Ft,Pr],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.div_message[_ngcontent-%COMP%]{width:100%;height:50px;font-size:17px;font-weight:700;text-align:center}.custom-div-centered[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#fff}.custom-div-centered-bold[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#fff;font-weight:700}.custom-img-line[_ngcontent-%COMP%]{width:480px;height:60px}"]})}return e})();var WM=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275cmp=Oe({type:e,selectors:[["app-page-not-found"]],decls:2,vars:0,template:function(n,r){n&1&&(N(0,"h2"),K(1,"Page not found"),O())}})}return e})();var J1=Object.defineProperty,ZY=Object.getOwnPropertyDescriptor,QY=Object.getOwnPropertyNames,YY=Object.prototype.hasOwnProperty,JY=(e=>typeof hi<"u"?hi:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof hi<"u"?hi:t)[i]}):e)(function(e){if(typeof hi<"u")return hi.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),ue=(e,t)=>()=>(e&&(t=e(e=0)),t),kf=(e,t)=>{for(var i in t)J1(e,i,{get:t[i],enumerable:!0})},XY=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of QY(t))!YY.call(e,r)&&r!==i&&J1(e,r,{get:()=>t[r],enumerable:!(n=ZY(t,r))||n.enumerable});return e},Sg=e=>XY(J1({},"__esModule",{value:!0}),e),mf,Xo,Ll,qM,EN,IN=ue(()=>{"use strict";mf=new Map,Xo=[],Ll=(e,t,i)=>{if(t&&typeof t.init=="function"&&typeof t.createInferenceSessionHandler=="function"){let n=mf.get(e);if(n===void 0)mf.set(e,{backend:t,priority:i});else{if(n.priority>i)return;if(n.priority===i&&n.backend!==t)throw new Error(`cannot register backend "${e}" using priority ${i}`)}if(i>=0){let r=Xo.indexOf(e);r!==-1&&Xo.splice(r,1);for(let o=0;o<Xo.length;o++)if(mf.get(Xo[o]).priority<=i){Xo.splice(o,0,e);return}Xo.push(e)}return}throw new TypeError("not a valid backend")},qM=e=>J(void 0,null,function*(){let t=mf.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let i=!!t.initPromise;try{return i||(t.initPromise=t.backend.init(e)),yield t.initPromise,t.initialized=!0,t.backend}catch(n){return i||(t.error=`${n}`,t.aborted=!0),t.error}finally{delete t.initPromise}}}),EN=e=>J(void 0,null,function*(){let t=e.executionProviders||[],i=t.map(u=>typeof u=="string"?u:u.name),n=i.length===0?Xo:i,r,o=[],s=new Set;for(let u of n){let c=yield qM(u);typeof c=="string"?o.push({name:u,err:c}):(r||(r=c),r===c&&s.add(u))}if(!r)throw new Error(`no available backend found. ERR: ${o.map(u=>`[${u.name}] ${u.err}`).join(", ")}`);for(let{name:u,err:c}of o)i.includes(u)&&console.warn(`removing requested execution provider "${u}" from session options because it is not available: ${c}`);let a=t.filter(u=>s.has(typeof u=="string"?u:u.name));return[r,new Proxy(e,{get:(u,c)=>c==="executionProviders"?a:Reflect.get(u,c)})]})}),eJ=ue(()=>{"use strict";IN()}),SN,tJ=ue(()=>{"use strict";SN="1.21.0"}),Ux,Vi,DN=ue(()=>{"use strict";tJ(),Ux="warning",Vi={wasm:{},webgl:{},webgpu:{},versions:{common:SN},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);Ux=e}},get logLevel(){return Ux}},Object.defineProperty(Vi,"logLevel",{enumerable:!0})}),Yt,nJ=ue(()=>{"use strict";DN(),Yt=Vi}),TN,$N,iJ=ue(()=>{"use strict";TN=(e,t)=>{let i=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);i.width=e.dims[3],i.height=e.dims[2];let n=i.getContext("2d");if(n!=null){let r,o;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(r=e.dims[2],o=e.dims[3]):(r=e.dims[3],o=e.dims[2]);let s=t?.format!==void 0?t.format:"RGB",a=t?.norm,u,c;a===void 0||a.mean===void 0?u=[255,255,255,255]:typeof a.mean=="number"?u=[a.mean,a.mean,a.mean,a.mean]:(u=[a.mean[0],a.mean[1],a.mean[2],0],a.mean[3]!==void 0&&(u[3]=a.mean[3])),a===void 0||a.bias===void 0?c=[0,0,0,0]:typeof a.bias=="number"?c=[a.bias,a.bias,a.bias,a.bias]:(c=[a.bias[0],a.bias[1],a.bias[2],0],a.bias[3]!==void 0&&(c[3]=a.bias[3]));let f=o*r,p=0,m=f,v=f*2,b=-1;s==="RGBA"?(p=0,m=f,v=f*2,b=f*3):s==="RGB"?(p=0,m=f,v=f*2):s==="RBG"&&(p=0,v=f,m=f*2);for(let w=0;w<o;w++)for(let C=0;C<r;C++){let x=(e.data[p++]-c[0])*u[0],y=(e.data[m++]-c[1])*u[1],I=(e.data[v++]-c[2])*u[2],S=b===-1?255:(e.data[b++]-c[3])*u[3];n.fillStyle="rgba("+x+","+y+","+I+","+S+")",n.fillRect(C,w,1,1)}if("toDataURL"in i)return i.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},$N=(e,t)=>{let i=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),n;if(i!=null){let r,o,s;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(r=e.dims[2],o=e.dims[1],s=e.dims[3]):(r=e.dims[3],o=e.dims[2],s=e.dims[1]);let a=t!==void 0&&t.format!==void 0?t.format:"RGB",u=t?.norm,c,f;u===void 0||u.mean===void 0?c=[255,255,255,255]:typeof u.mean=="number"?c=[u.mean,u.mean,u.mean,u.mean]:(c=[u.mean[0],u.mean[1],u.mean[2],255],u.mean[3]!==void 0&&(c[3]=u.mean[3])),u===void 0||u.bias===void 0?f=[0,0,0,0]:typeof u.bias=="number"?f=[u.bias,u.bias,u.bias,u.bias]:(f=[u.bias[0],u.bias[1],u.bias[2],0],u.bias[3]!==void 0&&(f[3]=u.bias[3]));let p=o*r;if(t!==void 0&&(t.format!==void 0&&s===4&&t.format!=="RGBA"||s===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let m=4,v=0,b=1,w=2,C=3,x=0,y=p,I=p*2,S=-1;a==="RGBA"?(x=0,y=p,I=p*2,S=p*3):a==="RGB"?(x=0,y=p,I=p*2):a==="RBG"&&(x=0,I=p,y=p*2),n=i.createImageData(r,o);for(let T=0;T<o*r;v+=m,b+=m,w+=m,C+=m,T++)n.data[v]=(e.data[x++]-f[0])*c[0],n.data[b]=(e.data[y++]-f[1])*c[1],n.data[w]=(e.data[I++]-f[2])*c[2],n.data[C]=S===-1?255:(e.data[S++]-f[3])*c[3]}else throw new Error("Can not access image data");return n}}),cg,kN,MN,AN,RN,ON,rJ=ue(()=>{"use strict";X1(),cg=(e,t)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:i,width:n}=t,r=t.norm??{mean:255,bias:0},o,s;typeof r.mean=="number"?o=[r.mean,r.mean,r.mean,r.mean]:o=[r.mean[0],r.mean[1],r.mean[2],r.mean[3]??255],typeof r.bias=="number"?s=[r.bias,r.bias,r.bias,r.bias]:s=[r.bias[0],r.bias[1],r.bias[2],r.bias[3]??0];let a=t.format!==void 0?t.format:"RGBA",u=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",c=i*n,f=u==="RGBA"?new Float32Array(c*4):new Float32Array(c*3),p=4,m=0,v=1,b=2,w=3,C=0,x=c,y=c*2,I=-1;a==="RGB"&&(p=3,m=0,v=1,b=2,w=-1),u==="RGBA"?I=c*3:u==="RBG"?(C=0,y=c,x=c*2):u==="BGR"&&(y=0,x=c,C=c*2);for(let S=0;S<c;S++,m+=p,b+=p,v+=p,w+=p)f[C++]=(e[m]+s[0])/o[0],f[x++]=(e[v]+s[1])/o[1],f[y++]=(e[b]+s[2])/o[2],I!==-1&&w!==-1&&(f[I++]=(e[w]+s[3])/o[3]);return u==="RGBA"?new Di("float32",f,[1,4,i,n]):new Di("float32",f,[1,3,i,n])},kN=(e,t)=>J(void 0,null,function*(){let i=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,n=typeof ImageData<"u"&&e instanceof ImageData,r=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,o=typeof e=="string",s,a=t??{},u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},c=f=>typeof HTMLCanvasElement<"u"&&f instanceof HTMLCanvasElement||f instanceof OffscreenCanvas?f.getContext("2d"):null;if(i){let f=u();f.width=e.width,f.height=e.height;let p=c(f);if(p!=null){let m=e.height,v=e.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(m=t.resizedHeight,v=t.resizedWidth),t!==void 0){if(a=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");a.tensorFormat="RGBA",a.height=m,a.width=v}else a.tensorFormat="RGBA",a.height=m,a.width=v;p.drawImage(e,0,0),s=p.getImageData(0,0,v,m).data}else throw new Error("Can not access image data")}else if(n){let f,p;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(f=t.resizedHeight,p=t.resizedWidth):(f=e.height,p=e.width),t!==void 0&&(a=t),a.format="RGBA",a.height=f,a.width=p,t!==void 0){let m=u();m.width=p,m.height=f;let v=c(m);if(v!=null)v.putImageData(e,0,0),s=v.getImageData(0,0,p,f).data;else throw new Error("Can not access image data")}else s=e.data}else if(r){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");let f=u();f.width=e.width,f.height=e.height;let p=c(f);if(p!=null){let m=e.height,v=e.width;return p.drawImage(e,0,0,v,m),s=p.getImageData(0,0,v,m).data,a.height=m,a.width=v,cg(s,a)}else throw new Error("Can not access image data")}else{if(o)return new Promise((f,p)=>{let m=u(),v=c(m);if(!e||!v)return p();let b=new Image;b.crossOrigin="Anonymous",b.src=e,b.onload=()=>{m.width=b.width,m.height=b.height,v.drawImage(b,0,0,m.width,m.height);let w=v.getImageData(0,0,m.width,m.height);a.height=m.height,a.width=m.width,f(cg(w.data,a))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(s!==void 0)return cg(s,a);throw new Error("Input data provided is not supported - aborted tensor creation")}),MN=(e,t)=>{let{width:i,height:n,download:r,dispose:o}=t,s=[1,n,i,4];return new Di({location:"texture",type:"float32",texture:e,dims:s,download:r,dispose:o})},AN=(e,t)=>{let{dataType:i,dims:n,download:r,dispose:o}=t;return new Di({location:"gpu-buffer",type:i??"float32",gpuBuffer:e,dims:n,download:r,dispose:o})},RN=(e,t)=>{let{dataType:i,dims:n,download:r,dispose:o}=t;return new Di({location:"ml-tensor",type:i??"float32",mlTensor:e,dims:n,download:r,dispose:o})},ON=(e,t,i)=>new Di({location:"cpu-pinned",type:e,data:t,dims:i??[t.length]})}),ha,Ef,Hx,NN,oJ=ue(()=>{"use strict";ha=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Ef=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),Hx=!1,NN=()=>{if(!Hx){Hx=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,i=globalThis.Float16Array,n=typeof i<"u"&&i.from;e&&(ha.set("int64",BigInt64Array),Ef.set(BigInt64Array,"int64")),t&&(ha.set("uint64",BigUint64Array),Ef.set(BigUint64Array,"uint64")),n?(ha.set("float16",i),Ef.set(i,"float16")):ha.set("float16",Uint16Array)}}}),PN,FN,sJ=ue(()=>{"use strict";X1(),PN=e=>{let t=1;for(let i=0;i<e.length;i++){let n=e[i];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${i}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${i}] must be a non-negative integer, got: ${n}`);t*=n}return t},FN=(e,t)=>{switch(e.location){case"cpu":return new Di(e.type,e.data,t);case"cpu-pinned":return new Di({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new Di({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new Di({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new Di({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),Di,X1=ue(()=>{"use strict";iJ(),rJ(),oJ(),sJ(),Di=class{constructor(e,t,i){NN();let n,r;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,n=e.type,r=e.dims,e.location){case"cpu-pinned":{let s=ha.get(n);if(!s)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(e.data instanceof s))throw new TypeError(`buffer should be of type ${s.name}`);this.cpuData=e.data;break}case"texture":{if(n!=="float32")throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}case"ml-tensor":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint64"&&n!=="int8"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let s,a;if(typeof e=="string")if(n=e,a=i,e==="string"){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");s=t}else{let u=ha.get(e);if(u===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t)){if(e==="float16"&&u===Uint16Array||e==="uint4"||e==="int4")throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${u.name} as data.`);e==="uint64"||e==="int64"?s=u.from(t,BigInt):s=u.from(t)}else if(t instanceof u)s=t;else if(t instanceof Uint8ClampedArray)if(e==="uint8")s=Uint8Array.from(t);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(e==="float16"&&t instanceof Uint16Array&&u!==Uint16Array)s=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length);else throw new TypeError(`A ${n} tensor's data must be type of ${u}`)}else if(a=t,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let u=typeof e[0];if(u==="string")n="string",s=e;else if(u==="boolean")n="bool",s=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${u}.`)}else if(e instanceof Uint8ClampedArray)n="uint8",s=Uint8Array.from(e);else{let u=Ef.get(e.constructor);if(u===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);n=u,s=e}if(a===void 0)a=[s.length];else if(!Array.isArray(a))throw new TypeError("A tensor's dims must be a number array");r=a,this.cpuData=s,this.dataLocation="cpu"}let o=PN(r);if(this.cpuData&&o!==this.cpuData.length&&!((n==="uint4"||n==="int4")&&Math.ceil(o/2)===this.cpuData.length))throw new Error(`Tensor's size(${o}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=r,this.size=o}static fromImage(e,t){return J(this,null,function*(){return kN(e,t)})}static fromTexture(e,t){return MN(e,t)}static fromGpuBuffer(e,t){return AN(e,t)}static fromMLTensor(e,t){return RN(e,t)}static fromPinnedBuffer(e,t,i){return ON(e,t,i)}toDataURL(e){return TN(this,e)}toImageData(e){return $N(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}getData(e){return J(this,null,function*(){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=yield this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}})}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return FN(this,e)}}}),Ui,zN=ue(()=>{"use strict";X1(),Ui=Di}),Dg,Wx,Lr,mr,LN=ue(()=>{"use strict";DN(),Dg=(e,t)=>{(typeof Vi.trace>"u"?!Vi.wasm.trace:!Vi.trace)||console.timeStamp(`${e}::ORT::${t}`)},Wx=(e,t)=>{let i=new Error().stack?.split(/\r\n|\r|\n/g)||[],n=!1;for(let r=0;r<i.length;r++){if(n&&!i[r].includes("TRACE_FUNC")){let o=`FUNC_${e}::${i[r].trim().split(" ")[1]}`;t&&(o+=`::${t}`),Dg("CPU",o);return}i[r].includes("TRACE_FUNC")&&(n=!0)}},Lr=e=>{(typeof Vi.trace>"u"?!Vi.wasm.trace:!Vi.trace)||Wx("BEGIN",e)},mr=e=>{(typeof Vi.trace>"u"?!Vi.wasm.trace:!Vi.trace)||Wx("END",e)}}),BN,aJ=ue(()=>{"use strict";IN(),zN(),LN(),BN=class jN{constructor(t){this.handler=t}run(t,i,n){return J(this,null,function*(){Lr();let r={},o={};if(typeof t!="object"||t===null||t instanceof Ui||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let s=!0;if(typeof i=="object"){if(i===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(i instanceof Ui)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(i)){if(i.length===0)throw new TypeError("'fetches' cannot be an empty array.");s=!1;for(let c of i){if(typeof c!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(c)===-1)throw new RangeError(`'fetches' contains invalid output name: ${c}.`);r[c]=null}if(typeof n=="object"&&n!==null)o=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let c=!1,f=Object.getOwnPropertyNames(i);for(let p of this.outputNames)if(f.indexOf(p)!==-1){let m=i[p];(m===null||m instanceof Ui)&&(c=!0,s=!1,r[p]=m)}if(c){if(typeof n=="object"&&n!==null)o=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else o=i}}else if(typeof i<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let c of this.inputNames)if(typeof t[c]>"u")throw new Error(`input '${c}' is missing in 'feeds'.`);if(s)for(let c of this.outputNames)r[c]=null;let a=yield this.handler.run(t,r,o),u={};for(let c in a)if(Object.hasOwnProperty.call(a,c)){let f=a[c];f instanceof Ui?u[c]=f:u[c]=new Ui(f.type,f.data,f.dims)}return mr(),u})}release(){return J(this,null,function*(){return this.handler.dispose()})}static create(t,i,n,r){return J(this,null,function*(){Lr();let o,s={};if(typeof t=="string"){if(o=t,typeof i=="object"&&i!==null)s=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(o=t,typeof i=="object"&&i!==null)s=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer){let f=t,p=0,m=t.byteLength;if(typeof i=="object"&&i!==null)s=i;else if(typeof i=="number"){if(p=i,!Number.isSafeInteger(p))throw new RangeError("'byteOffset' must be an integer.");if(p<0||p>=f.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${f.byteLength}).`);if(m=t.byteLength-p,typeof n=="number"){if(m=n,!Number.isSafeInteger(m))throw new RangeError("'byteLength' must be an integer.");if(m<=0||p+m>f.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${f.byteLength-p}].`);if(typeof r=="object"&&r!==null)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof i<"u")throw new TypeError("'options' must be an object.");o=new Uint8Array(f,p,m)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[a,u]=yield EN(s),c=yield a.createInferenceSessionHandler(o,u);return mr(),new jN(c)})}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}}),Og,lJ=ue(()=>{"use strict";aJ(),Og=BN}),uJ=ue(()=>{"use strict"}),cJ=ue(()=>{"use strict"}),dJ=ue(()=>{"use strict"}),fJ=ue(()=>{"use strict"}),hJ={};kf(hJ,{InferenceSession:()=>Og,TRACE:()=>Dg,TRACE_FUNC_BEGIN:()=>Lr,TRACE_FUNC_END:()=>mr,Tensor:()=>Ui,env:()=>Yt,registerBackend:()=>Ll});var gr=ue(()=>{"use strict";eJ(),nJ(),lJ(),zN(),uJ(),cJ(),LN(),dJ(),fJ()}),eC=ue(()=>{"use strict"}),VN={};kf(VN,{default:()=>UN});var qx,Gx,UN,pJ=ue(()=>{"use strict";qF(),ba(),tC(),qx="ort-wasm-proxy-worker",Gx=globalThis.self?.name===qx,Gx&&(self.onmessage=e=>{let{type:t,in:i}=e.data;try{switch(t){case"init-wasm":nC(i.wasm).then(()=>{yC(i).then(()=>{postMessage({type:t})},n=>{postMessage({type:t,err:n})})},n=>{postMessage({type:t,err:n})});break;case"init-ep":{let{epName:n,env:r}=i;wC(r,n).then(()=>{postMessage({type:t})},o=>{postMessage({type:t,err:o})});break}case"copy-from":{let{buffer:n}=i,r=Rg(n);postMessage({type:t,out:r});break}case"create":{let{model:n,options:r}=i;xC(n,r).then(o=>{postMessage({type:t,out:o})},o=>{postMessage({type:t,err:o})});break}case"release":CC(i),postMessage({type:t});break;case"run":{let{sessionId:n,inputIndices:r,inputs:o,outputIndices:s,options:a}=i;EC(n,r,o,s,new Array(s.length).fill(null),a).then(u=>{u.some(c=>c[3]!=="cpu")?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:u},SC([...o,...u]))},u=>{postMessage({type:t,err:u})});break}case"end-profiling":IC(i),postMessage({type:t});break;default:}}catch(n){postMessage({type:t,err:n})}}),UN=Gx?null:e=>new Worker(e??Si,{type:"module",name:qx})}),HN={};kf(HN,{default:()=>WN});var Kx,Zx,WN,GM,mJ=ue(()=>{"use strict";Zx=(Kx=import.meta.url,function(){return J(this,arguments,function*(e={}){var t,i,n=e,r=new Promise((l,d)=>{t=l,i=d}),o=typeof window=="object",s=typeof WorkerGlobalScope<"u",a=s&&self.name?.startsWith("em-pthread");n.mountExternalData=(l,d)=>{l.startsWith("./")&&(l=l.substring(2)),(n.Bd||(n.Bd=new Map)).set(l,d)},n.unmountExternalData=()=>{delete n.Bd};var u=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,shared:!0}).buffer.constructor;let c=()=>{let l=(h,g,_)=>(...E)=>{let D=un,M=g?.();E=h(...E);let A=g?.();return M!==A&&(h=A,_(M),g=_=null),un!=D?new Promise((B,q)=>{Is={resolve:B,reject:q}}):E},d=h=>(...g)=>J(this,null,function*(){try{if(n.Cd)throw Error("Session already started");let _=n.Cd={be:g[0],errors:[]},E=yield h(...g);if(n.Cd!==_)throw Error("Session mismatch");n.Dd?.flush();let D=_.errors;if(0<D.length){let M=yield Promise.all(D);if(M=M.filter(A=>A),0<M.length)throw Error(M.join(`
`))}return E}finally{n.Cd=null}});n._OrtCreateSession=l(n._OrtCreateSession,()=>n._OrtCreateSession,h=>n._OrtCreateSession=h),n._OrtRun=d(l(n._OrtRun,()=>n._OrtRun,h=>n._OrtRun=h)),n._OrtRunWithBinding=d(l(n._OrtRunWithBinding,()=>n._OrtRunWithBinding,h=>n._OrtRunWithBinding=h)),n._OrtBindInput=l(n._OrtBindInput,()=>n._OrtBindInput,h=>n._OrtBindInput=h),c=void 0};n.jsepInit=(l,d)=>{if(c?.(),l==="webgpu"){[n.Dd,n.Rd,n.Vd,n.Hd,n.Ud,n.hc,n.Wd,n.Zd,n.Sd,n.Td,n.Xd]=d;let h=n.Dd;n.jsepRegisterBuffer=(g,_,E,D)=>h.registerBuffer(g,_,E,D),n.jsepGetBuffer=g=>h.getBuffer(g),n.jsepCreateDownloader=(g,_,E)=>h.createDownloader(g,_,E),n.jsepOnCreateSession=g=>{h.onCreateSession(g)},n.jsepOnReleaseSession=g=>{h.onReleaseSession(g)},n.jsepOnRunStart=g=>h.onRunStart(g),n.$d=(g,_)=>{h.upload(g,_)}}else if(l==="webnn"){[n.Dd,n.Yd,n.Id,n.jsepEnsureTensor,n.Jd,n.jsepDownloadTensor]=d,n.jsepReleaseTensorId=n.Id,n.jsepUploadTensor=n.Jd;let h=n.Dd;n.jsepOnRunStart=g=>h.onRunStart(g),n.jsepOnRunEnd=h.onRunEnd.bind(h),n.jsepRegisterMLContext=(g,_)=>{h.registerMLContext(g,_)},n.jsepOnReleaseSession=g=>{h.onReleaseSession(g)},n.jsepCreateMLTensorDownloader=(g,_)=>h.createMLTensorDownloader(g,_),n.jsepRegisterMLTensor=(g,_,E,D)=>h.registerMLTensor(g,_,E,D),n.jsepCreateMLContext=g=>h.createMLContext(g),n.jsepRegisterMLConstant=(g,_,E,D,M)=>h.registerMLConstant(g,_,E,D,M,n.Bd),n.jsepRegisterGraphInput=h.registerGraphInput.bind(h),n.jsepIsGraphInput=h.isGraphInput.bind(h),n.jsepCreateTemporaryTensor=h.createTemporaryTensor.bind(h)}};var f,p,m=Object.assign({},n),v=(l,d)=>{throw d},b="";(o||s)&&(s?b=self.location.href:typeof document<"u"&&document.currentScript&&(b=document.currentScript.src),Kx&&(b=Kx),b=b.startsWith("blob:")?"":b.slice(0,b.replace(/[?#].*/,"").lastIndexOf("/")+1),s&&(p=l=>{var d=new XMLHttpRequest;return d.open("GET",l,!1),d.responseType="arraybuffer",d.send(null),new Uint8Array(d.response)}),f=l=>J(this,null,function*(){if(we(l))return new Promise((h,g)=>{var _=new XMLHttpRequest;_.open("GET",l,!0),_.responseType="arraybuffer",_.onload=()=>{_.status==200||_.status==0&&_.response?h(_.response):g(_.status)},_.onerror=g,_.send(null)});var d=yield fetch(l,{credentials:"same-origin"});if(d.ok)return d.arrayBuffer();throw Error(d.status+" : "+d.url)}));var w=console.log.bind(console),C=console.error.bind(console),x=w,y=C;Object.assign(n,m),m=null;var I,S,T,$,k,P,j,H,re,ae,L,ge,ye,Y=n.wasmBinary,ve=!1,we=l=>l.startsWith("file://");function X(){return I.buffer!=$.buffer&&Ot(),$}function xe(){return I.buffer!=$.buffer&&Ot(),k}function z(){return I.buffer!=$.buffer&&Ot(),P}function W(){return I.buffer!=$.buffer&&Ot(),j}function R(){return I.buffer!=$.buffer&&Ot(),H}function se(){return I.buffer!=$.buffer&&Ot(),re}function Ke(){return I.buffer!=$.buffer&&Ot(),ae}function zt(){return I.buffer!=$.buffer&&Ot(),ye}if(a){let l=function(d){try{var h=d.data,g=h.yd;if(g==="load"){let _=[];self.onmessage=E=>_.push(E),self.startWorker=()=>{postMessage({yd:"loaded"});for(let E of _)l(E);self.onmessage=l};for(let E of h.Od)n[E]&&!n[E].proxy||(n[E]=(...D)=>{postMessage({yd:"callHandler",Nd:E,args:D})},E=="print"&&(x=n[E]),E=="printErr"&&(y=n[E]));I=h.he,Ot(),Xe(h.ie)}else if(g==="run"){l_(h.xd),$s(h.xd,0,0,1,0,0),nu(),Cs(h.xd),vn||(Qu(),vn=!0);try{u_(h.de,h.Fd)}catch(_){if(_!="unwind")throw _}}else h.target!=="setimmediate"&&(g==="checkMailbox"?vn&&Hr():g&&(y(`worker: received unknown command ${g}`),y(h)))}catch(_){throw Yu(),_}};var gt=l,Xe,vn=!1;y=function(...d){d=d.join(" "),console.error(d)},self.alert=function(...d){postMessage({yd:"alert",text:d.join(" "),fe:Jr()})},self.onunhandledrejection=d=>{throw d.reason||d},self.onmessage=l}function Ot(){var l=I.buffer;n.HEAP8=$=new Int8Array(l),n.HEAP16=P=new Int16Array(l),n.HEAPU8=k=new Uint8Array(l),n.HEAPU16=j=new Uint16Array(l),n.HEAP32=H=new Int32Array(l),n.HEAPU32=re=new Uint32Array(l),n.HEAPF32=ae=new Float32Array(l),n.HEAPF64=ye=new Float64Array(l),n.HEAP64=L=new BigInt64Array(l),n.HEAPU64=ge=new BigUint64Array(l)}function Vr(){a?startWorker(n):F.Bb()}a||(I=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),Ot());var us,Gi=0,Ki=null;function Zl(){if(--Gi==0&&Ki){var l=Ki;Ki=null,l()}}function bn(l){throw y(l="Aborted("+l+")"),ve=!0,l=new WebAssembly.RuntimeError(l+". Build with -sASSERTIONS for more info."),i(l),l}function Ql(){return{a:{Ta:a_,Va:s_,W:c_,la:d_,b:h_,u:p_,R:m_,Za:g_,d:__,pb:su,g:f_,T:uu,Ga:cu,lb:fu,nb:hu,Ha:pu,Ea:mu,wb:gu,Da:_u,pa:vu,mb:bu,jb:yu,Fa:wu,kb:xu,Ma:v_,za:y_,eb:w_,cb:C_,ya:I_,V:S_,N:D_,db:T_,ma:N_,fb:P_,zb:F_,hb:z_,qb:L_,ab:B_,Aa:j_,yb:Cs,Ja:V_,S:U_,Wa:H_,$:G_,G:K_,E:Q_,m:ys,H:Y_,B:ev,X:tv,J:nv,v:iv,O:rv,D:ov,t:sv,A:av,z:lv,w:uv,r:cv,tb:dv,ub:fv,vb:hv,rb:Pu,sb:Fu,bb:zu,Oa:mv,La:vv,y:bv,ja:yv,Ba:wv,Ka:gv,qa:xv,Ia:Cv,ib:Ev,U:pv,fa:Iv,Sa:Sv,gb:Dv,Qa:Tv,Pa:$v,Ab:Vu,Ca:Uu,ob:ps,aa:Hu,oa:Wu,xb:qu,na:Gu,$a:nb,ia:mb,sa:yb,ga:eb,da:lb,ua:vb,p:Jv,e:Pv,c:Ov,ea:sb,f:Fv,n:Lv,k:Kv,Y:jv,ka:Zv,j:Xv,wa:ob,Ra:Cb,ca:hb,Ua:xb,P:ab,K:Uv,_:fb,Q:tb,Z:gb,x:Vv,l:Nv,va:db,i:Rv,h:Bv,ra:wb,ta:bb,o:zv,q:Hv,s:qv,I:Gv,C:Yv,L:Qv,xa:rb,_a:ib,F:pb,Ya:ub,ba:_b,M:Wv,Xa:cb,ha:Mv,a:I,Na:hs}}}var cs={1319426:()=>typeof wasmOffsetConverter<"u",1319483:(l,d,h,g,_)=>{if(n===void 0||!n.Bd)return 1;if((l=et(Number(l>>>0))).startsWith("./")&&(l=l.substring(2)),!(l=n.Bd.get(l)))return 2;if(d=Number(d>>>0),h=Number(h>>>0),g=Number(g>>>0),d+h>l.byteLength)return 3;try{let E=l.subarray(d,d+h);switch(_){case 0:xe().set(E,g>>>0);break;case 1:n.$d(g,E);break;default:return 4}return 0}catch{return 4}},1320198:(l,d,h)=>{n.Jd(l,xe().subarray(d>>>0,d+h>>>0))},1320261:()=>n.Yd(),1320302:l=>{n.Id(l)},1320338:()=>{n.Sd()},1320369:()=>{n.Td()},1320398:()=>{n.Xd()},1320423:l=>n.Rd(l),1320456:l=>n.Vd(l),1320488:(l,d,h)=>{n.Hd(Number(l),Number(d),Number(h),!0)},1320551:(l,d,h)=>{n.Hd(Number(l),Number(d),Number(h))},1320608:l=>{n.hc("Abs",l,void 0)},1320659:l=>{n.hc("Neg",l,void 0)},1320710:l=>{n.hc("Floor",l,void 0)},1320763:l=>{n.hc("Ceil",l,void 0)},1320815:l=>{n.hc("Reciprocal",l,void 0)},1320873:l=>{n.hc("Sqrt",l,void 0)},1320925:l=>{n.hc("Exp",l,void 0)},1320976:l=>{n.hc("Erf",l,void 0)},1321027:l=>{n.hc("Sigmoid",l,void 0)},1321082:(l,d,h)=>{n.hc("HardSigmoid",l,{alpha:d,beta:h})},1321161:l=>{n.hc("Log",l,void 0)},1321212:l=>{n.hc("Sin",l,void 0)},1321263:l=>{n.hc("Cos",l,void 0)},1321314:l=>{n.hc("Tan",l,void 0)},1321365:l=>{n.hc("Asin",l,void 0)},1321417:l=>{n.hc("Acos",l,void 0)},1321469:l=>{n.hc("Atan",l,void 0)},1321521:l=>{n.hc("Sinh",l,void 0)},1321573:l=>{n.hc("Cosh",l,void 0)},1321625:l=>{n.hc("Asinh",l,void 0)},1321678:l=>{n.hc("Acosh",l,void 0)},1321731:l=>{n.hc("Atanh",l,void 0)},1321784:l=>{n.hc("Tanh",l,void 0)},1321836:l=>{n.hc("Not",l,void 0)},1321887:(l,d,h)=>{n.hc("Clip",l,{min:d,max:h})},1321956:l=>{n.hc("Clip",l,void 0)},1322008:(l,d)=>{n.hc("Elu",l,{alpha:d})},1322066:l=>{n.hc("Gelu",l,void 0)},1322118:l=>{n.hc("Relu",l,void 0)},1322170:(l,d)=>{n.hc("LeakyRelu",l,{alpha:d})},1322234:(l,d)=>{n.hc("ThresholdedRelu",l,{alpha:d})},1322304:(l,d)=>{n.hc("Cast",l,{to:d})},1322362:l=>{n.hc("Add",l,void 0)},1322413:l=>{n.hc("Sub",l,void 0)},1322464:l=>{n.hc("Mul",l,void 0)},1322515:l=>{n.hc("Div",l,void 0)},1322566:l=>{n.hc("Pow",l,void 0)},1322617:l=>{n.hc("Equal",l,void 0)},1322670:l=>{n.hc("Greater",l,void 0)},1322725:l=>{n.hc("GreaterOrEqual",l,void 0)},1322787:l=>{n.hc("Less",l,void 0)},1322839:l=>{n.hc("LessOrEqual",l,void 0)},1322898:(l,d,h,g,_)=>{n.hc("ReduceMean",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1323073:(l,d,h,g,_)=>{n.hc("ReduceMax",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1323247:(l,d,h,g,_)=>{n.hc("ReduceMin",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1323421:(l,d,h,g,_)=>{n.hc("ReduceProd",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1323596:(l,d,h,g,_)=>{n.hc("ReduceSum",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1323770:(l,d,h,g,_)=>{n.hc("ReduceL1",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1323943:(l,d,h,g,_)=>{n.hc("ReduceL2",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1324116:(l,d,h,g,_)=>{n.hc("ReduceLogSum",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1324293:(l,d,h,g,_)=>{n.hc("ReduceSumSquare",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1324473:(l,d,h,g,_)=>{n.hc("ReduceLogSumExp",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1324653:l=>{n.hc("Where",l,void 0)},1324706:(l,d,h)=>{n.hc("Transpose",l,{perm:d?Array.from(R().subarray(Number(d)>>>0,Number(h)>>>0)):[]})},1324830:(l,d,h,g)=>{n.hc("DepthToSpace",l,{blocksize:d,mode:et(h),format:g?"NHWC":"NCHW"})},1324963:(l,d,h,g)=>{n.hc("DepthToSpace",l,{blocksize:d,mode:et(h),format:g?"NHWC":"NCHW"})},1325096:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe,Qt)=>{n.hc("ConvTranspose",l,{format:A?"NHWC":"NCHW",autoPad:d,dilations:[h],group:g,kernelShape:[_],pads:[E,D],strides:[M],wIsConst:()=>!!X()[B>>>0],outputPadding:q?Array.from(R().subarray(Number(q)>>>0,Number(oe)>>>0)):[],outputShape:pe?Array.from(R().subarray(Number(pe)>>>0,Number(Pe)>>>0)):[],activation:et(Qt)})},1325529:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>{n.hc("ConvTranspose",l,{format:M?"NHWC":"NCHW",autoPad:d,dilations:Array.from(R().subarray(Number(h)>>>0,2+(Number(h)>>>0)>>>0)),group:g,kernelShape:Array.from(R().subarray(Number(_)>>>0,2+(Number(_)>>>0)>>>0)),pads:Array.from(R().subarray(Number(E)>>>0,4+(Number(E)>>>0)>>>0)),strides:Array.from(R().subarray(Number(D)>>>0,2+(Number(D)>>>0)>>>0)),wIsConst:()=>!!X()[A>>>0],outputPadding:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],outputShape:oe?Array.from(R().subarray(Number(oe)>>>0,Number(pe)>>>0)):[],activation:et(Pe)})},1326190:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe,Qt)=>{n.hc("ConvTranspose",l,{format:A?"NHWC":"NCHW",autoPad:d,dilations:[h],group:g,kernelShape:[_],pads:[E,D],strides:[M],wIsConst:()=>!!X()[B>>>0],outputPadding:q?Array.from(R().subarray(Number(q)>>>0,Number(oe)>>>0)):[],outputShape:pe?Array.from(R().subarray(Number(pe)>>>0,Number(Pe)>>>0)):[],activation:et(Qt)})},1326623:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>{n.hc("ConvTranspose",l,{format:M?"NHWC":"NCHW",autoPad:d,dilations:Array.from(R().subarray(Number(h)>>>0,2+(Number(h)>>>0)>>>0)),group:g,kernelShape:Array.from(R().subarray(Number(_)>>>0,2+(Number(_)>>>0)>>>0)),pads:Array.from(R().subarray(Number(E)>>>0,4+(Number(E)>>>0)>>>0)),strides:Array.from(R().subarray(Number(D)>>>0,2+(Number(D)>>>0)>>>0)),wIsConst:()=>!!X()[A>>>0],outputPadding:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],outputShape:oe?Array.from(R().subarray(Number(oe)>>>0,Number(pe)>>>0)):[],activation:et(Pe)})},1327284:(l,d)=>{n.hc("GlobalAveragePool",l,{format:d?"NHWC":"NCHW"})},1327375:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>{n.hc("AveragePool",l,{format:Pe?"NHWC":"NCHW",auto_pad:d,ceil_mode:h,count_include_pad:g,storage_order:_,dilations:E?Array.from(R().subarray(Number(E)>>>0,Number(D)>>>0)):[],kernel_shape:M?Array.from(R().subarray(Number(M)>>>0,Number(A)>>>0)):[],pads:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],strides:oe?Array.from(R().subarray(Number(oe)>>>0,Number(pe)>>>0)):[]})},1327854:(l,d)=>{n.hc("GlobalAveragePool",l,{format:d?"NHWC":"NCHW"})},1327945:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>{n.hc("AveragePool",l,{format:Pe?"NHWC":"NCHW",auto_pad:d,ceil_mode:h,count_include_pad:g,storage_order:_,dilations:E?Array.from(R().subarray(Number(E)>>>0,Number(D)>>>0)):[],kernel_shape:M?Array.from(R().subarray(Number(M)>>>0,Number(A)>>>0)):[],pads:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],strides:oe?Array.from(R().subarray(Number(oe)>>>0,Number(pe)>>>0)):[]})},1328424:(l,d)=>{n.hc("GlobalMaxPool",l,{format:d?"NHWC":"NCHW"})},1328511:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>{n.hc("MaxPool",l,{format:Pe?"NHWC":"NCHW",auto_pad:d,ceil_mode:h,count_include_pad:g,storage_order:_,dilations:E?Array.from(R().subarray(Number(E)>>>0,Number(D)>>>0)):[],kernel_shape:M?Array.from(R().subarray(Number(M)>>>0,Number(A)>>>0)):[],pads:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],strides:oe?Array.from(R().subarray(Number(oe)>>>0,Number(pe)>>>0)):[]})},1328986:(l,d)=>{n.hc("GlobalMaxPool",l,{format:d?"NHWC":"NCHW"})},1329073:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>{n.hc("MaxPool",l,{format:Pe?"NHWC":"NCHW",auto_pad:d,ceil_mode:h,count_include_pad:g,storage_order:_,dilations:E?Array.from(R().subarray(Number(E)>>>0,Number(D)>>>0)):[],kernel_shape:M?Array.from(R().subarray(Number(M)>>>0,Number(A)>>>0)):[],pads:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],strides:oe?Array.from(R().subarray(Number(oe)>>>0,Number(pe)>>>0)):[]})},1329548:(l,d,h,g,_)=>{n.hc("Gemm",l,{alpha:d,beta:h,transA:g,transB:_})},1329652:l=>{n.hc("MatMul",l,void 0)},1329706:(l,d,h,g)=>{n.hc("ArgMax",l,{keepDims:!!d,selectLastIndex:!!h,axis:g})},1329814:(l,d,h,g)=>{n.hc("ArgMin",l,{keepDims:!!d,selectLastIndex:!!h,axis:g})},1329922:(l,d)=>{n.hc("Softmax",l,{axis:d})},1329985:(l,d)=>{n.hc("Concat",l,{axis:d})},1330045:(l,d,h,g,_)=>{n.hc("Split",l,{axis:d,numOutputs:h,splitSizes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1330201:l=>{n.hc("Expand",l,void 0)},1330255:(l,d)=>{n.hc("Gather",l,{axis:Number(d)})},1330326:(l,d)=>{n.hc("GatherElements",l,{axis:Number(d)})},1330405:(l,d)=>{n.hc("GatherND",l,{batch_dims:Number(d)})},1330484:(l,d,h,g,_,E,D,M,A,B,q)=>{n.hc("Resize",l,{antialias:d,axes:h?Array.from(R().subarray(Number(h)>>>0,Number(g)>>>0)):[],coordinateTransformMode:et(_),cubicCoeffA:E,excludeOutside:D,extrapolationValue:M,keepAspectRatioPolicy:et(A),mode:et(B),nearestMode:et(q)})},1330846:(l,d,h,g,_,E,D)=>{n.hc("Slice",l,{starts:d?Array.from(R().subarray(Number(d)>>>0,Number(h)>>>0)):[],ends:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[],axes:E?Array.from(R().subarray(Number(E)>>>0,Number(D)>>>0)):[]})},1331110:l=>{n.hc("Tile",l,void 0)},1331162:(l,d,h)=>{n.hc("InstanceNormalization",l,{epsilon:d,format:h?"NHWC":"NCHW"})},1331276:(l,d,h)=>{n.hc("InstanceNormalization",l,{epsilon:d,format:h?"NHWC":"NCHW"})},1331390:l=>{n.hc("Range",l,void 0)},1331443:(l,d)=>{n.hc("Einsum",l,{equation:et(d)})},1331524:(l,d,h,g,_)=>{n.hc("Pad",l,{mode:d,value:h,pads:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1331667:(l,d,h,g,_,E)=>{n.hc("BatchNormalization",l,{epsilon:d,momentum:h,spatial:!!_,trainingMode:!!g,format:E?"NHWC":"NCHW"})},1331836:(l,d,h,g,_,E)=>{n.hc("BatchNormalization",l,{epsilon:d,momentum:h,spatial:!!_,trainingMode:!!g,format:E?"NHWC":"NCHW"})},1332005:(l,d,h)=>{n.hc("CumSum",l,{exclusive:Number(d),reverse:Number(h)})},1332102:(l,d,h)=>{n.hc("DequantizeLinear",l,{axis:d,blockSize:h})},1332192:(l,d,h,g,_)=>{n.hc("GridSample",l,{align_corners:d,mode:et(h),padding_mode:et(g),format:_?"NHWC":"NCHW"})},1332362:(l,d,h,g,_)=>{n.hc("GridSample",l,{align_corners:d,mode:et(h),padding_mode:et(g),format:_?"NHWC":"NCHW"})},1332532:(l,d)=>{n.hc("ScatterND",l,{reduction:et(d)})},1332617:(l,d,h,g,_,E,D,M,A)=>{n.hc("Attention",l,{numHeads:d,isUnidirectional:h,maskFilterValue:g,scale:_,doRotary:E,qkvHiddenSizes:D?Array.from(R().subarray(Number(M)>>>0,Number(M)+D>>>0)):[],pastPresentShareBuffer:!!A})},1332889:l=>{n.hc("BiasAdd",l,void 0)},1332944:l=>{n.hc("BiasSplitGelu",l,void 0)},1333005:l=>{n.hc("FastGelu",l,void 0)},1333061:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe,Qt,Ji)=>{n.hc("Conv",l,{format:oe?"NHWC":"NCHW",auto_pad:d,dilations:h?Array.from(R().subarray(Number(h)>>>0,Number(g)>>>0)):[],group:_,kernel_shape:E?Array.from(R().subarray(Number(E)>>>0,Number(D)>>>0)):[],pads:M?Array.from(R().subarray(Number(M)>>>0,Number(A)>>>0)):[],strides:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],w_is_const:()=>!!X()[Number(pe)>>>0],activation:et(Pe),activation_params:Qt?Array.from(Ke().subarray(Number(Qt)>>>0,Number(Ji)>>>0)):[]})},1333645:l=>{n.hc("Gelu",l,void 0)},1333697:(l,d,h,g,_,E,D,M,A)=>{n.hc("GroupQueryAttention",l,{numHeads:d,kvNumHeads:h,scale:g,softcap:_,doRotary:E,rotaryInterleaved:D,smoothSoftmax:M,localWindowSize:A})},1333914:(l,d,h,g)=>{n.hc("LayerNormalization",l,{axis:d,epsilon:h,simplified:!!g})},1334025:(l,d,h,g)=>{n.hc("LayerNormalization",l,{axis:d,epsilon:h,simplified:!!g})},1334136:(l,d,h,g,_,E)=>{n.hc("MatMulNBits",l,{k:d,n:h,accuracyLevel:g,bits:_,blockSize:E})},1334263:(l,d,h,g,_,E)=>{n.hc("MultiHeadAttention",l,{numHeads:d,isUnidirectional:h,maskFilterValue:g,scale:_,doRotary:E})},1334422:(l,d)=>{n.hc("QuickGelu",l,{alpha:d})},1334486:(l,d,h,g,_)=>{n.hc("RotaryEmbedding",l,{interleaved:!!d,numHeads:h,rotaryEmbeddingDim:g,scale:_})},1334625:(l,d,h)=>{n.hc("SkipLayerNormalization",l,{epsilon:d,simplified:!!h})},1334727:(l,d,h)=>{n.hc("SkipLayerNormalization",l,{epsilon:d,simplified:!!h})},1334829:(l,d,h,g)=>{n.hc("GatherBlockQuantized",l,{gatherAxis:d,quantizeAxis:h,blockSize:g})},1334950:l=>{n.Wd(l)},1334984:(l,d)=>n.Zd(Number(l),Number(d),n.Cd.be,n.Cd.errors)};function s_(l,d,h){return ku(()=>J(this,null,function*(){yield n.Ud(Number(l),Number(d),Number(h))}))}function a_(){return typeof wasmOffsetConverter<"u"}class ds{name="ExitStatus";constructor(d){this.message=`Program terminated with exit(${d})`,this.status=d}}var Yl=l=>{l.terminate(),l.onmessage=()=>{}},fs=[],Jl=l=>{Rn.length==0&&(ru(),iu(Rn[0]));var d=Rn.pop();if(!d)return 6;Zi.push(d),Xn[l.xd]=d,d.xd=l.xd;var h={yd:"run",de:l.ce,Fd:l.Fd,xd:l.xd};return d.postMessage(h,l.Ld),0},An=0,Le=(l,d,...h)=>{for(var g=2*h.length,_=de(),E=Ms(8*g),D=E>>>3,M=0;M<h.length;M++){var A=h[M];typeof A=="bigint"?(L[D+2*M]=1n,L[D+2*M+1]=A):(L[D+2*M]=0n,zt()[D+2*M+1>>>0]=A)}return l=Ju(l,0,g,E,d),le(_),l};function hs(l){if(a)return Le(0,1,l);if(T=l,!(0<An)){for(var d of Zi)Yl(d);for(d of Rn)Yl(d);Rn=[],Zi=[],Xn={},ve=!0}v(0,new ds(l))}function Xl(l){if(a)return Le(1,0,l);ps(l)}var ps=l=>{if(T=l,a)throw Xl(l),"unwind";hs(l)},Rn=[],Zi=[],eu=[],Xn={},tu=l=>{var d=l.xd;delete Xn[d],Rn.push(l),Zi.splice(Zi.indexOf(l),1),l.xd=0,Xu(d)};function nu(){eu.forEach(l=>l())}var iu=l=>new Promise(d=>{l.onmessage=_=>{var E=(_=_.data).yd;if(_.Ed&&_.Ed!=Jr()){var D=Xn[_.Ed];D?D.postMessage(_,_.Ld):y(`Internal error! Worker sent a message "${E}" to target pthread ${_.Ed}, but that thread no longer exists!`)}else E==="checkMailbox"?Hr():E==="spawnThread"?Jl(_):E==="cleanupThread"?tu(Xn[_.ee]):E==="loaded"?(l.loaded=!0,d(l)):E==="alert"?alert(`Thread ${_.fe}: ${_.text}`):_.target==="setimmediate"?l.postMessage(_):E==="callHandler"?n[_.Nd](..._.args):E&&y(`worker sent an unknown command ${E}`)},l.onerror=_=>{throw y(`worker sent an error! ${_.filename}:${_.lineno}: ${_.message}`),_};var h,g=[];for(h of[])n.propertyIsEnumerable(h)&&g.push(h);l.postMessage({yd:"load",Od:g,he:I,ie:S})});function ru(){var l=new Worker(import.meta.url.startsWith("file:")?new URL("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url),{type:"module",workerData:"em-pthread",name:"em-pthread"});Rn.push(l)}var l_=l=>{Ot();var d=se()[l+52>>>2>>>0];l=se()[l+56>>>2>>>0],nc(d,d-l),le(d)},u_=(l,d)=>{An=0,l=As(l,d),0<An?T=l:ks(l)},Ur=[];function c_(l){var d=new ms(l>>>=0);if(X()[d.wd+12>>>0]==0){var h=1;X()[d.wd+12>>>0]=h}return h=0,X()[d.wd+13>>>0]=h,Ur.push(d),rc(l),sc(l)}var bi=0,d_=()=>{he(0,0);var l=Ur.pop();ic(l.Gd),bi=0};class ms{constructor(d){this.Gd=d,this.wd=d-24}}function f_(l){throw bi||=l>>>0,bi}var gs=l=>{var d=bi;if(!d)return Yi(0),0;var h=new ms(d);se()[h.wd+16>>>2>>>0]=d;var g=se()[h.wd+4>>>2>>>0];if(!g)return Yi(0),d;for(var _ of l){if(_===0||_===g)break;if(oc(_,g,h.wd+16))return Yi(_),d}return Yi(g),d};function h_(){return gs([])}function p_(l){return gs([l>>>0])}function m_(l,d){return gs([l>>>0,d>>>0])}var g_=()=>{var l=Ur.pop();l||bn("no exception to throw");var d=l.Gd;if(X()[l.wd+13>>>0]==0){Ur.push(l);var h=1;X()[l.wd+13>>>0]=h,h=0,X()[l.wd+12>>>0]=h}throw bi=d};function __(l,d,h){var g=new ms(l>>>=0);throw d>>>=0,h>>>=0,se()[g.wd+16>>>2>>>0]=0,se()[g.wd+4>>>2>>>0]=d,se()[g.wd+8>>>2>>>0]=h,bi=l}function ou(l,d,h,g){return a?Le(2,1,l,d,h,g):su(l,d,h,g)}function su(l,d,h,g){if(l>>>=0,h>>>=0,g>>>=0,u===void 0)return 6;var _=[];return a&&_.length===0?ou(l,d>>>=0,h,g):(l={ce:h,xd:l,Fd:g,Ld:_},a?(l.yd="spawnThread",postMessage(l,_),0):Jl(l))}var au=typeof TextDecoder<"u"?new TextDecoder:void 0,lu=(l,d=0,h=NaN)=>{var g=(d>>>=0)+h;for(h=d;l[h]&&!(h>=g);)++h;if(16<h-d&&l.buffer&&au)return au.decode(l.buffer instanceof ArrayBuffer?l.subarray(d,h):l.slice(d,h));for(g="";d<h;){var _=l[d++];if(128&_){var E=63&l[d++];if((224&_)==192)g+=String.fromCharCode((31&_)<<6|E);else{var D=63&l[d++];65536>(_=(240&_)==224?(15&_)<<12|E<<6|D:(7&_)<<18|E<<12|D<<6|63&l[d++])?g+=String.fromCharCode(_):(_-=65536,g+=String.fromCharCode(55296|_>>10,56320|1023&_))}}else g+=String.fromCharCode(_)}return g},et=(l,d)=>(l>>>=0)?lu(xe(),l,d):"";function uu(l,d,h){return a?Le(3,1,l,d,h):0}function cu(l,d){if(a)return Le(4,1,l,d)}var du=l=>{for(var d=0,h=0;h<l.length;++h){var g=l.charCodeAt(h);127>=g?d++:2047>=g?d+=2:55296<=g&&57343>=g?(d+=4,++h):d+=3}return d},yi=(l,d,h)=>{var g=xe();if(d>>>=0,0<h){var _=d;h=d+h-1;for(var E=0;E<l.length;++E){var D=l.charCodeAt(E);if(55296<=D&&57343>=D&&(D=65536+((1023&D)<<10)|1023&l.charCodeAt(++E)),127>=D){if(d>=h)break;g[d++>>>0]=D}else{if(2047>=D){if(d+1>=h)break;g[d++>>>0]=192|D>>6}else{if(65535>=D){if(d+2>=h)break;g[d++>>>0]=224|D>>12}else{if(d+3>=h)break;g[d++>>>0]=240|D>>18,g[d++>>>0]=128|D>>12&63}g[d++>>>0]=128|D>>6&63}g[d++>>>0]=128|63&D}}g[d>>>0]=0,l=d-_}else l=0;return l};function fu(l,d){if(a)return Le(5,1,l,d)}function hu(l,d,h){if(a)return Le(6,1,l,d,h)}function pu(l,d,h){return a?Le(7,1,l,d,h):0}function mu(l,d){if(a)return Le(8,1,l,d)}function gu(l,d,h){if(a)return Le(9,1,l,d,h)}function _u(l,d,h,g){if(a)return Le(10,1,l,d,h,g)}function vu(l,d,h,g){if(a)return Le(11,1,l,d,h,g)}function bu(l,d,h,g){if(a)return Le(12,1,l,d,h,g)}function yu(l){if(a)return Le(13,1,l)}function wu(l,d){if(a)return Le(14,1,l,d)}function xu(l,d,h){if(a)return Le(15,1,l,d,h)}var Cu,On,v_=()=>bn(""),ln=l=>{for(var d="";xe()[l>>>0];)d+=Cu[xe()[l++>>>0]];return d},_s={},vs={},b_={};function yn(l,d,h={}){return function(g,_,E={}){var D=_.name;if(!g)throw new On(`type "${D}" must have a positive integer typeid pointer`);if(vs.hasOwnProperty(g)){if(E.Pd)return;throw new On(`Cannot register type '${D}' twice`)}vs[g]=_,delete b_[g],_s.hasOwnProperty(g)&&(_=_s[g],delete _s[g],_.forEach(M=>M()))}(l,d,h)}var Eu=(l,d,h)=>{switch(d){case 1:return h?g=>X()[g>>>0]:g=>xe()[g>>>0];case 2:return h?g=>z()[g>>>1>>>0]:g=>W()[g>>>1>>>0];case 4:return h?g=>R()[g>>>2>>>0]:g=>se()[g>>>2>>>0];case 8:return h?g=>L[g>>>3]:g=>ge[g>>>3];default:throw new TypeError(`invalid integer width (${d}): ${l}`)}};function y_(l,d,h){h>>>=0,yn(l>>>=0,{name:d=ln(d>>>0),fromWireType:g=>g,toWireType:function(g,_){if(typeof _!="bigint"&&typeof _!="number")throw _=_===null?"null":(g=typeof _)=="object"||g==="array"||g==="function"?_.toString():""+_,new TypeError(`Cannot convert "${_}" to ${this.name}`);return typeof _=="number"&&(_=BigInt(_)),_},zd:Nn,readValueFromPointer:Eu(d,h,d.indexOf("u")==-1),Ad:null})}var Nn=8;function w_(l,d,h,g){yn(l>>>=0,{name:d=ln(d>>>0),fromWireType:function(_){return!!_},toWireType:function(_,E){return E?h:g},zd:Nn,readValueFromPointer:function(_){return this.fromWireType(xe()[_>>>0])},Ad:null})}var bs=[],wn=[];function ys(l){9<(l>>>=0)&&--wn[l+1]==0&&(wn[l]=void 0,bs.push(l))}var Lt=l=>{if(!l)throw new On("Cannot use deleted val. handle = "+l);return wn[l]},Zt=l=>{switch(l){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let d=bs.pop()||wn.length;return wn[d]=l,wn[d+1]=1,d}};function ws(l){return this.fromWireType(se()[l>>>2>>>0])}var x_={name:"emscripten::val",fromWireType:l=>{var d=Lt(l);return ys(l),d},toWireType:(l,d)=>Zt(d),zd:Nn,readValueFromPointer:ws,Ad:null};function C_(l){return yn(l>>>0,x_)}var E_=(l,d)=>{switch(d){case 4:return function(h){return this.fromWireType(Ke()[h>>>2>>>0])};case 8:return function(h){return this.fromWireType(zt()[h>>>3>>>0])};default:throw new TypeError(`invalid float width (${d}): ${l}`)}};function I_(l,d,h){h>>>=0,yn(l>>>=0,{name:d=ln(d>>>0),fromWireType:g=>g,toWireType:(g,_)=>_,zd:Nn,readValueFromPointer:E_(d,h),Ad:null})}function S_(l,d,h,g,_){if(l>>>=0,h>>>=0,d=ln(d>>>0),_===-1&&(_=4294967295),_=M=>M,g===0){var E=32-8*h;_=M=>M<<E>>>E}var D=d.includes("unsigned")?function(M,A){return A>>>0}:function(M,A){return A};yn(l,{name:d,fromWireType:_,toWireType:D,zd:Nn,readValueFromPointer:Eu(d,h,g!==0),Ad:null})}function D_(l,d,h){function g(E){var D=se()[E>>>2>>>0];return E=se()[E+4>>>2>>>0],new _(X().buffer,E,D)}var _=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][d];yn(l>>>=0,{name:h=ln(h>>>0),fromWireType:g,zd:Nn,readValueFromPointer:g},{Pd:!0})}function T_(l,d){yn(l>>>=0,{name:d=ln(d>>>0),fromWireType:function(h){for(var g,_=se()[h>>>2>>>0],E=h+4,D=E,M=0;M<=_;++M){var A=E+M;M!=_&&xe()[A>>>0]!=0||(D=et(D,A-D),g===void 0?g=D:(g+="\0",g+=D),D=A+1)}return cn(h),g},toWireType:function(h,g){g instanceof ArrayBuffer&&(g=new Uint8Array(g));var _=typeof g=="string";if(!(_||g instanceof Uint8Array||g instanceof Uint8ClampedArray||g instanceof Int8Array))throw new On("Cannot pass non-string to std::string");var E=_?du(g):g.length,D=Xr(4+E+1),M=D+4;if(se()[D>>>2>>>0]=E,_)yi(g,M,E+1);else if(_)for(_=0;_<E;++_){var A=g.charCodeAt(_);if(255<A)throw cn(D),new On("String has UTF-16 code units that do not fit in 8 bits");xe()[M+_>>>0]=A}else for(_=0;_<E;++_)xe()[M+_>>>0]=g[_];return h!==null&&h.push(cn,D),D},zd:Nn,readValueFromPointer:ws,Ad(h){cn(h)}})}var Iu=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,$_=(l,d)=>{for(var h=l>>1,g=h+d/2;!(h>=g)&&W()[h>>>0];)++h;if(32<(h<<=1)-l&&Iu)return Iu.decode(xe().slice(l,h));for(h="",g=0;!(g>=d/2);++g){var _=z()[l+2*g>>>1>>>0];if(_==0)break;h+=String.fromCharCode(_)}return h},k_=(l,d,h)=>{if(h??=2147483647,2>h)return 0;var g=d;h=(h-=2)<2*l.length?h/2:l.length;for(var _=0;_<h;++_){var E=l.charCodeAt(_);z()[d>>>1>>>0]=E,d+=2}return z()[d>>>1>>>0]=0,d-g},M_=l=>2*l.length,A_=(l,d)=>{for(var h=0,g="";!(h>=d/4);){var _=R()[l+4*h>>>2>>>0];if(_==0)break;++h,65536<=_?(_-=65536,g+=String.fromCharCode(55296|_>>10,56320|1023&_)):g+=String.fromCharCode(_)}return g},R_=(l,d,h)=>{if(d>>>=0,h??=2147483647,4>h)return 0;var g=d;h=g+h-4;for(var _=0;_<l.length;++_){var E=l.charCodeAt(_);if(55296<=E&&57343>=E&&(E=65536+((1023&E)<<10)|1023&l.charCodeAt(++_)),R()[d>>>2>>>0]=E,(d+=4)+4>h)break}return R()[d>>>2>>>0]=0,d-g},O_=l=>{for(var d=0,h=0;h<l.length;++h){var g=l.charCodeAt(h);55296<=g&&57343>=g&&++h,d+=4}return d};function N_(l,d,h){if(l>>>=0,d>>>=0,h=ln(h>>>=0),d===2)var g=$_,_=k_,E=M_,D=M=>W()[M>>>1>>>0];else d===4&&(g=A_,_=R_,E=O_,D=M=>se()[M>>>2>>>0]);yn(l,{name:h,fromWireType:M=>{for(var A,B=se()[M>>>2>>>0],q=M+4,oe=0;oe<=B;++oe){var pe=M+4+oe*d;oe!=B&&D(pe)!=0||(q=g(q,pe-q),A===void 0?A=q:(A+="\0",A+=q),q=pe+d)}return cn(M),A},toWireType:(M,A)=>{if(typeof A!="string")throw new On(`Cannot pass non-string to C++ string type ${h}`);var B=E(A),q=Xr(4+B+d);return se()[q>>>2>>>0]=B/d,_(A,q+4,B+d),M!==null&&M.push(cn,q),q},zd:Nn,readValueFromPointer:ws,Ad(M){cn(M)}})}function P_(l,d){yn(l>>>=0,{Qd:!0,name:d=ln(d>>>0),zd:0,fromWireType:()=>{},toWireType:()=>{}})}function F_(l){$s(l>>>0,!s,1,!o,131072,!1),nu()}var xs=l=>{if(!ve)try{if(l(),!(0<An))try{a?ks(T):ps(T)}catch(d){d instanceof ds||d=="unwind"||v(0,d)}}catch(d){d instanceof ds||d=="unwind"||v(0,d)}};function Cs(l){l>>>=0,typeof Atomics.ge=="function"&&(Atomics.ge(R(),l>>>2,l).value.then(Hr),l+=128,Atomics.store(R(),l>>>2,1))}var Hr=()=>{var l=Jr();l&&(Cs(l),xs(tc))};function z_(l,d){(l>>>=0)==d>>>0?setTimeout(Hr):a?postMessage({Ed:l,yd:"checkMailbox"}):(l=Xn[l])&&l.postMessage({yd:"checkMailbox"})}var Es=[];function L_(l,d,h,g,_){for(d>>>=0,g/=2,Es.length=g,h=_>>>0>>>3,_=0;_<g;_++)Es[_]=L[h+2*_]?L[h+2*_+1]:zt()[h+2*_+1>>>0];return(d?cs[d]:Av[l])(...Es)}var B_=()=>{An=0};function j_(l){l>>>=0,a?postMessage({yd:"cleanupThread",ee:l}):tu(Xn[l])}function V_(l){}var Wr=(l,d)=>{var h=vs[l];if(h===void 0)throw l=Zu(l),h=ln(l),cn(l),new On(`${d} has unknown type ${h}`);return h},Su=(l,d,h)=>{var g=[];return l=l.toWireType(g,h),g.length&&(se()[d>>>2>>>0]=Zt(g)),l};function U_(l,d,h){return d>>>=0,h>>>=0,l=Lt(l>>>0),d=Wr(d,"emval::as"),Su(d,h,l)}function H_(l,d){return d>>>=0,l=Lt(l>>>0),(d=Wr(d,"emval::as")).toWireType(null,l)}var qr=l=>{try{l()}catch(d){bn(d)}},Pn=0,un=null,Du=0,Gr=[],Tu={},$u={},W_=0,Is=null,q_=[];function ku(l){return function(d){if(!ve){if(Pn===0){var h=!1,g=!1;d((_=0)=>{if(!ve&&(Du=_,h=!0,g)){Pn=2,qr(()=>Xc(un)),typeof MainLoop<"u"&&MainLoop.Md&&MainLoop.resume(),_=!1;try{var E=function(){var A=R()[un+8>>>2>>>0];return A=F[$u[A]],--An,A()}()}catch(A){E=A,_=!0}var D=!1;if(!un){var M=Is;M&&(Is=null,(_?M.reject:M.resolve)(E),D=!0)}if(_&&!D)throw E}}),g=!0,h||(Pn=1,un=function(){var _=Xr(65548),E=_+12;se()[_>>>2>>>0]=E,se()[_+4>>>2>>>0]=E+65536,E=Gr[0];var D=Tu[E];return D===void 0&&(D=W_++,Tu[E]=D,$u[D]=E),E=D,R()[_+8>>>2>>>0]=E,_}(),typeof MainLoop<"u"&&MainLoop.Md&&MainLoop.pause(),qr(()=>Yc(un)))}else Pn===2?(Pn=0,qr(ed),cn(un),un=null,q_.forEach(xs)):bn(`invalid state: ${Pn}`);return Du}}(d=>{l().then(d)})}function G_(l){return l>>>=0,ku(()=>J(this,null,function*(){var d=yield Lt(l);return Zt(d)}))}var Kr=[];function K_(l,d,h,g){return h>>>=0,g>>>=0,(l=Kr[l>>>0])(null,d=Lt(d>>>0),h,g)}var Z_={},Zr=l=>{var d=Z_[l];return d===void 0?ln(l):d};function Q_(l,d,h,g,_){return h>>>=0,g>>>=0,_>>>=0,(l=Kr[l>>>0])(d=Lt(d>>>0),d[h=Zr(h)],g,_)}var Mu=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Y_(l){return(l>>>=0)==0?Zt(Mu()):(l=Zr(l),Zt(Mu()[l]))}var J_=l=>{var d=Kr.length;return Kr.push(l),d},X_=(l,d)=>{for(var h=Array(l),g=0;g<l;++g)h[g]=Wr(se()[d+4*g>>>2>>>0],"parameter "+g);return h},Au=(l,d)=>Object.defineProperty(d,"name",{value:l});function ev(l,d,h){var g=(d=X_(l,d>>>0)).shift();l--;var _=`return function (obj, func, destructorsRef, args) {
`,E=0,D=[];h===0&&D.push("obj");for(var M=["retType"],A=[g],B=0;B<l;++B)D.push("arg"+B),M.push("argType"+B),A.push(d[B]),_+=`  var arg${B} = argType${B}.readValueFromPointer(args${E?"+"+E:""});
`,E+=d[B].zd;return _+=`  var rv = ${h===1?"new func":"func.call"}(${D.join(", ")});
`,g.Qd||(M.push("emval_returnValue"),A.push(Su),_+=`  return emval_returnValue(retType, destructorsRef, rv);
`),M.push(_+`};
`),l=function(q){var oe=Function;if(!(oe instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof oe} which is not a function`);var pe=Au(oe.name||"unknownFunctionName",function(){});return pe.prototype=oe.prototype,pe=new pe,(q=oe.apply(pe,q))instanceof Object?q:pe}(M)(...A),h=`methodCaller<(${d.map(q=>q.name).join(", ")}) => ${g.name}>`,J_(Au(h,l))}function tv(l){return l=Zr(l>>>0),Zt(n[l])}function nv(l,d){return d>>>=0,l=Lt(l>>>0),d=Lt(d),Zt(l[d])}function iv(l){9<(l>>>=0)&&(wn[l+1]+=1)}function rv(){return Zt([])}function ov(l){l=Lt(l>>>0);for(var d=Array(l.length),h=0;h<l.length;h++)d[h]=l[h];return Zt(d)}function sv(l){return Zt(Zr(l>>>0))}function av(){return Zt({})}function lv(l){for(var d=Lt(l>>>=0);d.length;){var h=d.pop();d.pop()(h)}ys(l)}function uv(l,d,h){d>>>=0,h>>>=0,l=Lt(l>>>0),d=Lt(d),h=Lt(h),l[d]=h}function cv(l,d){return d>>>=0,l=(l=Wr(l>>>0,"_emval_take_value")).readValueFromPointer(d),Zt(l)}function dv(l,d){l=-9007199254740992>l||9007199254740992<l?NaN:Number(l),d>>>=0,l=new Date(1e3*l),R()[d>>>2>>>0]=l.getUTCSeconds(),R()[d+4>>>2>>>0]=l.getUTCMinutes(),R()[d+8>>>2>>>0]=l.getUTCHours(),R()[d+12>>>2>>>0]=l.getUTCDate(),R()[d+16>>>2>>>0]=l.getUTCMonth(),R()[d+20>>>2>>>0]=l.getUTCFullYear()-1900,R()[d+24>>>2>>>0]=l.getUTCDay(),l=(l.getTime()-Date.UTC(l.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,R()[d+28>>>2>>>0]=l}var Ru=l=>l%4==0&&(l%100!=0||l%400==0),Ou=[0,31,60,91,121,152,182,213,244,274,305,335],Nu=[0,31,59,90,120,151,181,212,243,273,304,334];function fv(l,d){l=-9007199254740992>l||9007199254740992<l?NaN:Number(l),d>>>=0,l=new Date(1e3*l),R()[d>>>2>>>0]=l.getSeconds(),R()[d+4>>>2>>>0]=l.getMinutes(),R()[d+8>>>2>>>0]=l.getHours(),R()[d+12>>>2>>>0]=l.getDate(),R()[d+16>>>2>>>0]=l.getMonth(),R()[d+20>>>2>>>0]=l.getFullYear()-1900,R()[d+24>>>2>>>0]=l.getDay();var h=(Ru(l.getFullYear())?Ou:Nu)[l.getMonth()]+l.getDate()-1|0;R()[d+28>>>2>>>0]=h,R()[d+36>>>2>>>0]=-60*l.getTimezoneOffset(),h=new Date(l.getFullYear(),6,1).getTimezoneOffset();var g=new Date(l.getFullYear(),0,1).getTimezoneOffset();l=0|(h!=g&&l.getTimezoneOffset()==Math.min(g,h)),R()[d+32>>>2>>>0]=l}function hv(l){l>>>=0;var d=new Date(R()[l+20>>>2>>>0]+1900,R()[l+16>>>2>>>0],R()[l+12>>>2>>>0],R()[l+8>>>2>>>0],R()[l+4>>>2>>>0],R()[l>>>2>>>0],0),h=R()[l+32>>>2>>>0],g=d.getTimezoneOffset(),_=new Date(d.getFullYear(),6,1).getTimezoneOffset(),E=new Date(d.getFullYear(),0,1).getTimezoneOffset(),D=Math.min(E,_);return 0>h?R()[l+32>>>2>>>0]=+(_!=E&&D==g):0<h!=(D==g)&&(_=Math.max(E,_),d.setTime(d.getTime()+6e4*((0<h?D:_)-g))),R()[l+24>>>2>>>0]=d.getDay(),h=(Ru(d.getFullYear())?Ou:Nu)[d.getMonth()]+d.getDate()-1|0,R()[l+28>>>2>>>0]=h,R()[l>>>2>>>0]=d.getSeconds(),R()[l+4>>>2>>>0]=d.getMinutes(),R()[l+8>>>2>>>0]=d.getHours(),R()[l+12>>>2>>>0]=d.getDate(),R()[l+16>>>2>>>0]=d.getMonth(),R()[l+20>>>2>>>0]=d.getYear(),l=d.getTime(),BigInt(isNaN(l)?-1:l/1e3)}function Pu(l,d,h,g,_,E,D){return a?Le(16,1,l,d,h,g,_,E,D):-52}function Fu(l,d,h,g,_,E){if(a)return Le(17,1,l,d,h,g,_,E)}var Qi={},pv=()=>performance.timeOrigin+performance.now();function zu(l,d){if(a)return Le(18,1,l,d);if(Qi[l]&&(clearTimeout(Qi[l].id),delete Qi[l]),!d)return 0;var h=setTimeout(()=>{delete Qi[l],xs(()=>ec(l,performance.timeOrigin+performance.now()))},d);return Qi[l]={id:h,ke:d},0}function mv(l,d,h,g){l>>>=0,d>>>=0,h>>>=0,g>>>=0;var _=new Date().getFullYear(),E=new Date(_,0,1).getTimezoneOffset();_=new Date(_,6,1).getTimezoneOffset();var D=Math.max(E,_);se()[l>>>2>>>0]=60*D,R()[d>>>2>>>0]=+(E!=_),l=(d=M=>{var A=Math.abs(M);return`UTC${0<=M?"-":"+"}${String(Math.floor(A/60)).padStart(2,"0")}${String(A%60).padStart(2,"0")}`})(E),d=d(_),_<E?(yi(l,h,17),yi(d,g,17)):(yi(l,g,17),yi(d,h,17))}var gv=()=>Date.now(),_v=1;function vv(l,d,h){if(!(0<=l&&3>=l))return 28;if(l===0)l=Date.now();else{if(!_v)return 52;l=performance.timeOrigin+performance.now()}return L[h>>>0>>>3]=BigInt(Math.round(1e6*l)),0}var Ss=[],Lu=(l,d)=>{Ss.length=0;for(var h;h=xe()[l++>>>0];){var g=h!=105;d+=(g&=h!=112)&&d%8?4:0,Ss.push(h==112?se()[d>>>2>>>0]:h==106?L[d>>>3]:h==105?R()[d>>>2>>>0]:zt()[d>>>3>>>0]),d+=g?8:4}return Ss};function bv(l,d,h){return l>>>=0,d=Lu(d>>>0,h>>>0),cs[l](...d)}function yv(l,d,h){return l>>>=0,d=Lu(d>>>0,h>>>0),cs[l](...d)}var wv=()=>{};function xv(l,d){return y(et(l>>>0,d>>>0))}var Cv=()=>{throw An+=1,"unwind"};function Ev(){return 4294901760}var Iv=()=>navigator.hardwareConcurrency;function Sv(){return bn("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Dv(l){l>>>=0;var d=xe().length;if(l<=d||4294901760<l)return!1;for(var h=1;4>=h;h*=2){var g=d*(1+.2/h);g=Math.min(g,l+100663296);e:{g=(Math.min(4294901760,65536*Math.ceil(Math.max(l,g)/65536))-I.buffer.byteLength+65535)/65536|0;try{I.grow(g),Ot();var _=1;break e}catch{}_=void 0}if(_)return!0}return!1}var Qr=()=>(bn("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),wi={},Bu=l=>{l.forEach(d=>{var h=Qr();h&&(wi[h]=d)})};function Tv(){var l=Error().stack.toString().split(`
`);return l[0]=="Error"&&l.shift(),Bu(l),wi.Kd=Qr(),wi.ae=l,wi.Kd}function $v(l,d,h){if(l>>>=0,d>>>=0,wi.Kd==l)var g=wi.ae;else(g=Error().stack.toString().split(`
`))[0]=="Error"&&g.shift(),Bu(g);for(var _=3;g[_]&&Qr()!=l;)++_;for(l=0;l<h&&g[l+_];++l)R()[d+4*l>>>2>>>0]=Qr();return l}var Ds,Ts={},ju=()=>{if(!Ds){var l,d={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(l in Ts)Ts[l]===void 0?delete d[l]:d[l]=Ts[l];var h=[];for(l in d)h.push(`${l}=${d[l]}`);Ds=h}return Ds};function Vu(l,d){if(a)return Le(19,1,l,d);l>>>=0,d>>>=0;var h=0;return ju().forEach((g,_)=>{var E=d+h;for(_=se()[l+4*_>>>2>>>0]=E,E=0;E<g.length;++E)X()[_++>>>0]=g.charCodeAt(E);X()[_>>>0]=0,h+=g.length+1}),0}function Uu(l,d){if(a)return Le(20,1,l,d);l>>>=0,d>>>=0;var h=ju();se()[l>>>2>>>0]=h.length;var g=0;return h.forEach(_=>g+=_.length+1),se()[d>>>2>>>0]=g,0}function Hu(l){return a?Le(21,1,l):52}function Wu(l,d,h,g){return a?Le(22,1,l,d,h,g):52}function qu(l,d,h,g){return a?Le(23,1,l,d,h,g):70}var kv=[null,[],[]];function Gu(l,d,h,g){if(a)return Le(24,1,l,d,h,g);d>>>=0,h>>>=0,g>>>=0;for(var _=0,E=0;E<h;E++){var D=se()[d>>>2>>>0],M=se()[d+4>>>2>>>0];d+=8;for(var A=0;A<M;A++){var B=xe()[D+A>>>0],q=kv[l];B===0||B===10?((l===1?x:y)(lu(q)),q.length=0):q.push(B)}_+=M}return se()[g>>>2>>>0]=_,0}function Mv(l){return l>>>0}a||function(){for(var l=n.numThreads-1;l--;)ru();fs.unshift(()=>{Gi++,function(d){a?d():Promise.all(Rn.map(iu)).then(d)}(()=>Zl())})}();for(var Ku=Array(256),Yr=0;256>Yr;++Yr)Ku[Yr]=String.fromCharCode(Yr);Cu=Ku,On=n.BindingError=class extends Error{constructor(l){super(l),this.name="BindingError"}},n.InternalError=class extends Error{constructor(l){super(l),this.name="InternalError"}},wn.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=()=>wn.length/2-5-bs.length;var F,Av=[hs,Xl,ou,uu,cu,fu,hu,pu,mu,gu,_u,vu,bu,yu,wu,xu,Pu,Fu,zu,Vu,Uu,Hu,Wu,qu,Gu];(function(){return J(this,null,function*(){function l(g,_){return F=g.exports,F=function(){var E=F,D={};for(let[M,A]of Object.entries(E))D[M]=typeof A=="function"?(...B)=>{Gr.push(M);try{return A(...B)}finally{ve||(Gr.pop(),un&&Pn===1&&Gr.length===0&&(Pn=0,An+=1,qr(Jc),typeof Fibers<"u"&&Fibers.le()))}}:A;return D}(),F=function(){var E=F,D=A=>B=>A(B)>>>0,M=A=>()=>A()>>>0;return(E=Object.assign({},E)).Cb=D(E.Cb),E.fc=M(E.fc),E.ic=D(E.ic),E.vc=D(E.vc),E.wc=M(E.wc),E.Ac=D(E.Ac),E}(),eu.push(F.jc),S=_,Zl(),F}Gi++;var d=Ql();if(n.instantiateWasm)return new Promise(g=>{n.instantiateWasm(d,(_,E)=>{l(_,E),g(_.exports)})});if(a)return new Promise(g=>{Xe=_=>{var E=new WebAssembly.Instance(_,Ql());g(l(E,_))}});us??=n.locateFile?n.locateFile?n.locateFile("ort-wasm-simd-threaded.jsep.wasm",b):b+"ort-wasm-simd-threaded.jsep.wasm":new URL("ort-wasm-simd-threaded.jsep.wasm",import.meta.url).href;try{var h=yield function(g){return J(this,null,function*(){var _=us;if(!Y&&typeof WebAssembly.instantiateStreaming=="function"&&!we(_))try{var E=fetch(_,{credentials:"same-origin"});return yield WebAssembly.instantiateStreaming(E,g)}catch(D){y(`wasm streaming compile failed: ${D}`),y("falling back to ArrayBuffer instantiation")}return function(D,M){return J(this,null,function*(){try{var A=yield function(B){return J(this,null,function*(){if(!Y)try{var q=yield f(B);return new Uint8Array(q)}catch{}if(B==us&&Y)B=new Uint8Array(Y);else{if(!p)throw"both async and sync fetching of the wasm failed";B=p(B)}return B})}(D);return yield WebAssembly.instantiate(A,M)}catch(B){y(`failed to asynchronously prepare wasm: ${B}`),bn(B)}})}(_,g)})}(d);return l(h.instance,h.module)}catch(g){return i(g),Promise.reject(g)}})})();var Zu=l=>(Zu=F.Cb)(l),Qu=()=>(Qu=F.Db)();n._OrtInit=(l,d)=>(n._OrtInit=F.Eb)(l,d),n._OrtGetLastError=(l,d)=>(n._OrtGetLastError=F.Fb)(l,d),n._OrtCreateSessionOptions=(l,d,h,g,_,E,D,M,A,B)=>(n._OrtCreateSessionOptions=F.Gb)(l,d,h,g,_,E,D,M,A,B),n._OrtAppendExecutionProvider=(l,d)=>(n._OrtAppendExecutionProvider=F.Hb)(l,d),n._OrtAddFreeDimensionOverride=(l,d,h)=>(n._OrtAddFreeDimensionOverride=F.Ib)(l,d,h),n._OrtAddSessionConfigEntry=(l,d,h)=>(n._OrtAddSessionConfigEntry=F.Jb)(l,d,h),n._OrtReleaseSessionOptions=l=>(n._OrtReleaseSessionOptions=F.Kb)(l),n._OrtCreateSession=(l,d,h)=>(n._OrtCreateSession=F.Lb)(l,d,h),n._OrtReleaseSession=l=>(n._OrtReleaseSession=F.Mb)(l),n._OrtGetInputOutputCount=(l,d,h)=>(n._OrtGetInputOutputCount=F.Nb)(l,d,h),n._OrtGetInputName=(l,d)=>(n._OrtGetInputName=F.Ob)(l,d),n._OrtGetOutputName=(l,d)=>(n._OrtGetOutputName=F.Pb)(l,d),n._OrtFree=l=>(n._OrtFree=F.Qb)(l),n._OrtCreateTensor=(l,d,h,g,_,E)=>(n._OrtCreateTensor=F.Rb)(l,d,h,g,_,E),n._OrtGetTensorData=(l,d,h,g,_)=>(n._OrtGetTensorData=F.Sb)(l,d,h,g,_),n._OrtReleaseTensor=l=>(n._OrtReleaseTensor=F.Tb)(l),n._OrtCreateRunOptions=(l,d,h,g)=>(n._OrtCreateRunOptions=F.Ub)(l,d,h,g),n._OrtAddRunConfigEntry=(l,d,h)=>(n._OrtAddRunConfigEntry=F.Vb)(l,d,h),n._OrtReleaseRunOptions=l=>(n._OrtReleaseRunOptions=F.Wb)(l),n._OrtCreateBinding=l=>(n._OrtCreateBinding=F.Xb)(l),n._OrtBindInput=(l,d,h)=>(n._OrtBindInput=F.Yb)(l,d,h),n._OrtBindOutput=(l,d,h,g)=>(n._OrtBindOutput=F.Zb)(l,d,h,g),n._OrtClearBoundOutputs=l=>(n._OrtClearBoundOutputs=F._b)(l),n._OrtReleaseBinding=l=>(n._OrtReleaseBinding=F.$b)(l),n._OrtRunWithBinding=(l,d,h,g,_)=>(n._OrtRunWithBinding=F.ac)(l,d,h,g,_),n._OrtRun=(l,d,h,g,_,E,D,M)=>(n._OrtRun=F.bc)(l,d,h,g,_,E,D,M),n._OrtEndProfiling=l=>(n._OrtEndProfiling=F.cc)(l),n._JsepOutput=(l,d,h)=>(n._JsepOutput=F.dc)(l,d,h),n._JsepGetNodeName=l=>(n._JsepGetNodeName=F.ec)(l);var Jr=()=>(Jr=F.fc)(),cn=n._free=l=>(cn=n._free=F.gc)(l),Xr=n._malloc=l=>(Xr=n._malloc=F.ic)(l),$s=(l,d,h,g,_,E)=>($s=F.kc)(l,d,h,g,_,E),Yu=()=>(Yu=F.lc)(),Ju=(l,d,h,g,_)=>(Ju=F.mc)(l,d,h,g,_),Xu=l=>(Xu=F.nc)(l),ks=l=>(ks=F.oc)(l),ec=(l,d)=>(ec=F.pc)(l,d),tc=()=>(tc=F.qc)(),he=(l,d)=>(he=F.rc)(l,d),Yi=l=>(Yi=F.sc)(l),nc=(l,d)=>(nc=F.tc)(l,d),le=l=>(le=F.uc)(l),Ms=l=>(Ms=F.vc)(l),de=()=>(de=F.wc)(),ic=l=>(ic=F.xc)(l),rc=l=>(rc=F.yc)(l),oc=(l,d,h)=>(oc=F.zc)(l,d,h),sc=l=>(sc=F.Ac)(l),ac=n.dynCall_iii=(l,d,h)=>(ac=n.dynCall_iii=F.Bc)(l,d,h),lc=n.dynCall_vi=(l,d)=>(lc=n.dynCall_vi=F.Cc)(l,d),As=n.dynCall_ii=(l,d)=>(As=n.dynCall_ii=F.Dc)(l,d),uc=n.dynCall_vii=(l,d,h)=>(uc=n.dynCall_vii=F.Ec)(l,d,h),cc=n.dynCall_iiii=(l,d,h,g)=>(cc=n.dynCall_iiii=F.Fc)(l,d,h,g),dc=n.dynCall_viii=(l,d,h,g)=>(dc=n.dynCall_viii=F.Gc)(l,d,h,g),fc=n.dynCall_iiiii=(l,d,h,g,_)=>(fc=n.dynCall_iiiii=F.Hc)(l,d,h,g,_),hc=n.dynCall_viiii=(l,d,h,g,_)=>(hc=n.dynCall_viiii=F.Ic)(l,d,h,g,_),pc=n.dynCall_viiiiii=(l,d,h,g,_,E,D)=>(pc=n.dynCall_viiiiii=F.Jc)(l,d,h,g,_,E,D),mc=n.dynCall_viiiiiii=(l,d,h,g,_,E,D,M)=>(mc=n.dynCall_viiiiiii=F.Kc)(l,d,h,g,_,E,D,M),gc=n.dynCall_ji=(l,d)=>(gc=n.dynCall_ji=F.Lc)(l,d),_c=n.dynCall_v=l=>(_c=n.dynCall_v=F.Mc)(l),vc=n.dynCall_viiiii=(l,d,h,g,_,E)=>(vc=n.dynCall_viiiii=F.Nc)(l,d,h,g,_,E),bc=n.dynCall_i=l=>(bc=n.dynCall_i=F.Oc)(l),yc=n.dynCall_fii=(l,d,h)=>(yc=n.dynCall_fii=F.Pc)(l,d,h),wc=n.dynCall_viiiiiiii=(l,d,h,g,_,E,D,M,A)=>(wc=n.dynCall_viiiiiiii=F.Qc)(l,d,h,g,_,E,D,M,A),xc=n.dynCall_viiiiiiiiii=(l,d,h,g,_,E,D,M,A,B,q)=>(xc=n.dynCall_viiiiiiiiii=F.Rc)(l,d,h,g,_,E,D,M,A,B,q),Cc=n.dynCall_jiii=(l,d,h,g)=>(Cc=n.dynCall_jiii=F.Sc)(l,d,h,g),Ec=n.dynCall_dii=(l,d,h)=>(Ec=n.dynCall_dii=F.Tc)(l,d,h),Ic=n.dynCall_viiiiiiiii=(l,d,h,g,_,E,D,M,A,B)=>(Ic=n.dynCall_viiiiiiiii=F.Uc)(l,d,h,g,_,E,D,M,A,B),Sc=n.dynCall_viiiiiiiiiii=(l,d,h,g,_,E,D,M,A,B,q,oe)=>(Sc=n.dynCall_viiiiiiiiiii=F.Vc)(l,d,h,g,_,E,D,M,A,B,q,oe),Dc=n.dynCall_iiiiii=(l,d,h,g,_,E)=>(Dc=n.dynCall_iiiiii=F.Wc)(l,d,h,g,_,E),Tc=n.dynCall_iij=(l,d,h)=>(Tc=n.dynCall_iij=F.Xc)(l,d,h),$c=n.dynCall_iiiiiiiiii=(l,d,h,g,_,E,D,M,A,B)=>($c=n.dynCall_iiiiiiiiii=F.Yc)(l,d,h,g,_,E,D,M,A,B),kc=n.dynCall_iiiiiiiiiii=(l,d,h,g,_,E,D,M,A,B,q)=>(kc=n.dynCall_iiiiiiiiiii=F.Zc)(l,d,h,g,_,E,D,M,A,B,q),Mc=n.dynCall_vij=(l,d,h)=>(Mc=n.dynCall_vij=F._c)(l,d,h),Ac=n.dynCall_iiif=(l,d,h,g)=>(Ac=n.dynCall_iiif=F.$c)(l,d,h,g),Rc=n.dynCall_iiij=(l,d,h,g)=>(Rc=n.dynCall_iiij=F.ad)(l,d,h,g),Oc=n.dynCall_fiii=(l,d,h,g)=>(Oc=n.dynCall_fiii=F.bd)(l,d,h,g),Nc=n.dynCall_viiiiiiiiiiiii=(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>(Nc=n.dynCall_viiiiiiiiiiiii=F.cd)(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe),Pc=n.dynCall_vjiii=(l,d,h,g,_)=>(Pc=n.dynCall_vjiii=F.dd)(l,d,h,g,_),Fc=n.dynCall_vif=(l,d,h)=>(Fc=n.dynCall_vif=F.ed)(l,d,h),zc=n.dynCall_iiiiiii=(l,d,h,g,_,E,D)=>(zc=n.dynCall_iiiiiii=F.fd)(l,d,h,g,_,E,D),Lc=n.dynCall_iiiij=(l,d,h,g,_)=>(Lc=n.dynCall_iiiij=F.gd)(l,d,h,g,_),Bc=n.dynCall_iiiiiiii=(l,d,h,g,_,E,D,M)=>(Bc=n.dynCall_iiiiiiii=F.hd)(l,d,h,g,_,E,D,M),jc=n.dynCall_viiiiiiiiiiii=(l,d,h,g,_,E,D,M,A,B,q,oe,pe)=>(jc=n.dynCall_viiiiiiiiiiii=F.id)(l,d,h,g,_,E,D,M,A,B,q,oe,pe),Vc=n.dynCall_diii=(l,d,h,g)=>(Vc=n.dynCall_diii=F.jd)(l,d,h,g),Uc=n.dynCall_jiiii=(l,d,h,g,_)=>(Uc=n.dynCall_jiiii=F.kd)(l,d,h,g,_),Hc=n.dynCall_viiij=(l,d,h,g,_)=>(Hc=n.dynCall_viiij=F.ld)(l,d,h,g,_),Wc=n.dynCall_fiiii=(l,d,h,g,_)=>(Wc=n.dynCall_fiiii=F.md)(l,d,h,g,_),qc=n.dynCall_viiif=(l,d,h,g,_)=>(qc=n.dynCall_viiif=F.nd)(l,d,h,g,_),Gc=n.dynCall_diiii=(l,d,h,g,_)=>(Gc=n.dynCall_diiii=F.od)(l,d,h,g,_),Kc=n.dynCall_viiid=(l,d,h,g,_)=>(Kc=n.dynCall_viiid=F.pd)(l,d,h,g,_),Zc=n.dynCall_iiiijii=(l,d,h,g,_,E,D)=>(Zc=n.dynCall_iiiijii=F.qd)(l,d,h,g,_,E,D),Qc=n.dynCall_iiiiiij=(l,d,h,g,_,E,D)=>(Qc=n.dynCall_iiiiiij=F.rd)(l,d,h,g,_,E,D),Yc=l=>(Yc=F.sd)(l),Jc=()=>(Jc=F.td)(),Xc=l=>(Xc=F.ud)(l),ed=()=>(ed=F.vd)();function Rv(l,d,h){var g=de();try{uc(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function Ov(l,d,h){var g=de();try{return ac(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function Nv(l,d){var h=de();try{lc(l,d)}catch(g){if(le(h),g!==g+0)throw g;he(1,0)}}function Pv(l,d){var h=de();try{return As(l,d)}catch(g){if(le(h),g!==g+0)throw g;he(1,0)}}function Fv(l,d,h,g){var _=de();try{return cc(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;he(1,0)}}function zv(l,d,h,g,_){var E=de();try{hc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function Lv(l,d,h,g,_){var E=de();try{return fc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function Bv(l,d,h,g){var _=de();try{dc(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;he(1,0)}}function jv(l,d,h,g,_,E,D){var M=de();try{return zc(l,d,h,g,_,E,D)}catch(A){if(le(M),A!==A+0)throw A;he(1,0)}}function Vv(l){var d=de();try{_c(l)}catch(h){if(le(d),h!==h+0)throw h;he(1,0)}}function Uv(l,d,h){var g=de();try{return Tc(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function Hv(l,d,h,g,_,E){var D=de();try{vc(l,d,h,g,_,E)}catch(M){if(le(D),M!==M+0)throw M;he(1,0)}}function Wv(l,d,h){var g=de();try{Mc(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function qv(l,d,h,g,_,E,D){var M=de();try{pc(l,d,h,g,_,E,D)}catch(A){if(le(M),A!==A+0)throw A;he(1,0)}}function Gv(l,d,h,g,_,E,D,M){var A=de();try{mc(l,d,h,g,_,E,D,M)}catch(B){if(le(A),B!==B+0)throw B;he(1,0)}}function Kv(l,d,h,g,_,E){var D=de();try{return Dc(l,d,h,g,_,E)}catch(M){if(le(D),M!==M+0)throw M;he(1,0)}}function Zv(l,d,h,g,_,E,D,M){var A=de();try{return Bc(l,d,h,g,_,E,D,M)}catch(B){if(le(A),B!==B+0)throw B;he(1,0)}}function Qv(l,d,h,g,_,E,D,M,A,B){var q=de();try{Ic(l,d,h,g,_,E,D,M,A,B)}catch(oe){if(le(q),oe!==oe+0)throw oe;he(1,0)}}function Yv(l,d,h,g,_,E,D,M,A){var B=de();try{wc(l,d,h,g,_,E,D,M,A)}catch(q){if(le(B),q!==q+0)throw q;he(1,0)}}function Jv(l){var d=de();try{return bc(l)}catch(h){if(le(d),h!==h+0)throw h;he(1,0)}}function Xv(l,d,h,g,_,E,D,M,A,B){var q=de();try{return $c(l,d,h,g,_,E,D,M,A,B)}catch(oe){if(le(q),oe!==oe+0)throw oe;he(1,0)}}function eb(l,d,h){var g=de();try{return yc(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function tb(l,d,h,g){var _=de();try{return Cc(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;return he(1,0),0n}}function nb(l,d,h){var g=de();try{return Ec(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function ib(l,d,h,g,_,E,D,M,A,B,q,oe){var pe=de();try{Sc(l,d,h,g,_,E,D,M,A,B,q,oe)}catch(Pe){if(le(pe),Pe!==Pe+0)throw Pe;he(1,0)}}function rb(l,d,h,g,_,E,D,M,A,B,q){var oe=de();try{xc(l,d,h,g,_,E,D,M,A,B,q)}catch(pe){if(le(oe),pe!==pe+0)throw pe;he(1,0)}}function ob(l,d,h,g,_,E,D,M,A,B,q){var oe=de();try{return kc(l,d,h,g,_,E,D,M,A,B,q)}catch(pe){if(le(oe),pe!==pe+0)throw pe;he(1,0)}}function sb(l,d,h,g){var _=de();try{return Ac(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;he(1,0)}}function ab(l,d,h,g){var _=de();try{return Rc(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;he(1,0)}}function lb(l,d,h,g){var _=de();try{return Oc(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;he(1,0)}}function ub(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe){var Qt=de();try{Nc(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)}catch(Ji){if(le(Qt),Ji!==Ji+0)throw Ji;he(1,0)}}function cb(l,d,h,g,_){var E=de();try{Pc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function db(l,d,h){var g=de();try{Fc(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function fb(l,d){var h=de();try{return gc(l,d)}catch(g){if(le(h),g!==g+0)throw g;return he(1,0),0n}}function hb(l,d,h,g,_){var E=de();try{return Lc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function pb(l,d,h,g,_,E,D,M,A,B,q,oe,pe){var Pe=de();try{jc(l,d,h,g,_,E,D,M,A,B,q,oe,pe)}catch(Qt){if(le(Pe),Qt!==Qt+0)throw Qt;he(1,0)}}function mb(l,d,h,g){var _=de();try{return Vc(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;he(1,0)}}function gb(l,d,h,g,_){var E=de();try{return Uc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;return he(1,0),0n}}function _b(l,d,h,g,_){var E=de();try{Hc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function vb(l,d,h,g,_){var E=de();try{return Wc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function bb(l,d,h,g,_){var E=de();try{qc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function yb(l,d,h,g,_){var E=de();try{return Gc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function wb(l,d,h,g,_){var E=de();try{Kc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function xb(l,d,h,g,_,E,D){var M=de();try{return Zc(l,d,h,g,_,E,D)}catch(A){if(le(M),A!==A+0)throw A;he(1,0)}}function Cb(l,d,h,g,_,E,D){var M=de();try{return Qc(l,d,h,g,_,E,D)}catch(A){if(le(M),A!==A+0)throw A;he(1,0)}}return n.stackSave=()=>de(),n.stackRestore=l=>le(l),n.stackAlloc=l=>Ms(l),n.setValue=function(l,d,h="i8"){switch(h.endsWith("*")&&(h="*"),h){case"i1":case"i8":X()[l>>>0]=d;break;case"i16":z()[l>>>1>>>0]=d;break;case"i32":R()[l>>>2>>>0]=d;break;case"i64":L[l>>>3]=BigInt(d);break;case"float":Ke()[l>>>2>>>0]=d;break;case"double":zt()[l>>>3>>>0]=d;break;case"*":se()[l>>>2>>>0]=d;break;default:bn(`invalid type for setValue: ${h}`)}},n.getValue=function(l,d="i8"){switch(d.endsWith("*")&&(d="*"),d){case"i1":case"i8":return X()[l>>>0];case"i16":return z()[l>>>1>>>0];case"i32":return R()[l>>>2>>>0];case"i64":return L[l>>>3];case"float":return Ke()[l>>>2>>>0];case"double":return zt()[l>>>3>>>0];case"*":return se()[l>>>2>>>0];default:bn(`invalid type for getValue: ${d}`)}},n.UTF8ToString=et,n.stringToUTF8=yi,n.lengthBytesUTF8=du,function l(){if(0<Gi)Ki=l;else if(a)t(n),Vr();else{for(;0<fs.length;)fs.shift()(n);0<Gi?Ki=l:(n.calledRun=!0,ve||(Vr(),t(n)))}}(),n.PTR_SIZE=4,r})}),WN=Zx,GM=globalThis.self?.name?.startsWith("em-pthread"),GM&&Zx()}),Qx,KM,Si,qN,dg,ZM,QM,Yx,YM,Jx,GN,Xx,KN,tC=ue(()=>{"use strict";eC(),Qx=typeof location>"u"?void 0:location.origin,KM=()=>import.meta.url?.startsWith("file:")?new URL(new URL("ort.bundle.min.mjs",import.meta.url).href,Qx).href:import.meta.url,Si=KM(),qN=()=>{if(Si&&!Si.startsWith("blob:"))return Si.substring(0,Si.lastIndexOf("/")+1)},dg=(e,t)=>{try{let i=t??Si;return(i?new URL(e,i):new URL(e)).origin===Qx}catch{return!1}},ZM=(e,t)=>{let i=t??Si;try{return(i?new URL(e,i):new URL(e)).href}catch{return}},QM=(e,t)=>`${t??"./"}${e}`,Yx=e=>J(void 0,null,function*(){let t=yield(yield fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)}),YM=e=>J(void 0,null,function*(){return(yield import(e)).default}),Jx=(pJ(),Sg(VN)).default,GN=()=>J(void 0,null,function*(){if(!Si)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(dg(Si))return[void 0,Jx()];let e=yield Yx(Si);return[e,Jx(e)]}),Xx=(mJ(),Sg(HN)).default,KN=(e,t,i)=>J(void 0,null,function*(){if(!e&&!t&&Xx&&Si&&dg(Si))return[void 0,Xx];{let n="ort-wasm-simd-threaded.jsep.mjs",r=e??ZM(n,t),o=i&&r&&!dg(r,t),s=o?yield Yx(r):r??QM(n,t);return[o?s:void 0,yield YM(s)]}})}),e1,fg,gf,t1,JM,XM,nC,En,ba=ue(()=>{"use strict";tC(),fg=!1,gf=!1,t1=!1,JM=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},XM=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},nC=e=>J(void 0,null,function*(){if(fg)return Promise.resolve();if(gf)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(t1)throw new Error("previous call to 'initializeWebAssembly()' failed.");gf=!0;let t=e.initTimeout,i=e.numThreads;if(!XM())throw new Error("WebAssembly SIMD is not supported in the current environment.");let n=JM();i>1&&!n&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+i+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=i=1);let r=e.wasmPaths,o=typeof r=="string"?r:void 0,s=r?.mjs,a=s?.href??s,u=r?.wasm,c=u?.href??u,f=e.wasmBinary,[p,m]=yield KN(a,o,i>1),v=!1,b=[];if(t>0&&b.push(new Promise(w=>{setTimeout(()=>{v=!0,w()},t)})),b.push(new Promise((w,C)=>{let x={numThreads:i};if(f)x.wasmBinary=f;else if(c||o)x.locateFile=y=>c??o+y;else if(a&&a.indexOf("blob:")!==0)x.locateFile=y=>new URL(y,a).href;else if(p){let y=qN();y&&(x.locateFile=I=>y+I)}m(x).then(y=>{gf=!1,fg=!0,e1=y,w(),p&&URL.revokeObjectURL(p)},y=>{gf=!1,t1=!0,C(y)})})),yield Promise.race(b),v)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)}),En=()=>{if(fg&&e1)return e1;throw new Error("WebAssembly is not initialized yet.")}}),jn,Tg,It,iC=ue(()=>{"use strict";ba(),jn=(e,t)=>{let i=En(),n=i.lengthBytesUTF8(e)+1,r=i._malloc(n);return i.stringToUTF8(e,r,n),t.push(r),r},Tg=(e,t,i,n)=>{if(typeof e=="object"&&e!==null){if(i.has(e))throw new Error("Circular reference in options");i.add(e)}Object.entries(e).forEach(([r,o])=>{let s=t?t+r:r;if(typeof o=="object")Tg(o,s+".",i,n);else if(typeof o=="string"||typeof o=="number")n(s,o.toString());else if(typeof o=="boolean")n(s,o?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof o}`)})},It=e=>{let t=En(),i=t.stackSave();try{let n=t.PTR_SIZE,r=t.stackAlloc(2*n);t._OrtGetLastError(r,r+n);let o=Number(t.getValue(r,n===4?"i32":"i64")),s=t.getValue(r+n,"*"),a=s?t.UTF8ToString(s):"";throw new Error(`${e} ERROR_CODE: ${o}, ERROR_MESSAGE: ${a}`)}finally{t.stackRestore(i)}}}),ZN,gJ=ue(()=>{"use strict";ba(),iC(),ZN=e=>{let t=En(),i=0,n=[],r=e||{};try{if(e?.logSeverityLevel===void 0)r.logSeverityLevel=2;else if(typeof e.logSeverityLevel!="number"||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${e.logSeverityLevel}`);if(e?.logVerbosityLevel===void 0)r.logVerbosityLevel=0;else if(typeof e.logVerbosityLevel!="number"||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);e?.terminate===void 0&&(r.terminate=!1);let o=0;return e?.tag!==void 0&&(o=jn(e.tag,n)),i=t._OrtCreateRunOptions(r.logSeverityLevel,r.logVerbosityLevel,!!r.terminate,o),i===0&&It("Can't create run options."),e?.extra!==void 0&&Tg(e.extra,"",new WeakSet,(s,a)=>{let u=jn(s,n),c=jn(a,n);t._OrtAddRunConfigEntry(i,u,c)!==0&&It(`Can't set a run config entry: ${s} - ${a}.`)}),[i,n]}catch(o){throw i!==0&&t._OrtReleaseRunOptions(i),n.forEach(s=>t._free(s)),o}}}),eA,tA,nA,iA,QN,_J=ue(()=>{"use strict";ba(),iC(),eA=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},tA=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},nA=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(i=>(typeof i=="string"?i:i.name)==="webgpu")&&(e.enableMemPattern=!1)},iA=(e,t,i)=>{for(let n of t){let r=typeof n=="string"?n:n.name;switch(r){case"webnn":if(r="WEBNN",typeof n!="string"){let s=n?.deviceType;if(s){let a=jn("deviceType",i),u=jn(s,i);En()._OrtAddSessionConfigEntry(e,a,u)!==0&&It(`Can't set a session config entry: 'deviceType' - ${s}.`)}}break;case"webgpu":if(r="JS",typeof n!="string"){let s=n;if(s?.preferredLayout){if(s.preferredLayout!=="NCHW"&&s.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${s.preferredLayout}`);let a=jn("preferredLayout",i),u=jn(s.preferredLayout,i);En()._OrtAddSessionConfigEntry(e,a,u)!==0&&It(`Can't set a session config entry: 'preferredLayout' - ${s.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${r}`)}let o=jn(r,i);En()._OrtAppendExecutionProvider(e,o)!==0&&It(`Can't append execution provider: ${r}.`)}},QN=e=>{let t=En(),i=0,n=[],r=e||{};nA(r);try{let o=eA(r.graphOptimizationLevel??"all"),s=tA(r.executionMode??"sequential"),a=typeof r.logId=="string"?jn(r.logId,n):0,u=r.logSeverityLevel??2;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log serverity level is not valid: ${u}`);let c=r.logVerbosityLevel??0;if(!Number.isInteger(c)||c<0||c>4)throw new Error(`log verbosity level is not valid: ${c}`);let f=typeof r.optimizedModelFilePath=="string"?jn(r.optimizedModelFilePath,n):0;if(i=t._OrtCreateSessionOptions(o,!!r.enableCpuMemArena,!!r.enableMemPattern,s,!!r.enableProfiling,0,a,u,c,f),i===0&&It("Can't create session options."),r.executionProviders&&iA(i,r.executionProviders,n),r.enableGraphCapture!==void 0){if(typeof r.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${r.enableGraphCapture}`);let p=jn("enableGraphCapture",n),m=jn(r.enableGraphCapture.toString(),n);t._OrtAddSessionConfigEntry(i,p,m)!==0&&It(`Can't set a session config entry: 'enableGraphCapture' - ${r.enableGraphCapture}.`)}if(r.freeDimensionOverrides)for(let[p,m]of Object.entries(r.freeDimensionOverrides)){if(typeof p!="string")throw new Error(`free dimension override name must be a string: ${p}`);if(typeof m!="number"||!Number.isInteger(m)||m<0)throw new Error(`free dimension override value must be a non-negative integer: ${m}`);let v=jn(p,n);t._OrtAddFreeDimensionOverride(i,v,m)!==0&&It(`Can't set a free dimension override: ${p} - ${m}.`)}return r.extra!==void 0&&Tg(r.extra,"",new WeakSet,(p,m)=>{let v=jn(p,n),b=jn(m,n);t._OrtAddSessionConfigEntry(i,v,b)!==0&&It(`Can't set a session config entry: ${p} - ${m}.`)}),[i,n]}catch(o){throw i!==0&&t._OrtReleaseSessionOptions(i)!==0&&It("Can't release session options."),n.forEach(s=>t._free(s)),o}}}),zl,pa,ma,rC,$g,oC,sC,z1,Fe=ue(()=>{"use strict";zl=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},pa=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},ma=(e,t)=>{let i=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],n=typeof t=="number"?t:t.reduce((r,o)=>r*o,1);return i>0?Math.ceil(n*i):void 0},rC=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},$g=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},oC=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",sC=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint64"||e==="int8"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",z1=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),aC,YN=ue(()=>{"use strict";eC(),aC=e=>J(void 0,null,function*(){if(typeof e=="string")if(0)try{}catch(o){if(o.code==="ERR_FS_FILE_TOO_LARGE")try{for(var t=KY(a),i,n,r;i=!(n=yield t.next()).done;i=!1){let c=n.value;;}}catch(n){r=[n]}finally{try{i&&(n=t.return)&&(yield n.call(t))}finally{if(r)throw r[0]}}}else{let o=yield fetch(e);if(!o.ok)throw new Error(`failed to load external data file: ${e}`);let s=o.headers.get("Content-Length"),a=s?parseInt(s,10):0;if(a<1073741824)return new Uint8Array(yield o.arrayBuffer());{if(!o.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let u=o.body.getReader(),c;try{c=new ArrayBuffer(a)}catch(p){if(p instanceof RangeError){let m=Math.ceil(a/65536);c=new WebAssembly.Memory({initial:m,maximum:m}).buffer}else throw p}let f=0;for(;;){let{done:p,value:m}=yield u.read();if(p)break;let v=m.byteLength;new Uint8Array(c,f,v).set(m),f+=v}return new Uint8Array(c,0,a)}}else return e instanceof Blob?new Uint8Array(yield e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)})}),rA,oA,sA,aA,lC,lA,pt,yo=ue(()=>{"use strict";Fe(),rA=["V","I","W","E","F"],oA=(e,t)=>{console.log(`[${rA[e]},${new Date().toISOString()}]${t}`)},lC=(e,t)=>{sA=e,aA=t},lA=(e,t)=>{let i=$g(e),n=$g(sA);i>=n&&oA(i,typeof t=="function"?t():t)},pt=(...e)=>{aA&&lA(...e)}}),uC,JN=ue(()=>{"use strict";Fe(),uC=(e,t)=>new(rC(t))(e)}),cC=ue(()=>{"use strict"}),n1,hg,pg,uA,cA,i1,L1,dA,XN,vJ=ue(()=>{"use strict";yo(),cC(),n1=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),hg=[],pg=e=>Math.ceil(Number(e)/16)*16,uA=e=>{for(let t=0;t<hg.length;t++){let i=hg[t];if(e<=i)return i}return Math.ceil(e/16)*16},cA=1,i1=()=>cA++,L1=(e,t,i,n)=>J(void 0,null,function*(){let r=pg(i),o=e.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let s=e.getCommandEncoder();e.endComputePass(),s.copyBufferToBuffer(t,0,o,0,r),e.flush(),yield o.mapAsync(GPUMapMode.READ);let a=o.getMappedRange();if(n){let u=n();return u.set(new Uint8Array(a,0,i)),u}else return new Uint8Array(a.slice(0,i))}finally{o.destroy()}}),dA=class{constructor(e){this.backend=e,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[t]of n1)hg.push(t),this.freeBuffers.set(t,[]),this.freeUniformBuffers.set(t,[]);this.sessionCount=0}upload(e,t){let i=t.buffer,n=t.byteOffset,r=t.byteLength,o=pg(r),s=this.storageCache.get(e);if(!s)throw new Error("gpu data for uploading does not exist");if(Number(s.originalSize)!==r)throw new Error(`inconsistent data size. gpu data size=${s.originalSize}, data size=${r}`);let a=this.backend.device.createBuffer({mappedAtCreation:!0,size:o,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),u=a.getMappedRange();new Uint8Array(u).set(new Uint8Array(i,n,r)),a.unmap();let c=this.backend.device.createCommandEncoder();c.copyBufferToBuffer(a,0,s.gpuData.buffer,0,o),this.backend.device.queue.submit([c.finish()]),a.destroy(),pt("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${e})`)}memcpy(e,t){let i=this.storageCache.get(e);if(!i)throw new Error("source gpu data for memcpy does not exist");let n=this.storageCache.get(t);if(!n)throw new Error("destination gpu data for memcpy does not exist");if(i.originalSize!==n.originalSize)throw new Error("inconsistent source and destination gpu data size");let r=pg(i.originalSize),o=this.backend.getCommandEncoder();this.backend.endComputePass(),o.copyBufferToBuffer(i.gpuData.buffer,0,n.gpuData.buffer,0,r)}registerExternalBuffer(e,t,i){let n;if(i){if(n=i[0],e===i[1])return pt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${n}, buffer is the same, skip.`),n;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else n=i1();return this.storageCache.set(n,{gpuData:{id:n,type:0,buffer:e},originalSize:t}),pt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${n}, registered.`),n}unregisterExternalBuffer(e){e!==void 0&&(this.storageCache.delete(e),pt("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${e}`))}create(e,t=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let i=uA(e),n,r=(t&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,o=(t&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(r||o){let a=(r?this.freeBuffers:this.freeUniformBuffers).get(i);a?a.length>0?n=a.pop():n=this.backend.device.createBuffer({size:i,usage:t}):n=this.backend.device.createBuffer({size:i,usage:t})}else n=this.backend.device.createBuffer({size:i,usage:t});let s={id:i1(),type:0,buffer:n};return this.storageCache.set(s.id,{gpuData:s,originalSize:Number(e)}),pt("verbose",()=>`[WebGPU] GpuDataManager.create(size=${e}) => id=${s.id}`),s}get(e){return this.storageCache.get(e)?.gpuData}release(e){let t=typeof e=="bigint"?Number(e):e,i=this.storageCache.get(t);if(!i){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return pt("verbose",()=>`[WebGPU] GpuDataManager.release(id=${t}), gpuDataId=${i.gpuData.id}`),this.storageCache.delete(t),this.buffersPending.push(i.gpuData.buffer),i.originalSize}download(e,t){return J(this,null,function*(){let i=this.storageCache.get(Number(e));if(!i)throw new Error("data does not exist");yield L1(this.backend,i.gpuData.buffer,i.originalSize,t)})}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let e of this.buffersPending){let t=n1.get(e.size);if((e.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let i=this.freeBuffers.get(e.size)||[];t===void 0||i.length>=t?e.destroy():i.push(e)}else if((e.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let i=this.freeUniformBuffers.get(e.size)||[];t===void 0||i.length>=t?e.destroy():i.push(e)}else e.destroy()}this.buffersPending=[]}else{let e=this.capturedPendingBuffers.get(this.backend.currentSessionId);e||(e=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,e));for(let t of this.buffersPending)e.push(t);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.freeUniformBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(e){let t=this.capturedPendingBuffers.get(e);t&&(t.forEach(i=>{i.destroy()}),this.capturedPendingBuffers.delete(e)),this.sessionCount-=1,this.sessionCount===0&&(pt("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(i=>{i.gpuData.buffer.destroy()}),this.storageCache=new Map)}},XN=(...e)=>new dA(...e)}),fA,$t,on=ue(()=>{"use strict";fA=class{constructor(e){Object.assign(this,e)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(e=>`${this[e]}`).join(";")),this.key}},$t=e=>new fA(e)}),hA,jl,Z,kg,e3,t3,n3,Ue=ue(()=>{"use strict";hA=class{static calcMatMulShape(e,t){return e[1]!==t[0]?void 0:[e[0],t[1]]}},jl=class{static calcShape(e,t,i=!1){let n=e.length,r=t.length;if(n===0)return t;if(r===0)return e;let o=Math.max(e.length,t.length),s=new Array(o);if(i){if(n<2||r<2)return;let a=hA.calcMatMulShape([e[n-2],e[n-1]],[t[r-2],t[r-1]]);if(a===void 0)return;[s[o-2],s[o-1]]=a}for(let a=i?3:1;a<=o;a++){let u=n-a<0?1:e[n-a],c=r-a<0?1:t[r-a];if(u!==c&&u>1&&c>1)return;let f=Math.max(u,c);if(u&&c)s[o-a]=Math.max(u,c);else{if(f>1)return;s[o-a]=0}}return s}static isValidBroadcast(e,t){let i=e.length,n=t.length;if(i>n)return!1;for(let r=1;r<=i;r++)if(e[i-r]!==1&&e[i-r]!==t[n-r])return!1;return!0}},Z=class Eg{static size(t){return Eg.getSizeFromDimensionRange(t,0,t.length)}static convertShape(t,i=4){let n=t.length;if(n===0)return[];let r=new Array(n),o=n-1;for(;o>=0;){if(t[o]%i===0){r[o]=t[o]/i;break}if(i%t[o]!==0)throw new Error("cannot convert shape");r[o]=1,i/=t[o],o--}for(o--;o>=0;o--)r[o]=t[o];return r}static sizeFromDimension(t,i){if(i<0||i>t.length)throw new Error(`invalid dimension of ${i} for sizeFromDimension as Tensor has ${t.length} dimensions.`);return Eg.getSizeFromDimensionRange(t,i,t.length)}static sizeToDimension(t,i){if(i<0||i>t.length)throw new Error(`invalid dimension of ${i} for sizeToDimension as Tensor has ${t.length} dimensions.`);return Eg.getSizeFromDimensionRange(t,0,i)}static getSizeFromDimensionRange(t,i,n){let r=1;for(let o=i;o<n;o++){if(t[o]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");r*=Number(t[o])}return r}static computeStrides(t){let i=t.length;if(i===0)return[];if(i===1)return[1];let n=new Array(i);n[i-1]=1,n[i-2]=t[i-1];for(let r=i-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}static normalizeAxis(t,i){if(t<-i&&t>=i)throw new Error("unsupported axis for this operation.");return t<0?t+i:t}static normalizeAxes(t,i){return t.map(n=>this.normalizeAxis(n,i??t.length))}static sortBasedOnPerm(t,i){return i?i.map(n=>t[n]):t.slice().reverse()}static padShape(t,i){let n=t.length;return t.map((r,o)=>r+i[o]+i[o+n])}static areEqual(t,i){return t.length!==i.length?!1:t.every((n,r)=>n===i[r])}},kg=class If{static adjustPoolAttributes(t,i,n,r,o,s){if(!t&&n.length!==i.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(t)for(let a=0;a<i.length-2;a++)a>=n.length?n.push(i[a+2]):n[a]=i[a+2];for(let a=0;a<n.length;a++)if(a<r.length){if(r[a]<0)throw new Error("strides should be greater than or equal to 1")}else r.push(1);for(let a=0;a<n.length;a++)if(a<o.length){if(o[a]<0)throw new Error("dilations should be greater than or equal to 1")}else o.push(1);for(let a=0;a<n.length*2;a++)if(a<s.length){if(s[a]<0)throw new Error("pad should be greater than or equal to 1")}else s.push(0);for(let a=0;a<n.length;a++){if(n[a]<=0)throw new Error("kernel shapes need to be greater than 0");if(s[a]>=n[a]||s[a+n.length]>=n[a])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(t,i,n,r,o,s,a){if(a){if(o.length!==2*(t.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(i.length!==t.length-2)throw new Error("length of strides should be the length of data dimensions");if(r.length!==t.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let u=0;u<t.length-2;u++)If.adjustPadAndReturnShape(t[u+(s?1:2)],i[u],n[u],r[u],o,u,u+t.length-2,a)}}static computePoolOutputShape(t,i,n,r,o,s,a){if(i.length<=0)throw new Error("input shape must be of size greater than 0");let u=[i[0],i[1]];return If.computeShapeHelper(t,i,u,n,r,o,s,a),u}static computeConvOutputShape(t,i,n,r,o,s,a){if(t.length<=0||i.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let u=[t[0],i[0]];return If.computeShapeHelper(!1,t,u,n,r,o,s,a),u}static computeShapeHelper(t,i,n,r,o,s,a,u){if(t)for(let c=0;c<i.length-2;c++)n.push(1);else for(let c=0;c<i.length-2;c++)n.push(If.adjustPadAndReturnShape(i[c+2],r[c],o[c],s[c],a,c,c+i.length-2,u))}static adjustPadAndReturnShape(t,i,n,r,o,s,a,u){let c=n*(r-1)+1;if(u&&u!=="NOTSET")switch(u){case"VALID":return o[s]=0,o[a]=0,Math.floor((t-c)/i+1);case"SAME_LOWER":case"SAME_UPPER":if(n!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let f=((t+i-1)/i-1)*i+r-t;return o[s]=Math.floor(u==="SAME_LOWER"?(f+1)/2:f/2),o[a]=f-o[s],Math.floor((t+f-r)/i+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((t+o[s]+o[a]-c)/i+1)}},e3=class{static getShapeOfGemmResult(e,t,i,n,r){if(e.length!==2||i.length!==2)throw new Error("shape need to be of size 2");let o,s,a;t?(o=e[1],s=e[0]):(o=e[0],s=e[1]);let u=-1;if(n?(a=i[0],u=1):(a=i[1],u=0),i[u]!==s)throw new Error("dimension mismatch");if(o<=0||a<=0||s<=0)throw new Error("invalid shape specified");if(r&&!jl.isValidBroadcast(r,[o,a]))throw new Error("gemm: invalid bias shape for broadcast");return[o,a,s]}},t3=-34028234663852886e22,n3=34028234663852886e22}),Vl,mg,In,Yn,Te,en,B1,Bl,ns,Se,_f,ee,Ee,i3,dC,pA,r3,Qe=ue(()=>{"use strict";Fe(),Ue(),Vl=64,mg=(e,t)=>{if(t===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(e)){case 10:return t>1?`vec${t}<f16>`:"f16";case 1:return t>1?`vec${t}<f32>`:"f32";case 6:return t>1?`vec${t}<i32>`:"i32";case 12:return t>1?`vec${t}<u32>`:"u32";case 7:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(t!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${e}`)}},In=(e,t=1)=>{let i=mg(e,t);return typeof i=="string"?i:i[0]},Yn=(e,t=1)=>{let i=mg(e,t);return typeof i=="string"?i:i[1]},Te=(...e)=>{let t=[];return e.forEach(i=>{i.length!==0&&t.push({type:12,data:i},{type:12,data:Z.computeStrides(i)})}),t},en=e=>e%4===0?4:e%2===0?2:1,B1=(e="f32",t,i="0")=>!t||t===1?`${e}(${i})`:`vec${t}<${e}>(${i})`,Bl=(e,t,i)=>e==="f32"?i:t===1?`f32(${i})`:`vec${t}<f32>(${i})`,ns=(e,t)=>t===4?`(${e}.x + ${e}.y + ${e}.z + ${e}.w)`:t===2?`(${e}.x + ${e}.y)`:t===3?`(${e}.x + ${e}.y + ${e}.z)`:e,Se=(e,t,i,n)=>e.startsWith("uniforms.")&&i>4?typeof t=="string"?n==="f16"?`${e}[(${t}) / 8][(${t}) % 8 / 4][(${t}) % 8 % 4]`:`${e}[(${t}) / 4][(${t}) % 4]`:n==="f16"?`${e}[${Math.floor(t/8)}][${Math.floor(t%8/4)}][${t%8%4}]`:`${e}[${Math.floor(t/4)}][${t%4}]`:i>1?`${e}[${t}]`:e,_f=(e,t,i,n,r)=>{let o=typeof i=="number",s=o?i:i.length,a=[...new Array(s).keys()],u=s<2?"u32":s<=4?`vec${s}<u32>`:`array<u32, ${s}>`,c=mg(t,r),f=typeof c=="string"?c:c[1],p=typeof c=="string"?c:c[0],m={indices:u,value:f,storage:p,tensor:t},v=z=>typeof z=="string"?z:`${z}u`,b={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},w=o?"uniforms.":"",C=`${w}${e}_shape`,x=`${w}${e}_strides`,y="";for(let z=0;z<s-1;z++)y+=`
    let dim${z} = current / ${Se(x,z,s)};
    let rest${z} = current % ${Se(x,z,s)};
    indices[${z}] = dim${z};
    current = rest${z};
    `;y+=`indices[${s-1}] = current;`;let I=s<2?"":`
  fn o2i_${e}(offset: u32) -> ${m.indices} {
    var indices: ${m.indices};
    var current = offset;
    ${y}
    return indices;
  }`,S=z=>(b.offsetToIndices=!0,s<2?z:`o2i_${e}(${z})`),T=[];if(s>=2)for(let z=s-1;z>=0;z--)T.push(`${Se(x,z,s)} * (indices[${z}])`);let $=s<2?"":`
  fn i2o_${e}(indices: ${m.indices}) -> u32 {
    return ${T.join("+")};
  }`,k=z=>(b.indicesToOffset=!0,s<2?z:`i2o_${e}(${z})`),P=(...z)=>s===0?"0u":`${m.indices}(${z.map(v).join(",")})`,j=(z,W)=>s<2?`${z}`:`${Se(z,W,s)}`,H=(z,W,R)=>s<2?`${z}=${R};`:`${Se(z,W,s)}=${R};`,re={},ae=(z,W)=>{b.broadcastedIndicesToOffset=!0;let R=`${W.name}broadcastedIndicesTo${e}Offset`;if(R in re)return`${R}(${z})`;let se=[];for(let Ke=s-1;Ke>=0;Ke--){let zt=W.indicesGet("outputIndices",Ke+W.rank-s);se.push(`${j(x,Ke)} * (${zt} % ${j(C,Ke)})`)}return re[R]=`fn ${R}(outputIndices: ${W.type.indices}) -> u32 {
             return ${se.length>0?se.join("+"):"0u"};
           }`,`${R}(${z})`},L=(z,W)=>(()=>{if(m.storage===m.value)return`${e}[${z}]=${W};`;if(m.storage==="vec2<u32>"&&m.value==="i32")return`${e}[${z}]=vec2<u32>(u32(${W}), select(0u, 0xFFFFFFFFu, ${W} < 0));`;if(m.storage==="vec2<u32>"&&m.value==="u32")return`${e}[${z}]=vec2<u32>(u32(${W}), 0u);`;if(m.storage==="u32"&&m.value==="vec4<bool>")return`${e}[${z}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${W}));`;throw new Error(`not supported combination of storage type ${m.storage} and value type ${m.value} yet`)})(),ge=z=>(()=>{if(m.storage===m.value)return`${e}[${z}]`;if(m.storage==="vec2<u32>"&&m.value==="i32")return`i32(${e}[${z}].x)`;if(m.storage==="vec2<u32>"&&m.value==="u32")return`u32(${e}[${z}].x)`;if(m.storage==="u32"&&m.value==="vec4<bool>")return`vec4<bool>(bool(${e}[${z}] & 0xFFu), bool(${e}[${z}] & 0xFF00u), bool(${e}[${z}] & 0xFF0000u), bool(${e}[${z}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${m.storage} and value type ${m.value} yet`)})(),ye=s<2?"":`
  fn get_${e}ByIndices(indices: ${m.indices}) -> ${f} {
    return ${ge(`i2o_${e}(indices)`)};
  }`,Y=s<2?"":(()=>{let z=a.map(R=>`d${R}: u32`).join(", "),W=a.map(R=>`d${R}`).join(", ");return`
  fn get_${e}(${z}) -> ${f} {
    return get_${e}ByIndices(${P(W)});
  }`})(),ve=(...z)=>{if(z.length!==s)throw new Error(`indices length must be ${s}`);let W=z.map(v).join(",");return s===0?ge("0u"):s===1?ge(W[0]):(b.get=!0,b.getByIndices=!0,b.indicesToOffset=!0,`get_${e}(${W})`)},we=z=>s<2?ge(z):(b.getByIndices=!0,b.indicesToOffset=!0,`get_${e}ByIndices(${z})`),X=s<2?"":`
  fn set_${e}ByIndices(indices: ${m.indices}, value: ${f}) {
    ${L(`i2o_${e}(indices)`,"value")}
  }`,xe=s<2?"":(()=>{let z=a.map(R=>`d${R}: u32`).join(", "),W=a.map(R=>`d${R}`).join(", ");return`
  fn set_${e}(${z}, value: ${f}) {
    set_${e}ByIndices(${P(W)}, value);
  }`})();return{impl:()=>{let z=[],W=!1;return b.offsetToIndices&&(z.push(I),W=!0),b.indicesToOffset&&(z.push($),W=!0),b.broadcastedIndicesToOffset&&(Object.values(re).forEach(R=>z.push(R)),W=!0),b.set&&(z.push(xe),W=!0),b.setByIndices&&(z.push(X),W=!0),b.get&&(z.push(Y),W=!0),b.getByIndices&&(z.push(ye),W=!0),!o&&W&&z.unshift(`const ${C} = ${m.indices}(${i.join(",")});`,`const ${x} = ${m.indices}(${Z.computeStrides(i).join(",")});`),z.join(`
`)},type:m,offsetToIndices:S,indicesToOffset:k,broadcastedIndicesToOffset:ae,indices:P,indicesGet:j,indicesSet:H,set:(...z)=>{if(z.length!==s+1)throw new Error(`indices length must be ${s}`);let W=z[s];if(typeof W!="string")throw new Error("value must be string");let R=z.slice(0,s).map(v).join(",");return s===0?L("0u",W):s===1?L(R[0],W):(b.set=!0,b.setByIndices=!0,b.indicesToOffset=!0,`set_${e}(${R}, ${W})`)},setByOffset:L,setByIndices:(z,W)=>s<2?L(z,W):(b.setByIndices=!0,b.indicesToOffset=!0,`set_${e}ByIndices(${z}, ${W});`),get:ve,getByOffset:ge,getByIndices:we,usage:n,name:e,strides:x,shape:C,rank:s}},ee=(e,t,i,n=1)=>_f(e,t,i,"input",n),Ee=(e,t,i,n=1)=>_f(e,t,i,"output",n),i3=(e,t,i)=>_f(e,t,i,"atomicOutput",1),dC=(e,t,i,n=1)=>_f(e,t,i,"internal",n),pA=class{constructor(e,t){this.normalizedDispatchGroup=e,this.limits=t,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(e){return`if (global_idx >= ${typeof e=="number"?`${e}u`:e}) { return; }`}mainStart(e=Vl){let t=typeof e=="number"?e:e[0],i=typeof e=="number"?1:e[1],n=typeof e=="number"?1:e[2];if(t>this.limits.maxComputeWorkgroupSizeX||i>this.limits.maxComputeWorkgroupSizeY||n>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${t}, ${i}, ${n}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(t*i*n>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${t}, ${i}, ${n}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let r=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,o=r?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,s=r?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${t*i*n}u + local_idx;`;return`@compute @workgroup_size(${t}, ${i}, ${n})
  fn main(${o}) {
    ${s}
  `}appendVariableUniforms(e){e.rank!==0&&(e.shape.startsWith("uniforms.")&&this.uniforms.push({name:e.shape.replace("uniforms.",""),type:"u32",length:e.rank}),e.strides.startsWith("uniforms.")&&this.uniforms.push({name:e.strides.replace("uniforms.",""),type:"u32",length:e.rank}))}declareVariable(e,t){if(e.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(e),this.appendVariableUniforms(e);let i=e.usage==="input"?"read":"read_write",n=e.usage==="atomicOutput"?"atomic<i32>":e.type.storage;return`@group(0) @binding(${t}) var<storage, ${i}> ${e.name}: array<${n}>;`}declareVariables(...e){return e.map(t=>this.declareVariable(t,this.variableIndex++)).join(`
`)}registerInternalVariable(e){if(e.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(e),this.appendVariableUniforms(e)}registerInternalVariables(...e){return e.forEach(t=>this.registerInternalVariable(t)),this}registerUniform(e,t,i=1){return this.uniforms.push({name:e,type:t,length:i}),this}registerUniforms(e){return this.uniforms=this.uniforms.concat(e),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let e=[];for(let{name:t,type:i,length:n}of this.uniforms)if(n&&n>4)i==="f16"?e.push(`@align(16) ${t}:array<mat2x4<${i}>, ${Math.ceil(n/8)}>`):e.push(`${t}:array<vec4<${i}>, ${Math.ceil(n/4)}>`);else{let r=n==null||n===1?i:`vec${n}<${i}>`;e.push(`${t}:${r}`)}return`
      struct Uniforms { ${e.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(e=>e.impl()).join(`
`)+this.internalVariables.map(e=>e.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let e=t=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(t)];return this.uniforms.map(t=>[e(t.type),t.length??1])}},r3=(e,t)=>new pA(e,t)}),mA,r1,gA,_A,vA,bA,Ti,o3,s3,is=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),mA=(e,t)=>{if(!e||e.length!==1)throw new Error("Transpose requires 1 input.");if(t.length!==0&&t.length!==e[0].dims.length)throw new Error(`perm size ${t.length} does not match input rank ${e[0].dims.length}`)},r1=(e,t)=>t.length!==0?t:[...new Array(e).keys()].reverse(),gA=(e,t)=>Z.sortBasedOnPerm(e,r1(e.length,t)),_A=(e,t,i,n)=>{let r=`fn perm(i: ${n.type.indices}) -> ${i.type.indices} {
    var a: ${i.type.indices};`;for(let o=0;o<t;++o)r+=`a[${e[o]}]=i[${o}];`;return r+="return a;}"},vA=(e,t)=>{let i=[],n=[];for(let r=0;r<e.length;++r)e[r]!==1&&i.push(e[r]),e[t[r]]!==1&&n.push(t[r]);return{newShape:i,newPerm:n}},bA=(e,t)=>{let i=0;for(let n=0;n<e.length;++n)if(t[e[n]]!==1){if(e[n]<i)return!1;i=e[n]}return!0},Ti=(e,t)=>{let i=e.dataType,n=e.dims.length,r=r1(n,t),o=gA(e.dims,r),s=e.dims,a=o,u=n<2||bA(r,e.dims),c;if(u)return c=b=>{let w=ee("input",i,s,4),C=Ee("output",i,a,4);return`
  ${b.registerUniform("output_size","u32").declareVariables(w,C)}
  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let b=Z.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(b/64/4)},programUniforms:[{type:12,data:Math.ceil(b/4)}]}},getShaderSource:c};let{newShape:f,newPerm:p}=vA(e.dims,r),m=Z.areEqual(p,[2,3,1]),v=Z.areEqual(p,[3,1,2]);if(f.length===2||m||v){s=m?[f[0],f[1]*f[2]]:v?[f[0]*f[1],f[2]]:f,a=[s[1],s[0]];let b=16;return c=w=>{let C=ee("a",i,s.length),x=Ee("output",i,a.length);return`
  ${w.registerUniform("output_size","u32").declareVariables(C,x)}
  var<workgroup> tile : array<array<${x.type.value}, ${b+1}>, ${b}>;
  ${w.mainStart([b,b,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${b} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${b}u + local_id.x;
    let input_row = workgroup_id_x * ${b}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${C.getByIndices(`${C.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${b}u + local_id.x;
    let output_row = workgroup_id_y * ${b}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${x.setByIndices(`${x.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let w=Z.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(a[1]/b),y:Math.ceil(a[0]/b)},programUniforms:[{type:12,data:w},...Te(s,a)]}},getShaderSource:c}}return c=b=>{let w=ee("a",i,s.length),C=Ee("output",i,a.length);return`
  ${b.registerUniform("output_size","u32").declareVariables(w,C)}

  ${_A(r,n,w,C)}

  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${C.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${C.setByOffset("global_idx",w.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${t}`,inputDependencies:["rank"]},getRunData:()=>{let b=Z.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:[{type:12,data:b},...Te(s,a)]}},getShaderSource:c}},o3=(e,t)=>{mA(e.inputs,t.perm),e.compute(Ti(e.inputs[0],t.perm))},s3=e=>$t({perm:e.perm})}),yA,wA,xA,CA,EA,IA,SA,DA,TA,$A,cr,a3,l3,u3,c3,d3,f3,h3,p3,m3,g3,bJ=ue(()=>{"use strict";Fe(),Ue(),Qe(),fC(),is(),yA={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},wA={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},xA={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},CA={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},EA=(e,t)=>{let i=[];for(let n=t-e;n<t;++n)i.push(n);return i},IA=(e,t)=>{let i=[],n=e.length;for(let o=0;o<n;o++)t.indexOf(o)===-1&&i.push(e[o]);let r=t.map(o=>e[o]);return[i,r]},SA=(e,t)=>{let i=e.length+t.length,n=[],r=0;for(let o=0;o<i;o++)t.indexOf(o)===-1?n.push(e[r++]):n.push(1);return n},DA=(e,t)=>{for(let i=0;i<e.length;++i)if(e[e.length-i-1]!==t-1-i)return!1;return!0},TA=(e,t)=>{let i=[];if(!DA(e,t)){for(let n=0;n<t;++n)e.indexOf(n)===-1&&i.push(n);e.forEach(n=>i.push(n))}return i},$A=(e,t,i,n,r,o,s)=>{let a=i[0].dims,u=Z.size(o),c=Z.size(s),f=ee("_A",i[0].dataType,a),p=Ee("output",r,o),m=64;u===1&&(m=256);let v=`
          var<workgroup> aBestValues : array<f32, ${m}>;
       `,b=w=>`
        ${w.registerUniform("reduceSize","u32").declareVariables(f,p)}
        ${v}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${w.mainStart(m)}

          let outputIndex = global_idx / ${m};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${xA[n]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${m}) {
           let candidate = f32(${f.getByOffset("offset + k")});
           bestValue = ${yA[n]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${m}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${wA[n]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${p.setByOffset("outputIndex",`${n==="mean"?`${p.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${p.type.storage}(${CA[n]})`}`)};
         }
        }`;return{name:e,shaderCache:{hint:`${t};${m}`,inputDependencies:["type"]},getShaderSource:b,getRunData:()=>({outputs:[{dims:o,dataType:r}],dispatchGroup:{x:u},programUniforms:[{type:12,data:c}]})}},cr=(e,t,i,n)=>{let r=e.inputs.length===1?i:j1(e.inputs,i),o=r.axes;o.length===0&&!r.noopWithEmptyAxes&&(o=e.inputs[0].dims.map((v,b)=>b));let s=Z.normalizeAxes(o,e.inputs[0].dims.length),a=s,u=e.inputs[0],c=TA(a,e.inputs[0].dims.length);c.length>0&&(u=e.compute(Ti(e.inputs[0],c),{inputs:[0],outputs:[-1]})[0],a=EA(a.length,u.dims.length));let[f,p]=IA(u.dims,a),m=f;r.keepDims&&(m=SA(f,s)),e.compute($A(t,r.cacheKey,[u],n,e.inputs[0].dataType,m,p),{inputs:[u]})},a3=(e,t)=>{cr(e,"ReduceMeanShared",t,"mean")},l3=(e,t)=>{cr(e,"ReduceL1Shared",t,"l1")},u3=(e,t)=>{cr(e,"ReduceL2Shared",t,"l2")},c3=(e,t)=>{cr(e,"ReduceLogSumExpShared",t,"logSumExp")},d3=(e,t)=>{cr(e,"ReduceMaxShared",t,"max")},f3=(e,t)=>{cr(e,"ReduceMinShared",t,"min")},h3=(e,t)=>{cr(e,"ReduceProdShared",t,"prod")},p3=(e,t)=>{cr(e,"ReduceSumShared",t,"sum")},m3=(e,t)=>{cr(e,"ReduceSumSquareShared",t,"sumSquare")},g3=(e,t)=>{cr(e,"ReduceLogSumShared",t,"logSum")}}),dr,kA,Mg,j1,fr,MA,AA,RA,OA,NA,PA,FA,zA,LA,BA,hr,_3,v3,b3,y3,w3,x3,C3,E3,I3,S3,fC=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),bJ(),dr=e=>{if(!e||e.length===0||e.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(e.length===2&&e[1].dims.length!==1)throw new Error("Invalid axes input dims.")},kA=e=>["","",`var value = ${e.getByIndices("input_indices")};`,""],Mg=(e,t,i,n,r,o,s=!1,a=!1)=>{let u=[],c=i[0].dims,f=c.length,p=Z.normalizeAxes(r,f),m=!a&&p.length===0;c.forEach((w,C)=>{m||p.indexOf(C)>=0?s&&u.push(1):u.push(w)});let v=u.length,b=Z.size(u);return{name:e,shaderCache:t,getShaderSource:w=>{let C=[],x=ee("_A",i[0].dataType,f),y=Ee("output",o,v),I=n(x,y,p),S=I[2];for(let T=0,$=0;T<f;T++)m||p.indexOf(T)>=0?(s&&$++,S=`for(var j${T}: u32 = 0; j${T} < ${c[T]}; j${T}++) {
                  ${I[2].includes("last_index")?`let last_index = j${T};`:""}
                  ${x.indicesSet("input_indices",T,`j${T}`)}
                  ${S}
                }`):(C.push(`${x.indicesSet("input_indices",T,y.indicesGet("output_indices",$))};`),$++);return`

        ${w.registerUniform("output_size","u32").declareVariables(x,y)}

        ${w.mainStart()}
          ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${x.type.indices};
          let output_indices = ${y.offsetToIndices("global_idx")};

          ${C.join(`
`)}
          ${I[0]}       // init ops for reduce max/min
          ${I[1]}
          ${S}
          ${I[3]}
          ${I.length===4?y.setByOffset("global_idx","value"):I.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:u,dataType:o}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:[{type:12,data:b},...Te(c,u)]})}},j1=(e,t)=>{let i=[];return e[1].dims[0]>0&&e[1].getBigInt64Array().forEach(n=>i.push(Number(n))),$t({axes:i,keepDims:t.keepDims,noopWithEmptyAxes:t.noopWithEmptyAxes})},fr=(e,t,i,n)=>{let r=e.inputs,o=r.length===1?i:j1(r,i);e.compute(Mg(t,{hint:o.cacheKey,inputDependencies:["rank"]},[r[0]],o.noopWithEmptyAxes&&o.axes.length===0?kA:n,o.axes,r[0].dataType,o.keepDims,o.noopWithEmptyAxes),{inputs:[0]})},MA=(e,t)=>{dr(e.inputs),fr(e,"ReduceLogSum",t,(i,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${i.getByIndices("input_indices")};`,"value = log(value);"])},AA=(e,t)=>{dr(e.inputs),fr(e,"ReduceL1",t,(i,n)=>[`var value = ${n.type.storage}(0);`,"",`value += abs(${i.getByIndices("input_indices")});`,""])},RA=(e,t)=>{dr(e.inputs),fr(e,"ReduceL2",t,(i,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${i.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},OA=(e,t)=>{dr(e.inputs),fr(e,"ReduceLogSumExp",t,(i,n)=>[`var value = ${n.type.storage}(0);`,"",`value += exp(${i.getByIndices("input_indices")});`,"value = log(value);"])},NA=(e,t)=>{dr(e.inputs),fr(e,"ReduceMax",t,(i,n,r)=>{let o=[];for(let s=0;s<i.rank;s++)(r.indexOf(s)>=0||r.length===0)&&o.push(i.indicesSet("input_indices",s,0));return[`${o.join(`
`)}`,`var value = ${i.getByIndices("input_indices")};`,`value = max(value, ${i.getByIndices("input_indices")});`,""]})},PA=(e,t)=>{dr(e.inputs),fr(e,"ReduceMean",t,(i,n,r)=>{let o=1;for(let s=0;s<i.rank;s++)(r.indexOf(s)>=0||r.length===0)&&(o*=e.inputs[0].dims[s]);return["var sum = f32(0);","",`sum += f32(${i.getByIndices("input_indices")});`,`let value = ${n.type.value}(sum / ${o});`]})},FA=(e,t)=>{dr(e.inputs),fr(e,"ReduceMin",t,(i,n,r)=>{let o=[];for(let s=0;s<i.rank;s++)(r.indexOf(s)>=0||r.length===0)&&o.push(`input_indices[${s}] = 0;`);return[`${o.join(`
`)}`,`var value = ${i.getByIndices("input_indices")};`,`value = min(value, ${i.getByIndices("input_indices")});`,""]})},zA=(e,t)=>{dr(e.inputs),fr(e,"ReduceProd",t,(i,n)=>[`var value = ${n.type.storage}(1);`,"",`value *= ${i.getByIndices("input_indices")};`,""])},LA=(e,t)=>{dr(e.inputs),fr(e,"ReduceSum",t,(i,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${i.getByIndices("input_indices")};`,""])},BA=(e,t)=>{dr(e.inputs),fr(e,"ReduceSumSquare",t,(i,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${i.getByIndices("input_indices")}; value += t * t;`,""])},hr=(e,t,i)=>{if(t.length===0)return i;let n=1,r=1;for(let o=0;o<t.length;o++)t.indexOf(o)===-1?n*=e[o]:r*=e[o];return r<32&&n>1024},_3=(e,t)=>{hr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?PA(e,t):a3(e,t)},v3=(e,t)=>{hr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?AA(e,t):l3(e,t)},b3=(e,t)=>{hr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?RA(e,t):u3(e,t)},y3=(e,t)=>{hr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?OA(e,t):c3(e,t)},w3=(e,t)=>{hr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?NA(e,t):d3(e,t)},x3=(e,t)=>{hr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?FA(e,t):f3(e,t)},C3=(e,t)=>{hr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?zA(e,t):h3(e,t)},E3=(e,t)=>{hr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?LA(e,t):p3(e,t)},I3=(e,t)=>{hr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?BA(e,t):m3(e,t)},S3=(e,t)=>{hr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?MA(e,t):g3(e,t)}}),o1,D3,T3,V1,yJ=ue(()=>{"use strict";Fe(),on(),fC(),o1=e=>{if(!e||e.length===0||e.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(e[0].dataType!==1)throw new Error("Invalid input type.")},D3=(e,t)=>{o1(e.inputs);let i=(n,r,o)=>{let s=[];for(let a=0;a<n.rank;a++)(o.indexOf(a)>=0||o.length===0)&&s.push(`input_indices[${a}] = 0;`);return[`${s.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${t.selectLastIndex>0?"<=":"<"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",r.setByOffset("global_idx","best_index")]};e.compute(Mg("ArgMin",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],i,[t.axis],7,t.keepDims),{inputs:[0]})},T3=(e,t)=>{o1(e.inputs);let i=(n,r,o)=>{let s=[];for(let a=0;a<n.rank;a++)(o.indexOf(a)>=0||o.length===0)&&s.push(`input_indices[${a}] = 0;`);return[`${s.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${t.selectLastIndex>0?">=":">"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",r.setByOffset("global_idx","best_index")]};e.compute(Mg("argMax",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],i,[t.axis],7,t.keepDims),{inputs:[0]})},V1=e=>$t(e)}),jA,gg,VA,UA,HA,$f,WA,$3,hC=ue(()=>{"use strict";Fe(),Ue(),cC(),Qe(),jA=(e,t)=>{let i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5];if(s&&a)throw new Error("Attention cannot have both past and attention_bias");if(i.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let u=i.dims[0],c=i.dims[1],f=i.dims[2];if(r.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(n.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(n.dims[0]!==f)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(r.dims[0]!==n.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let p=r.dims[0]/3,m=p,v=m;if(t.qkvHiddenSizes.length>0){if(t.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let I of t.qkvHiddenSizes)if(I%t.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");p=t.qkvHiddenSizes[0],m=t.qkvHiddenSizes[1],v=t.qkvHiddenSizes[2]}let b=c;if(p!==m)throw new Error("qkv_hidden_sizes first element should be same as the second");if(r.dims[0]!==p+m+v)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let w=0;if(s){if(m!==v)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(s.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(s.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(s.dims[1]!==u)throw new Error('Input "past" second dimension must be batch_size');if(s.dims[2]!==t.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(s.dims[4]!==m/t.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');t.pastPresentShareBuffer||(w=s.dims[3])}let C=b+w,x=-1,y=0;if(o)throw new Error("Mask not supported");if(s)throw new Error("past is not supported");if(a){if(a.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(a.dims[0]!==u||a.dims[1]!==t.numHeads||a.dims[2]!==c||a.dims[3]!==C)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:u,sequenceLength:c,pastSequenceLength:w,kvSequenceLength:b,totalSequenceLength:C,maxSequenceLength:x,inputHiddenSize:f,hiddenSize:p,vHiddenSize:v,headSize:Math.floor(p/t.numHeads),vHeadSize:Math.floor(v/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:y,scale:t.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},gg=(e,t,i)=>t&&e?`
      let total_sequence_length_input = u32(${t.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${e?.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${i?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,VA=(e,t,i,n,r,o,s,a)=>{let u=en(s?1:o),c=64,f=o/u;f<c&&(c=32);let p=Math.ceil(o/u/c),m=[{type:12,data:t},{type:12,data:i},{type:12,data:n},{type:12,data:r},{type:12,data:f},{type:12,data:p}],v=In(e.dataType,u),b=Yn(1,u),w=["type"];s&&w.push("type"),a&&w.push("type");let C=x=>{let y=Ee("x",e.dataType,e.dims,u),I=[y],S=s?ee("seq_lens",s.dataType,s.dims):void 0;S&&I.push(S);let T=a?ee("total_sequence_length_input",a.dataType,a.dims):void 0;T&&I.push(T);let $=Yn(e.dataType),k=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${c}>;
  var<workgroup> thread_sum: array<f32, ${c}>;
  ${x.registerUniforms(k).declareVariables(...I)}
  ${x.mainStart([c,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${gg(S,T,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${c}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${s?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${b}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${b}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(u){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${u}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${c}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${b}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${b}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(u){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${u}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${c}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${y.type.value}(${$}(1.0) / ${$}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${b}(x[offset + i]);
        x[offset + i] = ${y.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${s?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${y.type.value}(${$}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${c};${v};${u}`,inputDependencies:w},getShaderSource:C,getRunData:()=>({outputs:[],dispatchGroup:{x:Math.ceil(o/c),y:r,z:t*i},programUniforms:m})}},UA=(e,t,i,n,r,o,s,a,u)=>{let c=s+o.kvSequenceLength,f=[o.batchSize,o.numHeads,o.sequenceLength,c],p=e>1&&n,m=o.kvNumHeads?o.kvNumHeads:o.numHeads,v=p?[o.batchSize,m,c,o.headSize]:void 0,b=o.nReps?o.nReps:1,w=o.scale===0?1/Math.sqrt(o.headSize):o.scale,C=en(o.headSize),x=o.headSize/C,y=12,I={x:Math.ceil(c/y),y:Math.ceil(o.sequenceLength/y),z:o.batchSize*o.numHeads},S=[{type:12,data:o.sequenceLength},{type:12,data:x},{type:12,data:c},{type:12,data:o.numHeads},{type:12,data:o.headSize},{type:1,data:w},{type:12,data:s},{type:12,data:o.kvSequenceLength},{type:12,data:b}],T=p&&n&&Z.size(n.dims)>0,$=["type","type"];T&&$.push("type"),r&&$.push("type"),a&&$.push("type"),u&&$.push("type");let k=[{dims:f,dataType:t.dataType,gpuDataType:0}];p&&k.push({dims:v,dataType:t.dataType,gpuDataType:0});let P=j=>{let H=ee("q",t.dataType,t.dims,C),re=ee("key",i.dataType,i.dims,C),ae=[H,re];if(T){let X=ee("past_key",n.dataType,n.dims,C);ae.push(X)}r&&ae.push(ee("attention_bias",r.dataType,r.dims));let L=a?ee("seq_lens",a.dataType,a.dims):void 0;L&&ae.push(L);let ge=u?ee("total_sequence_length_input",u.dataType,u.dims):void 0;ge&&ae.push(ge);let ye=Ee("output",t.dataType,f),Y=[ye];p&&Y.push(Ee("present_key",t.dataType,v,C));let ve=Yn(1,C),we=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${y}u;

  var<workgroup> tileQ: array<${H.type.storage}, ${y*y}>;
  var<workgroup> tileK: array<${H.type.storage}, ${y*y}>;
  ${j.registerUniforms(we).declareVariables(...ae,...Y)}
  ${j.mainStart([y,y,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${b===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${b===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${gg(L,ge,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${T&&p?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${p?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${ve}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${T&&p?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${p?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${ve}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(C){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${C}`)}})()};
        output[outputIdx] = ${ye.type.value} (sum * uniforms.alpha) + ${r?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${C};${r!==void 0};${n!==void 0};${e}`,inputDependencies:$},getRunData:()=>({outputs:k,dispatchGroup:I,programUniforms:S}),getShaderSource:P}},HA=(e,t,i,n,r,o,s=void 0,a=void 0)=>{let u=o+r.kvSequenceLength,c=r.nReps?r.nReps:1,f=r.vHiddenSize*c,p=e>1&&n,m=r.kvNumHeads?r.kvNumHeads:r.numHeads,v=p?[r.batchSize,m,u,r.headSize]:void 0,b=[r.batchSize,r.sequenceLength,f],w=12,C={x:Math.ceil(r.vHeadSize/w),y:Math.ceil(r.sequenceLength/w),z:r.batchSize*r.numHeads},x=[{type:12,data:r.sequenceLength},{type:12,data:u},{type:12,data:r.vHeadSize},{type:12,data:r.numHeads},{type:12,data:r.headSize},{type:12,data:f},{type:12,data:o},{type:12,data:r.kvSequenceLength},{type:12,data:c}],y=p&&n&&Z.size(n.dims)>0,I=["type","type"];y&&I.push("type"),s&&I.push("type"),a&&I.push("type");let S=[{dims:b,dataType:t.dataType,gpuDataType:0}];p&&S.push({dims:v,dataType:t.dataType,gpuDataType:0});let T=$=>{let k=ee("probs",t.dataType,t.dims),P=ee("v",i.dataType,i.dims),j=[k,P];y&&j.push(ee("past_value",n.dataType,n.dims));let H=s?ee("seq_lens",s.dataType,s.dims):void 0;s&&j.push(H);let re=a?ee("total_sequence_length_input",a.dataType,a.dims):void 0;a&&j.push(re);let ae=[Ee("output",t.dataType,b)];p&&ae.push(Ee("present_value",t.dataType,v));let L=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${w}u;
  var<workgroup> tileQ: array<${k.type.value}, ${w*w}>;
  var<workgroup> tileV: array<${k.type.value}, ${w*w}>;
  ${$.registerUniforms(L).declareVariables(...j,...ae)}
  ${$.mainStart([w,w,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${c===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${c===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${gg(H,re,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${y&&p?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${p?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${k.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${y&&p?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${p?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${n!==void 0};${e}`,inputDependencies:I},getRunData:()=>({outputs:S,dispatchGroup:C,programUniforms:x}),getShaderSource:T}},$f=(e,t,i,n,r,o,s,a,u,c,f=void 0,p=void 0)=>{let m=Math.min(e.outputCount,1+(s?1:0)+(a?1:0)),v=m>1?c.pastSequenceLength:0,b=v+c.kvSequenceLength,w=u&&Z.size(u.dims)>0?u:void 0,C=[t,i];m>1&&s&&Z.size(s.dims)>0&&C.push(s),w&&C.push(w),f&&C.push(f),p&&C.push(p);let x=e.compute(UA(m,t,i,s,w,c,v,f,p),{inputs:C,outputs:m>1?[-1,1]:[-1]})[0];e.compute(VA(x,c.batchSize,c.numHeads,v,c.sequenceLength,b,f,p),{inputs:f&&p?[x,f,p]:[x],outputs:[]});let y=[x,n];m>1&&a&&Z.size(a.dims)>0&&y.push(a),f&&y.push(f),p&&y.push(p),e.compute(HA(m,x,n,a,c,v,f,p),{inputs:y,outputs:m>1?[0,2]:[0]})},WA=(e,t)=>{let i=[t.batchSize,t.numHeads,t.sequenceLength,t.headSize],n=t.sequenceLength,r=t.inputHiddenSize,o=t.headSize,s=12,a={x:Math.ceil(t.headSize/s),y:Math.ceil(t.sequenceLength/s),z:t.batchSize*t.numHeads},u=[e.inputs[0],e.inputs[1],e.inputs[2]],c=[{type:12,data:n},{type:12,data:r},{type:12,data:o},{type:12,data:t.numHeads},{type:12,data:t.headSize},{type:12,data:t.hiddenSize},{type:12,data:t.hiddenSize+t.hiddenSize+t.vHiddenSize}],f=p=>{let m=Ee("output_q",u[0].dataType,i),v=Ee("output_k",u[0].dataType,i),b=Ee("output_v",u[0].dataType,i),w=ee("input",u[0].dataType,u[0].dims),C=ee("weight",u[1].dataType,u[1].dims),x=ee("bias",u[2].dataType,u[2].dims),y=w.type.storage,I=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${s}u;
  var<workgroup> tileInput: array<${y}, ${s*s}>;
  var<workgroup> tileWeightQ: array<${y}, ${s*s}>;
  var<workgroup> tileWeightK: array<${y}, ${s*s}>;
  var<workgroup> tileWeightV: array<${y}, ${s*s}>;
  ${p.registerUniforms(I).declareVariables(w,C,x,m,v,b)}
  ${p.mainStart([s,s,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${y}(0);
    var valueK = ${y}(0);
    var valueV = ${y}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return e.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:i,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:i,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:i,dataType:e.inputs[0].dataType,gpuDataType:0}],dispatchGroup:a,programUniforms:c}),getShaderSource:f},{inputs:u,outputs:[-1,-1,-1]})},$3=(e,t)=>{let i=jA(e.inputs,t),[n,r,o]=WA(e,i);return $f(e,n,r,o,e.inputs[4],void 0,void 0,void 0,e.inputs[5],i)}}),qA,GA,KA,k3,wJ=ue(()=>{"use strict";gr(),Fe(),Ue(),on(),Qe(),qA=(e,t)=>{if(!e||e.length!==5)throw new Error("BatchNormalization requires 5 inputs");let i=(n,r,o)=>{let s=r.length;if(s!==n.length)throw new Error(`${o}: num dimensions != ${s}`);r.forEach((a,u)=>{if(a!==n[u])throw new Error(`${o}: dim[${u}] do not match`)})};if(e[0].dims.length>1){let n=t.format==="NHWC"?t.spatial?e[0].dims.slice(-1):e[0].dims.slice(-1).concat(e[0].dims.slice(1,e[0].dims.length-1)):e[0].dims.slice(1,t.spatial?2:void 0);i(e[1].dims,n,"Invalid input scale"),i(e[2].dims,n,"Invalid input B"),i(e[3].dims,n,"Invalid input mean"),i(e[4].dims,n,"Invalid input var")}else i(e[1].dims,[1],"Invalid input scale"),i(e[2].dims,[1],"Invalid input B"),i(e[3].dims,[1],"Invalid input mean"),i(e[4].dims,[1],"Invalid input var")},GA=(e,t)=>{let{epsilon:i,spatial:n,format:r}=t,o=e[0].dims,s=n?en(o[o.length-1]):1,a=r==="NHWC"&&o.length>1?s:1,u=Z.size(o)/s,c=n,f=c?o.length:o,p=ee("x",e[0].dataType,e[0].dims,s),m=ee("scale",e[1].dataType,e[1].dims,a),v=ee("bias",e[2].dataType,e[2].dims,a),b=ee("inputMean",e[3].dataType,e[3].dims,a),w=ee("inputVar",e[4].dataType,e[4].dims,a),C=Ee("y",e[0].dataType,f,s),x=()=>{let I="";if(n)I=`let cOffset = ${o.length===1?"0u":r==="NHWC"?`outputIndices[${o.length-1}] / ${s}`:"outputIndices[1]"};`;else if(r==="NCHW")I=`
            ${C.indicesSet("outputIndices","0","0")}
            let cOffset = ${C.indicesToOffset("outputIndices")};`;else{I=`var cIndices = ${m.type.indices}(0);
                       cIndices[0] = outputIndices[${o.length-1}];`;for(let S=1;S<m.rank;S++)I+=`cIndices[${S}] = outputIndices[${S}];`;I+=`let cOffset = ${m.indicesToOffset("cIndices")};`}return I},y=I=>`
  const epsilon = ${i};
  ${I.registerUniform("outputSize","u32").declareVariables(p,m,v,b,w,C)}
  ${I.mainStart()}
  ${I.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${C.offsetToIndices(`global_idx * ${s}`)};
    ${x()}
    let scale = ${m.getByOffset("cOffset")};
    let bias = ${v.getByOffset("cOffset")};
    let inputMean = ${b.getByOffset("cOffset")};
    let inputVar = ${w.getByOffset("cOffset")};
    let x = ${p.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${C.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${t.epsilon}_${t.format}_${n}_${s}`,inputDependencies:c?["rank","type","type","type","type"]:void 0},getShaderSource:y,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c?[{type:12,data:u},...Te(o)]:[{type:12,data:u}]})}},KA=e=>$t(e),k3=(e,t)=>{let{inputs:i,outputCount:n}=e,r=KA(Ae(ie({},t),{outputCount:n}));if(Yt.webgpu.validateInputContent&&qA(i,r),t.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");e.compute(GA(i,r))}}),ZA,QA,M3,xJ=ue(()=>{"use strict";Ue(),Qe(),ZA=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(e[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},QA=e=>{let t=e[0].dims,i=e[0].dims[2],n=Z.size(t)/4,r=e[0].dataType,o=ee("input",r,t,4),s=ee("bias",r,[i],4),a=ee("residual",r,t,4),u=Ee("output",r,t,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(n/64)}}),getShaderSource:c=>`
  const channels = ${i}u / 4;
  ${c.declareVariables(o,s,a,u)}

  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes(n)}
    let value = ${o.getByOffset("global_idx")}
      + ${s.getByOffset("global_idx % channels")} + ${a.getByOffset("global_idx")};
    ${u.setByOffset("global_idx","value")}
  }`}},M3=e=>{ZA(e.inputs),e.compute(QA(e.inputs))}}),YA,wt,A3,R3,O3,N3,P3,F3,z3,L3,B3,JA,j3,V3,U3,H3,Sf,W3,Ig,q3,G3,K3,Z3,Q3,Y3,J3,X3,eP,tP,nP,iP,rP,oP,sP,aP,s1,lP,U1,H1,uP,cP,dP,XA,eR,fP,pC=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),YA=(e,t,i,n,r,o,s)=>{let a=Math.ceil(t/4),u="";typeof r=="string"?u=`${r}(a)`:u=r("a");let c=ee("inputData",i,[a],4),f=Ee("outputData",n,[a],4),p=[{name:"vec_size",type:"u32"}];return s&&p.push(...s),`
      ${e.registerUniforms(p).declareVariables(c,f)}

  ${o??""}

  ${e.mainStart()}
    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${c.getByOffset("global_idx")};
    ${f.setByOffset("global_idx",u)}
  }`},wt=(e,t,i,n,r,o=e.dataType,s,a)=>{let u=[{type:12,data:Math.ceil(Z.size(e.dims)/4)}];return s&&u.push(...s),{name:t,shaderCache:{hint:r,inputDependencies:["type"]},getShaderSource:c=>YA(c,Z.size(e.dims),e.dataType,o,i,n,a),getRunData:c=>({outputs:[{dims:e.dims,dataType:o}],dispatchGroup:{x:Math.ceil(Z.size(c[0].dims)/64/4)},programUniforms:u})}},A3=e=>{e.compute(wt(e.inputs[0],"Abs","abs"))},R3=e=>{e.compute(wt(e.inputs[0],"Acos","acos"))},O3=e=>{e.compute(wt(e.inputs[0],"Acosh","acosh"))},N3=e=>{e.compute(wt(e.inputs[0],"Asin","asin"))},P3=e=>{e.compute(wt(e.inputs[0],"Asinh","asinh"))},F3=e=>{e.compute(wt(e.inputs[0],"Atan","atan"))},z3=e=>{e.compute(wt(e.inputs[0],"Atanh","atanh"))},L3=e=>$t(e),B3=(e,t)=>{let i;switch(t.to){case 10:i="vec4<f16>";break;case 1:i="vec4<f32>";break;case 12:i="vec4<u32>";break;case 6:i="vec4<i32>";break;case 9:i="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${t.to}`)}e.compute(wt(e.inputs[0],"Cast",i,void 0,t.cacheKey,t.to))},JA=e=>{let t,i,n=e.length>=2&&e[1].data!==0,r=e.length>=3&&e[2].data!==0;switch(e[0].dataType){case 1:t=n?e[1].getFloat32Array()[0]:-34028234663852886e22,i=r?e[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:t=n?e[1].getUint16Array()[0]:64511,i=r?e[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return $t({min:t,max:i})},j3=(e,t)=>{let i=t||JA(e.inputs),n=Yn(e.inputs[0].dataType);e.compute(wt(e.inputs[0],"Clip",r=>`clamp(${r}, vec4<${n}>(uniforms.min), vec4<${n}>(uniforms.max))`,void 0,i.cacheKey,void 0,[{type:e.inputs[0].dataType,data:i.min},{type:e.inputs[0].dataType,data:i.max}],[{name:"min",type:n},{name:"max",type:n}]),{inputs:[0]})},V3=e=>{e.compute(wt(e.inputs[0],"Ceil","ceil"))},U3=e=>{e.compute(wt(e.inputs[0],"Cos","cos"))},H3=e=>{e.compute(wt(e.inputs[0],"Cosh","cosh"))},Sf=e=>$t(e),W3=(e,t)=>{let i=Yn(e.inputs[0].dataType);e.compute(wt(e.inputs[0],"Elu",n=>`elu_vf32(${n})`,`
  const elu_alpha_ = ${i}(${t.alpha});

  fn elu_f32(a: ${i}) -> ${i} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${i}>) -> vec4<${i}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,t.cacheKey))},Ig=(e="f32")=>`
const r0: ${e} = 0.3275911;
const r1: ${e} = 0.254829592;
const r2: ${e} = -0.284496736;
const r3: ${e} = 1.421413741;
const r4: ${e} = -1.453152027;
const r5: ${e} = 1.061405429;

fn erf_vf32(v: vec4<${e}>) -> vec4<${e}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,q3=e=>{let t=Yn(e.inputs[0].dataType);e.compute(wt(e.inputs[0],"Erf",i=>`erf_vf32(${i})`,Ig(t)))},G3=e=>{e.compute(wt(e.inputs[0],"Exp","exp"))},K3=e=>{e.compute(wt(e.inputs[0],"Floor","floor"))},Z3=e=>{let t=Yn(e.inputs[0].dataType);e.compute(wt(e.inputs[0],"Gelu",i=>`0.5 * ${i} * (1.0 + erf_vf32(${i} * 0.7071067811865475))`,Ig(t)))},Q3=(e,t)=>{let i=Yn(e.inputs[0].dataType);e.compute(wt(e.inputs[0],"LeakyRelu",n=>`select(leaky_relu_alpha_ * ${n}, ${n}, ${n} >= vec4<${i}>(0.0))`,`const leaky_relu_alpha_ = ${i}(${t.alpha});`,t.cacheKey))},Y3=e=>{e.compute(wt(e.inputs[0],"Not",t=>`!${t}`))},J3=e=>{e.compute(wt(e.inputs[0],"Neg",t=>`-${t}`))},X3=e=>{e.compute(wt(e.inputs[0],"Reciprocal",t=>`1.0/${t}`))},eP=e=>{let t=Yn(e.inputs[0].dataType);e.compute(wt(e.inputs[0],"Relu",i=>`select(vec4<${t}>(0.0), ${i}, ${i} > vec4<${t}>(0.0))`))},tP=e=>{e.compute(wt(e.inputs[0],"Sigmoid",t=>`(1.0 / (1.0 + exp(-${t})))`))},nP=e=>$t(e),iP=(e,t)=>{let i=Yn(e.inputs[0].dataType);e.compute(wt(e.inputs[0],"HardSigmoid",n=>`max(vec4<${i}>(0.0), min(vec4<${i}>(1.0), ${t.alpha} * ${n} + vec4<${i}>(${t.beta})))`,void 0,t.cacheKey))},rP=e=>{e.compute(wt(e.inputs[0],"Sin","sin"))},oP=e=>{e.compute(wt(e.inputs[0],"Sinh","sinh"))},sP=e=>{e.compute(wt(e.inputs[0],"Sqrt","sqrt"))},aP=e=>{e.compute(wt(e.inputs[0],"Tan","tan"))},s1=e=>`sign(${e}) * (1 - exp(-2 * abs(${e}))) / (1 + exp(-2 * abs(${e})))`,lP=e=>{e.compute(wt(e.inputs[0],"Tanh",s1))},U1=(e="f32")=>`
const fast_gelu_a: ${e} = 0.5;
const fast_gelu_b: ${e} = 0.7978845608028654;
const fast_gelu_c: ${e} = 0.035677408136300125;

fn tanh_v(v: vec4<${e}>) -> vec4<${e}> {
  return ${s1("v")};
}
`,H1=e=>`(fast_gelu_a + fast_gelu_a * tanh_v(${e} * (fast_gelu_c * ${e} * ${e} + fast_gelu_b))) * ${e}`,uP=e=>{let t=Yn(e.inputs[0].dataType);e.compute(wt(e.inputs[0],"FastGelu",H1,U1(t),void 0,e.inputs[0].dataType))},cP=(e,t)=>{let i=Yn(e.inputs[0].dataType);return e.compute(wt(e.inputs[0],"ThresholdedRelu",n=>`select(vec4<${i}>(0.0), ${n}, ${n} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${i}>(${t.alpha});`,t.cacheKey)),0},dP=e=>{e.compute(wt(e.inputs[0],"Log","log"))},XA=(e,t)=>`
const alpha = vec4<${e}>(${t});
const one = ${e}(1.0);
const zero = ${e}(0.0);

fn quick_gelu_impl(x: vec4<${e}>) -> vec4<${e}> {
  let v = x *alpha;
  var x1 : vec4<${e}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,eR=e=>`quick_gelu_impl(${e})`,fP=(e,t)=>{let i=Yn(e.inputs[0].dataType);e.compute(wt(e.inputs[0],"QuickGelu",eR,XA(i,t.alpha),t.cacheKey,e.inputs[0].dataType))}}),tR,nR,hP,CJ=ue(()=>{"use strict";Ue(),Qe(),pC(),tR=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(e[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},nR=e=>{let t=e[0].dims.slice();t[2]=t[2]/2;let i=ee("input",e[0].dataType,e[0].dims,4),n=ee("bias",e[0].dataType,[e[0].dims[2]],4),r=Ee("output",e[0].dataType,t,4),o=Z.size(t)/4,s=In(e[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)}}),getShaderSource:a=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${e[0].dims[2]/4/2}u;

  ${a.declareVariables(i,n,r)}

  ${Ig(s)}

  ${a.mainStart()}
    ${a.guardAgainstOutOfBoundsWorkgroupSizes(o)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${r.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},hP=e=>{tR(e.inputs),e.compute(nR(e.inputs))}}),iR,rR,pr,pP,mP,gP,_P,vP,bP,yP,wP,xP,CP,EJ=ue(()=>{"use strict";Fe(),Ue(),Qe(),iR=(e,t,i,n,r,o,s,a,u,c,f,p)=>{let m,v;typeof a=="string"?m=v=(y,I)=>`${a}((${y}),(${I}))`:typeof a=="function"?m=v=a:(m=a.scalar,v=a.vector);let b=Ee("outputData",f,n.length,4),w=ee("aData",u,t.length,4),C=ee("bData",c,i.length,4),x;if(r)if(o){let y=Z.size(t)===1,I=Z.size(i)===1,S=t.length>0&&t[t.length-1]%4===0,T=i.length>0&&i[i.length-1]%4===0;y||I?x=b.setByOffset("global_idx",v(y?`${w.type.value}(${w.getByOffset("0")}.x)`:w.getByOffset("global_idx"),I?`${C.type.value}(${C.getByOffset("0")}.x)`:C.getByOffset("global_idx"))):x=`
            let outputIndices = ${b.offsetToIndices("global_idx * 4u")};
            let offsetA = ${w.broadcastedIndicesToOffset("outputIndices",b)};
            let offsetB = ${C.broadcastedIndicesToOffset("outputIndices",b)};
            ${b.setByOffset("global_idx",v(s||S?w.getByOffset("offsetA / 4u"):`${w.type.value}(${w.getByOffset("offsetA / 4u")}[offsetA % 4u])`,s||T?C.getByOffset("offsetB / 4u"):`${C.type.value}(${C.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else x=b.setByOffset("global_idx",v(w.getByOffset("global_idx"),C.getByOffset("global_idx")));else{if(!o)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let y=(I,S,T="")=>{let $=`aData[indexA${S}][componentA${S}]`,k=`bData[indexB${S}][componentB${S}]`;return`
            let outputIndices${S} = ${b.offsetToIndices(`global_idx * 4u + ${S}u`)};
            let offsetA${S} = ${w.broadcastedIndicesToOffset(`outputIndices${S}`,b)};
            let offsetB${S} = ${C.broadcastedIndicesToOffset(`outputIndices${S}`,b)};
            let indexA${S} = offsetA${S} / 4u;
            let indexB${S} = offsetB${S} / 4u;
            let componentA${S} = offsetA${S} % 4u;
            let componentB${S} = offsetB${S} % 4u;
            ${I}[${S}] = ${T}(${m($,k)});
          `};f===9?x=`
            var data = vec4<u32>(0);
            ${y("data",0,"u32")}
            ${y("data",1,"u32")}
            ${y("data",2,"u32")}
            ${y("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:x=`
            ${y("outputData[global_idx]",0)}
            ${y("outputData[global_idx]",1)}
            ${y("outputData[global_idx]",2)}
            ${y("outputData[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(w,C,b)}

        ${p??""}

        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${x}
      }`},rR=(e,t,i,n,r,o,s=i.dataType)=>{let a=i.dims.map(w=>Number(w)??1),u=n.dims.map(w=>Number(w)??1),c=!Z.areEqual(a,u),f=a,p=Z.size(a),m=!1,v=!1,b=[c];if(c){let w=jl.calcShape(a,u,!1);if(!w)throw new Error("Can't perform binary op on the given tensors");f=w.slice(),p=Z.size(f);let C=Z.size(a)===1,x=Z.size(u)===1,y=a.length>0&&a[a.length-1]%4===0,I=u.length>0&&u[u.length-1]%4===0;b.push(C),b.push(x),b.push(y),b.push(I);let S=1;for(let T=1;T<f.length;T++){let $=a[a.length-T],k=u[u.length-T];if($===k)S*=$;else break}S%4===0?(v=!0,m=!0):(C||x||y||I)&&(m=!0)}else m=!0;return b.push(m),{name:e,shaderCache:{hint:t+b.map(w=>w.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:w=>iR(w,a,u,f,m,c,v,r,i.dataType,n.dataType,s,o),getRunData:()=>({outputs:[{dims:f,dataType:s}],dispatchGroup:{x:Math.ceil(p/64/4)},programUniforms:[{type:12,data:Math.ceil(Z.size(f)/4)},...Te(a,u,f)]})}},pr=(e,t,i,n,r,o)=>{e.compute(rR(t,r??"",e.inputs[0],e.inputs[1],i,n,o))},pP=e=>{pr(e,"Add",(t,i)=>`${t}+${i}`)},mP=e=>{pr(e,"Div",(t,i)=>`${t}/${i}`)},gP=e=>{pr(e,"Equal",{scalar:(t,i)=>`u32(${t}==${i})`,vector:(t,i)=>`vec4<u32>(${t}==${i})`},void 0,void 0,9)},_P=e=>{pr(e,"Mul",(t,i)=>`${t}*${i}`)},vP=e=>{let t=ee("input",e.inputs[0].dataType,e.inputs[0].dims).type.value;pr(e,"Pow",{scalar:(i,n)=>`pow_custom(${i},${n})`,vector:(i,n)=>`pow_vector_custom(${i},${n})`},`
    fn pow_custom(a : ${t}, b : ${t}) -> ${t} {
      if (b == ${t}(0.0)) {
        return ${t}(1.0);
      } else if (a < ${t}(0.0) && f32(b) != floor(f32(b))) {
        return ${t}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${t}(1.0), round(f32(abs(b) % ${t}(2.0))) != 1.0) * ${t}(${t==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${t}>, b : vec4<${t}>) -> vec4<${t}> {
      // TODO: implement vectorized pow
      return vec4<${t}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},bP=e=>{pr(e,"Sub",(t,i)=>`${t}-${i}`)},yP=e=>{pr(e,"Greater",{scalar:(t,i)=>`u32(${t}>${i})`,vector:(t,i)=>`vec4<u32>(${t}>${i})`},void 0,void 0,9)},wP=e=>{pr(e,"Less",{scalar:(t,i)=>`u32(${t}<${i})`,vector:(t,i)=>`vec4<u32>(${t}<${i})`},void 0,void 0,9)},xP=e=>{pr(e,"GreaterOrEqual",{scalar:(t,i)=>`u32(${t}>=${i})`,vector:(t,i)=>`vec4<u32>(${t}>=${i})`},void 0,void 0,9)},CP=e=>{pr(e,"LessOrEqual",{scalar:(t,i)=>`u32(${t}<=${i})`,vector:(t,i)=>`vec4<u32>(${t}<=${i})`},void 0,void 0,9)}}),oR,sR,aR,lR,EP,IP,IJ=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),oR=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");let i=0,n=e[i],r=n.dataType,o=n.dims.length;e.forEach((s,a)=>{if(a!==i){if(s.dataType!==r)throw new Error("input tensors should be one type");if(s.dims.length!==o)throw new Error("input tensors should have the same shape");s.dims.forEach((u,c)=>{if(c!==t&&u!==n.dims[c])throw new Error("non concat dimensions must match")})}})},sR=(e,t)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${e}u>(${t});
    for (var i: u32 = 0u; i < ${e}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${e}u;
  }`,aR=(e,t)=>{let i=e.length,n=[];for(let r=0;r<i;++r){let o=t.setByOffset("global_idx",e[r].getByIndices("indices"));i===1?n.push(o):r===0?n.push(`if (inputIndex == ${r}u) { ${o} }`):r===i-1?n.push(`else { ${o} }`):n.push(`else if (inputIndex == ${r}) { ${o} }`)}return n.join(`
`)},lR=(e,t,i,n)=>{let r=Z.size(i),o=new Array(e.length),s=new Array(e.length),a=0,u=[],c=[],f=[{type:12,data:r}];for(let w=0;w<e.length;++w)a+=e[w].dims[t],o[w]=a,c.push(e[w].dims.length),s[w]=ee(`input${w}`,n,c[w]),u.push("rank"),f.push({type:12,data:o[w]});for(let w=0;w<e.length;++w)f.push(...Te(e[w].dims));f.push(...Te(i));let p=Ee("output",n,i.length),m=p.indicesGet("indices",t),v=Array.from(Array(o.length).keys()).map(w=>`uniforms.sizeInConcatAxis${w}`).join(","),b=w=>`

  ${(()=>{w.registerUniform("outputSize","u32");for(let C=0;C<e.length;C++)w.registerUniform(`sizeInConcatAxis${C}`,"u32");return w.declareVariables(...s,p)})()}

  ${sR(o.length,v)}

  ${w.mainStart()}
    ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${p.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${m});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${o.length}u>(${v});
      ${m} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${aR(s,p)}
  }`;return{name:"Concat",shaderCache:{hint:`${t}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:i,dataType:n}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:f}),getShaderSource:b}},EP=(e,t)=>{let i=e.inputs,n=i[0].dims,r=Z.normalizeAxis(t.axis,n.length);oR(i,r);let o=n.slice();o[r]=i.reduce((a,u)=>a+(u.dims.length>r?u.dims[r]:0),0);let s=i.filter(a=>Z.size(a.dims)>0);e.compute(lR(s,r,o,i[0].dataType),{inputs:s})},IP=e=>$t({axis:e.axis})}),ga,_a,va,mC,ya=ue(()=>{"use strict";Fe(),Ue(),ga=(e,t,i="f32")=>{switch(e.activation){case"Relu":return`value = max(value, ${t}(0.0));`;case"Sigmoid":return`value = (${t}(1.0) / (${t}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${t}(${i}(uniforms.clip_min)), ${t}(${i}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${t}(0.0), min(${t}(1.0), ${i}(uniforms.alpha) * value + ${i}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${i}(uniforms.alpha) * value, value, value >= ${t}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${e.activation}`)}},_a=(e,t)=>{e.activation==="Clip"?t.push({type:1,data:e.clipMax},{type:1,data:e.clipMin}):e.activation==="HardSigmoid"?t.push({type:1,data:e.alpha},{type:1,data:e.beta}):e.activation==="LeakyRelu"&&t.push({type:1,data:e.alpha})},va=(e,t)=>{e.activation==="Clip"?t.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):e.activation==="HardSigmoid"?t.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):e.activation==="LeakyRelu"&&t.push({name:"alpha",type:"f32"})},mC=e=>{let t=e?.activation||"";if(t==="HardSigmoid"){let[i,n]=e?.activation_params||[.2,.5];return{activation:t,alpha:i,beta:n}}else if(t==="Clip"){let[i,n]=e?.activation_params||[t3,n3];return{activation:t,clipMax:n,clipMin:i}}else if(t==="LeakyRelu"){let[i]=e?.activation_params||[.01];return{activation:t,alpha:i}}return{activation:t}}}),kn,SP,gC=ue(()=>{"use strict";kn=(e,t)=>{switch(e){case 1:return t;case 2:return`vec2<${t}>`;case 3:return`vec3<${t}>`;case 4:return`vec4<${t}>`;default:throw new Error(`${e}-component is not supported.`)}},SP=e=>`
      ${e?"value = value + getBiasByOutputCoords(coords);":""}
      `}),DP,SJ=ue(()=>{"use strict";DP=e=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${e}.x), i32(${e}.y), i32(${e}.z), 1));
}
`}),Tf,_C,vC=ue(()=>{"use strict";Fe(),Ue(),Qe(),ya(),Tf=(e,t,i,n,r)=>{let o=n-i;return`
      ${Array.from({length:i}).map((s,a)=>`
      if (${Se(t.shape,a,t.rank)} != 1) {
        ${t.indicesSet(e,a,Se(r,a+o,n))}
      } else {
        ${t.indicesSet(e,a,0)}
      }`).join("")}
`},_C=(e,t,i,n,r=!1,o)=>{let s=e[0].dims,a=e[1].dims,u=s[s.length-2],c=a[a.length-1],f=s[s.length-1],p=en(c),m=en(f),v=en(u),b=Z.size(i)/p/v,w=e.length>2,C=n?n.slice(0,-2):i.slice(0,-2),x=[Z.size(C),u,c],y=[{type:12,data:b},{type:12,data:u},{type:12,data:c},{type:12,data:f}];_a(t,y),y.push(...Te(C,s,a)),w&&y.push(...Te(e[2].dims)),y.push(...Te(x));let I=S=>{let T=dC("batch_dims",e[0].dataType,C.length),$=ee("a",e[0].dataType,s.length,m),k=ee("b",e[1].dataType,a.length,p),P=Ee("output",e[0].dataType,x.length,p),j=In(P.type.tensor),H=ga(t,P.type.value,j),re=[$,k],ae="";if(w){let ye=r?p:1;re.push(ee("bias",e[2].dataType,e[2].dims.length,ye)),ae=`${r?`value += bias[col / ${ye}];`:`value += ${P.type.value}(bias[row + i]);`}`}let L=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];va(t,L);let ge=()=>{let ye=`var a_data: ${$.type.value};`;for(let Y=0;Y<m;Y++)ye+=`
              let b_data${Y} = b[(b_offset + (k + ${Y}) * uniforms.N + col) / ${p}];`;for(let Y=0;Y<v;Y++){ye+=`a_data = a[(a_offset + (row + ${Y}) * uniforms.K + k) / ${m}];`;for(let ve=0;ve<m;ve++)ye+=`
            values[${Y}] = fma(${k.type.value}(a_data${m===1?"":`[${ve}]`}), b_data${ve}, values[${Y}]);
`}return ye};return`
  ${S.registerUniforms(L).registerInternalVariables(T).declareVariables(...re,P)}
  ${S.mainStart()}
    ${S.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${p})) * ${p};
    var index1 = global_idx / (uniforms.N / ${p});
    let stride1 = uniforms.M / ${v};
    let row = (index1 % stride1) * ${v};
    let batch = index1 / stride1;

    ${i.length===2?"":`let batch_indices = ${T.offsetToIndices("batch")};`}

    var a_indices: ${$.type.indices};
    ${Tf("a_indices",$,$.rank-2,T.rank,"batch_indices")}
    ${$.indicesSet("a_indices",$.rank-2,0)}
    ${$.indicesSet("a_indices",$.rank-1,0)}
    let a_offset = ${$.indicesToOffset("a_indices")};

    var b_indices: ${k.type.indices};
    ${Tf("b_indices",k,k.rank-2,T.rank,"batch_indices")}
    ${k.indicesSet("b_indices",k.rank-2,0)}
    ${k.indicesSet("b_indices",k.rank-1,0)}
    let b_offset = ${k.indicesToOffset("b_indices")};
    var values: array<${P.type.value}, ${v}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${m}) {
      ${ge()}
    }
    for (var i = 0u; i < ${v}u; i++) {
      var value = values[i];
      ${ae}
      ${H}
      let cur_indices = ${P.type.indices}(batch, row + i, col);
      let offset = ${P.indicesToOffset("cur_indices")};
      ${P.setByOffset(`offset / ${p}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${t.activation};${p};${m};${v};${r}`,inputDependencies:w?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:o?o(i):i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:y}),getShaderSource:I}}}),uR,cR,W1,a1,dR,q1,fR,Ag,bC=ue(()=>{"use strict";Fe(),Ue(),Qe(),ya(),vC(),gC(),uR=(e,t)=>e?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${t?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${t?", batchIndices":""});
        `,cR=(e,t)=>e?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${t===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,W1=(e,t,i="f32",n,r=!1,o=32,s=!1,a=32)=>{let u=t[1]*e[1],c=t[0]*e[0],f=r?u:o,p=r?o:u,m=f/t[0],v=o/t[1];if(!((r&&m===4&&e[1]===4||!r&&(m===3||m===4))&&f%t[0]===0&&o%t[1]===0&&e[0]===4))throw new Error(`If transposeA ${r} is true, innerElementSize ${m} and workPerThread[1] ${e[1]} must be 4.
      Otherwise, innerElementSize ${m} must be 3 or 4.
  tileAWidth ${f} must be divisible by workgroupSize[0]${t[0]}. tileInner ${o} must be divisible by workgroupSize[1] ${t[1]}. colPerThread ${e[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${m}<${i}>, ${f/m}>, ${p}>;
var<workgroup> mm_Bsub: array<array<vec4<${i}>, ${c/e[0]}>, ${o}>;

const rowPerThread = ${e[1]};
const colPerThread = ${e[0]};
const innerElementSize = ${m};
const tileInner = ${o};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${s?"0":"i32(globalId.z)"};
  ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${u};

  let num_tiles = ${s?`${Math.ceil(a/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${s?`i32(globalId.z) * ${a}`:"0"};

  var acc: array<vec4<${i}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${v};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${uR(r,n)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${v}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${n?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${m===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${cR(r,m)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},a1=(e,t)=>e?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${t?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${t?", batchIndices":""});
            `,dR=e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",q1=(e,t,i="f32",n,r=!1,o=32,s=!1,a=32,u=!1)=>{let c=e[1]*t[1],f=e[0]*t[0],p=r?c:o,m=r?o:c;if(!(m%t[1]===0&&p%t[0]===0&&o%t[1]===0))throw new Error(`tileAHight ${m} must be divisible by workgroupSize[1]${t[1]}, tileAWidth ${p} must be divisible by workgroupSize[0]${t[0]}, tileInner ${o} must be divisible by workgroupSize[1]${t[1]}`);let v=m/t[1],b=p/t[0],w=o/t[1],C=u?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${c};
    let globalColStart = i32(workgroupId.x) * ${f};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${m}; inputRow = inputRow + ${t[1]}) {
        for (var inputCol = localCol; inputCol < ${p}; inputCol = inputCol + ${t[0]}) {
          ${a1(r,n)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${o}; inputRow = inputRow + ${t[1]}) {
            for (var inputCol = localCol; inputCol < ${f}; inputCol = inputCol + ${t[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${n?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${i}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${t[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${r?`mm_Asub[k][localRow + innerRow * ${t[1]}];`:`mm_Asub[localRow + innerRow * ${t[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${t[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${t[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${c};

let tileRowA = i32(localId.y) * ${v};
let tileColA = i32(localId.x) * ${b};
let tileRowB = i32(localId.y) * ${w};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${v}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${b}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${a1(r,n)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${w}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${n?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${i}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${dR(r)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${i}, ${p}>, ${m}>;
  var<workgroup> mm_Bsub : array<array<${i}, ${f}>, ${o}>;
  const rowPerThread = ${e[1]};
  const colPerThread = ${e[0]};
  const tileInner = ${o};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${s?"0":"i32(globalId.z)"};
    ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${s?`${Math.ceil(a/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${s?`i32(globalId.z) * ${a}`:"0"};

    var acc : array<array<${i}, colPerThread>, rowPerThread>;
    ${C}
  }
`},fR=(e,t,i,n,r=!1)=>{let[o,s,a,u]=n,c=In(n[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${o.type.indices}) -> ${kn(e,c)} {
      var value = ${kn(e,c)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${s.type.indices};
        ${Tf("aIndices",s,s.rank-2,o.rank,"batchIndices")}
        ${s.indicesSet("aIndices",s.rank-2,"u32(row)")}
        ${s.indicesSet("aIndices",s.rank-1,"u32(colIn)")}
        value = ${s.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${o.type.indices}) -> ${kn(e,c)} {
      var value = ${kn(e,c)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${a.type.indices};
        ${Tf("bIndices",a,a.rank-2,o.rank,"batchIndices")}
        ${a.indicesSet("bIndices",a.rank-2,"u32(row)")}
        ${a.indicesSet("bIndices",a.rank-1,"u32(colIn)")}
        value = ${a.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${kn(e,c)}) {
      let col = colIn * ${e};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${t?`value = value + ${r?"bias[colIn]":`${kn(e,c)}(bias[row])`};`:""}
        ${i}
        ${u.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},Ag=(e,t,i,n,r=!1,o)=>{let s=e[0].dims,a=e[1].dims,u=s.slice(0,-2),c=a.slice(0,-2),f=n?n.slice(0,-2):i.slice(0,-2),p=Z.size(f),m=s[s.length-2],v=s[s.length-1],b=a[a.length-1],w=v%4===0&&b%4===0,C=m<=8?[4,1,1]:[4,4,1],x=[8,8,1],y=[Math.ceil(b/x[0]/C[0]),Math.ceil(m/x[1]/C[1]),Math.ceil(p/x[2]/C[2])],I=w?4:1,S=[...u,m,v/I],T=S.length,$=[...c,v,b/I],k=$.length,P=[p,m,b/I],j=[{type:6,data:m},{type:6,data:b},{type:6,data:v}];_a(t,j),j.push(...Te(f,S,$));let H=["rank","rank"],re=e.length>2;re&&(j.push(...Te(e[2].dims)),H.push("rank")),j.push(...Te(P));let ae=L=>{let ge=f.length,ye=dC("batchDims",e[0].dataType,ge,1),Y=In(e[0].dataType),ve=ee("a",e[0].dataType,T,I),we=ee("b",e[1].dataType,k,I),X=Ee("result",e[0].dataType,P.length,I),xe=[ve,we];if(re){let Ke=r?I:1;xe.push(ee("bias",e[2].dataType,e[2].dims.length,Ke))}let z=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];va(t,z);let W=In(X.type.tensor),R=ga(t,X.type.value,W),se=fR(I,re,R,[ye,ve,we,X],r);return`
  ${L.registerUniforms(z).registerInternalVariables(ye).declareVariables(...xe,X)}
  ${se}
  ${w?W1(C,x,Y,ye):q1(C,x,Y,ye)}
                   `};return{name:"MatMul",shaderCache:{hint:`${C};${t.activation};${w};${r}`,inputDependencies:H},getRunData:()=>({outputs:[{dims:o?o(i):i,dataType:e[0].dataType}],dispatchGroup:{x:y[0],y:y[1],z:y[2]},programUniforms:j}),getShaderSource:ae}}}),hR,TP,DJ=ue(()=>{"use strict";Fe(),yo(),Qe(),ya(),gC(),SJ(),bC(),hR=(e,t,i,n,r=!1,o,s=4,a=4,u=4,c="f32")=>{let f=j=>{switch(j){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${c}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${j} is not supported.`)}},p=j=>{switch(j){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${j} is not supported.`)}},m=e?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,v=e?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,b=e?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",w=e?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",C=e?"row":"col",x=e?"col":"row",y=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${C} / outWidth;
    let outCol = ${C} % outWidth;

    let WRow = ${x} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${x} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${x} % inChannels;
    var resData = ${kn(s,c)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${b} && xCol >= 0 && xCol < ${w}) {
      ${m}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${f(s)}
    }
    return resData;`,I=e?t&&n?`
    let col = colIn * ${s};
    ${y}`:`
    let col = colIn * ${s};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${y}
    }
    return ${kn(s,c)}(0.0);`:n&&i?`
    let col = colIn * ${s};
    ${y}`:`
    let col = colIn * ${s};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${y}
    }
    return ${kn(s,c)}(0.0);`,S=e?n&&i?p(a):`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${p(a)}
    }
    return ${kn(a,c)}(0.0);`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${p(a)}
    }
    return ${kn(a,c)}(0.0);`,T=kn(u,c),$=kn(e?s:a,c),k=kn(e?a:s,c),P=ga(o,T,c);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${$} {
      ${e?I:S}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${k} {
      ${e?S:I}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${T}) {
      let col = colIn * ${u};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${v}
      ${SP(r)}
      ${P}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},TP=(e,t,i,n,r,o,s,a,u)=>{let c=t.format==="NHWC",f=c?e[0].dims[3]:e[0].dims[1],p=i[0],m=c?i[2]:i[3],v=c?i[1]:i[2],b=c?i[3]:i[1],w=c&&(f%4===0||f%3===0)&&b%4===0,C=c?b:m*v,x=c?m*v:b,y=[8,8,1],I=n<=8?[4,1,1]:[4,4,1],S=[Math.ceil(C/y[0]/I[0]),Math.ceil(x/y[1]/I[1]),Math.ceil(p/y[2]/I[2])];pt("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${S}`);let T=w?c&&f%4!==0?3:4:1,$=y[1]*I[1],k=y[0]*I[0],P=Math.max(y[0]*T,y[1]),j=n%$===0,H=r%k===0,re=o%P===0,ae=w?[T,4,4]:[1,1,1],L=[{type:6,data:n},{type:6,data:r},{type:6,data:o},{type:6,data:[t.pads[0],t.pads[1]]},{type:6,data:t.strides},{type:6,data:t.dilations}];_a(t,L),L.push(...Te(e[0].dims,e[1].dims));let ge=["rank","rank"];s&&(L.push(...Te(e[2].dims)),ge.push("rank")),L.push(...Te(i));let ye=Y=>{let ve=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];va(t,ve);let we=w?4:1,X=In(e[0].dataType),xe=`
      fn setOutputAtIndex(flatIndex : i32, value : ${w?`vec4<${X}>`:X}) {
        result[flatIndex] = ${w?`vec4<${X}>`:X}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${w?`vec4<${X}>`:X}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${w?"/ 4":""}, value);
      }`,z=ee("x",e[0].dataType,e[0].dims.length,T===3?1:T),W=ee("w",e[1].dataType,e[1].dims.length,we),R=[z,W],se=Ee("result",e[0].dataType,i.length,we);if(s){let Ke=ee("bias",e[2].dataType,e[2].dims.length,we);R.push(Ke),xe+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${w?`vec4<${X}>`:X} {
          return bias[coords.${c?"w":"y"}${w?"/ 4":""}];
        }`}return`
        ${DP("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${Y.registerUniforms(ve).declareVariables(...R,se)}
        ${xe}
        ${hR(c,j,H,re,s,t,ae[0],ae[1],ae[2],X)}
        ${w?W1(I,y,X,void 0,!c,P):q1(I,y,X,void 0,!c,P,!1,void 0,a)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${t.cacheKey};${T};${w};${j};${H};${re};${$};${k};${P}`,inputDependencies:ge},getRunData:()=>({outputs:[{dims:u?u(i):i,dataType:e[0].dataType}],dispatchGroup:{x:S[0],y:S[1],z:S[2]},programUniforms:L}),getShaderSource:ye}}}),pR,l1,vf,mR,u1,gR,$P,kP,TJ=ue(()=>{"use strict";Fe(),yo(),Ue(),Qe(),ya(),gC(),pR=e=>{let t=1;for(let i=0;i<e.length;i++)t*=e[i];return t},l1=e=>typeof e=="number"?[e,e,e]:e,vf=(e,t)=>t<=1?e:e+(e-1)*(t-1),mR=(e,t,i,n=1)=>{let r=vf(t,n);return Math.floor((e[0]*(i-1)-i+r)/2)},u1=(e,t,i,n,r)=>{r==null&&(r=mR(e,t[0],n[0]));let o=[0,0,0,i];for(let s=0;s<3;s++)e[s]+2*r>=t[s]&&(o[s]=Math.trunc((e[s]-t[s]+2*r)/n[s]+1));return o},gR=(e,t,i,n,r,o,s,a,u,c)=>{let f,p,m,v;if(e==="VALID"&&(e=0),typeof e=="number"){f={top:e,bottom:e,left:e,right:e,front:e,back:e};let b=u1([t,i,n,1],[a,u,c],1,[r,o,s],e);p=b[0],m=b[1],v=b[2]}else if(Array.isArray(e)){if(!e.every((w,C,x)=>w===x[0]))throw Error(`Unsupported padding parameter: ${e}`);f={top:e[0],bottom:e[1],left:e[2],right:e[3],front:e[4],back:e[5]};let b=u1([t,i,n,1],[a,u,c],1,[r,o,s],e[0]);p=b[0],m=b[1],v=b[2]}else if(e==="SAME_UPPER"){p=Math.ceil(t/r),m=Math.ceil(i/o),v=Math.ceil(n/s);let b=(p-1)*r+a-t,w=(m-1)*o+u-i,C=(v-1)*s+c-n,x=Math.floor(b/2),y=b-x,I=Math.floor(w/2),S=w-I,T=Math.floor(C/2),$=C-T;f={top:I,bottom:S,left:T,right:$,front:x,back:y}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:f,outDepth:p,outHeight:m,outWidth:v}},$P=(e,t,i,n,r,o=!1,s="channelsLast")=>{let a,u,c,f,p;if(s==="channelsLast")[a,u,c,f,p]=e;else if(s==="channelsFirst")[a,p,u,c,f]=e;else throw new Error(`Unknown dataFormat ${s}`);let[m,,v,b,w]=t,[C,x,y]=l1(i),[I,S,T]=l1(n),$=vf(v,I),k=vf(b,S),P=vf(w,T),{padInfo:j,outDepth:H,outHeight:re,outWidth:ae}=gR(r,u,c,f,C,x,y,$,k,P),L=o?m*p:m,ge=[0,0,0,0,0];return s==="channelsFirst"?ge=[a,L,H,re,ae]:s==="channelsLast"&&(ge=[a,H,re,ae,L]),{batchSize:a,dataFormat:s,inDepth:u,inHeight:c,inWidth:f,inChannels:p,outDepth:H,outHeight:re,outWidth:ae,outChannels:L,padInfo:j,strideDepth:C,strideHeight:x,strideWidth:y,filterDepth:v,filterHeight:b,filterWidth:w,effectiveFilterDepth:$,effectiveFilterHeight:k,effectiveFilterWidth:P,dilationDepth:I,dilationHeight:S,dilationWidth:T,inShape:e,outShape:ge,filterShape:t}},kP=(e,t,i,n,r,o)=>{let s=o==="channelsLast",a=s?e[0].dims[3]:e[0].dims[1],u=!1,c=[64,1,1],f={x:i.map((y,I)=>I)},p=[Math.ceil(pR(f.x.map(y=>i[y]))/c[0]),1,1];pt("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${p}`);let m=u?s&&a%4!==0?3:4:1,v=Z.size(i),b=[{type:12,data:v},{type:12,data:n},{type:12,data:r},{type:12,data:t.strides},{type:12,data:t.dilations}];_a(t,b),b.push(...Te(e[0].dims,e[1].dims));let w=["rank","rank"],C=e.length===3;C&&(b.push(...Te(e[2].dims)),w.push("rank")),b.push(...Te(i));let x=y=>{let I=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:n.length},{name:"pads",type:"u32",length:r.length},{name:"strides",type:"u32",length:t.strides.length},{name:"dilations",type:"u32",length:t.dilations.length}];va(t,I);let S=u?4:1,T=In(e[0].dataType),$=ee("x",e[0].dataType,e[0].dims.length,m===3?1:m),k=ee("W",e[1].dataType,e[1].dims.length,S),P=[$,k],j=Ee("result",e[0].dataType,i.length,S),H="";if(C){let L=ee("bias",e[2].dataType,e[2].dims.length,S);P.push(L),H+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${u?`vec4<${T}>`:T} {
          return bias[${s?Se("coords",4,5):Se("coords",1,5)}${u?"/ 4":""}];
        }`}let re=kn(m,T),ae=ga(t,re,T);return`
            ${H}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${$.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${k.getByIndices("aIndices")};
            }
          ${y.registerUniforms(I).declareVariables(...P,j)}
          ${y.mainStart()}
          ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${j.offsetToIndices("global_idx")};
              let batch = ${Se("coords",0,$.rank)};
              let d2 = ${s?Se("coords",$.rank-1,$.rank):Se("coords",1,$.rank)};
              let xFRCCorner = vec3<u32>(${s?Se("coords",1,$.rank):Se("coords",2,$.rank)},
              ${s?Se("coords",2,$.rank):Se("coords",3,$.rank)},
              ${s?Se("coords",3,$.rank):Se("coords",4,$.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${s?Se("uniforms.x_shape",1,$.rank):Se("uniforms.x_shape",2,$.rank)};
              let xShapeZ = ${s?Se("uniforms.x_shape",2,$.rank):Se("uniforms.x_shape",3,$.rank)};
              let xShapeW = ${s?Se("uniforms.x_shape",3,$.rank):Se("uniforms.x_shape",4,$.rank)};
              let xShapeU = ${s?Se("uniforms.x_shape",4,$.rank):Se("uniforms.x_shape",1,$.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${s?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${s?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${s?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${s?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${C?"value = value + getBiasByOutputCoords(coords)":""};
              ${ae}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${t.cacheKey};${s};${m};${C}`,inputDependencies:w},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:p[0],y:p[1],z:p[2]},programUniforms:b}),getShaderSource:x}}}),MP,AP,$J=ue(()=>{"use strict";Fe(),Ue(),Qe(),ya(),MP=(e,t,i,n)=>{let r=e.length>2,o=r?"value += b[output_channel];":"",s=e[0].dims,a=e[1].dims,u=t.format==="NHWC",c=u?i[3]:i[1],f=c/t.group,p=u&&f>=4?en(c):1,m=Z.size(i)/p,v=[{type:12,data:m},{type:12,data:t.dilations},{type:12,data:[t.strides[0],t.strides[1]]},{type:12,data:[t.pads[0],t.pads[1]]},{type:12,data:f}];_a(t,v),v.push(...Te(s,[a[0],a[1],a[2],a[3]/p]));let b=r?["rank","rank","rank"]:["rank","rank"];v.push(...Te([i[0],i[1],i[2],i[3]/p]));let w=C=>{let x=Ee("output",e[0].dataType,i.length,p),y=In(x.type.tensor),I=ga(t,x.type.value,y),S=ee("x",e[0].dataType,s.length),T=ee("w",e[1].dataType,a.length,p),$=[S,T];r&&$.push(ee("b",e[2].dataType,e[2].dims,p));let k=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:t.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];va(t,k);let P=u?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${S.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${T.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${S.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${T.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${C.registerUniforms(k).declareVariables(...$,x)}

  ${C.mainStart()}
    ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${x.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${u?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${u?1:2}], outputIndices[${u?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${p} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${u?2:1}];

    var value: ${x.type.value} = ${x.type.value}(0);
    ${P}
    ${o}
    ${I}
    ${x.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${t.cacheKey}_${p}`,inputDependencies:b},getRunData:()=>({outputs:[{dims:n?n(i):i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:v}),getShaderSource:w}},AP=(e,t,i,n)=>{let r=e.length>2,o=en(i[3]),s=en(i[2]),a=Z.size(i)/o/s,u=[e[0].dims[0],e[0].dims[1],e[0].dims[2],e[0].dims[3]/o],c=[e[1].dims[0],e[1].dims[1],e[1].dims[2],e[1].dims[3]/o],f=[i[0],i[1],i[2],i[3]/o],p=[{type:12,data:a},{type:6,data:[t.strides[0],t.strides[1]]},{type:6,data:[t.pads[0],t.pads[1]]}];_a(t,p),p.push(...Te(u,c,f));let m=(s-1)*t.strides[1]+c[1],v=b=>{let w=Ee("output",e[0].dataType,f.length,o),C=In(w.type.tensor),x=ga(t,w.type.value,C),y=ee("x",e[0].dataType,u.length,o),I=ee("w",e[1].dataType,c.length,o),S=[y,I];r&&S.push(ee("b",e[2].dataType,e[2].dims,o));let T=r?"value += b[output_channel];":"",$=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return va(t,$),`
  ${b.registerUniforms($).declareVariables(...S,w)}
  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${s}u;
    let col = (index1 % width1) * ${s}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${y.type.value}, ${m}>;
    var values: array<${w.type.value}, ${s}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${c[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${m}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${y.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${y.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${c[1]}; w_width++) {
          let w_val = ${I.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${s}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${s}u; i++) {
      var value = values[i];
      ${T}
      ${x}
      ${w.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${t.cacheKey};${o};${s};${m};${c[0]};${c[1]}`,inputDependencies:r?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:n?n(i):i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:p}),getShaderSource:v}}}),_R,_g,vR,vg,G1,c1,bR,yR,K1,kJ=ue(()=>{"use strict";Ue(),DJ(),TJ(),bC(),$J(),ya(),vC(),is(),_R=(e,t,i,n,r,o)=>{let s=e[0],a=e.slice(o?1:2,o?3:4),u=a.length,c=t[0],f=t.slice(2).map((m,v)=>m+(m-1)*(i[v]-1)),p=a.map((m,v)=>m+n[v]+n[v+u]).map((m,v)=>Math.floor((m-f[v]+r[v])/r[v]));return p.splice(0,0,s),p.splice(o?3:1,0,c),p},_g=[2,3,1,0],vR=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length>5)throw new Error("greater than 5D is not supported");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let i=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],n=e[1].dims[1]*t.group;if(i!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(e.length===3&&(e[2].dims.length!==1||e[1].dims[0]!==e[2].dims[0]))throw new Error("invalid bias");let r=e[0].dims.length-2;if(t.dilations.length!==r)throw new Error(`dilations should be ${r}D`);if(t.strides.length!==r)throw new Error(`strides should be ${r}D`);if(t.pads.length!==r*2)throw new Error(`pads should be ${r*2}D`);if(t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape")},vg=(e,t)=>{let i=e.kernelShape.slice();i.length<t[1].dims.length-2&&i.push(...Array(t[1].dims.length-2-i.length).fill(0));for(let o=2;o<t[1].dims.length;++o)i[o-2]===0&&(i[o-2]=t[1].dims[o]);let n=e.pads.slice();kg.adjustPadsBasedOnAutoPad(t[0].dims,e.strides,e.dilations,i,n,e.format==="NHWC",e.autoPad);let r=Object.assign({},e);return Object.assign(r,{kernelShape:i,pads:n}),r},G1=e=>{let t=mC(e),i=e.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],r=e.dilations,o=e.group,s=e.kernel_shape,a=e.pads,u=e.strides,c=e.w_is_const();return Ae(ie({autoPad:n,format:i,dilations:r,group:o,kernelShape:s,pads:a,strides:u,wIsConst:c},t),{cacheKey:`${e.format};${t.activation};`})},c1=(e,t,i,n)=>{let r=i.format==="NHWC",o=_R(t[0].dims,t[1].dims,i.dilations,i.pads,i.strides,r);if(i.group!==1){let $=[t[0]];if(r){let k=e.kernelCustomData.wT??e.compute(Ti(t[1],_g),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];i.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=k),$.push(k)}else $.push(t[1]);t.length===3&&$.push(t[2]),!e.adapterInfo.isArchitecture("ampere")&&r&&t[1].dims[0]===i.group&&t[1].dims[1]===1&&i.dilations[0]===1&&i.dilations[1]===1?e.compute(AP($,i,o,n),{inputs:$}):e.compute(MP($,i,o,n),{inputs:$});return}let s=t.length===3,a=t[0].dims[r?1:2],u=t[0].dims[r?2:3],c=t[0].dims[r?3:1],f=t[1].dims[2],p=t[1].dims[3],m=o[r?1:2],v=o[r?2:3],b=o[r?3:1],w=r&&f===a&&p===u&&i.pads[0]===0&&i.pads[1]===0;if(w||f===1&&p===1&&i.dilations[0]===1&&i.dilations[1]===1&&i.strides[0]===1&&i.strides[1]===1&&i.pads[0]===0&&i.pads[1]===0){let $=o[0],k,P,j,H=[];if(r){let L=e.kernelCustomData.wT??e.compute(Ti(t[1],_g),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];if(i.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=L),w){let ge=a*u*c;k=t[0].reshape([1,$,ge]),P=L.reshape([1,ge,b]),j=[1,$,b]}else k=t[0].reshape([$,a*u,c]),P=L.reshape([1,c,b]),j=[$,m*v,b];H.push(k),H.push(P)}else k=t[0].reshape([$,c,a*u]),P=t[1].reshape([1,b,c]),j=[$,b,m*v],H.push(P),H.push(k);s&&H.push(t[2]);let re=j[2],ae=H[0].dims[H[0].dims.length-1];re<8&&ae<8?e.compute(_C(H,i,o,j,r,n),{inputs:H}):e.compute(Ag(H,i,o,j,r,n),{inputs:H});return}let C=!0,x=e.kernelCustomData.wT??e.compute(Ti(t[1],_g),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];i.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=x);let y=[t[0],x];s&&y.push(t[2]);let I=r?m*v:b,S=r?b:m*v,T=f*p*c;e.compute(TP(y,i,o,I,S,T,s,C,n),{inputs:y})},bR=(e,t)=>{let i=t.format==="NHWC",n=[e.inputs[0].reshape(i?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&n.push(e.inputs[2]);let r=[0,t.pads[0],0,t.pads[1]],o=[1].concat(t.strides),s=[1].concat(t.dilations),a=[1].concat(t.kernelShape),u=vg(Ae(ie({},t),{pads:r,strides:o,dilations:s,kernelShape:a}),n);c1(e,n,u,c=>i?[c[0],c[2],c[3]]:[c[0],c[1],c[3]])},yR=(e,t,i)=>{let n=i.format==="NHWC"?"channelsLast":"channelsFirst",r=vg(i,t),o=i.autoPad==="NOTSET"?i.pads:i.autoPad,s=$P(t[0].dims,t[1].dims,i.strides,i.dilations,o,!1,n);e.compute(kP(t,r,s.outShape,[s.filterDepth,s.filterHeight,s.filterWidth],[s.padInfo.front,s.padInfo.top,s.padInfo.left],n))},K1=(e,t)=>{if(vR(e.inputs,t),e.inputs[0].dims.length===3)bR(e,t);else if(e.inputs[0].dims.length===5)yR(e,e.inputs,t);else{let i=vg(t,e.inputs);c1(e,e.inputs,i)}}}),RP,MJ=ue(()=>{"use strict";Fe(),yo(),Ue(),Qe(),RP=(e,t,i)=>{let n=e.length>2,r=t.outputShape,o=t.format==="NHWC",s=t.group,a=e[1].dims,u=a[2]/s,c=a[3],f=o?en(u):1,p=o?en(c):1,m=o?c===1?f:p:1,v=Z.size(r)/p,b=[Math.ceil(v/64),1,1];pt("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${b}`);let w=["rank","rank"],C=[t.strides[0],t.strides[1]],x=[t.kernelShape[o?1:2],t.kernelShape[o?2:3]],y=[t.dilations[0],t.dilations[1]],I=[x[0]+(t.dilations[0]<=1?0:(t.kernelShape[o?1:2]-1)*(t.dilations[0]-1)),x[1]+(t.dilations[1]<=1?0:(t.kernelShape[o?2:3]-1)*(t.dilations[1]-1))],S=[I[0]-1-Math.floor((t.pads[0]+t.pads[2])/2),I[1]-1-Math.floor((t.pads[1]+t.pads[3])/2)],T=[{type:12,data:v},{type:12,data:C},{type:12,data:x},{type:12,data:y},{type:12,data:I},{type:6,data:S},{type:12,data:u},{type:12,data:c},...Te(e[0].dims,e[1].dims)];n&&(T.push(...Te(e[2].dims)),w.push("rank")),T.push(...Te(r));let $=k=>{let P=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:C.length},{name:"filter_dims",type:"u32",length:x.length},{name:"dilations",type:"u32",length:x.length},{name:"effective_filter_dims",type:"u32",length:I.length},{name:"pads",type:"i32",length:S.length},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],j=In(e[0].dataType),H=o?1:2,re=o?2:3,ae=o?3:1,L=ee("W",e[1].dataType,e[1].dims.length,m),ge=ee("Dy",e[0].dataType,e[0].dims.length,f),ye=[ge,L];n&&ye.push(ee("bias",e[2].dataType,[r[ae]].length,p));let Y=Ee("result",e[0].dataType,r.length,p),ve=()=>{let X="";if(f===1)X+=`
        let w_offset = ${L.indicesToOffset(`${L.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
        let wValue = ${L.getByOffset(`w_offset / ${m}`)};
        dotProd = dotProd + xValue * wValue;`;else if(c===1)X+=`
          let wValue = ${L.getByOffset(`${L.indicesToOffset(`${L.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)} / ${m}`)};
          dotProd = dotProd + dot(xValue, wValue);`;else for(let xe=0;xe<f;xe++)X+=`
            let wValue${xe} = ${L.getByOffset(`${L.indicesToOffset(`${L.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${xe}, wOutChannel)`)} / ${m}`)};
            dotProd = dotProd + xValue[${xe}] * wValue${xe};`;return X},we=`
            let outputIndices = ${Y.offsetToIndices(`global_idx * ${p}`)};
            let batch = ${Y.indicesGet("outputIndices",0)};
            let d1 = ${Y.indicesGet("outputIndices",ae)};
            let r = ${Y.indicesGet("outputIndices",H)};
            let c = ${Y.indicesGet("outputIndices",re)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${Y.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${j}(dyRCorner) + ${j}(wR)) / ${j}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${j}(uniforms.Dy_shape[${H}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }

              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${j}(dyCCorner) + ${j}(wC)) / ${j}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${j}(uniforms.Dy_shape[${re}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group; d2 = d2 + ${f}) {
                  let xValue = ${o?ge.getByOffset(`${ge.indicesToOffset(`${ge.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${f}`):ge.get("batch","inputChannel","idyR","idyC")};
                  ${ve()}
                  inputChannel = inputChannel + ${f};
                }
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${n?` + bias[d1 / ${p}]`:""};
            ${Y.setByOffset("global_idx","value")};
          `;return`
    ${k.registerUniforms(P).declareVariables(...ye,Y)}
      ${k.mainStart()}
      ${k.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${we}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${t.cacheKey};${f}${m}${p}${c===1}`,inputDependencies:w},getRunData:()=>({dispatchGroup:{x:b[0],y:b[1],z:b[2]},outputs:[{dims:i?i(r):r,dataType:e[0].dataType}],programUniforms:T}),getShaderSource:$}}}),wR,xR,CR,d1,OP,ER,f1,IR,NP,AJ=ue(()=>{"use strict";MJ(),ya(),is(),wR=(e,t,i,n,r,o)=>(e-1)*t+i+(n-1)*r+1-o,xR=(e,t,i,n,r)=>{let o=Math.floor(e/2);t==="SAME_UPPER"?(i[n]=o,i[r]=e-o):t==="SAME_LOWER"&&(i[n]=e-o,i[r]=o)},CR=(e,t,i,n,r,o,s,a,u,c)=>{let f=e.length-2,p=c.length===0;u.length<f&&u.push(...Array(f-u.length).fill(0));let m=e[0],v=t[a?3:1]*r;for(let b=0,w=e.length-f-(a?1:0);b<f;++b,++w){let C=e[w],x=p?C*s[b]:c[b],y=wR(C,s[b],o[b],t[w],i[b],x);xR(y,n,o,b,b+f),p&&c.push(s[b]*(C-1)+u[b]+(t[w]-1)*i[b]+1-o[b]-o[b+f])}c.splice(0,0,m),c.splice(a?3:1,0,v)},d1=(e,t)=>{let i=e.kernelShape.slice();if(e.kernelShape.length===0||e.kernelShape.reduce((p,m)=>p*m,1)===0){i.length=0;for(let p=2;p<t[1].dims.length;++p)i.push(t[1].dims[p])}let n=e.format==="NHWC";i.splice(0,0,t[1].dims[0]),i.splice(n?3:1,0,t[1].dims[1]);let r=e.pads.slice(),o=e.outputShape.slice(),s=e.outputPadding.slice(),a=t[0].dims,u=e.dilations.slice();if(u.reduce((p,m)=>p+m,0)===0){let p=t[0].dims.length-2;u=new Array(p).fill(1)}let c=e.strides.slice();if(c.reduce((p,m)=>p+m,0)===0){let p=t[0].dims.length-2;c=new Array(p).fill(1)}CR(a,i,u,e.autoPad,e.group,r,c,n,s,o);let f=Object.assign({},e);return Object.assign(f,{kernelShape:i,pads:r,outputPadding:s,outputShape:o,dilations:u,strides:c}),f},OP=e=>{let t=mC(e),i=e.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof e.autoPad>"u"?0:e.autoPad],r=e.dilations,o=e.group,s=e.kernelShape,a=e.pads,u=e.strides,c=e.wIsConst(),f=e.outputPadding,p=e.outputShape;return Ae(ie({autoPad:n,format:i,dilations:r,group:o,kernelShape:s,outputPadding:f,outputShape:p,pads:a,strides:u,wIsConst:c},t),{cacheKey:`${e.format};${t.activation};`})},ER=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length!==4&&e[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let i=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],n=e[1].dims[0];if(i!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let r=e[1].dims[1]*t.group;if(e.length===3&&(e[2].dims.length!==1||e[2].dims[0]!==r))throw new Error("invalid bias");let o=e[0].dims.length-2;if(t.dilations.reduce((s,a)=>s+a,0)>0&&t.dilations.length!==o)throw new Error(`dilations should be ${o}D`);if(t.strides.reduce((s,a)=>s+a,0)>0&&t.strides.length!==o)throw new Error(`strides should be ${o}D`);if(t.pads.reduce((s,a)=>s+a,0)>0&&t.pads.length!==o*2)throw new Error(`pads should be ${o*2}D`);if(t.outputPadding.length!==o&&t.outputPadding.length!==0)throw new Error(`output_padding should be ${o}D`);if(t.kernelShape.reduce((s,a)=>s+a,0)>0&&t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape");if(t.outputShape.length!==0&&t.outputShape.length!==e[0].dims.length-2)throw new Error("invalid output shape")},f1=(e,t,i,n)=>{let r=e.kernelCustomData.wT??e.compute(Ti(t[1],[2,3,0,1]),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];i.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=r);let o=[t[0],r];t.length===3&&o.push(t[2]),e.compute(RP(o,i,n),{inputs:o})},IR=(e,t)=>{let i=t.format==="NHWC",n=[e.inputs[0].reshape(i?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&n.push(e.inputs[2]);let r=t.kernelShape;(r.length===0||r[0]===0)&&(r=[e.inputs[1].dims[2]]);let o=t.dilations;(o.length===0||o[0]===0)&&(o=[1]);let s=t.strides;(s.length===0||s[0]===0)&&(s=[1]);let a=t.pads;a.length===0&&(a=[0,0]),a=[0,a[0],0,a[1]],s=[1].concat(s),o=[1].concat(o),r=[1].concat(r);let u=t.outputPadding;u=[0].concat(u);let c=d1(Ae(ie({},t),{pads:a,strides:s,dilations:o,kernelShape:r,outputPadding:u}),n);f1(e,n,c,f=>i?[f[0],f[2],f[3]]:[f[0],f[1],f[3]])},NP=(e,t)=>{if(ER(e.inputs,t),e.inputs[0].dims.length===3)IR(e,t);else{let i=d1(t,e.inputs);f1(e,e.inputs,i)}}}),SR,PP,FP,RJ=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),SR=(e,t,i,n)=>{let r=Z.size(t),o=t.length,s=ee("input",e,o),a=Ee("output",e,o),u=i.dataType===6?i.getInt32Array()[0]:Number(i.getBigInt64Array()[0]),c=Z.normalizeAxis(u,o),f=p=>{let m=` i32(${s.indicesGet("inputIndices","uniforms.axis")}) `,v=Se("uniforms.input_shape","uniforms.axis",o),b=n.reverse?m+(n.exclusive?" + 1":""):"0",w=n.reverse?v:m+(n.exclusive?"":" + 1");return`
                ${p.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(s,a)}
                ${p.mainStart()}
                  ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${a.offsetToIndices("global_idx")};
                  var sum = ${a.type.value}(0);
                  let first : i32 = ${b};
                  let last : i32 = ${w};
                  for (var i : i32 = first; i < last; i++) {
                    ${s.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${s.getByIndices("inputIndices")};
                  }
                  ${a.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:n.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:t,dataType:e}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:[{type:12,data:r},{type:12,data:c},...Te(t,t)]}),getShaderSource:f}},PP=(e,t)=>{let i=e.inputs[0].dims,n=e.inputs[0].dataType,r=e.inputs[1];e.compute(SR(n,i,r,t),{inputs:[0]})},FP=e=>{let t=e.exclusive===1,i=e.reverse===1;return $t({exclusive:t,reverse:i})}}),DR,TR,$R,zP,LP,OJ=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),DR=e=>{if(!e||e.length!==1)throw new Error("DepthToSpace requires 1 input.");if(e[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},TR=(e,t,i,n)=>{let r=[];r.push(`fn perm(i: ${n.type.indices}) -> ${i.type.indices} {
    var a: ${i.type.indices};`);for(let o=0;o<t;++o)r.push(i.indicesSet("a",e[o],`i[${o}]`));return r.push("return a;}"),r.join(`
`)},$R=(e,t)=>{let i,n,r,o,s,a,u=t.format==="NHWC",c=t.blocksize,f=t.mode==="DCR";u?([i,n,r,o]=e.dims,s=f?[i,n,r,c,c,o/c**2]:[i,n,r,o/c**2,c,c],a=f?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([i,n,r,o]=[e.dims[0],e.dims[2],e.dims[3],e.dims[1]],s=f?[i,c,c,o/c**2,n,r]:[i,o/c**2,c,c,n,r],a=f?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let p=e.reshape(s),m=p.dims.length,v=e.dataType,b=ee("a",v,m),w=Ee("output",v,m),C=x=>`
  ${x.registerUniform("output_size","u32").declareVariables(b,w)}

  ${TR(a,m,b,w)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${w.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${w.setByOffset("global_idx",b.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${e.dims};${t.blocksize};${t.mode}`,inputDependencies:["rank"]},getRunData:x=>{let y=u?[i,n*c,r*c,o/c**2]:[i,o/c**2,n*c,r*c],I=Z.size(y),S=p.dims,T=Z.sortBasedOnPerm(S,a);return{outputs:[{dims:y,dataType:x[0].dataType}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:[{type:12,data:I},...Te(S,T)]}},getShaderSource:C}},zP=(e,t)=>{DR(e.inputs),e.compute($R(e.inputs[0],t))},LP=e=>$t({blocksize:e.blocksize,mode:e.mode,format:e.format})}),bg,bf,h1,kR,MR,AR,RR,p1,OR,BP,jP,NJ=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),bg="[a-zA-Z]|\\.\\.\\.",bf="("+bg+")+",h1="^"+bf+"$",kR="("+bf+",)*"+bf,MR="^"+kR+"$",AR=class{constructor(e=-1){this.symbolToIndices=new Map,this.inputIndex=e}addSymbol(e,t){let i=this.symbolToIndices.get(e);i===void 0?i=[t]:i.push(t),this.symbolToIndices.set(e,i)}},RR=class{constructor(e,t){this.equation=t,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[i,n]=t.includes("->")?t.split("->",2):[t,""];if(!i.match(RegExp(MR)))throw new Error("Invalid LHS term");if(i.split(",").forEach((r,o)=>{let s=e[o].dims.slice();if(!r.match(RegExp(h1)))throw new Error("Invalid LHS term");let a=this.processTerm(r,!0,s,o);this.lhs.push(a)}),n==="")n+=[...this.symbolToInfo.entries()].filter(([r,o])=>o.count===1||r==="...").map(([r])=>r).join("");else if(!n.match(RegExp(bf)))throw new Error("Invalid RHS");n.match(RegExp(bg,"g"))?.forEach(r=>{if(r==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let o=this.symbolToInfo.get(r);if(o===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(o.dimValue)}}),this.rhs=this.processTerm(n,!1,this.outputDims)}addSymbol(e,t,i){let n=this.symbolToInfo.get(e);if(n!==void 0){if(n.dimValue!==t&&n.count!==1)throw new Error("Dimension mismatch");n.count++,n.inputIndices.push(i)}else n={count:1,dimValue:t,inputIndices:[i]};this.symbolToInfo.set(e,n)}processTerm(e,t,i,n=-1){let r=i.length,o=!1,s=[],a=0;if(!e.match(RegExp(h1))&&!t&&e!=="")throw new Error("Invalid LHS term");let u=e.match(RegExp(bg,"g")),c=new AR(n);return u?.forEach((f,p)=>{if(f==="..."){if(o)throw new Error("Only one ellipsis is allowed per input term");o=!0;let m=r-u.length+1;if(m<0)throw new Error("Ellipsis out of bounds");if(s=i.slice(a,a+m),this.hasEllipsis){if(this.ellipsisDims.length!==s.length||this.ellipsisDims.toString()!==s.toString())throw new Error("Ellipsis dimensions mismatch")}else if(t)this.hasEllipsis=!0,this.ellipsisDims=s;else throw new Error("Ellipsis must be specified in the LHS");for(let v=0;v<s.length;v++){let b=String.fromCharCode(48+v);c.addSymbol(b,p+v),this.addSymbol(b,i[a++],n)}}else c.addSymbol(f,p+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(f,i[a++],n)}),c}},p1=e=>e+"_max",OR=(e,t,i,n)=>{let r=e.map(c=>c.length).map((c,f)=>ee(`input${f}`,t,c)),o=Z.size(n),s=Ee("output",t,n.length),a=[...i.symbolToInfo.keys()].filter(c=>!i.rhs.symbolToIndices.has(c)),u=c=>{let f=[],p="var prod = 1.0;",m="var sum = 0.0;",v="sum += prod;",b=[],w=[],C=[],x=[],y=i.symbolToInfo.size===i.rhs.symbolToIndices.size;i.symbolToInfo.forEach((S,T)=>{if(i.rhs.symbolToIndices.has(T)){let $=i.rhs.symbolToIndices.get(T)?.[0];$!==void 0&&i.lhs.forEach((k,P)=>{if(S.inputIndices.includes(P)){let j=k.symbolToIndices.get(T);if(j===void 0)throw new Error("Invalid symbol error");j.forEach(H=>{f.push(`${r[P].indicesSet(`input${P}Indices`,H,s.indicesGet("outputIndices",$))}`)})}})}else i.lhs.forEach(($,k)=>{if(S.inputIndices.includes(k)){let P=$.symbolToIndices.get(T);if(P===void 0)throw new Error("Invalid symbol error");P.forEach(j=>{b.push(`${r[k].indicesSet(`input${k}Indices`,j,`${T}`)}`)}),x.push(`prod *= ${r[k].getByIndices(`input${k}Indices`)};`)}}),w.push(`for(var ${T}: u32 = 0; ${T} < uniforms.${p1(T)}; ${T}++) {`),C.push("}")});let I=y?[...f,`let sum = ${r.map((S,T)=>S.getByIndices(`input${T}Indices`)).join(" * ")};`]:[...f,m,...w,...b,p,...x,v,...C];return`
            ${c.registerUniforms(a.map(S=>({name:`${p1(S)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...r,s)}

            ${c.mainStart()}
            ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${s.offsetToIndices("global_idx")};
            ${r.map((S,T)=>`var input${T}Indices: ${r[T].type.indices};`).join(`
`)}
            ${I.join(`
`)};
            ${s.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:i.equation,inputDependencies:e.map(()=>"rank")},getRunData:()=>{let c=a.filter(p=>i.symbolToInfo.has(p)).map(p=>({type:12,data:i.symbolToInfo.get(p)?.dimValue||0}));c.push({type:12,data:o});let f=e.map((p,m)=>[...Te(p)]).reduce((p,m)=>p.concat(m),c);return f.push(...Te(n)),{outputs:[{dims:n,dataType:t}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:f}},getShaderSource:u}},BP=(e,t)=>{let i=new RR(e.inputs,t.equation),n=i.outputDims,r=e.inputs.map((o,s)=>o.dims);e.compute(OR(r,e.inputs[0].dataType,i,n))},jP=e=>{let t=e.equation.replace(/\s+/g,"");return $t({equation:t})}}),NR,m1,PR,FR,VP,PJ=ue(()=>{"use strict";Fe(),Ue(),Qe(),NR=e=>{if(!e||e.length!==2)throw new Error("Expand requires 2 input.");let t=e[0].dims,i=Array.from(e[1].getBigInt64Array(),Number),n=i.length<t.length?0:i.length-t.length,r=t.length<i.length?0:t.length-i.length;for(;n<i.length&&r<t.length;++n,++r)if(i[n]!==t[r]&&i[n]!==1&&t[r]!==1)throw new Error("Expand requires shape to be broadcastable to input")},m1=(e,t)=>{let i=e.length-t.length,n=[];for(let r=0;r<i;++r)n.push(e[r]);for(let r=0;r<t.length;++r)n.push(t[r]===1?e[r+i]:t[r]);return n},PR=(e,t)=>e.length>t.length?m1(e,t):m1(t,e),FR=e=>{let t=e[0].dims,i=Array.from(e[1].getBigInt64Array(),Number),n=PR(t,i),r=e[0].dataType,o=r===9||Z.size(t)===1,s=r===9||t.length>0&&t[t.length-1]%4===0?4:1,a=o||n.length>0&&n[n.length-1]%4===0?4:1,u=Math.ceil(Z.size(n)/a),c=p=>{let m=ee("input",r,t.length,s),v=Ee("output",r,n.length,a),b;if(r===9){let w=(C,x,y="")=>`
          let outputIndices${x} = ${v.offsetToIndices(`outputOffset + ${x}u`)};
          let offset${x} = ${m.broadcastedIndicesToOffset(`outputIndices${x}`,v)};
          let index${x} = offset${x} / 4u;
          let component${x} = offset${x} % 4u;
          ${C}[${x}] = ${y}(${m.getByOffset(`index${x}`)}[component${x}]);
        `;b=`
        let outputOffset = global_idx * ${a};
        var data = vec4<u32>(0);
        ${w("data",0,"u32")}
        ${w("data",1,"u32")}
        ${w("data",2,"u32")}
        ${w("data",3,"u32")}
        ${v.setByOffset("global_idx","data")}
      }`}else b=`
        let outputIndices = ${v.offsetToIndices(`global_idx * ${a}`)};
        let inputOffset = ${m.broadcastedIndicesToOffset("outputIndices",v)};
        let data = ${v.type.value}(${m.getByOffset(`inputOffset / ${s}`)});
        ${v.setByOffset("global_idx","data")}
      }`;return`
    ${p.registerUniform("vec_size","u32").declareVariables(m,v)}
    ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${b}`},f=[{type:12,data:u},...Te(t,n)];return{name:"Expand",shaderCache:{hint:`${n.length};${s}${a}`,inputDependencies:["rank"]},getShaderSource:c,getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:f})}},VP=e=>{NR(e.inputs),e.compute(FR(e.inputs),{inputs:[0]})}}),zR,UP,FJ=ue(()=>{"use strict";Fe(),Ue(),Qe(),pC(),zR=e=>{let t=e[0].dataType,i=Z.size(e[0].dims),n=Z.size(e[1].dims),r=n%4===0,o=s=>{let a=ee("x",t,[1],4),u=ee("bias",t,[1],4),c=Ee("y",t,[1],4),f=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],p=v=>`
      let bias${v}_offset: u32 = (global_idx * 4 + ${v}) % uniforms.bias_size;
      let bias${v} = ${u.getByOffset(`bias${v}_offset / 4`)}[bias${v}_offset % 4];`,m=r?`
      let bias = ${u.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${p(0)}${p(1)}${p(2)}${p(3)}
      let bias = ${a.type.value}(bias0, bias1, bias2, bias3);`;return`${s.registerUniforms(f).declareVariables(a,u,c)}

    ${U1(Yn(t))}

    ${s.mainStart(Vl)}
      ${s.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${a.getByOffset("global_idx")};
      ${m}
      let x_in = x + bias;
      ${c.setByOffset("global_idx",H1("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${r}`,inputDependencies:["type","type"]},getShaderSource:o,getRunData:s=>({outputs:[{dims:s[0].dims,dataType:s[0].dataType}],programUniforms:[{type:12,data:Math.ceil(i/4)},{type:12,data:n}],dispatchGroup:{x:Math.ceil(i/Vl/4)}})}},UP=e=>{e.inputs.length<2||Z.size(e.inputs[1].dims)===0?uP(e):e.compute(zR(e.inputs))}}),LR,BR,HP,WP,zJ=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),LR=e=>{if(!e||e.length!==2)throw new Error("Gather requires 2 inputs.")},BR=(e,t)=>{let i=e[0].dims,n=e[1].dims,r=i.length,o=Z.normalizeAxis(t.axis,r),s=i.slice(0);s.splice(o,1,...n);let a=i[o],u=e[0].dataType===9?4:1,c=Math.ceil(Z.size(s)/u),f=[{type:12,data:c},{type:6,data:a},{type:12,data:o},...Te(e[0].dims,e[1].dims,s)],p=m=>{let v=ee("data",e[0].dataType,e[0].dims.length,u),b=ee("inputIndices",e[1].dataType,e[1].dims.length),w=Ee("output",e[0].dataType,s.length,u),C=y=>{let I=n.length,S=`var indicesIndices${y}  = ${b.type.indices}(0);`;for(let T=0;T<I;T++)S+=`${I>1?`indicesIndices${y}[${T}]`:`indicesIndices${y}`} = ${s.length>1?`outputIndices${y}[uniforms.axis + ${T}]`:`outputIndices${y}`};`;S+=`
          var idx${y} = ${b.getByIndices(`indicesIndices${y}`)};
          if (idx${y} < 0) {
            idx${y} = idx${y} + uniforms.axisDimLimit;
          }
          var dataIndices${y} : ${v.type.indices};
        `;for(let T=0,$=0;T<r;T++)T===o?(S+=`${r>1?`dataIndices${y}[${T}]`:`dataIndices${y}`} = u32(idx${y});`,$+=I):(S+=`${r>1?`dataIndices${y}[${T}]`:`dataIndices${y}`} = ${s.length>1?`outputIndices${y}[${$}]`:`outputIndices${y}`};`,$++);return S},x;if(e[0].dataType===9){let y=(I,S,T="")=>`
          let outputIndices${S} = ${w.offsetToIndices(`outputOffset + ${S}u`)};
          ${C(S)};
          let offset${S} = ${v.indicesToOffset(`dataIndices${S}`)};
          let index${S} = offset${S} / 4u;
          let component${S} = offset${S} % 4u;
          ${I}[${S}] = ${T}(${v.getByOffset(`index${S}`)}[component${S}]);
        `;x=`
        let outputOffset = global_idx * ${u};
        var value = vec4<u32>(0);
        ${y("value",0,"u32")}
        ${y("value",1,"u32")}
        ${y("value",2,"u32")}
        ${y("value",3,"u32")}
        ${w.setByOffset("global_idx","value")}
      `}else x=`
      let outputIndices = ${w.offsetToIndices("global_idx")};
      ${C("")};
      let value = ${v.getByIndices("dataIndices")};
      ${w.setByOffset("global_idx","value")};
      `;return`
      ${m.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(v,b,w)}
      ${m.mainStart()}
        ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${x}
      }`};return{name:"Gather",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:f}),getShaderSource:p}},HP=e=>$t({axis:e.axis}),WP=(e,t)=>{let i=e.inputs;LR(i),e.compute(BR(e.inputs,t))}}),jR,qP,GP,LJ=ue(()=>{"use strict";Fe(),Ue(),Qe(),jR=(e,t,i,n,r,o,s,a,u)=>{let c=[{type:12,data:o},{type:12,data:n},{type:12,data:r},{type:12,data:i},{type:12,data:s},{type:12,data:a},{type:12,data:u}],f=[o];c.push(...Te(t.dims,f));let p=m=>{let v=ee("indices_data",t.dataType,t.dims.length),b=Ee("input_slice_offsets_data",12,1,1),w=[v,b],C=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:r.length},{name:"sizes_from_slice_dims_data",type:"u32",length:i.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${m.registerUniforms(C).declareVariables(...w)}
  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${r.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${i.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return e.compute({name:"computeSliceOffsets",shaderCache:{hint:`${r.length}_${i.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:f,dataType:e.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:c}),getShaderSource:p},{inputs:[t],outputs:[-1]})[0]},qP=(e,t)=>{let i=e.inputs,n=i[0].dims,r=i[0].dataType,o=i[1].dims,s=o[o.length-1],a=Z.sizeToDimension(o,o.length-1),u=Z.sizeFromDimension(n,t.batchDims+s),c=Z.sizeToDimension(n,t.batchDims),f=Z.sizeFromDimension(n,t.batchDims),p=a/c,m=new Array(s),v=u;for(let S=0;S<s;++S)m[s-1-S]=v,v*=n[t.batchDims+s-1-S];let b=jR(e,i[1],m,t.batchDims,n,a,p,f,s),w=t.batchDims+s;if(w>n.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let C=o.slice(0,-1).concat(n.slice(w)),x=Z.size(C),y=[{type:12,data:x},{type:12,data:u},...Te(i[0].dims,b.dims,C)],I=S=>{let T=ee("data",i[0].dataType,i[0].dims.length),$=ee("slice_offsets",12,b.dims.length),k=Ee("output",i[0].dataType,C.length);return`
          ${S.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(T,$,k)}
            ${S.mainStart()}
            ${S.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};e.compute({name:"GatherND",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:C,dataType:r}],dispatchGroup:{x:Math.ceil(x/64)},programUniforms:y}),getShaderSource:I},{inputs:[i[0],b]})},GP=e=>({batchDims:e.batch_dims,cacheKey:""})}),VR,UR,KP,ZP,BJ=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),VR=(e,t)=>{if(e.length<3||e.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let i=Z.normalizeAxis(t.quantizeAxis,e[0].dims.length),n=t.blockSize,r=e[0],o=e[2],s=e.length===4?e[3]:void 0;if(o.dims.length!==r.dims.length||!r.dims.map((a,u)=>u===i?Math.ceil(a/n)===o.dims[u]:a===o.dims[u]).reduce((a,u)=>a&&u,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(s){if(s.dataType!==r.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(s.dims.length!==o.dims.length||!s.dims.map((a,u)=>a===o.dims[u]).reduce((a,u)=>a&&u,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},UR=(e,t)=>{let i=e[0].dims,n=e[1].dims,r=i.length,o=Z.normalizeAxis(t.gatherAxis,r),s=Z.normalizeAxis(t.quantizeAxis,r),a=i.slice(0);a.splice(o,1,...n);let u=Z.size(a),c=e[2].dataType,f=e[0].dataType===22,p=[{type:12,data:u},{type:12,data:s},{type:12,data:o},{type:12,data:t.blockSize},...Te(...e.map((v,b)=>v.dims),a)],m=v=>{let b=ee("data",e[0].dataType,e[0].dims.length),w=ee("inputIndices",e[1].dataType,e[1].dims.length),C=ee("scales",e[2].dataType,e[2].dims.length),x=e.length>3?ee("zeroPoint",e[3].dataType,e[3].dims.length):void 0,y=Ee("output",c,a.length),I=[b,w,C];x&&I.push(x);let S=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${v.registerUniforms(S).declareVariables(...I,y)}
        ${v.mainStart()}
        let output_indices = ${y.offsetToIndices("global_idx")};
        var indices_indices = ${w.type.indices}(0);
        ${n.length>1?`
          for (var i: u32 = 0; i < ${n.length}; i++) {
            let index = ${y.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${w.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${y.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${b.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${y.indicesGet("output_indices","i")};
          ${b.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${w.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${i[o]};
        }
        ${b.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${a.length}; i++) {
          let index = ${y.indicesGet("output_indices",`i + ${n.length} - 1`)};
          ${b.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${b.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${b.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${f?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${C.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${C.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${C.getByIndices("scale_indices")};
        ${x?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${x.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${x.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${f?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${Yn(c)}(quantized_data - zero_point) * scale;
        ${y.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${t.cacheKey};${e.filter((v,b)=>b!==1).map(v=>v.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:e.length},(v,b)=>"rank")},getRunData:()=>({outputs:[{dims:a,dataType:c}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:p}),getShaderSource:m}},KP=(e,t)=>{let i=e.inputs;VR(i,t),e.compute(UR(e.inputs,t))},ZP=e=>$t({blockSize:e.blockSize,gatherAxis:e.gatherAxis,quantizeAxis:e.quantizeAxis})}),HR,WR,QP,YP,jJ=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),HR=e=>{if(!e||e.length!==2)throw new Error("GatherElements requires 2 inputs.");if(e[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(e[0].dims.length!==e[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},WR=(e,t)=>{let i=e[0].dims,n=e[0].dataType,r=i.length,o=e[1].dims,s=e[1].dataType,a=Z.normalizeAxis(t.axis,r),u=i[a],c=o.slice(0),f=Z.size(c),p=ee("input",n,r),m=ee("indicesInput",s,o.length),v=Ee("output",n,c.length),b=[{type:12,data:f},{type:6,data:u},{type:12,data:a}];return b.push(...Te(i,o,c)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:c,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:b}),getShaderSource:w=>`
      ${w.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(p,m,v)}
      ${w.mainStart()}
      ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${v.offsetToIndices("global_idx")};

      var idx = ${m.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${p.type.indices}(outputIndices);
      ${p.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${p.getByIndices("inputIndices")};

      ${v.setByOffset("global_idx","value")};
  }`}},QP=e=>$t({axis:e.axis}),YP=(e,t)=>{let i=e.inputs;HR(i),e.compute(WR(e.inputs,t))}}),qR,GR,JP,XP,VJ=ue(()=>{"use strict";Fe(),Ue(),Qe(),qR=e=>{if(!e)throw new Error("Input is missing");if(e.length<2||e.length>3)throw new Error("Invaid input number.");if(e.length===3&&e[2].dims.length>2)throw new Error("Invalid input shape of C");if(e[0].dataType!==e[1].dataType||e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("Input types are mismatched")},GR=(e,t)=>{let i=e[0].dims.slice(),n=e[1].dims.slice(),[r,o,s]=e3.getShapeOfGemmResult(i,t.transA,n,t.transB,e.length===3?e[2].dims:void 0),a=[r,o];if(!a)throw new Error("Can't use gemm on the given tensors");let u=16,c=Math.ceil(o/u),f=Math.ceil(r/u),p=!0,m=Z.size(a),v=[{type:12,data:p?c:m},{type:12,data:r},{type:12,data:o},{type:12,data:s},{type:1,data:t.alpha},{type:1,data:t.beta}],b=["type","type"];e.length===3&&(v.push(...Te(e[2].dims)),b.push("rank")),v.push(...Te(a));let w=x=>{let y="";t.transA&&t.transB?y="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":t.transA&&!t.transB?y="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!t.transA&&t.transB?y="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!t.transA&&!t.transB&&(y="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let I=t.alpha===1?"":"value *= uniforms.alpha;",S=ee("a",e[0].dataType,e[0].dims),T=ee("b",e[1].dataType,e[1].dims),$=S.type.value,k=null,P=[S,T];e.length===3&&(k=ee("c",e[2].dataType,e[2].dims.length),P.push(k));let j=Ee("output",e[0].dataType,a.length);P.push(j);let H=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${x.registerUniforms(H).declareVariables(...P)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${$}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${y}
    }

    ${I}
    ${k!=null?`let cOffset = ${k.broadcastedIndicesToOffset("vec2(m, n)",j)}; value += ${$}(uniforms.beta) * ${k.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},C=x=>{let y=ee("a",e[0].dataType,e[0].dims),I=ee("b",e[1].dataType,e[1].dims),S=null,T=[y,I];e.length===3&&(S=ee("c",e[2].dataType,e[2].dims.length),T.push(S));let $=Ee("output",e[0].dataType,a.length);T.push($);let k=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],P="",j="";t.transA&&t.transB?(j=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${I.type.value}(0);
      }
      `,P="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):t.transA&&!t.transB?(j=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${I.type.value}(0);
      }
      `,P="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!t.transA&&t.transB?(j=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${I.type.value}(0);
      }
      `,P="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!t.transA&&!t.transB&&(j=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${I.type.value}(0);
      }
      `,P="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let H=t.alpha===1?"":"value *= uniforms.alpha;";return`
  ${x.registerUniforms(k).declareVariables(...T)}
  var<workgroup> tile_a: array<array<${y.type.storage}, ${u}>, ${u}>;
  var<workgroup> tile_b: array<array<${I.type.storage}, ${u}>, ${u}>;
  ${x.mainStart([u,u,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${u};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${u};
    let num_tiles = (uniforms.K - 1) / ${u} + 1;
    var k_start = 0u;
    var value = ${$.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${j}
      k_start = k_start + ${u};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${u}; k++) {
        ${P}
      }
      workgroupBarrier();
    }

    ${H}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${S!=null?`let cOffset = ${S.broadcastedIndicesToOffset("vec2(m, n)",$)}; value += ${$.type.value}(uniforms.beta) * ${S.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return p?{name:"GemmShared",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:b},getRunData:()=>({outputs:[{dims:a,dataType:e[0].dataType}],dispatchGroup:{x:c*f},programUniforms:v}),getShaderSource:C}:{name:"Gemm",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:b},getRunData:()=>({outputs:[{dims:a,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:v}),getShaderSource:w}},JP=e=>{let t=e.transA,i=e.transB,n=e.alpha,r=e.beta;return{transA:t,transB:i,alpha:n,beta:r,cacheKey:`${e.transA};${e.transB};${e.alpha===1}`}},XP=(e,t)=>{qR(e.inputs),e.compute(GR(e.inputs,t))}}),zr,bo,ua,ca,KR,ZR,QR,YR,JR,XR,eO,tO,eF,tF,UJ=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),[zr,bo,ua,ca]=[0,1,2,3],KR=e=>{if(e[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(e[0].dims.length!==e[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(e[0].dims.length-2!==e[1].dims[e[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${e[0].dims.length-2}`);if(e[0].dims[0]!==e[1].dims[0])throw new Error("grid batch size must match input batch size")},ZR=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,QR=e=>`
  fn gs_bicubic_interpolate(p: mat4x4<${e}>, x: f32, y: f32) -> ${e} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${e}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,YR=e=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${e.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,JR=e=>`
  ${e.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,XR=(e,t,i)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${t} {
     var pixel = ${t}(0);
     var indices = vec4<u32>(0);
     indices[${zr}] = batch;
     indices[${bo}] = channel;`+(()=>{switch(i.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${ua}] = u32(r);
            indices[${ca}] = u32(c);
          }
        `;case"border":return`
          indices[${ua}] = u32(clamp(r, 0, H - 1));
          indices[${ca}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${ua}] = gs_reflect(r, border[1], border[3]);
          indices[${ca}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${i.paddingMode} is not supported`)}})()+`
    return ${e.getByIndices("indices")};
  }
`,eO=(e,t,i)=>(()=>{switch(i.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${zr}], indices[${bo}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${zr}], indices[${bo}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${zr}], indices[${bo}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${zr}], indices[${bo}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${zr}], indices[${bo}], border);

          let dx2 = ${t}(f32(x2) - x);
          let dx1 = ${t}(x - f32(x1));
          let dy2 = ${t}(f32(y2) - y);
          let dy1 = ${t}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${t}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${zr}], indices[${bo}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${i.mode} is not supported`)}})()+`${e.setByOffset("global_idx","result")}`,tO=(e,t)=>{let i=ee("x",e[0].dataType,e[0].dims.length),n=[e[1].dims[0],e[1].dims[1],e[1].dims[2]],r=ee("grid",e[1].dataType,n.length,2),o=[e[0].dims[0],e[0].dims[1],e[1].dims[1],e[1].dims[2]];t.format==="NHWC"&&(o=[e[0].dims[0],e[1].dims[1],e[1].dims[2],e[0].dims[3]],[zr,bo,ua,ca]=[0,3,1,2]);let s=Ee("output",e[0].dataType,o.length),a=i.type.value,u=Z.size(o),c=[{type:12,data:u},...Te(e[0].dims,n,o)],f=p=>`
  ${p.registerUniform("output_size","u32").declareVariables(i,r,s)}
  ${ZR}
  ${QR(a)}
  ${YR(t)}
  ${JR(t)}
  ${XR(i,a,t)}

  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${ua}]);
      let W_in = i32(uniforms.x_shape[${ca}]);

      ${t.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${s.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${zr}], indices[${ua}], indices[${ca}]);
      let nxy = ${r.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${eO(s,a,t)}
  }`;return{name:"GridSample",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:["type","type"]},getRunData:p=>{let m=Z.size(o);return{outputs:[{dims:o,dataType:p[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:c}},getShaderSource:f}},eF=(e,t)=>{KR(e.inputs),e.compute(tO(e.inputs,t))},tF=e=>$t({alignCorners:e.align_corners,mode:e.mode,paddingMode:e.padding_mode,format:e.format})}),di,nO,nF,g1,iO,Df,iF,rF=ue(()=>{"use strict";Fe(),Ue(),on(),cC(),hC(),Qe(),is(),di=(e,t)=>e.length>t&&e[t].dims.length>0?e[t]:void 0,nO=(e,t)=>{let i=e[0],n=di(e,1),r=di(e,2),o=di(e,3),s=di(e,4),a=di(e,5),u=di(e,6),c=di(e,7);if(i.dims.length!==3&&i.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let f=i.dims[0],p=i.dims[1],m=i.dims.length===3?i.dims[2]:t.numHeads*i.dims[4],v=p,b=0,w=0,C=Math.floor(m/t.numHeads);if(u&&c&&Z.size(u.dims)&&Z.size(c.dims)){if(u.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(u.dims[0]!==f||u.dims[1]!==t.numHeads||u.dims[3]!==C)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(c.dims[0]!==f||c.dims[1]!==t.numHeads||c.dims[3]!==C)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(u.dims[2]!==c.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(c.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');b=u.dims[2],w=u.dims[2]}else if(u&&Z.size(u.dims)||c&&Z.size(c.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let x;if(n&&Z.size(n.dims)>0){if(i.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(i.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(n.dims[2]!==i.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');x=2,v=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==t.numHeads||n.dims[3]!==2||n.dims[4]!==C)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(r)throw new Error('Expect "value" be none when "key" has packed kv format.');x=5,v=n.dims[1]}else{if(n.dims[1]!==t.numHeads||n.dims[3]!==C)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');x=0,v=n.dims[2]}}else{if(i.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(i.dims[2]!==t.numHeads||i.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');x=3}if(o&&Z.size(o.dims)>0){if(o.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(n&&n.dims.length===5&&n.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let y=b+v,I=0;if(s&&Z.size(s.dims)>0){I=8;let k=s.dims;throw k.length===1?k[0]===f?I=1:k[0]===3*f+2&&(I=3):k.length===2&&k[0]===f&&k[1]===y&&(I=5),I===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let S=!1,T=m;if(r&&Z.size(r.dims)>0){if(r.dims.length!==3&&r.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(i.dims[0]!==r.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(r.dims.length===3){if(v!==r.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');T=r.dims[2]}else{if(v!==r.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');T=r.dims[1]*r.dims[3],S=!0}}let $=!1;if(s&&Z.size(s.dims)>0)throw new Error("Key padding mask is not supported");if(a&&Z.size(a.dims)>0){if(a.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(a.dims[0]!==f||a.dims[1]!==t.numHeads||a.dims[2]!==p||a.dims[3]!==y)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:f,sequenceLength:p,pastSequenceLength:b,kvSequenceLength:v,totalSequenceLength:y,maxSequenceLength:w,inputHiddenSize:0,hiddenSize:m,vHiddenSize:T,headSize:C,vHeadSize:Math.floor(T/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:I,scale:t.scale,broadcastResPosBias:$,passPastInKv:S,qkvFormat:x}},nF=e=>$t(ie({},e)),g1=$t({perm:[0,2,1,3]}),iO=(e,t,i,n,r,o,s)=>{let a=[n,r,o],u=Z.size(a),c=[{type:12,data:u},{type:12,data:s},{type:12,data:o}],f=p=>{let m=Ee("qkv_with_bias",t.dataType,a),v=ee("qkv",t.dataType,a),b=ee("bias",i.dataType,a),w=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${p.registerUniforms(w).declareVariables(v,b,m)}
  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return e.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:a,dataType:t.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c}),getShaderSource:f},{inputs:[t,i],outputs:[-1]})[0]},Df=(e,t,i,n,r,o,s,a)=>{let u=o;if(s&&Z.size(s.dims)>0){if(n===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return u=iO(e,o,s,t,n,i*r,a),u=u.reshape([t,n,i,r]),i===1||n===1?u:e.compute(Ti(u,g1.perm),{inputs:[u],outputs:[-1]})[0]}else return o.dims.length===3&&(u=o.reshape([t,n,i,r])),i===1||n===1?u:e.compute(Ti(u,g1.perm),{inputs:[u],outputs:[-1]})[0]},iF=(e,t)=>{let i=nO(e.inputs,t),n=e.inputs[0],r=di(e.inputs,1),o=di(e.inputs,2),s=di(e.inputs,3),a=di(e.inputs,4),u=di(e.inputs,5),c=di(e.inputs,6),f=di(e.inputs,7);if(n.dims.length===5)throw new Error("Packed QKV is not implemented");if(r?.dims.length===5)throw new Error("Packed KV is not implemented");let p=r&&o&&r.dims.length===4&&o.dims.length===4,m=Df(e,i.batchSize,i.numHeads,i.sequenceLength,i.headSize,n,s,0);if(p)return $f(e,m,r,o,a,void 0,c,f,u,i);if(!r||!o)throw new Error("key and value must be provided");let v=Df(e,i.batchSize,i.numHeads,i.kvSequenceLength,i.headSize,r,s,i.hiddenSize),b=Df(e,i.batchSize,i.numHeads,i.kvSequenceLength,i.vHeadSize,o,s,2*i.hiddenSize);$f(e,m,v,b,a,void 0,c,f,u,i)}}),rO,oO,sO,aO,Z1,oF,sF,aF=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),rO=e=>{if(!e||e.length<1)throw new Error("too few inputs")},oO=(e,t)=>{let i=[],n=t.numOutputs;return e[1].dims[0]>0&&(e[1].getBigInt64Array().forEach(r=>i.push(Number(r))),n=i.length),$t({numOutputs:n,axis:t.axis,splitSizes:i})},sO=e=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${e}u; i += 1u ) {
    if (index < ${Se("uniforms.size_in_split_axis","i",e)}) {
        return i;
    }
    }
    return ${e}u;
}`,aO=e=>{let t=e.length,i=[];for(let n=0;n<t;++n){let r=e[n].setByIndices("indices","input[global_idx]");t===1?i.push(r):n===0?i.push(`if (output_number == ${n}u) { ${r} }`):n===t-1?i.push(`else { ${r} }`):i.push(`else if (output_number == ${n}) { ${r} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${e[0].type.indices}, global_idx: u32) {
        ${i.join(`
`)}
      }`},Z1=(e,t)=>{let i=e[0].dims,n=Z.size(i),r=e[0].dataType,o=Z.normalizeAxis(t.axis,i.length),s=new Array(t.numOutputs),a=ee("input",r,i.length),u=new Array(t.numOutputs),c=[],f=[],p=0,m=[{type:12,data:n}];for(let b=0;b<t.numOutputs;b++){p+=t.splitSizes[b],u[b]=p;let w=i.slice();w[o]=t.splitSizes[b],f.push(w),s[b]=Ee(`output${b}`,r,w.length),c.push({dims:f[b],dataType:e[0].dataType})}m.push({type:12,data:u},...Te(i,...f));let v=b=>`
  ${b.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",u.length).declareVariables(a,...s)}
  ${sO(u.length)}
  ${aO(s)}

  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${a.offsetToIndices("global_idx")};
    var index = ${a.indicesGet("indices",o)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${Se("uniforms.size_in_split_axis","output_number - 1u",u.length)};
      ${a.indicesSet("indices",o,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:t.cacheKey,inputDependencies:["rank"]},getShaderSource:v,getRunData:()=>({outputs:c,dispatchGroup:{x:Math.ceil(n/64)},programUniforms:m})}},oF=(e,t)=>{rO(e.inputs);let i=e.inputs.length===1?t:oO(e.inputs,t);e.compute(Z1(e.inputs,i),{inputs:[0]})},sF=e=>{let t=e.axis,i=e.splitSizes,n=e.numOutputs<0?i.length:e.numOutputs;if(n!==i.length)throw new Error("numOutputs and splitSizes lengh must be equal");return $t({axis:t,numOutputs:n,splitSizes:i})}}),lO,uO,_1,lF,HJ=ue(()=>{"use strict";on(),hC(),rF(),aF(),is(),lO=(e,t)=>{if(t.doRotary)throw new Error("GroupQuerryAttention do_rotary attribute is not supported");if(t.doRotary&&e.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let i=e[0],n=e[1],r=e[2],o=e[3],s=e[4];if(t.localWindowSize!==-1)throw new Error("Local attention is not supported");if(t.softcap!==0)throw new Error("Softcap is not supported");if(t.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(t.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(i.dims.length!==3&&i.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let a=!1,u=i.dims[0],c=i.dims[1],f=i.dims.length===3?a?i.dims[2]/3:i.dims[2]:t.numHeads*i.dims[4],p=c,m=0,v=!n||n.dims.length===0,b=Math.floor(v?f/(t.numHeads+2*t.kvNumHeads):f/t.numHeads);v&&(f=b*t.numHeads);let w=o&&o.dims.length!==0,C=s&&s.dims.length!==0;if(w&&o.dims.length===4&&o.dims[0]===u&&o.dims[1]!==t.kvNumHeads&&o.dims[2]===t.kvNumHeads&&o.dims[3]===b)throw new Error("BSNH pastKey/pastValue is not supported");if(w&&C){if(o.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(s.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');m=o.dims[2]}else if(w||C)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let x=1;if(n&&n.dims.length>0){if(i.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(i.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(i.dims[2]%n.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');p=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==t.numHeads||n.dims[3]!==2||n.dims[4]!==b)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(r)throw new Error('Expect "value" be none when "key" has packed kv format.');p=n.dims[1]}else{if(n.dims[1]!==t.numHeads||n.dims[3]!==b)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');p=n.dims[2]}}else{if(i.dims.length!==3&&i.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(i.dims.length===5&&(i.dims[2]!==t.numHeads||i.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');x=3}let y=0,I=!1,S=t.kvNumHeads?b*t.kvNumHeads:f;if(r&&r.dims.length>0){if(r.dims.length!==3&&r.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(i.dims[0]!==r.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(r.dims.length===3){if(p!==r.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');S=r.dims[2]}else{if(p!==r.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');S=r.dims[1]*r.dims[3],I=!0}}let T=e.length>4?e[5]:void 0;if(T&&T.dims.length!==1&&T.dims[0]!==u)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:u,sequenceLength:c,pastSequenceLength:m,kvSequenceLength:p,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:f,vHiddenSize:S,headSize:b,vHeadSize:Math.floor(S/t.kvNumHeads),numHeads:t.numHeads,kvNumHeads:t.kvNumHeads,nReps:t.numHeads/t.kvNumHeads,pastPresentShareBuffer:!1,maskType:y,scale:t.scale,broadcastResPosBias:!1,passPastInKv:I,qkvFormat:x}},uO=$t({perm:[0,2,1,3]}),_1=(e,t,i)=>{let n=t,r=i.kvNumHeads;return t.dims.length===3&&i.kvSequenceLength!==0&&(n=t.reshape([i.batchSize,i.kvSequenceLength,r,i.headSize]),n=e.compute(Ti(n,uO.perm),{inputs:[n],outputs:[-1]})[0]),n},lF=(e,t)=>{let i=lO(e.inputs,t);if(e.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(e.inputs[1]?.dims.length===5)throw new Error("Packed KV is not implemented");let n=e.inputs[0],r=e.inputs[1]&&e.inputs[1].dims.length>0?e.inputs[1]:void 0,o=e.inputs[2]&&e.inputs[2].dims.length>0?e.inputs[2]:void 0,s=e.inputs[3]&&e.inputs[3].dims.length!==0?e.inputs[3]:void 0,a=e.inputs[4]&&e.inputs[4].dims.length!==0?e.inputs[4]:void 0,u=e.inputs.length>4?e.inputs[5]:void 0,c=e.inputs.length>5?e.inputs[6]:void 0,f=i.kvNumHeads?i.kvNumHeads:i.numHeads,p=$t({axis:2,numOutputs:3,splitSizes:[i.numHeads*i.headSize,f*i.headSize,f*i.headSize]}),[m,v,b]=!r&&!o?e.compute(Z1([n],p),{inputs:[n],outputs:[-1,-1,-1]}):[n,r,o],w=Df(e,i.batchSize,i.numHeads,i.sequenceLength,i.headSize,m,void 0,0);$f(e,w,_1(e,v,i),_1(e,b,i),void 0,void 0,s,a,void 0,i,u,c)}}),v1,cO,dO,uF,WJ=ue(()=>{"use strict";Fe(),Ue(),is(),Qe(),v1=(e,t,i,n,r,o,s,a)=>{let u=en(o),c=u===1?"f32":`vec${u}f`,f=u===1?"vec2f":`mat2x${u}f`,p=r*s,m=64;p===1&&(m=256);let v=[r,s,o/u],b=[r,s,2],w=["rank","type","type"],C=[];C.push(...Te(v,b));let x=y=>{let I=ee("x",t.dataType,3,u),S=ee("scale",i.dataType,i.dims),T=ee("bias",n.dataType,n.dims),$=Ee("output",1,3,2),k=[I,S,T,$];return`
  var<workgroup> workgroup_shared : array<${f}, ${m}>;
  const workgroup_size = ${m}u;
  ${y.declareVariables(...k)}
  ${y.mainStart(m)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${c}(0);
    var squared_sum = ${c}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${c}(${I.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${f}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${ns("workgroup_shared[0][0]",u)} / f32(hight * ${u});
      let squared_sum_final = ${ns("workgroup_shared[0][1]",u)} / f32(hight * ${u});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${a}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return e.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${u};${a};${m}`,inputDependencies:w},getRunData:()=>({outputs:[{dims:b,dataType:1}],dispatchGroup:{x:p},programUniforms:C}),getShaderSource:x},{inputs:[t,i,n],outputs:[-1]})[0]},cO=(e,t,i)=>{let n=t[0].dims,r=n,o=2,s=n[0],a=n[1],u=Z.sizeFromDimension(n,o),c=en(u),f=Z.size(r)/c,p=v1(e,t[0],t[1],t[2],s,u,a,i.epsilon),m=[s,a,u/c],v=[s,a],b=["type","none"],w=C=>{let x=ee("x",t[0].dataType,m.length,c),y=ee("scale_shift",1,v.length,2),I=Ee("output",t[0].dataType,m.length,c),S=[x,y,I];return`
  ${C.registerUniform("output_size","u32").declareVariables(...S)}
  ${C.mainStart()}
  ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${I.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${y.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${x.getByOffset("global_idx")} * ${I.type.value}(scale_shift.x) + ${I.type.value}(scale_shift.y);
      ${I.setByOffset("global_idx","value")};
  }`};e.compute({name:"InstanceNormalization",shaderCache:{hint:`${c}`,inputDependencies:b},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:[{type:12,data:f},...Te(m,v,m)]}),getShaderSource:w},{inputs:[t[0],p]})},dO=(e,t,i)=>{let n=t[0].dims,r=n,o=n[0],s=n[n.length-1],a=Z.sizeFromDimension(n,1)/s,u=en(s),c=Z.size(r)/u,f=[{type:12,data:a},{type:12,data:Math.floor(s/u)}],p=["type","type"],m=!1,v=[0,n.length-1];for(let x=0;x<n.length-2;x++)m=m||n[x+1]!==1,v.push(x+1);m=m&&n[n.length-1]!==1;let b=m?e.compute(Ti(e.inputs[0],v),{inputs:[e.inputs[0]],outputs:[-1]})[0]:e.inputs[0].reshape(Array.from({length:n.length},(x,y)=>n[v[y]])),w=v1(e,b,t[1],t[2],o,a,s,i.epsilon),C=x=>{let y=In(t[0].dataType),I=u===1?"vec2f":`mat${u}x2f`,S=k=>{let P=k===0?"x":"y",j=u===1?"f32":`vec${u}f`;switch(u){case 1:return`${y}(${j}(scale.${P}))`;case 2:return`vec2<${y}>(${j}(scale[0].${P}, scale[1].${P}))`;case 4:return`vec4<${y}>(${j}(scale[0].${P}, scale[1].${P}, scale[2].${P}, scale[3].${P}))`;default:throw new Error(`Not supported compoents ${u}`)}},T=ee("input",t[0].dataType,t[0].dims,u),$=Ee("output",t[0].dataType,r,u);return`
  @group(0) @binding(0) var<storage, read> input : array<${T.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${I}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${$.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${x.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${S(0)}, ${S(1)});
  }`};e.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${u}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:f}),getShaderSource:C},{inputs:[t[0],w]})},uF=(e,t)=>{t.format==="NHWC"?dO(e,e.inputs,t):cO(e,e.inputs,t)}}),fO,hO,cF,qJ=ue(()=>{"use strict";Fe(),Ue(),Qe(),fO=e=>{if(!e||e.length<2)throw new Error("layerNorm requires at least 2 inputs.")},hO=(e,t,i)=>{let n=t.simplified,r=e[0].dims,o=e[1],s=!n&&e[2],a=r,u=Z.normalizeAxis(t.axis,r.length),c=Z.sizeToDimension(r,u),f=Z.sizeFromDimension(r,u),p=Z.size(o.dims),m=s?Z.size(s.dims):0;if(p!==f||s&&m!==f)throw new Error(`Size of X.shape()[axis:] == ${f}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${p} and bias size of ${m}`);let v=[];for(let T=0;T<r.length;++T)T<u?v.push(r[T]):v.push(1);let b=en(f),w=["type","type"],C=[{type:12,data:c},{type:1,data:f},{type:12,data:Math.floor(f/b)},{type:1,data:t.epsilon}];s&&w.push("type");let x=i>1,y=i>2,I=T=>{let $=In(e[0].dataType),k=[ee("x",e[0].dataType,e[0].dims,b),ee("scale",o.dataType,o.dims,b)];s&&k.push(ee("bias",s.dataType,s.dims,b)),k.push(Ee("output",e[0].dataType,a,b)),x&&k.push(Ee("mean_data_output",1,v)),y&&k.push(Ee("inv_std_output",1,v));let P=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${T.registerUniforms(P).declareVariables(...k)}
  ${T.mainStart()}
    ${T.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${B1("f32",b)};
    var mean_square_vector = ${B1("f32",b)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${Bl($,b,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${ns("mean_vector",b)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${ns("mean_square_vector",b)} / uniforms.norm_size ${n?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${Bl($,b,"x[j + offset]")};
      let f32scale = ${Bl($,b,"scale[j]")};
      output[j + offset] = ${k[0].type.value}((f32input ${n?"":"- mean"}) * inv_std_dev * f32scale
        ${s?`+ ${Bl($,b,"bias[j]")}`:""}
      );
    }

    ${x?"mean_data_output[global_idx] = mean":""};
    ${y?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},S=[{dims:a,dataType:e[0].dataType}];return x&&S.push({dims:v,dataType:1}),y&&S.push({dims:v,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${b};${i};${n}`,inputDependencies:w},getRunData:()=>({outputs:S,dispatchGroup:{x:Math.ceil(c/64)},programUniforms:C}),getShaderSource:I}},cF=(e,t)=>{fO(e.inputs),e.compute(hO(e.inputs,t,e.outputCount))}}),pO,dF,GJ=ue(()=>{"use strict";Ue(),vC(),bC(),pO=e=>{if(!e||e.length!==2)throw new Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw new Error("shared dimension does not match.")},dF=e=>{pO(e.inputs);let t=jl.calcShape(e.inputs[0].dims,e.inputs[1].dims,!0);if(!t)throw new Error("Can't use matmul on the given tensors");let i=t[t.length-1],n=e.inputs[0].dims[e.inputs[0].dims.length-1];if(i<8&&n<8)e.compute(_C(e.inputs,{activation:""},t));else{let r=t[t.length-2],o=Z.size(e.inputs[0].dims.slice(0,-2)),s=Z.size(e.inputs[1].dims.slice(0,-2));if(o!==1&&r===1&&s===1){let a=e.inputs[0].reshape([1,o,n]),u=e.inputs[1].reshape([1,n,i]),c=[1,o,i],f=[a,u];e.compute(Ag(f,{activation:""},t,c),{inputs:f})}else e.compute(Ag(e.inputs,{activation:""},t))}}}),mO,gO,_O,fF,hF,KJ=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),mO=(e,t)=>{if(e.length<3||e.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let i=e[0],n=i.dims.length;if(i.dims[n-1]!==t.k)throw new Error("The last dim of input shape does not match the k value");let r=Math.floor((t.k+t.blockSize-1)/t.blockSize),o=t.blockSize/8*t.bits,s=e[1];if(!Z.areEqual(s.dims,[t.n,r,o]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let a=e[2].dims;if(Z.size(a)!==t.n*r)throw new Error("scales input size error.");if(e.length===4){let u=e[3].dims,c=t.bits>4?t.n*r:t.n*Math.floor((r+1)/2);if(Z.size(u)!==c)throw new Error("zeroPoints input size error.")}},gO=(e,t)=>{let i=e[0].dims,n=i.length,r=i[n-2],o=t.k,s=t.n,a=i.slice(0,n-2),u=Z.size(a),c=e[1].dims[2]/4,f=e[0].dataType,p=en(t.k),m=en(c),v=en(s),b=a.concat([r,s]),w=r>1&&s/v%2===0?2:1,C=Z.size(b)/v/w,x=64,y=[],I=[u,r,o/p],S=Z.convertShape(e[1].dims).slice();S.splice(-1,1,c/m),y.push(...Te(I)),y.push(...Te(S)),y.push(...Te(e[2].dims)),e.length===4&&y.push(...Te(Z.convertShape(e[3].dims)));let T=[u,r,s/v];y.push(...Te(T));let $=k=>{let P=I.length,j=ee("a",e[0].dataType,P,p),H=ee("b",12,S.length,m),re=ee("scales",e[2].dataType,e[2].dims.length),ae=[j,H,re],L=e.length===4?ee("zero_points",12,e[3].dims.length):void 0;L&&ae.push(L);let ge=T.length,ye=Ee("output",e[0].dataType,ge,v),Y=In(e[0].dataType),ve=(()=>{switch(p){case 1:return`array<${Y}, 8>`;case 2:return`mat4x2<${Y}>`;case 4:return`mat2x4<${Y}>`;default:throw new Error(`${p}-component is not supported.`)}})(),we=()=>{let z=`
          // reuse a data
            var input_offset = ${j.indicesToOffset(`${j.type.indices}(batch, row, word_offset)`)};
            var a_data: ${ve};
            for (var j: u32 = 0; j < ${8/p}; j++) {
              a_data[j] = ${j.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let W=0;W<v*w;W++)z+=`
            b_value = ${m===1?`b${W}_data`:`b${W}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${ve}(${Array.from({length:4},(R,se)=>`${Y}(b_value_lower[${se}]), ${Y}(b_value_upper[${se}])`).join(", ")});
            b_dequantized_values = ${p===1?`${ve}(${Array.from({length:8},(R,se)=>`(b_quantized_values[${se}] - ${L?`zero_point${W}`:"zero_point"}) * scale${W}`).join(", ")});`:`(b_quantized_values - ${ve}(${Array(8).fill(`${L?`zero_point${W}`:"zero_point"}`).join(",")})) * scale${W};`};
            workgroup_shared[local_id.x * ${w} + ${Math.floor(W/v)}]${v>1?`[${W%v}]`:""} += ${Array.from({length:8/p},(R,se)=>`${p===1?`a_data[${se}] * b_dequantized_values[${se}]`:`dot(a_data[${se}], b_dequantized_values[${se}])`}`).join(" + ")};
          `;return z},X=()=>{let z=`
            var col_index = col * ${v};
            ${L?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Y}(8);`}
            `;for(let W=0;W<v*w;W++)z+=`
            let scale${W} = ${re.getByOffset("col_index * nBlocksPerCol + block")};
            ${L?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${L.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${W} = ${Y}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return z},xe=()=>{let z=`col_index = col * ${v};`;for(let W=0;W<v*w;W++)z+=`
            let b${W}_data = ${H.getByIndices(`${H.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return z+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${ve};
            var b_dequantized_values: ${ve};`,z};return`
        var<workgroup> workgroup_shared: array<${ye.type.value}, ${w*x}>;
        ${k.declareVariables(...ae,ye)}
        ${k.mainStart([x,1,1])}
          let output_indices = ${ye.offsetToIndices(`(global_idx / ${x}) * ${w}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${x}) {
            //process one block
            var word_offset: u32 = block * ${t.blockSize/p};
            ${X()}
            for (var word: u32 = 0; word < ${c}; word += ${m}) {
              ${xe()}
              for (var i: u32 = 0; i < ${m}; i++) {
                ${we()}
                word_offset += ${8/p};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${w}) {
            var output_value: ${ye.type.value} = ${ye.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${x}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${w};
            }
            ${ye.setByIndices(`${ye.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${t.blockSize};${t.bits};${p};${m};${v};${w};${x}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:b,dataType:f}],dispatchGroup:{x:C},programUniforms:y}),getShaderSource:$}},_O=(e,t)=>{let i=e[0].dims,n=i.length,r=i[n-2],o=t.k,s=t.n,a=i.slice(0,n-2),u=Z.size(a),c=e[1].dims[2]/4,f=e[0].dataType,p=en(t.k),m=en(c),v=a.concat([r,s]),b=128,w=s%8===0?8:s%4===0?4:1,C=b/w,x=C*m*8,y=x/p,I=x/t.blockSize,S=Z.size(v)/w,T=[],$=[u,r,o/p],k=Z.convertShape(e[1].dims).slice();k.splice(-1,1,c/m),T.push(...Te($)),T.push(...Te(k)),T.push(...Te(e[2].dims)),e.length===4&&T.push(...Te(Z.convertShape(e[3].dims)));let P=[u,r,s];T.push(...Te(P));let j=H=>{let re=$.length,ae=ee("a",e[0].dataType,re,p),L=ee("b",12,k.length,m),ge=ee("scales",e[2].dataType,e[2].dims.length),ye=[ae,L,ge],Y=e.length===4?ee("zero_points",12,e[3].dims.length):void 0;Y&&ye.push(Y);let ve=P.length,we=Ee("output",e[0].dataType,ve),X=In(e[0].dataType),xe=()=>{switch(p){case 1:return`
          let a_data0 = vec4<${X}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${X}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${X}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${X}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${p}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${ae.type.value}, ${y}>;
        var<workgroup> inter_results: array<array<${we.type.value}, ${C}>, ${w}>;
        ${H.declareVariables(...ye,we)}
        ${H.mainStart([C,w,1])}
          let output_indices = ${we.offsetToIndices(`workgroup_index * ${w}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${I} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${y};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${y}; a_offset += ${b})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${ae.getByIndices(`${ae.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${ae.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${I} + local_id.x;
            ${Y?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${Y.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${X}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${X}(8);`}
            let scale = ${ge.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${L.getByIndices(`${L.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${t.blockSize/p};
            for (var i: u32 = 0; i < ${m}; i++) {
              ${xe()}
              let b_value = ${m===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${X}>(${Array.from({length:4},(z,W)=>`${X}(b_value_lower[${W}]), ${X}(b_value_upper[${W}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${X}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(z,W)=>`${`dot(a_data${W}, b_dequantized_values[${W}])`}`).join(" + ")};
              word_offset += ${8/p};
            }
            workgroupBarrier();
          }

          if (local_idx < ${w}) {
            var output_value: ${we.type.value} = ${we.type.value}(0);
            for (var b = 0u; b < ${C}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${we.setByIndices(`${we.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${t.blockSize};${p};${m};${C};${w}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:v,dataType:f}],dispatchGroup:{x:S},programUniforms:T}),getShaderSource:j}},fF=(e,t)=>{mO(e.inputs,t),t.blockSize===32&&e.adapterInfo.isVendor("intel")&&e.adapterInfo.isArchitecture("gen-12lp")?e.compute(_O(e.inputs,t)):e.compute(gO(e.inputs,t))},hF=e=>$t(e)}),vO,bO,yO,wO,xO,CO,EO,IO,pF,ZJ=ue(()=>{"use strict";Fe(),Ue(),Qe(),vO=e=>{if(!e||e.length<1)throw new Error("Too few inputs");if(e[0].dataType!==1&&e[0].dataType!==10)throw new Error("Input type must be float or float16.");if(e.length>=2){let t=e[0].dims.length*2===e[1].dims[0];if(e.length===4&&(t=e[3].dims[0]*2===e[1].dims[0]),!t)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},bO=(e,t,i)=>{let n="";for(let r=t-1;r>=0;--r)n+=`
            k = i32(${e.indicesGet("indices",r)}) - ${Se("uniforms.pads",r,i)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${Se("uniforms.x_shape",r,t)})) {
              break;
            }
            offset += k * i32(${Se("uniforms.x_strides",r,t)});
        `;return`
          value = ${e.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${n}
            value = x[offset];
          }
      `},yO=(e,t,i)=>{let n="";for(let r=t-1;r>=0;--r)n+=`
                k = i32(${e.indicesGet("indices",r)}) - ${Se("uniforms.pads",r,i)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${Se("uniforms.x_shape",r,t)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${Se("uniforms.x_shape",r,t)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${Se("uniforms.x_strides",r,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},wO=(e,t,i)=>{let n="";for(let r=t-1;r>=0;--r)n+=`
                k = i32(${e.indicesGet("indices",r)}) - ${Se("uniforms.pads",r,i)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${Se("uniforms.x_shape",r,t)})) {
                  k = i32(${Se("uniforms.x_shape",r,t)}) - 1;
                }
                offset += k * i32(${Se("uniforms.x_strides",r,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},xO=(e,t,i)=>{let n="";for(let r=t-1;r>=0;--r)n+=`
                k = i32(${e.indicesGet("indices",r)}) - ${Se("uniforms.pads",r,i)};
                if (k < 0)  {
                  k += i32(${Se("uniforms.x_shape",r,t)}]);
                }
                if (k >= i32(${Se("uniforms.x_shape",r,t)})) {
                  k -= i32(${Se("uniforms.x_shape",r,t)});
                }
                offset += k * i32(${Se("uniforms.x_strides",r,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},CO=(e,t,i)=>{switch(i.mode){case 0:return bO(e,t,i.pads.length);case 1:return yO(e,t,i.pads.length);case 2:return wO(e,t,i.pads.length);case 3:return xO(e,t,i.pads.length);default:throw new Error("Invalid mode")}},EO=(e,t)=>{let i=Z.padShape(e[0].dims.slice(),t.pads),n=e[0].dims,r=Z.size(i),o=[{type:12,data:r},{type:6,data:t.pads}],s=e.length>=3&&e[2].data;t.mode===0&&o.push({type:s?e[2].dataType:1,data:t.value}),o.push(...Te(e[0].dims,i));let a=["rank"],u=c=>{let f=Ee("output",e[0].dataType,i.length),p=ee("x",e[0].dataType,n.length),m=p.type.value,v=CO(f,n.length,t),b=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:t.pads.length}];return t.mode===0&&b.push({name:"constant_value",type:s?m:"f32"}),`
            ${c.registerUniforms(b).declareVariables(p,f)}
            ${c.mainStart()}
            ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${f.offsetToIndices("global_idx")};

            var value = ${m}(0);
            ${v}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${t.mode}${s}`,inputDependencies:a},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Z.size(i)/64)},programUniforms:o}),getShaderSource:u}},IO=(e,t)=>{if(e.length>1){let i=e[1].getBigInt64Array(),n=e.length>=3&&e[2].data?e[2].dataType===10?e[2].getUint16Array()[0]:e[2].getFloat32Array()[0]:0,r=e[0].dims.length,o=new Int32Array(2*r).fill(0);if(e.length>=4){let a=e[3].getBigInt64Array();for(let u=0;u<a.length;u++)o[Number(a[u])]=Number(i[u]),o[Number(a[u])+r]=Number(i[u+a.length])}else i.forEach((a,u)=>o[Number(u)]=Number(a));let s=[];return o.forEach(a=>s.push(a)),{mode:t.mode,value:n,pads:s}}else return t},pF=(e,t)=>{vO(e.inputs);let i=IO(e.inputs,t);e.compute(EO(e.inputs,i),{inputs:[0]})}}),yf,b1,y1,w1,x1,SO,DO,C1,E1,mF,gF,I1,_F,vF,S1,bF,yF,wF,xF,QJ=ue(()=>{"use strict";gr(),Fe(),Ue(),Qe(),yf=e=>{if(Yt.webgpu.validateInputContent&&(!e||e.length!==1))throw new Error("Pool ops requires 1 input.")},b1=(e,t,i)=>{let n=t.format==="NHWC",r=e.dims.slice();n&&r.splice(1,0,r.pop());let o=Object.hasOwnProperty.call(t,"dilations"),s=t.kernelShape.slice(),a=t.strides.slice(),u=o?t.dilations.slice():[],c=t.pads.slice();kg.adjustPoolAttributes(i,r,s,a,u,c);let f=kg.computePoolOutputShape(i,r,a,u,s,c,t.autoPad),p=Object.assign({},t);o?Object.assign(p,{kernelShape:s,strides:a,pads:c,dilations:u,cacheKey:t.cacheKey}):Object.assign(p,{kernelShape:s,strides:a,pads:c,cacheKey:t.cacheKey});let m=f.slice();return m.push(m.splice(1,1)[0]),[p,n?m:f]},y1=(e,t)=>{let i=t.format==="NHWC",n=Z.size(e),r=Z.size(t.kernelShape),o=[{type:12,data:n},{type:12,data:r}],s=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(t.kernelShape.length<=2){let a=t.kernelShape[t.kernelShape.length-1],u=t.strides[t.strides.length-1],c=t.pads[t.pads.length/2-1],f=t.pads[t.pads.length-1],p=!!(c+f);o.push({type:12,data:a},{type:12,data:u},{type:12,data:c},{type:12,data:f}),s.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let m=!1;if(t.kernelShape.length===2){let v=t.kernelShape[t.kernelShape.length-2],b=t.strides[t.strides.length-2],w=t.pads[t.pads.length/2-2],C=t.pads[t.pads.length-2];m=!!(w+C),o.push({type:12,data:v},{type:12,data:b},{type:12,data:w},{type:12,data:C}),s.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[o,s,!0,p,m]}else{if(i)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let a=Z.computeStrides(t.kernelShape);o.push({type:12,data:a},{type:12,data:t.pads},{type:12,data:t.strides}),s.push({name:"kernelStrides",type:"u32",length:a.length},{name:"pads",type:"u32",length:t.pads.length},{name:"strides",type:"u32",length:t.strides.length});let u=t.pads.reduce((c,f)=>c+f);return[o,s,!!u,!1,!1]}},w1=(e,t,i,n,r,o,s,a,u,c,f,p)=>{let m=r.format==="NHWC",v=t.type.value,b=Ee("output",t.type.tensor,n);if(r.kernelShape.length<=2){let w="",C="",x="",y=i-(m?2:1);if(f?w=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${y}] = indices[${y}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${y}] < 0 || xIndices[${y}]
                      >= uniforms.x_shape[${y}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${o}
                }`:w=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${y}] = indices[${y}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${o}
                }`,r.kernelShape.length===2){let I=i-(m?3:2);p?C=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${I}] = indices[${I}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${I}] < 0 || xIndices[${I}] >= uniforms.x_shape[${I}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:C=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${I}] = indices[${I}] * uniforms.sh - uniforms.phStart + j;
                `,x=`
              }
            `}return`
            ${e.registerUniforms(u).declareVariables(t,b)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${b.offsetToIndices("global_idx")};
              var xIndices = ${b.offsetToIndices("global_idx")};

              var value = ${v}(${a});
              var pad = 0;
              ${C}
              ${w}
              ${x}
              ${s}

              output[global_idx] = value;
            }`}else{if(m)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let w=r.kernelShape.length,C=r.pads.length,x="";return c?x=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${t.indicesToOffset("xIndices")}];
                ${o}
              }`:x=`
              }
              let x_val = x[${t.indicesToOffset("xIndices")}];
              ${o}
            `,`
            ${e.registerUniforms(u).declareVariables(t,b)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${b.offsetToIndices("global_idx")};
              var xIndices = ${b.offsetToIndices("global_idx")};

              var offsets: array<u32, ${w}>;

              var value = ${v}(${a});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${w-1}u; j++) {
                  offsets[j] = offset / ${Se("uniforms.kernelStrides","j",w)};
                  offset -= offsets[j] * ${Se("uniforms.kernelStrides","j",w)};
                }
                offsets[${w-1}] = offset;

                isPad = false;
                for (var j = ${i-w}u; j < ${i}u; j++) {
                  xIndices[j] = indices[j] * ${Se("uniforms.strides",`j - ${i-w}u`,w)}
                    + offsets[j - ${i-w}u] - ${Se("uniforms.pads","j - 2u",C)};
                  ${x}
              }
              ${s}

              output[global_idx] = value;
            }`}},x1=e=>`${e.format};${e.ceilMode};${e.autoPad};${e.kernelShape.length}`,SO=e=>`${x1(e)};${e.countIncludePad}`,DO=e=>`${x1(e)};${e.storageOrder};${e.dilations}`,C1=e=>({format:e.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],ceilMode:e.ceil_mode,kernelShape:e.kernel_shape,strides:e.strides,pads:e.pads}),E1=(e,t,i,n)=>{let[r,o]=b1(t,n,i),s=ee("x",t.dataType,t.dims.length),a=s.type.value,u="value += x_val;",c="";r.countIncludePad?c+=`value /= ${a}(uniforms.kernelSize);`:c+=`value /= ${a}(i32(uniforms.kernelSize) - pad);`;let[f,p,m,v,b]=y1(o,r);f.push(...Te(t.dims,o));let w=["rank"];return{name:e,shaderCache:{hint:`${n.cacheKey};${m};${v};${b}`,inputDependencies:w},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Z.size(o)/64)},programUniforms:f}),getShaderSource:C=>w1(C,s,t.dims.length,o.length,r,u,c,0,p,m,v,b)}},mF=e=>{let t=e.count_include_pad!==0,i=C1(e);if(i.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let n=Ae(ie({countIncludePad:t},i),{cacheKey:""});return Ae(ie({},n),{cacheKey:SO(n)})},gF=(e,t)=>{yf(e.inputs),e.compute(E1("AveragePool",e.inputs[0],!1,t))},I1={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},_F=e=>{let t=e.format;return Ae(ie({format:t},I1),{cacheKey:t})},vF=(e,t)=>{yf(e.inputs),e.compute(E1("GlobalAveragePool",e.inputs[0],!0,t))},S1=(e,t,i,n)=>{let[r,o]=b1(t,n,i),s=`
      value = max(x_val, value);
    `,a="",u=ee("x",t.dataType,t.dims.length),c=["rank"],[f,p,m,v,b]=y1(o,r);return f.push(...Te(t.dims,o)),{name:e,shaderCache:{hint:`${n.cacheKey};${m};${v};${b}`,inputDependencies:c},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Z.size(o)/64)},programUniforms:f}),getShaderSource:w=>w1(w,u,t.dims.length,o.length,r,s,a,t.dataType===10?-65504:-1e5,p,m,v,b)}},bF=(e,t)=>{yf(e.inputs),e.compute(S1("MaxPool",e.inputs[0],!1,t))},yF=e=>{let t=e.storage_order,i=e.dilations,n=C1(e);if(t!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(n.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let r=Ae(ie({storageOrder:t,dilations:i},n),{cacheKey:""});return Ae(ie({},r),{cacheKey:DO(r)})},wF=e=>{let t=e.format;return Ae(ie({format:t},I1),{cacheKey:t})},xF=(e,t)=>{yf(e.inputs),e.compute(S1("GlobalMaxPool",e.inputs[0],!0,t))}}),TO,$O,CF,EF,YJ=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),TO=(e,t)=>{if(e.length<2||e.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(e.length===3&&e[1].dims===e[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[0].dataType===6&&e.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(e[1].dims.length!==0&&e[1].dims.length!==1&&e[1].dims.length!==e[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(e.length>2){if(e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[1].dims.length!==e[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!e[1].dims.map((i,n)=>i===e[2].dims[n]).reduce((i,n)=>i&&n,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(t.blockSize>0){if(e[1].dims.length===0||e[1].dims.length===1&&e[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!e[1].dims.map((r,o)=>o===t.axis||r===e[0].dims[o]).reduce((r,o)=>r&&o,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(e[1].dims.length!==e[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let i=e[0].dims[t.axis],n=e[1].dims[t.axis];if(t.blockSize<Math.ceil(i/n)||t.blockSize>Math.ceil(i/(n-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},$O=(e,t)=>{let i=Z.normalizeAxis(t.axis,e[0].dims.length),n=e[0].dataType,r=n===3,o=e[0].dims,s=e[1].dataType,a=Z.size(o),u=n===3||n===2,c=u?[Math.ceil(Z.size(e[0].dims)/4)]:e[0].dims,f=e[1].dims,p=e.length>2?e[2]:void 0,m=p?u?[Math.ceil(Z.size(p.dims)/4)]:p.dims:void 0,v=f.length===0||f.length===1&&f[0]===1,b=v===!1&&f.length===1,w=en(a),C=v&&(!u||w===4),x=C?w:1,y=C&&!u?w:1,I=ee("input",u?12:n,c.length,y),S=ee("scale",s,f.length),T=p?ee("zero_point",u?12:n,m.length):void 0,$=Ee("output",s,o.length,x),k=[I,S];T&&k.push(T);let P=[c,f];p&&P.push(m);let j=[{type:12,data:a/x},{type:12,data:i},{type:12,data:t.blockSize},...Te(...P,o)],H=re=>{let ae=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${re.registerUniforms(ae).declareVariables(...k,$)}
      ${re.mainStart()}
          ${re.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${$.offsetToIndices("global_idx")};

          // Set input x
          ${u?`
            let input = ${I.getByOffset("global_idx / 4")};
            let x_vec = ${r?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${x===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${I.getByOffset("global_idx")};`};

          // Set scale input
          ${v?`let scale_value= ${S.getByOffset("0")}`:b?`
            let scale_index = ${$.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${S.getByOffset("scale_index")};`:`
            var scale_indices: ${S.type.indices} = output_indices;
            let index = ${S.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${S.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${S.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${T?v?u?`
                let zero_point_input = ${T.getByOffset("0")};
                let zero_point_vec =  ${r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${T.getByOffset("0")}`:b?u?`
                let zero_point_index = ${$.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${T.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${$.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${T.getByOffset("zero_point_index")};`:u?`
                let zero_point_offset = ${S.indicesToOffset("scale_indices")};
                let zero_point_input = ${T.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${T.getByIndices("scale_indices")};`:`let zero_point_value = ${u?r?"i32":"u32":I.type.value}(0);`};
      // Compute and write output
      ${$.setByOffset("global_idx",`${$.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:t.cacheKey,inputDependencies:T?["rank","rank","rank"]:["rank","rank"]},getShaderSource:H,getRunData:()=>({outputs:[{dims:o,dataType:s}],dispatchGroup:{x:Math.ceil(a/x/64),y:1,z:1},programUniforms:j})}},CF=(e,t)=>{TO(e.inputs,t),e.compute($O(e.inputs,t))},EF=e=>$t({axis:e.axis,blockSize:e.blockSize})}),kO,MO,IF,JJ=ue(()=>{"use strict";gr(),Fe(),Qe(),kO=(e,t,i)=>{let n=e===t,r=e<t&&i<0,o=e>t&&i>0;if(n||r||o)throw new Error("Range these inputs' contents are invalid.")},MO=(e,t,i,n)=>{let r=Math.abs(Math.ceil((t-e)/i)),o=[r],s=r,a=[{type:12,data:s},{type:n,data:e},{type:n,data:i},...Te(o)],u=c=>{let f=Ee("output",n,o.length),p=f.type.value,m=[{name:"outputSize",type:"u32"},{name:"start",type:p},{name:"delta",type:p}];return`
        ${c.registerUniforms(m).declareVariables(f)}
        ${c.mainStart()}
        ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${p}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${n}`},getShaderSource:u,getRunData:()=>({outputs:[{dims:o,dataType:n}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:a})}},IF=e=>{let t=0,i=0,n=0;e.inputs[0].dataType===6?(t=e.inputs[0].getInt32Array()[0],i=e.inputs[1].getInt32Array()[0],n=e.inputs[2].getInt32Array()[0]):e.inputs[0].dataType===1&&(t=e.inputs[0].getFloat32Array()[0],i=e.inputs[1].getFloat32Array()[0],n=e.inputs[2].getFloat32Array()[0]),Yt.webgpu.validateInputContent&&kO(t,i,n),e.compute(MO(t,i,n,e.inputs[0].dataType),{inputs:[]})}}),AO,RO,SF,DF,XJ=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),AO=(e,t,i,n)=>{if(e!=="none"&&n!=="i32"&&n!=="u32"&&n!=="f32")throw new Error(`Input ${n} is not supported with reduction ${e}.`);let r=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,o=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${t}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(e){case"none":return`${t}=${i};`;case"add":return n==="i32"||n==="u32"?`atomicAdd(&${t}, bitcast<${n}>(${i}));`:`
              ${r}bitcast<${n}>(oldValue) + (${i})${o}`;case"max":return n==="i32"||n==="u32"?`atomicMax(&${t}, bitcast<${n}>(${i}));`:`
                ${r}max(bitcast<f32>(oldValue), (${i}))${o}`;case"min":return n==="i32"||n==="u32"?`atomicMin(&${t}, bitcast<${n}>(${i}));`:`${r}min(bitcast<${n}>(oldValue), (${i}))${o}`;case"mul":return`${r}(bitcast<${n}>(oldValue) * (${i}))${o}`;default:throw new Error(`Reduction ${e} is not supported.`)}},RO=(e,t)=>{let i=e[0].dims,n=e[1].dims,r=i,o=1,s=Math.ceil(Z.size(n)/o),a=n[n.length-1],u=Z.sizeFromDimension(i,a),c=[{type:12,data:s},{type:12,data:a},{type:12,data:u},...Te(e[1].dims,e[2].dims,r)],f=p=>{let m=ee("indices",e[1].dataType,e[1].dims.length),v=ee("updates",e[2].dataType,e[2].dims.length,o),b=t.reduction!=="none"&&t.reduction!==""?i3("output",e[0].dataType,r.length):Ee("output",e[0].dataType,r.length,o);return`
      ${p.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(m,v,b)}
      ${p.mainStart()}
        ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var hasDuplicates = false;
  if (${t.reduction==="none"}) {
    let n = ${Z.size(n)};
    for (var i = 0; i < n; i = i + 1) {
      for (var j = i + 1; j < n; j = j + 1) {
        var index_i = i32(indices[i].x);
        var index_j = i32(indices[j].x);
        if (index_i == index_j) {
          hasDuplicates = true;
          break;
        }
      }
      if (hasDuplicates) {
        break;
      }
    }
  }

  var data_offset = 0u;
  var indices_start = uniforms.last_index_dimension * global_idx;
  if (${t.reduction==="none"} && hasDuplicates) {
    if (global_idx != 0u) {
      return;
    }
    indices_start = 0u;
  }
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${e[0].dims.length===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start + uniforms.last_index_dimension];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${AO(t.reduction,"output[data_offset + i]","value",b.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${t.cacheKey}_${t.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:c}),getShaderSource:f}},SF=e=>$t({reduction:e.reduction}),DF=(e,t)=>{e.compute(RO(e.inputs,t),{inputs:[e.inputs[1],e.inputs[2]],outputs:[]})}}),OO,NO,PO,D1,FO,zO,LO,BO,jO,VO,UO,HO,T1,WO,qO,GO,KO,ZO,TF,$F,eX=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),OO=(e,t)=>{if(e.every(i=>i>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),e.length>0){if(t.mode==="linear"){if(!(e.length===2||e.length===3||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1||e.length===5&&e[0]===1&&e[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(t.mode==="cubic"&&!(e.length===2||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},NO=(e,t,i)=>{t.every(r=>r>=0&&r<i||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let n=new Array(i).fill(1);return t.forEach((r,o)=>n[r]=e[o]),n},PO=(e,t,i,n,r,o)=>{let[s,a,u]=i>10?[1,2,3]:[-1,e.length>1?1:-1,-1],c=e[0].dims.length;if(s>0&&e.length>s&&e[s].dims.length>0)e[s].getFloat32Array().forEach(f=>o.push(f));else if(t.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(a>0&&e.length>a&&e[a].dims.length===1&&e[a].dims[0]>0){if(e[a].getFloat32Array().forEach(f=>n.push(f)),n.length!==0&&n.length!==c&&i>=18&&n.length!==t.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");OO(n,t),t.axes.length>0&&NO(n,t.axes,c).forEach((f,p)=>n[p]=f)}if(u>0&&e.length>u&&e[u].dims.length===1&&e[u].dims[0]>0&&(e[u].getBigInt64Array().forEach(f=>r.push(Number(f))),r.length!==0&&r.length!==c&&i>=18&&r.length!==t.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(t.axes.length>0){if(n.length!==0&&n.length!==t.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(r.length!==0&&r.length!==t.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof n<"u"&&typeof r<"u"&&n.length>0&&r.length>c)throw new Error("Resize requires only of scales or sizes to be specified")},D1=(e,t,i,n)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${e}) * (${t});
  let whole = ${n}(big / (${i}));
  let fract = ${n}(big % (${i})) / ${n}(${i});
  return whole + fract;
`,FO=(e,t)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${t} { `+(()=>{switch(e){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${t}(xResized) / ${t}(xScale);
          } else {
            ${D1("xResized","lengthOriginal","lengthResized",t)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${t}(xResized) + 0.5) / ${t}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${t}(xResized) + 0.5) / ${t}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${D1("xResized","lengthOriginal - 1","lengthResized - 1",t)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${t}(roiStart) * ${t}(lengthOriginal - 1) +
                        (${t}(xResized) * ${t}(roiEnd - roiStart) * ${t}(lengthOriginal - 1)) /
                        ${t}(lengthResized - 1);
                  } else {
                    return 0.5 * ${t}(roiStart + roiEnd) * ${t}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${t}xScale * ${t}(lengthResized);
                  const adjustment = ${t}(lengthResized) / outputWidth;
                  const center = ${t}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;case"half_pixel":return`return ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${e} is not supported`)}})()+"}",zO=(e,t,i)=>`fn getNearestPixelFromOriginal(xOriginal: ${i}, isDownSample: bool) -> ${i} {`+(()=>{switch(e){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(t<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${e} is not supported`)}})()+"}",LO=(e,t,i)=>{let n=new Array(i).fill(0).concat(new Array(i).fill(1)),r=e.length===0?n:e.slice();return t.length>0?(t.forEach((o,s)=>{n[o]=r[s],n[s+i]=r[t.length+s]}),n):r},BO=(e,t,i,n)=>{let r=[];if(i.length>0)if(n.length>0){if(e.forEach(o=>r.push(o)),Math.max(...n)>e.length)throw new Error("axes is out of bound");n.forEach((o,s)=>r[o]=i[s])}else i.forEach(o=>r.push(o));else{if(t.length===0)throw new Error("Resize requires either scales or sizes.");r=e.map((o,s)=>Math.round(o*t[s]))}return r},jO=(e,t,i)=>{let n=(()=>{switch(i.keepAspectRatioPolicy){case"not_larger":return i.axes.length>0?Math.min(...i.axes.map(o=>t[o]),Number.MAX_VALUE):Math.min(...t,Number.MAX_VALUE);case"not_smaller":return i.axes.length>0?Math.max(...i.axes.map(o=>t[o]),Number.MIN_VALUE):Math.max(...t,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${i.keepAspectRatioPolicy} is not supported`)}})();t.fill(1,0,t.length);let r=e.slice();return i.axes.length>0?(i.axes.forEach(o=>t[o]=n),i.axes.forEach(o=>r[o]=Math.round(e[o]*t[o]))):(t.fill(n,0,t.length),r.forEach((o,s)=>r[s]=Math.round(o*t[s]))),r},VO=(e,t,i,n,r)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> array<${e.type.value}, ${i.length}> {
      var original_indices: array<${e.type.value}, ${i.length}>;
      for (var i:u32 = 0; i < ${i.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var scale = ${Se("uniforms.scales","i",n)};
        var roi_low = ${Se("uniforms.roi","i",r)};
        var roi_hi = ${Se("uniforms.roi",`i + ${t.length}`,r)};
        if (scale == 1.0) {
          original_indices[i] = ${e.type.value}(output_index);
        } else {
          var input_shape_i = ${Se("uniforms.input_shape","i",t.length)};
          var output_shape_i = ${Se("uniforms.output_shape","i",i.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,UO=(e,t,i,n,r,o,s)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
      var input_indices: ${e.type.indices};
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${Se("uniforms.scales","i",r)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${Se("uniforms.roi","i",o)};
          var roi_hi = ${Se("uniforms.roi",`i + ${i.length}`,o)};
          var input_shape_i = ${Se("uniforms.input_shape","i",i.length)};
          var output_shape_i = ${Se("uniforms.output_shape","i",n.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${s} || (original_idx >= 0 && original_idx < ${t.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${t.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${e.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,HO=(e,t)=>`
    fn checkInputIndices(input_indices: ${e.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${t.length}; i++) {
        var input_index = ${e.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${Se("uniforms.input_shape","i",t.length)}) {
          return false;
        }
      }
      return true;
    }`,T1=(e,t,i,n)=>e.rank>n?`
    ${e.indicesSet("input_indices",t,"channel")};
    ${e.indicesSet("input_indices",i,"batch")};
`:"",WO=(e,t,i,n,r)=>{let[o,s,a,u]=i.length===2?[-1,0,1,-1]:[0,2,3,1],c=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${c} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",s,`max(0, min(row, ${i[s]} - 1))`)};
      ${e.indicesSet("input_indices",a,`max(0, min(col, ${i[a]} - 1))`)};
      ${T1(e,u,o,2)}
      return ${e.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${t.type.indices}) -> ${c} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${c} = originalIndices[${s}];
      var col:${c} = originalIndices[${a}];
      ${n?`if (row < 0 || row > (${i[s]} - 1) || col < 0 || col > (${i[a]} - 1)) {
        return ${r};
      }`:""};
      row = max(0, min(row, ${i[s]} - 1));
      col = max(0, min(col, ${i[a]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${i.length>2?`u32(originalIndices[${u}])`:"0"};
      var batch: u32 =  ${i.length>2?`u32(originalIndices[${o}])`:"0"};
      var x11: ${c} = getInputValue(batch, channel, row1, col1);
      var x12: ${c} = getInputValue(batch, channel, row1, col2);
      var x21: ${c} = getInputValue(batch, channel, row2, col1);
      var x22: ${c} = getInputValue(batch, channel, row2, col2);
      var dx1: ${c} = abs(row - ${c}(row1));
      var dx2: ${c} = abs(${c}(row2) - row);
      var dy1: ${c} = abs(col - ${c}(col1));
      var dy2: ${c} = abs(${c}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},qO=(e,t,i,n,r,o,s,a,u,c)=>{let f=i.length===2,p=!0,[m,v]=f?[0,1]:p?[2,3]:[1,2],b=e.type.value,w=C=>{let x=C===m?"row":"col";return`
      fn ${x}CubicInterpolation(input_indices: ${e.type.indices}, output_indices: ${t.type.indices}) -> ${b} {
        var output_index = ${t.indicesGet("output_indices",C)};
        var originalIdx: ${b} = getOriginalCoordinateFromResizedCoordinate(output_index, ${r[C]},
        ${n[C]}, ${i[C]}, ${o[C]}, ${o[C]} + ${i.length});
        var fractOriginalIdx: ${b} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${a} && (originalIdx < 0 || originalIdx > (${i[C]} - 1))) {
          return ${u};
        }
        var data: array<${b}, 4> = array<${b}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${x}: ${b} = originalIdx + ${b}(i);
          if (${x} < 0 || ${x} >= ${i[C]}) {
            ${c?`coefs[i + 1] = 0.0;
                        continue;`:a?`return ${u};`:`${x} = max(0, min(${x}, ${i[C]} - 1));`};
          }
        var input_indices_copy: ${e.type.indices} = input_indices;
          ${e.indicesSet("input_indices_copy",C,`u32(${x})`)};
          data[i + 1] = ${C===m?e.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${w(m)};
    ${w(v)};
  fn getCubicInterpolationCoefs(s: ${b}) -> array<${b}, 4> {
    var absS = abs(s);
    var coeffs: array<${b}, 4> = array<${b}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${b} = 1.0 - absS;
    var twoMinusAbsS: ${b} = 2.0 - absS;
    var onePlusAbsS: ${b} = 1.0 + absS;
    coeffs[0] = ((${s} * onePlusAbsS - 5 * ${s}) * onePlusAbsS + 8 * ${s}) * onePlusAbsS - 4 * ${s};
    coeffs[1] = ((${s} + 2) * absS - (${s} + 3)) * absS * absS + 1;
    coeffs[2] = ((${s} + 2) * oneMinusAbsS - (${s} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${s} * twoMinusAbsS - 5 * ${s}) * twoMinusAbsS + 8 * ${s}) * twoMinusAbsS - 4 * ${s};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${b}, 4>, coefs: array<${b}, 4>) -> ${b} {
    var coefsSum: ${b} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${t.type.indices}) -> ${b} {
    var input_indices: ${e.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},GO=(e,t,i,n,r)=>{let[o,s,a,u,c]=i.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],f=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${f} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",s,`max(0, min(depth, ${i[s]} - 1))`)};
      ${e.indicesSet("input_indices",a,`max(0, min(height, ${i[a]} - 1))`)};
      ${e.indicesSet("input_indices",u,`max(0, min(width, ${i[u]} - 1))`)};
      ${T1(e,c,o,3)}
      return ${e.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${t.type.indices}) -> ${f} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${f} = originalIndices[${s}];
      var height:${f} = originalIndices[${a}];
      var width:${f} = originalIndices[${u}];
      ${n?`if (depth < 0 || depth > (${i[s]} - 1) || height < 0 || height > (${i[a]} - 1) || width < 0 || (width > ${i[u]} - 1)) {
      return ${r};
        }`:""};

    depth = max(0, min(depth, ${i[s]} - 1));
      height = max(0, min(height, ${i[a]} - 1));
      width = max(0, min(width, ${i[u]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${i.length>3?`u32(originalIndices[${c}])`:"0"};
      var batch: u32 =  ${i.length>3?`u32(originalIndices[${o}])`:"0"};

      var x111: ${f} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${f} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${f} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${f} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${f} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${f} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${f} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${f} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${f} = abs(depth - ${f}(depth1));
      var dx2: ${f} = abs(${f}(depth2) - depth);
      var dy1: ${f} = abs(height - ${f}(height1));
      var dy2: ${f} = abs(${f}(height2) - height);
      var dz1: ${f} = abs(width - ${f}(width1));
      var dz2: ${f} = abs(${f}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},KO=(e,t,i,n,r,o)=>{let s=e.dims,a=LO(o,t.axes,s.length),u=BO(s,n,r,t.axes),c=n.slice();n.length===0&&(c=s.map((y,I)=>y===0?1:u[I]/y),t.keepAspectRatioPolicy!=="stretch"&&(u=jO(s,c,t)));let f=Ee("output",e.dataType,u.length),p=ee("input",e.dataType,s.length),m=Z.size(u),v=s.length===u.length&&s.every((y,I)=>y===u[I]),b=t.coordinateTransformMode==="tf_crop_and_resize",w=t.extrapolationValue,C=p.type.value,x=y=>`
      ${v?"":`
      ${FO(t.coordinateTransformMode,C)};
      ${(()=>{switch(t.mode){case"nearest":return`
              ${HO(p,s)};
              ${zO(t.nearestMode,i,C)};
              ${UO(p,f,s,u,c.length,a.length,b)};
              `;case"linear":return`
              ${VO(f,s,u,c.length,a.length)};
              ${(()=>{if(s.length===2||s.length===4)return`${WO(p,f,s,b,w)}`;if(s.length===3||s.length===5)return`${GO(p,f,s,b,w)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(s.length===2||s.length===4)return`${qO(p,f,s,u,c,a,t.cubicCoeffA,b,t.extrapolationValue,t.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${y.registerUniform("output_size","u32").registerUniform("scales","f32",c.length).registerUniform("roi","f32",a.length).declareVariables(p,f)}
      ${y.mainStart()}
        ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${v?"output[global_idx] = input[global_idx];":`
        let output_indices = ${f.offsetToIndices("global_idx")};
        var input_indices: ${p.type.indices};
        ${(()=>{switch(t.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${p.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${t.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${s.length===2||s.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${t.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${t.cacheKey}|${i}|${c.length>0?t.mode==="cubic"?c:c.length:""}|${r.length>0?r:""}|${a.length>0?a:""}|${v}|${t.mode==="nearest"?s.length:s}`,inputDependencies:["rank"]},getShaderSource:x,getRunData:()=>({outputs:[{dims:u,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:[{type:12,data:m},{type:1,data:c},{type:1,data:a},...Te(s,u)]})}},ZO=e=>{let t=e.customDataBuffer;return new Uint32Array(t,t.byteOffset,1)[0]},TF=(e,t)=>{let i=[],n=[],r=[],o=ZO(e);if(t.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");PO(e.inputs,t,o,i,n,r),e.compute(KO(e.inputs[0],t,o,i,n,r),{inputs:[0]})},$F=e=>{let t=e.antialias,i=e.axes,n=e.coordinateTransformMode,r=e.cubicCoeffA,o=e.excludeOutside!==0,s=e.extrapolationValue,a=e.keepAspectRatioPolicy,u=e.mode,c=e.nearestMode===""?"simple":e.nearestMode;return $t({antialias:t,axes:i,coordinateTransformMode:n,cubicCoeffA:r,excludeOutside:o,extrapolationValue:s,keepAspectRatioPolicy:a,mode:u,nearestMode:c})}}),QO,YO,kF,tX=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),QO=(e,t)=>{let[i,n,r,o]=e,{numHeads:s,rotaryEmbeddingDim:a}=t;if(i.dims.length!==3&&i.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${i.dims.length}`);if(!Z.areEqual(n.dims,[])&&!Z.areEqual(n.dims,[1])&&n.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${n.dims.length}`);if(r.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${r.dims.length}`);if(o.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${o.dims.length}`);if(!Z.areEqual(r.dims,o.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(a>0&&s===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let u=i.dims[0],c=i.dims[i.dims.length-2],f=r.dims[0],p=Z.sizeFromDimension(i.dims,1)/c,m=a===0?r.dims[1]*2:p/s;if(a>m)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(n.dims.length===2){if(u!==n.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${n.dims[0]}`);if(c!==n.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${n.dims[1]}`)}if(m/2!==r.dims[1]&&a/2!==r.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${r.dims[1]}`);if(c>f)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},YO=(e,t)=>{let{interleaved:i,numHeads:n,rotaryEmbeddingDim:r,scale:o}=t,s=e[0].dims[0],a=Z.sizeFromDimension(e[0].dims,1),u=e[0].dims[e[0].dims.length-2],c=a/u,f=e[2].dims[1],p=r===0?f*2:c/n,m=new Array(s,u,c/p,p-f),v=Z.computeStrides(m),b=[{type:1,data:o},{type:12,data:m},{type:12,data:v},...e[0].dims.length===3?new Array({type:12,data:[a,c,p,1]}):[],...e[0].dims.length===4?new Array({type:12,data:[a,p,u*p,1]}):[],...Te(e[0].dims,e[1].dims,e[2].dims,e[3].dims,e[0].dims)],w=C=>{let x=ee("input",e[0].dataType,e[0].dims.length),y=ee("position_ids",e[1].dataType,e[1].dims.length),I=ee("cos_cache",e[2].dataType,e[2].dims.length),S=ee("sin_cache",e[3].dataType,e[3].dims.length),T=Ee("output",e[0].dataType,e[0].dims.length);return C.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:m.length},{name:"global_strides",type:"u32",length:v.length},{name:"input_output_strides",type:"u32",length:v.length}]),`
        ${C.declareVariables(x,y,I,S,T)}

        ${C.mainStart(Vl)}
          let half_rotary_emb_dim = uniforms.${I.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${C.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${y.broadcastedIndicesToOffset("bsnh.xy",Ee("",y.type.tensor,2))};
            let position_id =
                u32(${y.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${i});
            let j = i + select(half_rotary_emb_dim, 1, ${i});
            let re = ${x.getByOffset("i")} * ${I.get("position_id","bsnh[3]")} -
                ${x.getByOffset("j")} * ${S.get("position_id","bsnh[3]")};
            ${T.setByOffset("i","re")}
            let im = ${x.getByOffset("i")} * ${S.get("position_id","bsnh[3]")} +
                ${x.getByOffset("j")} * ${I.get("position_id","bsnh[3]")};
            ${T.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${T.setByOffset("k",x.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:$t({interleaved:i}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:w,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Z.size(m)/Vl)},programUniforms:b})}},kF=(e,t)=>{QO(e.inputs,t),e.compute(YO(e.inputs,t))}}),JO,XO,MF,nX=ue(()=>{"use strict";Fe(),Ue(),Qe(),JO=e=>{if(!e||e.length<3)throw new Error("layerNorm requires at least 3 inputs.");let t=e[0],i=e[1],n=e[2];if(t.dataType!==i.dataType||t.dataType!==n.dataType)throw new Error("All inputs must have the same data type");if(t.dims.length!==3&&t.dims.length!==2)throw new Error("Input must be 2D or 3D");if(i.dims.length!==3&&i.dims.length!==2)throw new Error("Skip must be 2D or 3D");let r=t.dims[t.dims.length-1],o=t.dims[t.dims.length-2];if(i.dims[i.dims.length-1]!==r)throw new Error("Skip must have the same hidden size as input");if(i.dims[i.dims.length-2]!==o)throw new Error("Skip must have the same sequence length as input");if(n.dims.length!==1)throw new Error("Gamma must be 1D");if(n.dims[n.dims.length-1]!==r)throw new Error("Gamma must have the same hidden size as input");if(e.length>3){let s=e[3];if(s.dims.length!==1)throw new Error("Beta must be 1D");if(s.dims[s.dims.length-1]!==r)throw new Error("Beta must have the same hidden size as input")}if(e.length>4){let s=e[4];if(s.dims.length!==1)throw new Error("Bias must be 1D");if(s.dims[s.dims.length-1]!==r)throw new Error("Bias must have the same hidden size as input")}},XO=(e,t,i,n)=>{let r=t.simplified,o=e[0].dims,s=Z.size(o),a=o,u=s,c=o.slice(-1)[0],f=n?o.slice(0,-1).concat(1):[],p=!r&&e.length>3,m=e.length>4,v=n&&i>1,b=n&&i>2,w=i>3,C=64,x=en(c),y=[{type:12,data:u},{type:12,data:x},{type:12,data:c},{type:1,data:t.epsilon}],I=T=>{let $=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],k=[ee("x",e[0].dataType,e[0].dims,x),ee("skip",e[1].dataType,e[1].dims,x),ee("gamma",e[2].dataType,e[2].dims,x)];p&&k.push(ee("beta",e[3].dataType,e[3].dims,x)),m&&k.push(ee("bias",e[4].dataType,e[4].dims,x)),k.push(Ee("output",e[0].dataType,a,x)),v&&k.push(Ee("mean_output",1,f)),b&&k.push(Ee("inv_std_output",1,f)),w&&k.push(Ee("input_skip_bias_sum",e[0].dataType,a,x));let P=In(e[0].dataType),j=In(1,x);return`

      ${T.registerUniforms($).declareVariables(...k)}
      var<workgroup> sum_shared : array<${j}, ${C}>;
      var<workgroup> sum_squared_shared : array<${j}, ${C}>;

      ${T.mainStart([C,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${C};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${C};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${C-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${m?"bias[offset1d + i]":P+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${w?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${Bl(P,x,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${C};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${ns("sum",x)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${ns("square_sum",x)} / f32(uniforms.hidden_size) ${r?"":"- mean * mean"} + uniforms.epsilon);
        ${v?"mean_output[global_idx] = mean;":""}
        ${b?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${r?"":`- ${P}(mean)`}) *
            ${P}(inv_std_dev) * gamma[offset1d + i]
            ${p?"+ beta[offset1d + i]":""};
        }
      }`},S=[{dims:a,dataType:e[0].dataType}];return i>1&&S.push({dims:f,dataType:1}),i>2&&S.push({dims:f,dataType:1}),i>3&&S.push({dims:o,dataType:e[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${x};${v};${b};${w}`,inputDependencies:e.map((T,$)=>"type")},getShaderSource:I,getRunData:()=>({outputs:S,dispatchGroup:{x:Math.ceil(u/c)},programUniforms:y})}},MF=(e,t)=>{JO(e.inputs);let i=[0];e.outputCount>1&&i.push(-3),e.outputCount>2&&i.push(-3),e.outputCount>3&&i.push(3),e.compute(XO(e.inputs,t,e.outputCount,!1),{outputs:i})}}),eN,wf,tN,$1,nN,iN,AF,RF,iX=ue(()=>{"use strict";Fe(),Ue(),on(),Qe(),eN=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");if(t.axes.length!==0){if(t.axes.length!==t.starts.length||t.axes.length!==t.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(t.starts.length!==t.ends.length)throw new Error("starts and ends must have the same length");e.slice(1).forEach((i,n)=>{if(e[n+1].dataType!==6&&e[n+1].dataType!==7)throw new Error(`Input ${n} must be an array of int32 or int64`)})},wf=(e,t)=>{let i=[];if(e.length>t)if(e[t].dataType===7)e[t].getBigInt64Array().forEach(n=>i.push(Number(n)));else if(e[t].dataType===6)e[t].getInt32Array().forEach(n=>i.push(Number(n)));else throw new Error(`Input ${t} must be an array of int32 or int64`);return i},tN=(e,t)=>{if(e.length>1){let i=wf(e,1),n=wf(e,2),r=wf(e,3);return r.length===0&&(r=[...Array(e[0].dims.length).keys()]),$t({starts:i,ends:n,axes:r})}else return t},$1=(e,t,i,n,r)=>{let o=e;return e<0&&(o+=i[n[t]]),r[t]<0?Math.max(0,Math.min(o,i[n[t]]-1)):Math.max(0,Math.min(o,i[n[t]]))},nN=(e,t,i)=>`fn calculateInputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
          var input_indices: ${e.type.indices};
          var carry = 0u;
          for (var i = ${i.length}; i >= 0; i--) {
            let input_shape_i = ${Se("uniforms.input_shape","i",i.length)};
            let steps_i = ${Se("uniforms.steps","i",i.length)};
            let signs_i = ${Se("uniforms.signs","i",i.length)};
            let starts_i = ${Se("uniforms.starts","i",i.length)};
            var output_index = ${t.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${e.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,iN=(e,t)=>{let i=e[0].dims,n=Z.size(i),r=t.axes.length>0?Z.normalizeAxes(t.axes,i.length):[...Array(i.length).keys()],o=wf(e,4);o.forEach(x=>x!==0||(()=>{throw new Error("step cannot be 0")})),o.length===0&&(o=Array(r.length).fill(1));let s=t.starts.map((x,y)=>$1(x,y,i,r,o)),a=t.ends.map((x,y)=>$1(x,y,i,r,o));if(r.length!==s.length||r.length!==a.length)throw new Error("start, ends and axes should have the same number of elements");if(r.length!==i.length)for(let x=0;x<i.length;++x)r.includes(x)||(s.splice(x,0,0),a.splice(x,0,i[x]),o.splice(x,0,1));let u=o.map(x=>Math.sign(x));o.forEach((x,y,I)=>{if(x<0){let S=(a[y]-s[y])/x,T=s[y],$=T+S*o[y];s[y]=$,a[y]=T,I[y]=-x}});let c=i.slice(0);r.forEach((x,y)=>{c[x]=Math.ceil((a[x]-s[x])/o[x])});let f={dims:c,dataType:e[0].dataType},p=Ee("output",e[0].dataType,c.length),m=ee("input",e[0].dataType,e[0].dims.length),v=Z.size(c),b=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:s.length},{name:"signs",type:"i32",length:u.length},{name:"steps",type:"u32",length:o.length}],w=[{type:12,data:v},{type:12,data:s},{type:6,data:u},{type:12,data:o},...Te(e[0].dims,c)],C=x=>`
      ${x.registerUniforms(b).declareVariables(m,p)}
        ${nN(m,p,i)}
        ${x.mainStart()}
          ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${p.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${p.setByOffset("global_idx",m.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${u.length}_${s.length}_${o.length}`,inputDependencies:["rank"]},getShaderSource:C,getRunData:()=>({outputs:[f],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:w})}},AF=(e,t)=>{eN(e.inputs,t);let i=tN(e.inputs,t);e.compute(iN(e.inputs,i),{inputs:[0]})},RF=e=>{let t=e.starts,i=e.ends,n=e.axes;return $t({starts:t,ends:i,axes:n})}}),rN,oN,OF,NF,rX=ue(()=>{"use strict";Fe(),Ue(),on(),is(),Qe(),rN=e=>{if(!e||e.length!==1)throw new Error("Softmax op requires 1 input.")},oN=(e,t)=>{let i=e.inputs[0],n=i.dims,r=Z.size(n),o=n.length,s=Z.normalizeAxis(t.axis,o),a=s<n.length-1,u,c=[];a?(c=Array.from({length:o},(k,P)=>P),c[s]=o-1,c[o-1]=s,u=e.compute(Ti(i,c),{inputs:[i],outputs:[-1]})[0]):u=i;let f=u.dims,p=f[o-1],m=r/p,v=en(p),b=p/v,w=64;m===1&&(w=256);let C=(k,P)=>P===4?`max(max(${k}.x, ${k}.y), max(${k}.z, ${k}.w))`:P===2?`max(${k}.x, ${k}.y)`:P===3?`max(max(${k}.x, ${k}.y), ${k}.z)`:k,x=ee("x",u.dataType,u.dims,v),y=Ee("result",u.dataType,u.dims,v),I=x.type.value,S=In(u.dataType)==="f32"?`var threadMax = ${I}(-3.402823e+38f);`:`var threadMax = ${I}(-65504.0h);`,T=k=>`
      var<workgroup> rowMaxShared : ${I};
      var<workgroup> rowSumShared : ${I};
      var<workgroup> threadShared : array<${I}, ${w}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${I} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${I}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${k.registerUniform("packedCols","i32").declareVariables(x,y)}
      ${k.mainStart(w)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${w};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${S}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${I}(${C("threadShared[0]",v)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${I}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${I}(${ns("threadShared[0]",v)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          setValue(row, col, row_stride, value);
        }
      }`,$=e.compute({name:"Softmax",shaderCache:{hint:`${v};${w}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:f,dataType:u.dataType}],dispatchGroup:{x:m},programUniforms:[{type:6,data:b}]}),getShaderSource:T},{inputs:[u],outputs:[a?-1:0]})[0];a&&e.compute(Ti($,c),{inputs:[$]})},OF=(e,t)=>{rN(e.inputs),oN(e,t)},NF=e=>$t({axis:e.axis})}),k1,sN,aN,lN,PF,oX=ue(()=>{"use strict";Fe(),Ue(),Qe(),k1=e=>Array.from(e.getBigInt64Array(),Number),sN=e=>{if(!e||e.length!==2)throw new Error("Tile requires 2 inputs.");if(e[0].dataType!==1&&e[0].dataType!==10&&e[0].dataType!==6&&e[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(e[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(e[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(k1(e[1]).length!==e[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},aN=(e,t)=>{let i=[];for(let n=0;n<e.length;++n)i.push(e[n]*t[n]);return i},lN=(e,t)=>{let i=e[0].dims,n=t??k1(e[1]),r=aN(i,n),o=Z.size(r),s=e[0].dataType,a=ee("input",s,i.length),u=Ee("output",s,r.length),c=f=>`
      const inputShape = ${a.indices(...i)};
      ${f.registerUniform("output_size","u32").declareVariables(a,u)}
      ${f.mainStart()}
      ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${u.offsetToIndices("global_idx")};
      var input_indices: ${a.type.indices};
      for (var i = 0; i < ${i.length}; i++) {
        let input_dim_i = ${a.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${u.indicesGet("output_indices","i")}  % input_dim_i;

        ${a.indicesSet("input_indices","i","input_dim_value")}
      }
      ${u.setByOffset("global_idx",a.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${n}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:[{type:12,data:o},...Te(e[0].dims,r)]}),getShaderSource:c}},PF=e=>{sN(e.inputs),e.compute(lN(e.inputs),{inputs:[0]})}}),uN,cN,FF,sX=ue(()=>{"use strict";Fe(),Ue(),Qe(),uN=(e,t,i,n,r)=>{let o=Ee("output_data",r,i.length,4),s=ee("a_data",t[1].dataType,t[1].dims.length,4),a=ee("b_data",t[2].dataType,t[2].dims.length,4),u=ee("c_data",t[0].dataType,t[0].dims.length,4),c,f=(p,m,v)=>`select(${m}, ${p}, ${v})`;if(!n)c=o.setByOffset("global_idx",f(s.getByOffset("global_idx"),a.getByOffset("global_idx"),u.getByOffset("global_idx")));else{let p=(m,v,b="")=>{let w=`a_data[index_a${v}][component_a${v}]`,C=`b_data[index_b${v}][component_b${v}]`,x=`bool(c_data[index_c${v}] & (0xffu << (component_c${v} * 8)))`;return`
            let output_indices${v} = ${o.offsetToIndices(`global_idx * 4u + ${v}u`)};
            let offset_a${v} = ${s.broadcastedIndicesToOffset(`output_indices${v}`,o)};
            let offset_b${v} = ${a.broadcastedIndicesToOffset(`output_indices${v}`,o)};
            let offset_c${v} = ${u.broadcastedIndicesToOffset(`output_indices${v}`,o)};
            let index_a${v} = offset_a${v} / 4u;
            let index_b${v} = offset_b${v} / 4u;
            let index_c${v} = offset_c${v} / 4u;
            let component_a${v} = offset_a${v} % 4u;
            let component_b${v} = offset_b${v} % 4u;
            let component_c${v} = offset_c${v} % 4u;
            ${m}[${v}] = ${b}(${f(w,C,x)});
          `};r===9?c=`
            var data = vec4<u32>(0);
            ${p("data",0,"u32")}
            ${p("data",1,"u32")}
            ${p("data",2,"u32")}
            ${p("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:c=`
            ${p("output_data[global_idx]",0)}
            ${p("output_data[global_idx]",1)}
            ${p("output_data[global_idx]",2)}
            ${p("output_data[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(u,s,a,o)}
        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${c}
      }`},cN=e=>{let t=e[1].dims,i=e[2].dims,n=e[0].dims,r=e[1].dataType,o=!(Z.areEqual(t,i)&&Z.areEqual(i,n)),s=t,a=Z.size(t);if(o){let c=jl.calcShape(jl.calcShape(t,i,!1),n,!1);if(!c)throw new Error("Can't perform where op on the given tensors");s=c,a=Z.size(s)}let u=Math.ceil(a/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:c=>uN(c,e,s,o,r),getRunData:()=>({outputs:[{dims:s,dataType:r}],dispatchGroup:{x:Math.ceil(a/64/4)},programUniforms:[{type:12,data:u},...Te(n,t,i,s)]})}},FF=e=>{e.compute(cN(e.inputs))}}),zF,aX=ue(()=>{"use strict";yJ(),hC(),wJ(),xJ(),CJ(),EJ(),IJ(),kJ(),AJ(),RJ(),OJ(),NJ(),PJ(),FJ(),zJ(),LJ(),BJ(),jJ(),VJ(),UJ(),HJ(),WJ(),qJ(),GJ(),KJ(),rF(),ZJ(),QJ(),YJ(),JJ(),XJ(),fC(),eX(),tX(),nX(),iX(),rX(),aF(),oX(),is(),pC(),sX(),zF=new Map([["Abs",[A3]],["Acos",[R3]],["Acosh",[O3]],["Add",[pP]],["ArgMax",[T3,V1]],["ArgMin",[D3,V1]],["Asin",[N3]],["Asinh",[P3]],["Atan",[F3]],["Atanh",[z3]],["Attention",[$3]],["AveragePool",[gF,mF]],["BatchNormalization",[k3]],["BiasAdd",[M3]],["BiasSplitGelu",[hP]],["Cast",[B3,L3]],["Ceil",[V3]],["Clip",[j3]],["Concat",[EP,IP]],["Conv",[K1,G1]],["ConvTranspose",[NP,OP]],["Cos",[U3]],["Cosh",[H3]],["CumSum",[PP,FP]],["DepthToSpace",[zP,LP]],["DequantizeLinear",[CF,EF]],["Div",[mP]],["Einsum",[BP,jP]],["Elu",[W3,Sf]],["Equal",[gP]],["Erf",[q3]],["Exp",[G3]],["Expand",[VP]],["FastGelu",[UP]],["Floor",[K3]],["FusedConv",[K1,G1]],["Gather",[WP,HP]],["GatherElements",[YP,QP]],["GatherBlockQuantized",[KP,ZP]],["GatherND",[qP,GP]],["Gelu",[Z3]],["Gemm",[XP,JP]],["GlobalAveragePool",[vF,_F]],["GlobalMaxPool",[xF,wF]],["Greater",[yP]],["GreaterOrEqual",[xP]],["GridSample",[eF,tF]],["GroupQueryAttention",[lF]],["HardSigmoid",[iP,nP]],["InstanceNormalization",[uF]],["LayerNormalization",[cF]],["LeakyRelu",[Q3,Sf]],["Less",[wP]],["LessOrEqual",[CP]],["Log",[dP]],["MatMul",[dF]],["MatMulNBits",[fF,hF]],["MaxPool",[bF,yF]],["Mul",[_P]],["MultiHeadAttention",[iF,nF]],["Neg",[J3]],["Not",[Y3]],["Pad",[pF]],["Pow",[vP]],["QuickGelu",[fP,Sf]],["Range",[IF]],["Reciprocal",[X3]],["ReduceMin",[x3]],["ReduceMean",[_3]],["ReduceMax",[w3]],["ReduceSum",[E3]],["ReduceProd",[C3]],["ReduceL1",[v3]],["ReduceL2",[b3]],["ReduceLogSum",[S3]],["ReduceLogSumExp",[y3]],["ReduceSumSquare",[I3]],["Relu",[eP]],["Resize",[TF,$F]],["RotaryEmbedding",[kF]],["ScatterND",[DF,SF]],["Sigmoid",[tP]],["Sin",[rP]],["Sinh",[oP]],["Slice",[AF,RF]],["SkipLayerNormalization",[MF]],["Split",[oF,sF]],["Sqrt",[sP]],["Softmax",[OF,NF]],["Sub",[bP]],["Tan",[aP]],["Tanh",[lP]],["ThresholdedRelu",[cP,Sf]],["Tile",[PF]],["Transpose",[o3,s3]],["Where",[FF]]])}),LF,lX=ue(()=>{"use strict";gr(),yo(),Qe(),LF=class{constructor(e){this.backend=e,this.repo=new Map,this.attributesBound=!1}getArtifact(e){return this.repo.get(e)}setArtifact(e,t){this.repo.set(e,t)}run(e,t,i,n,r){Lr(e.programInfo.name);let o=this.backend.device,s=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let a=[];for(let c of t)a.push({binding:a.length,resource:{buffer:c.buffer}});for(let c of i)a.push({binding:a.length,resource:{buffer:c.buffer}});r&&a.push({binding:a.length,resource:r});let u=o.createBindGroup({layout:e.computePipeline.getBindGroupLayout(0),entries:a,label:e.programInfo.name});if(this.backend.sessionStatus==="capturing"){let c={kernelId:this.backend.currentKernelId,computePipeline:e.computePipeline,bindGroup:u,dispatchGroup:n};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(c)}s.setPipeline(e.computePipeline),s.setBindGroup(0,u),s.dispatchWorkgroups(...n),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),mr(e.programInfo.name)}dispose(){}build(e,t){Lr(e.name);let i=this.backend.device,n=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"},{feature:"subgroups-f16",extension:"subgroups_f16"}].forEach(c=>{i.features.has(c.feature)&&n.push(`enable ${c.extension};`)});let r=r3(t,this.backend.device.limits),o=e.getShaderSource(r),s=`${n.join(`
`)}
${r.additionalImplementations}
${o}`,a=i.createShaderModule({code:s,label:e.name});pt("verbose",()=>`[WebGPU] ${e.name} shader code: ${s}`);let u=i.createComputePipeline({compute:{module:a,entryPoint:"main"},layout:"auto",label:e.name});return mr(e.name),{programInfo:e,computePipeline:u,uniformVariablesInfo:r.variablesInfo}}normalizeDispatchGroupSize(e){let t=typeof e=="number"?e:e.x,i=typeof e=="number"?1:e.y||1,n=typeof e=="number"?1:e.z||1,r=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(t<=r&&i<=r&&n<=r)return[t,i,n];let o=t*i*n,s=Math.ceil(Math.sqrt(o));if(s>r){if(s=Math.ceil(Math.cbrt(o)),s>r)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[s,s,s]}else return[s,s,1]}}}),dN,fN,hN,pN,BF,uX=ue(()=>{"use strict";gr(),Fe(),yo(),JN(),vJ(),aX(),lX(),dN=(e,t)=>{if(t.length!==e.length)throw new Error(`inputDependencies length ${t.length} is not equal to inputTensors length ${e.length}.`);let i=[];for(let n=0;n<e.length;++n){let r=e[n].dataType;switch(t[n]){case"none":{i.push("");break}case"type":{i.push(`${r}`);break}case"rank":{let o=e[n].dims.length;i.push(`${r};${o}`);break}case"dims":{let o=e[n].dims.join(",");i.push(`${r};${o}`);break}default:throw new Error(`unsupported input dependency: ${t[n]}`)}}return i.join("|")},fN=(e,t,i)=>{let n=e.name;return e.shaderCache?.hint&&(n+="["+e.shaderCache.hint+"]"),n+=":"+i+`:${dN(t,e.shaderCache?.inputDependencies??new Array(t.length).fill("dims"))}`,n},hN=class{constructor(e){e&&(this.architecture=e.architecture,this.vendor=e.vendor)}isArchitecture(e){return this.architecture===e}isVendor(e){return this.vendor===e}},pN=class{constructor(e){this.subgroupsSupported=e.features.has("subgroups"),this.subgroupsF16Supported=e.features.has("subgroups");let t=e.limits;!this.subgroupsSupported||!t.minSubgroupSize||!t.maxSubgroupSize?this.subgroupSizeRange=void 0:this.subgroupSizeRange=[t.minSubgroupSize,t.maxSubgroupSize]}},BF=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let e=this.kernelCustomData.get(this.currentKernelId);return e||(e={},this.kernelCustomData.set(this.currentKernelId,e)),e}initialize(e,t){return J(this,null,function*(){this.env=e;let i=[],n={requiredLimits:{maxComputeWorkgroupStorageSize:t.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:t.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:t.limits.maxStorageBufferBindingSize,maxBufferSize:t.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:t.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:t.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:t.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:t.limits.maxComputeWorkgroupSizeZ},requiredFeatures:i},r=o=>t.features.has(o)&&i.push(o)&&!0;r("chromium-experimental-timestamp-query-inside-passes")||r("timestamp-query"),r("shader-f16"),r("subgroups")&&r("subgroups-f16"),this.device=yield t.requestDevice(n),this.deviceInfo=new pN(this.device),this.adapterInfo=new hN(t.info||(yield t.requestAdapterInfo())),this.gpuDataManager=XN(this),this.programManager=new LF(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,lC(e.logLevel,!!e.debug),this.device.onuncapturederror=o=>{o.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${o.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:t,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()})}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let e=this.getCommandEncoder(),t={};this.queryType==="at-passes"&&(t.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=e.beginComputePass(t)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;Lr(),this.endComputePass();let e;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),e=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(e,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&e.mapAsync(GPUMapMode.READ).then(()=>{let t=new BigUint64Array(e.getMappedRange()),i=this.pendingQueries.get(e);for(let n=0;n<t.length/2;n++){let r=i[n],o=r.kernelId,s=this.kernels.get(o),a=s.kernelType,u=s.kernelName,c=r.programName,f=r.inputTensorViews,p=r.outputTensorViews,m=t[n*2],v=t[n*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=m);let b=Number(m-this.queryTimeBase),w=Number(v-this.queryTimeBase);if(!Number.isSafeInteger(b)||!Number.isSafeInteger(w))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:f.map(C=>({dims:C.dims,dataType:pa(C.dataType)})),outputsMetadata:p.map(C=>({dims:C.dims,dataType:pa(C.dataType)})),kernelId:o,kernelType:a,kernelName:u,programName:c,startTime:b,endTime:w});else{let C="";f.forEach((y,I)=>{C+=`input[${I}]: [${y.dims}] | ${pa(y.dataType)}, `});let x="";p.forEach((y,I)=>{x+=`output[${I}]: [${y.dims}] | ${pa(y.dataType)}, `}),console.log(`[profiling] kernel "${o}|${a}|${u}|${c}" ${C}${x}execution time: ${w-b} ns`)}Dg("GPU",`${c}::${m}::${v}`)}e.unmap(),this.pendingQueries.delete(e)}),mr()}run(e,t,i,n,r,o){Lr(e.name);let s=[];for(let y=0;y<t.length;++y){let I=t[y].data;if(I===0)continue;let S=this.gpuDataManager.get(I);if(!S)throw new Error(`no GPU data for input: ${I}`);s.push(S)}let{outputs:a,dispatchGroup:u,programUniforms:c}=e.getRunData(t),f=i.length===0?a.map((y,I)=>I):i;if(f.length!==a.length)throw new Error(`Output size ${f.length} must be equal to ${a.length}.`);let p=[],m=[];for(let y=0;y<a.length;++y){if(!Number.isInteger(f[y])||f[y]<-3||f[y]>=o)throw new Error(`Invalid output index: ${f[y]}`);if(f[y]===-3)continue;let I=f[y]===-1,S=f[y]===-2,T=I||S?r(a[y].dataType,a[y].dims):n(f[y],a[y].dataType,a[y].dims);if(p.push(T),T.data===0)continue;let $=this.gpuDataManager.get(T.data);if(!$)throw new Error(`no GPU data for output: ${T.data}`);if(I&&this.temporaryData.push($),S){let k=this.kernelPersistentData.get(this.currentKernelId);k||(k=[],this.kernelPersistentData.set(this.currentKernelId,k)),k.push($)}m.push($)}if(s.length!==t.length||m.length!==p.length){if(m.length===0)return mr(e.name),p;throw new Error(`Program ${e.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let v;if(c){let y=0,I=[];c.forEach(k=>{let P=typeof k.data=="number"?[k.data]:k.data;if(P.length===0)return;let j=k.type===10?2:4,H,re;k.type===10?(re=P.length>4?16:P.length>2?8:P.length*j,H=P.length>4?16:j*P.length):(re=P.length<=2?P.length*j:16,H=16),y=Math.ceil(y/re)*re,I.push(y);let ae=k.type===10?8:4;y+=P.length>4?Math.ceil(P.length/ae)*H:P.length*j});let S=16;y=Math.ceil(y/S)*S;let T=new ArrayBuffer(y);c.forEach((k,P)=>{let j=I[P],H=typeof k.data=="number"?[k.data]:k.data;if(k.type===6)new Int32Array(T,j,H.length).set(H);else if(k.type===12)new Uint32Array(T,j,H.length).set(H);else if(k.type===10)new Uint16Array(T,j,H.length).set(H);else if(k.type===1)new Float32Array(T,j,H.length).set(H);else throw new Error(`Unsupported uniform type: ${pa(k.type)}`)});let $=this.gpuDataManager.create(y,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer($.buffer,0,T,0,y),this.gpuDataManager.release($.id),v={offset:0,size:y,buffer:$.buffer}}let b=this.programManager.normalizeDispatchGroupSize(u),w=b[1]===1&&b[2]===1,C=fN(e,t,w),x=this.programManager.getArtifact(C);if(x||(x=this.programManager.build(e,b),this.programManager.setArtifact(C,x),pt("info",()=>`[artifact] key: ${C}, programName: ${e.name}`)),c&&x.uniformVariablesInfo){if(c.length!==x.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${x.uniformVariablesInfo.length}, got ${c.length} in program "${x.programInfo.name}".`);for(let y=0;y<c.length;y++){let I=c[y],S=I.type,T=typeof I.data=="number"?1:I.data.length,[$,k]=x.uniformVariablesInfo[y];if(S!==$||T!==k)throw new Error(`Uniform variable ${y} mismatch: expect type ${$} with size ${k}, got type ${S} with size ${T} in program "${x.programInfo.name}".`)}}if(pt("info",()=>`[ProgramManager] run "${e.name}" (key=${C}) with ${b[0]}x${b[1]}x${b[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let y={kernelId:this.currentKernelId,programName:x.programInfo.name,inputTensorViews:t,outputTensorViews:p};this.pendingKernels.push(y),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(y)}return this.programManager.run(x,s,m,b,v),mr(e.name),p}upload(e,t){this.gpuDataManager.upload(e,t)}memcpy(e,t){this.gpuDataManager.memcpy(e,t)}download(e,t){return J(this,null,function*(){yield this.gpuDataManager.download(e,t)})}alloc(e){return this.gpuDataManager.create(e).id}free(e){return this.gpuDataManager.release(e)}createKernel(e,t,i,n){let r=zF.get(e);if(!r)throw new Error(`kernel not implemented: ${e}`);let o={kernelType:e,kernelName:n,kernelEntry:r[0],attributes:[r[1],i]};this.kernels.set(t,o)}releaseKernel(e){let t=this.kernelPersistentData.get(e);if(t){for(let i of t)this.gpuDataManager.release(i.id);this.kernelPersistentData.delete(e)}this.kernelCustomData.delete(e),this.kernels.delete(e)}computeKernel(e,t,i){let n=this.kernels.get(e);if(!n)throw new Error(`kernel not created: ${e}`);let r=n.kernelType,o=n.kernelName,s=n.kernelEntry,a=n.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${r}] ${o}" is not allowed to be called recursively`);this.currentKernelId=e,a[0]&&(a[1]=a[0](a[1]),a[0]=void 0),pt("info",()=>`[WebGPU] Start to run kernel "[${r}] ${o}"...`);let u=this.env.debug;this.temporaryData=[];try{return u&&this.device.pushErrorScope("validation"),s(t,a[1]),0}catch(c){return i.push(Promise.resolve(`[WebGPU] Kernel "[${r}] ${o}" failed. ${c}`)),1}finally{u&&i.push(this.device.popErrorScope().then(c=>c?`GPU validation error for kernel "[${r}] ${o}": ${c.message}`:null));for(let c of this.temporaryData)this.gpuDataManager.release(c.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(e,t,i,n){let r=this.sessionExternalDataMapping.get(e);r||(r=new Map,this.sessionExternalDataMapping.set(e,r));let o=r.get(t),s=this.gpuDataManager.registerExternalBuffer(i,n,o);return r.set(t,[s,i]),s}unregisterBuffers(e){let t=this.sessionExternalDataMapping.get(e);t&&(t.forEach(i=>this.gpuDataManager.unregisterExternalBuffer(i[0])),this.sessionExternalDataMapping.delete(e))}getBuffer(e){let t=this.gpuDataManager.get(e);if(!t)throw new Error(`no GPU data for buffer: ${e}`);return t.buffer}createDownloader(e,t,i){return()=>J(this,null,function*(){let n=yield L1(this,e,t);return uC(n.buffer,i)})}writeTimestamp(e){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,e)}setQueryType(){this.queryType="none",(this.env.webgpu.profiling?.mode==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){pt("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){pt("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){pt("info","replay"),this.sessionStatus="replaying";let e=this.capturedCommandList.get(this.currentSessionId),t=this.capturedPendingKernels.get(this.currentSessionId),i=e.length;this.pendingKernels=[];for(let n=0;n<i;n++){let r=this.getComputePassEncoder(),o=e[n];this.writeTimestamp(this.pendingDispatchNumber*2),r.setPipeline(o.computePipeline),r.setBindGroup(0,o.bindGroup),r.dispatchWorkgroups(...o.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(t[n]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(e){this.unregisterBuffers(e),this.capturedCommandList.has(e)&&this.capturedCommandList.delete(e),this.capturedPendingKernels.has(e)&&this.capturedPendingKernels.delete(e),this.gpuDataManager.onReleaseSession(e)}onRunStart(e){this.currentSessionId=e,this.setQueryType()}}}),mN,M1,gN,A1,R1,O1,_N,jF,cX=ue(()=>{"use strict";yo(),mN=1,M1=()=>mN++,gN=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),A1=(e,t)=>{let i=gN.get(e);if(!i)throw new Error("Unsupported data type.");return t.length>0?Math.ceil(t.reduce((n,r)=>n*r)*i/8):0},R1=class{constructor(e){this.sessionId=e.sessionId,this.mlContext=e.context,this.mlTensor=e.tensor,this.dataType=e.dataType,this.tensorShape=e.shape}get tensor(){return this.mlTensor}get type(){return this.dataType}get shape(){return this.tensorShape}get byteLength(){return A1(this.dataType,this.tensorShape)}destroy(){pt("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}read(e){return J(this,null,function*(){return e?this.mlContext.readTensor(this.mlTensor,e):this.mlContext.readTensor(this.mlTensor)})}canReuseTensor(e,t,i){return this.mlContext===e&&this.dataType===t&&this.tensorShape.length===i.length&&this.tensorShape.every((n,r)=>n===i[r])}},O1=class{constructor(e,t){this.tensorManager=e,this.wrapper=t}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}ensureTensor(e,t,i,n){return J(this,null,function*(){let r=this.tensorManager.getMLContext(e);if(this.wrapper){if(this.wrapper.canReuseTensor(r,t,i))return this.wrapper.tensor;if(n){if(this.wrapper.byteLength!==A1(t,i))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(yield this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let o=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=yield this.tensorManager.getCachedTensor(e,t,i,o,!0,!0),n&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor})}upload(e){if(this.wrapper)if(e.byteLength===this.wrapper.byteLength){this.wrapper.write(e);return}else pt("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor();this.activeUpload?this.activeUpload.set(e):this.activeUpload=new Uint8Array(e)}download(e){return J(this,null,function*(){if(this.activeUpload)if(e){e instanceof ArrayBuffer?new Uint8Array(e).set(this.activeUpload):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(this.activeUpload);return}else return this.activeUpload.buffer;if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read(e):this.wrapper.read()})}},_N=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let t=this.backend.getMLContext(e);if(!t)throw new Error("MLContext not found for session.");return t}reserveTensorId(){let e=M1();return this.tensorTrackersById.set(e,new O1(this)),e}releaseTensorId(e){let t=this.tensorTrackersById.get(e);t&&(this.tensorTrackersById.delete(e),t.tensorWrapper&&this.releaseTensor(t.tensorWrapper))}ensureTensor(e,t,i,n,r){return J(this,null,function*(){pt("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${t}, dataType: ${i}, shape: ${n}, copyOld: ${r}}`);let o=this.tensorTrackersById.get(t);if(!o)throw new Error("Tensor not found.");return o.ensureTensor(e,i,n,r)})}upload(e,t){let i=this.tensorTrackersById.get(e);if(!i)throw new Error("Tensor not found.");i.upload(t)}download(e,t){return J(this,null,function*(){pt("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${e}, dstBuffer: ${t?.byteLength}}`);let i=this.tensorTrackersById.get(e);if(!i)throw new Error("Tensor not found.");return i.download(t)})}releaseTensorsForSession(e){for(let t of this.freeTensors)t.sessionId===e&&t.destroy();this.freeTensors=this.freeTensors.filter(t=>t.sessionId!==e)}registerTensor(e,t,i,n){let r=this.getMLContext(e),o=M1(),s=new R1({sessionId:e,context:r,tensor:t,dataType:i,shape:n});return this.tensorTrackersById.set(o,new O1(this,s)),this.externalTensors.add(s),o}getCachedTensor(e,t,i,n,r,o){return J(this,null,function*(){let s=this.getMLContext(e);for(let[u,c]of this.freeTensors.entries())if(c.canReuseTensor(s,t,i)){pt("verbose",()=>`[WebNN] Reusing tensor {dataType: ${t}, shape: ${i}}`);let f=this.freeTensors.splice(u,1)[0];return f.sessionId=e,f}pt("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${t}, shape: ${i}}`);let a=yield s.createTensor({dataType:t,shape:i,dimensions:i,usage:n,writable:r,readable:o});return new R1({sessionId:e,context:s,tensor:a,dataType:t,shape:i})})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},jF=(...e)=>new _N(...e)}),yg,vN,VF,dX=ue(()=>{"use strict";Fe(),ba(),JN(),cX(),yo(),yg=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),vN=(e,t)=>{if(e===t)return!0;if(e===void 0||t===void 0)return!1;let i=Object.keys(e).sort(),n=Object.keys(t).sort();return i.length===n.length&&i.every((r,o)=>r===n[o]&&e[r]===t[r])},VF=class{constructor(e){this.tensorManager=jF(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.temporaryGraphInputs=[],this.temporarySessionTensorIds=new Map,lC(e.logLevel,!!e.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(e){pt("verbose",()=>`[WebNN] onRunStart {sessionId: ${e}}`),this.activeSessionId=e}onRunEnd(e){pt("verbose",()=>`[WebNN] onRunEnd {sessionId: ${e}}`);let t=this.temporarySessionTensorIds.get(e);if(t){for(let i of t)pt("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${i}}`),this.tensorManager.releaseTensorId(i);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}createMLContext(e){return J(this,null,function*(){if(e instanceof GPUDevice){let i=this.mlContextCache.findIndex(n=>n.gpuDevice===e);if(i!==-1)return this.mlContextCache[i].mlContext;{let n=yield navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:n}),n}}else if(e===void 0){let i=this.mlContextCache.findIndex(n=>n.options===void 0&&n.gpuDevice===void 0);if(i!==-1)return this.mlContextCache[i].mlContext;{let n=yield navigator.ml.createContext();return this.mlContextCache.push({mlContext:n}),n}}let t=this.mlContextCache.findIndex(i=>vN(i.options,e));if(t!==-1)return this.mlContextCache[t].mlContext;{let i=yield navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:i}),i}})}registerMLContext(e,t){this.mlContextBySessionId.set(e,t);let i=this.sessionIdsByMLContext.get(t);i||(i=new Set,this.sessionIdsByMLContext.set(t,i)),i.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e);let t=this.mlContextBySessionId.get(e);if(!t)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let i=this.sessionIdsByMLContext.get(t);if(i.delete(e),i.size===0){this.sessionIdsByMLContext.delete(t);let n=this.mlContextCache.findIndex(r=>r.mlContext===t);n!==-1&&this.mlContextCache.splice(n,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){pt("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e)}ensureTensor(e,t,i,n,r){return J(this,null,function*(){let o=yg.get(i);if(!o)throw new Error(`Unsupported ONNX data type: ${i}`);return this.tensorManager.ensureTensor(e??this.currentSessionId,t,o,n,r)})}createTemporaryTensor(e,t,i){return J(this,null,function*(){pt("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${t}, shape: ${i}}`);let n=yg.get(t);if(!n)throw new Error(`Unsupported ONNX data type: ${t}`);let r=this.tensorManager.reserveTensorId();yield this.tensorManager.ensureTensor(e,r,n,i,!1);let o=this.temporarySessionTensorIds.get(e);return o?o.push(r):this.temporarySessionTensorIds.set(e,[r]),r})}uploadTensor(e,t){if(!En().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");pt("verbose",()=>`[WebNN] uploadTensor {tensorId: ${e}, data: ${t.byteLength}}`),this.tensorManager.upload(e,t)}downloadTensor(e,t){return J(this,null,function*(){return this.tensorManager.download(e,t)})}createMLTensorDownloader(e,t){return()=>J(this,null,function*(){let i=yield this.tensorManager.download(e);return uC(i,t)})}registerMLTensor(e,t,i,n){let r=yg.get(i);if(!r)throw new Error(`Unsupported ONNX data type: ${i}`);let o=this.tensorManager.registerTensor(e,t,r,n);return pt("verbose",()=>`[WebNN] registerMLTensor {tensor: ${t}, dataType: ${r}, dimensions: ${n}} -> {tensorId: ${o}}`),o}registerMLConstant(e,t,i,n,r,o){if(!o)throw new Error("External mounted files are not available.");let s=e;e.startsWith("./")&&(s=e.substring(2));let a=o.get(s);if(!a)throw new Error(`File with name ${s} not found in preloaded files.`);if(t+i>a.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let u=a.slice(t,t+i).buffer,c;switch(r.dataType){case"float32":c=new Float32Array(u);break;case"float16":c=new Uint16Array(u);break;case"int32":c=new Int32Array(u);break;case"uint32":c=new Uint32Array(u);break;case"int64":c=new BigInt64Array(u);break;case"uint64":c=new BigUint64Array(u);break;case"int8":c=new Int8Array(u);break;case"int4":case"uint4":case"uint8":c=new Uint8Array(u);break;default:throw new Error(`Unsupported data type: ${r.dataType} in creating WebNN Constant from external data.`)}return pt("verbose",()=>`[WebNN] registerMLConstant {dataType: ${r.dataType}, shape: ${r.shape}}}`),n.constant(r,c)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}isGraphInput(e,t){let i=this.sessionGraphInputs.get(e);return i?i.includes(t):!1}flush(){}}}),UF={};kf(UF,{init:()=>HF});var wg,bN,HF,fX=ue(()=>{"use strict";Fe(),uX(),yo(),Ue(),dX(),wg=class WF{constructor(t,i,n,r){this.module=t,this.dataType=i,this.data=n,this.dims=r}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let t=Z.size(this.dims);return t===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,t)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let t=Z.size(this.dims);return t===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,t)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let t=Z.size(this.dims);return t===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,t)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let t=Z.size(this.dims);return t===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,t)}reshape(t){if(Z.size(t)!==Z.size(this.dims))throw new Error("Invalid new shape");return new WF(this.module,this.dataType,this.data,t)}},bN=class{constructor(e,t,i){this.module=e,this.backend=t,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=t.adapterInfo,this.deviceInfo=t.deviceInfo;let n=e.PTR_SIZE,r=i/e.PTR_SIZE,o=n===4?"i32":"i64";this.opKernelContext=Number(e.getValue(n*r++,o));let s=Number(e.getValue(n*r++,o));this.outputCount=Number(e.getValue(n*r++,o)),this.customDataOffset=Number(e.getValue(n*r++,"*")),this.customDataSize=Number(e.getValue(n*r++,o));let a=[];for(let u=0;u<s;u++){let c=Number(e.getValue(n*r++,o)),f=Number(e.getValue(n*r++,"*")),p=Number(e.getValue(n*r++,o)),m=[];for(let v=0;v<p;v++)m.push(Number(e.getValue(n*r++,o)));a.push(new wg(e,c,f,m))}this.inputs=a}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(e,t){let i=t?.inputs?.map(s=>typeof s=="number"?this.inputs[s]:s)??this.inputs,n=t?.outputs??[],r=(s,a,u)=>new wg(this.module,a,this.output(s,u),u),o=(s,a)=>{let u=ma(s,a);if(!u)throw new Error(`Unsupported data type: ${s}`);let c=u>0?this.backend.gpuDataManager.create(u).id:0;return new wg(this.module,s,c,a)};return this.backend.run(e,i,n,r,o,this.outputCount)}output(e,t){let i=this.module.stackSave();try{let n=this.module.PTR_SIZE,r=n===4?"i32":"i64",o=this.module.stackAlloc((1+t.length)*n);this.module.setValue(o,t.length,r);for(let s=0;s<t.length;s++)this.module.setValue(o+n*(s+1),t[s],r);return this.module._JsepOutput(this.opKernelContext,e,o)}catch(n){throw new Error(`Failed to generate kernel's output[${e}] with dims [${t}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${n}`)}finally{this.module.stackRestore(i)}}},HF=(e,t,i,n)=>J(void 0,null,function*(){let r=t.jsepInit;if(!r)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(e==="webgpu"){let o=new BF;yield o.initialize(i,n),r("webgpu",[o,s=>o.alloc(Number(s)),s=>o.free(s),(s,a,u,c=!1)=>{if(c)pt("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(s)}, dst=${Number(a)}, size=${Number(u)}`),o.memcpy(Number(s),Number(a));else{pt("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(s)}, gpuDataId=${Number(a)}, size=${Number(u)}`);let f=t.HEAPU8.subarray(Number(s>>>0),Number(s>>>0)+Number(u));o.upload(Number(a),f)}},(s,a,u)=>J(void 0,null,function*(){pt("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${s}, dataOffset=${a}, size=${u}`),yield o.download(Number(s),()=>t.HEAPU8.subarray(Number(a)>>>0,Number(a+u)>>>0))}),(s,a,u)=>o.createKernel(s,Number(a),u,t.UTF8ToString(t._JsepGetNodeName(Number(a)))),s=>o.releaseKernel(s),(s,a,u,c)=>{pt("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${u}, kernel=${s}, contextDataOffset=${a}`);let f=new bN(t,o,Number(a));return o.computeKernel(Number(s),f,c)},()=>o.captureBegin(),()=>o.captureEnd(),()=>o.replay()])}else{let o=new VF(i);r("webnn",[o,()=>o.reserveTensorId(),s=>o.releaseTensorId(s),(s,a,u,c,f)=>J(void 0,null,function*(){return o.ensureTensor(s,a,u,c,f)}),(s,a)=>{o.uploadTensor(s,a)},(s,a)=>J(void 0,null,function*(){return o.downloadTensor(s,a)})])}})}),yN,yC,wC,es,wN,Rg,xC,CC,N1,EC,IC,SC,qF=ue(()=>{"use strict";gJ(),_J(),Fe(),ba(),iC(),YN(),yN=(e,t)=>{En()._OrtInit(e,t)!==0&&It("Can't initialize onnxruntime.")},yC=e=>J(void 0,null,function*(){yN(e.wasm.numThreads,$g(e.logLevel))}),wC=(e,t)=>J(void 0,null,function*(){{let i=(fX(),Sg(UF)).init;if(t==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let n=e.webgpu.adapter;if(n){if(typeof n.limits!="object"||typeof n.features!="object"||typeof n.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let r=e.webgpu.powerPreference;if(r!==void 0&&r!=="low-power"&&r!=="high-performance")throw new Error(`Invalid powerPreference setting: "${r}"`);let o=e.webgpu.forceFallbackAdapter;if(o!==void 0&&typeof o!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${o}"`);if(n=yield navigator.gpu.requestAdapter({powerPreference:r,forceFallbackAdapter:o}),!n)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}yield i("webgpu",En(),e,n)}if(t==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");yield i("webnn",En(),e)}}}),es=new Map,wN=e=>{let t=En(),i=t.stackSave();try{let n=t.PTR_SIZE,r=t.stackAlloc(2*n);t._OrtGetInputOutputCount(e,r,r+n)!==0&&It("Can't get session input/output count.");let o=n===4?"i32":"i64";return[Number(t.getValue(r,o)),Number(t.getValue(r+n,o))]}finally{t.stackRestore(i)}},Rg=e=>{let t=En(),i=t._malloc(e.byteLength);if(i===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,i),[i,e.byteLength]},xC=(e,t)=>J(void 0,null,function*(){let i,n,r=En();Array.isArray(e)?[i,n]=e:e.buffer===r.HEAPU8.buffer?[i,n]=[e.byteOffset,e.byteLength]:[i,n]=Rg(e);let o=0,s=0,a=0,u=[],c=[],f=[];try{if([s,u]=QN(t),t?.externalData&&r.mountExternalData){let y=[];for(let I of t.externalData){let S=typeof I=="string"?I:I.path;y.push(aC(typeof I=="string"?I:I.data).then(T=>{r.mountExternalData(S,T)}))}yield Promise.all(y)}for(let y of t?.executionProviders??[])if((typeof y=="string"?y:y.name)==="webnn"){if(r.shouldTransferToMLTensor=!1,typeof y!="string"){let I=y,S=I?.context,T=I?.gpuDevice,$=I?.deviceType,k=I?.powerPreference;S?r.currentContext=S:T?r.currentContext=yield r.jsepCreateMLContext(T):r.currentContext=yield r.jsepCreateMLContext({deviceType:$,powerPreference:k})}else r.currentContext=yield r.jsepCreateMLContext();break}o=yield r._OrtCreateSession(i,n,s),o===0&&It("Can't create a session."),r.jsepOnCreateSession?.(),r.currentContext&&(r.jsepRegisterMLContext(o,r.currentContext),r.currentContext=void 0,r.shouldTransferToMLTensor=!0);let[p,m]=wN(o),v=!!t?.enableGraphCapture,b=[],w=[],C=[];for(let y=0;y<p;y++){let I=r._OrtGetInputName(o,y);I===0&&It("Can't get an input name."),c.push(I),b.push(r.UTF8ToString(I))}for(let y=0;y<m;y++){let I=r._OrtGetOutputName(o,y);I===0&&It("Can't get an output name."),f.push(I);let S=r.UTF8ToString(I);w.push(S);{if(v&&t?.preferredOutputLocation===void 0){C.push("gpu-buffer");continue}let T=typeof t?.preferredOutputLocation=="string"?t.preferredOutputLocation:t?.preferredOutputLocation?.[S]??"cpu";if(T!=="cpu"&&T!=="cpu-pinned"&&T!=="gpu-buffer"&&T!=="ml-tensor")throw new Error(`Not supported preferred output location: ${T}.`);if(v&&T!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${T}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);C.push(T)}}let x=null;return C.some(y=>y==="gpu-buffer"||y==="ml-tensor")&&(a=r._OrtCreateBinding(o),a===0&&It("Can't create IO binding."),x={handle:a,outputPreferredLocations:C,outputPreferredLocationsEncoded:C.map(y=>z1(y))}),es.set(o,[o,c,f,x,v,!1]),[o,b,w]}catch(p){throw c.forEach(m=>r._OrtFree(m)),f.forEach(m=>r._OrtFree(m)),a!==0&&r._OrtReleaseBinding(a)!==0&&It("Can't release IO binding."),o!==0&&r._OrtReleaseSession(o)!==0&&It("Can't release session."),p}finally{r._free(i),s!==0&&r._OrtReleaseSessionOptions(s)!==0&&It("Can't release session options."),u.forEach(p=>r._free(p)),r.unmountExternalData?.()}}),CC=e=>{let t=En(),i=es.get(e);if(!i)throw new Error(`cannot release session. invalid session id: ${e}`);let[n,r,o,s,a]=i;s&&(a&&t._OrtClearBoundOutputs(s.handle)!==0&&It("Can't clear bound outputs."),t._OrtReleaseBinding(s.handle)!==0&&It("Can't release IO binding.")),t.jsepOnReleaseSession?.(e),r.forEach(u=>t._OrtFree(u)),o.forEach(u=>t._OrtFree(u)),t._OrtReleaseSession(n)!==0&&It("Can't release session."),es.delete(e)},N1=(e,t,i,n,r,o=!1)=>J(void 0,null,function*(){if(!e){t.push(0);return}let s=En(),a=s.PTR_SIZE,u=e[0],c=e[1],f=e[3],p=f,m,v;if(u==="string"&&(f==="gpu-buffer"||f==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(o&&f!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${r} when enableGraphCapture is true.`);if(f==="gpu-buffer"){let C=e[2].gpuBuffer;v=ma(zl(u),c);let x=s.jsepRegisterBuffer;if(!x)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');m=x(n,r,C,v)}else if(f==="ml-tensor"){let C=e[2].mlTensor;v=ma(zl(u),c);let x=s.jsepRegisterMLTensor;if(!x)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');m=x(n,C,zl(u),c)}else{let C=e[2];if(Array.isArray(C)){v=a*C.length,m=s._malloc(v),i.push(m);for(let x=0;x<C.length;x++){if(typeof C[x]!="string")throw new TypeError(`tensor data at index ${x} is not a string`);s.setValue(m+x*a,jn(C[x],i),"*")}}else{let x=s.jsepIsGraphInput;if(u!=="string"&&x){let y=s._OrtGetInputName(n,r),I=s.UTF8ToString(y);if(x(n,I)){let S=zl(u);v=ma(S,c),p="ml-tensor";let T=s.jsepCreateTemporaryTensor,$=s.jsepUploadTensor;if(!T||!$)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let k=yield T(n,S,c);$(k,new Uint8Array(C.buffer,C.byteOffset,C.byteLength)),m=k}else v=C.byteLength,m=s._malloc(v),i.push(m),s.HEAPU8.set(new Uint8Array(C.buffer,C.byteOffset,v),m)}else v=C.byteLength,m=s._malloc(v),i.push(m),s.HEAPU8.set(new Uint8Array(C.buffer,C.byteOffset,v),m)}}let b=s.stackSave(),w=s.stackAlloc(4*c.length);try{c.forEach((x,y)=>s.setValue(w+y*a,x,a===4?"i32":"i64"));let C=s._OrtCreateTensor(zl(u),m,v,w,c.length,z1(p));C===0&&It(`Can't create tensor for input/output. session=${n}, index=${r}.`),t.push(C)}finally{s.stackRestore(b)}}),EC=(e,t,i,n,r,o)=>J(void 0,null,function*(){let s=En(),a=s.PTR_SIZE,u=es.get(e);if(!u)throw new Error(`cannot run inference. invalid session id: ${e}`);let c=u[0],f=u[1],p=u[2],m=u[3],v=u[4],b=u[5],w=t.length,C=n.length,x=0,y=[],I=[],S=[],T=[],$=s.stackSave(),k=s.stackAlloc(w*a),P=s.stackAlloc(w*a),j=s.stackAlloc(C*a),H=s.stackAlloc(C*a);try{[x,y]=ZN(o);for(let L=0;L<w;L++)yield N1(i[L],I,T,e,t[L],v);for(let L=0;L<C;L++)yield N1(r[L],S,T,e,w+n[L],v);for(let L=0;L<w;L++)s.setValue(k+L*a,I[L],"*"),s.setValue(P+L*a,f[t[L]],"*");for(let L=0;L<C;L++)s.setValue(j+L*a,S[L],"*"),s.setValue(H+L*a,p[n[L]],"*");if(m&&!b){let{handle:L,outputPreferredLocations:ge,outputPreferredLocationsEncoded:ye}=m;if(f.length!==w)throw new Error(`input count from feeds (${w}) is expected to be always equal to model's input count (${f.length}).`);for(let Y=0;Y<w;Y++){let ve=t[Y];(yield s._OrtBindInput(L,f[ve],I[Y]))!==0&&It(`Can't bind input[${Y}] for session=${e}.`)}for(let Y=0;Y<C;Y++){let ve=n[Y];r[Y]?.[3]?s._OrtBindOutput(L,p[ve],S[Y],0)!==0&&It(`Can't bind pre-allocated output[${Y}] for session=${e}.`):s._OrtBindOutput(L,p[ve],0,ye[ve])!==0&&It(`Can't bind output[${Y}] to ${ge[Y]} for session=${e}.`)}es.set(e,[c,f,p,m,v,!0])}s.jsepOnRunStart?.(c);let re;m?re=yield s._OrtRunWithBinding(c,m.handle,C,j,x):re=yield s._OrtRun(c,P,k,w,H,C,j,x),re!==0&&It("failed to call OrtRun().");let ae=[];for(let L=0;L<C;L++){let ge=Number(s.getValue(j+L*a,"*"));if(ge===S[L]){ae.push(r[L]);continue}let ye=s.stackSave(),Y=s.stackAlloc(4*a),ve=!1,we,X=0;try{s._OrtGetTensorData(ge,Y,Y+a,Y+2*a,Y+3*a)!==0&&It(`Can't access output tensor data on index ${L}.`);let xe=a===4?"i32":"i64",z=Number(s.getValue(Y,xe));X=s.getValue(Y+a,"*");let W=s.getValue(Y+a*2,"*"),R=Number(s.getValue(Y+a*3,xe)),se=[];for(let gt=0;gt<R;gt++)se.push(Number(s.getValue(W+gt*a,xe)));s._OrtFree(W)!==0&&It("Can't free memory for tensor dims.");let Ke=se.reduce((gt,Xe)=>gt*Xe,1);we=pa(z);let zt=m?.outputPreferredLocations[n[L]];if(we==="string"){if(zt==="gpu-buffer"||zt==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let gt=[];for(let Xe=0;Xe<Ke;Xe++){let vn=s.getValue(X+Xe*a,"*"),Ot=s.getValue(X+(Xe+1)*a,"*"),Vr=Xe===Ke-1?void 0:Ot-vn;gt.push(s.UTF8ToString(vn,Vr))}ae.push([we,se,gt,"cpu"])}else if(zt==="gpu-buffer"&&Ke>0){let gt=s.jsepGetBuffer;if(!gt)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let Xe=gt(X),vn=ma(z,Ke);if(vn===void 0||!oC(we))throw new Error(`Unsupported data type: ${we}`);ve=!0,ae.push([we,se,{gpuBuffer:Xe,download:s.jsepCreateDownloader(Xe,vn,we),dispose:()=>{s._OrtReleaseTensor(ge)!==0&&It("Can't release tensor.")}},"gpu-buffer"])}else if(zt==="ml-tensor"&&Ke>0){let gt=s.jsepEnsureTensor;if(!gt)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(ma(z,Ke)===void 0||!sC(we))throw new Error(`Unsupported data type: ${we}`);let Xe=yield gt(e,X,z,se,!1);ve=!0,ae.push([we,se,{mlTensor:Xe,download:s.jsepCreateMLTensorDownloader(X,we),dispose:()=>{s.jsepReleaseTensorId(X),s._OrtReleaseTensor(ge)}},"ml-tensor"])}else{let gt=rC(we),Xe=new gt(Ke);new Uint8Array(Xe.buffer,Xe.byteOffset,Xe.byteLength).set(s.HEAPU8.subarray(X,X+Xe.byteLength)),ae.push([we,se,Xe,"cpu"])}}finally{s.stackRestore(ye),we==="string"&&X&&s._free(X),ve||s._OrtReleaseTensor(ge),s.jsepOnRunEnd?.(c)}}return m&&!v&&(s._OrtClearBoundOutputs(m.handle)!==0&&It("Can't clear bound outputs."),es.set(e,[c,f,p,m,v,!1])),ae}finally{s.stackRestore($),I.forEach(re=>s._OrtReleaseTensor(re)),S.forEach(re=>s._OrtReleaseTensor(re)),T.forEach(re=>s._free(re)),x!==0&&s._OrtReleaseRunOptions(x),y.forEach(re=>s._free(re))}}),IC=e=>{let t=En(),i=es.get(e);if(!i)throw new Error("invalid session id");let n=i[0],r=t._OrtEndProfiling(n);r===0&&It("Can't get an profile file name."),t._OrtFree(r)},SC=e=>{let t=[];for(let i of e){let n=i[2];!Array.isArray(n)&&"buffer"in n&&t.push(n.buffer)}return t}}),ts,ji,Fl,xf,Cf,xg,P1,Cg,da,fa,xN,GF,KF,ZF,QF,YF,JF,XF,ez=ue(()=>{"use strict";gr(),qF(),ba(),tC(),ts=()=>!!Yt.wasm.proxy&&typeof document<"u",Fl=!1,xf=!1,Cf=!1,Cg=new Map,da=(e,t)=>{let i=Cg.get(e);i?i.push(t):Cg.set(e,[t])},fa=()=>{if(Fl||!xf||Cf||!ji)throw new Error("worker not ready")},xN=e=>{switch(e.data.type){case"init-wasm":Fl=!1,e.data.err?(Cf=!0,P1[1](e.data.err)):(xf=!0,P1[0]()),xg&&(URL.revokeObjectURL(xg),xg=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=Cg.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out);break}default:}},GF=()=>J(void 0,null,function*(){if(!xf){if(Fl)throw new Error("multiple calls to 'initWasm()' detected.");if(Cf)throw new Error("previous call to 'initWasm()' failed.");if(Fl=!0,ts())return new Promise((e,t)=>{ji?.terminate(),GN().then(([i,n])=>{try{ji=n,ji.onerror=o=>t(o),ji.onmessage=xN,P1=[e,t];let r={type:"init-wasm",in:Yt};!r.in.wasm.wasmPaths&&(i||import.meta.url?.startsWith("file:"))&&(r.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.jsep.wasm",import.meta.url).href}),ji.postMessage(r),xg=i}catch(r){t(r)}},t)});try{yield nC(Yt.wasm),yield yC(Yt),xf=!0}catch(e){throw Cf=!0,e}finally{Fl=!1}}}),KF=e=>J(void 0,null,function*(){if(ts())return fa(),new Promise((t,i)=>{da("init-ep",[t,i]);let n={type:"init-ep",in:{epName:e,env:Yt}};ji.postMessage(n)});yield wC(Yt,e)}),ZF=e=>J(void 0,null,function*(){return ts()?(fa(),new Promise((t,i)=>{da("copy-from",[t,i]);let n={type:"copy-from",in:{buffer:e}};ji.postMessage(n,[e.buffer])})):Rg(e)}),QF=(e,t)=>J(void 0,null,function*(){if(ts()){if(t?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return fa(),new Promise((i,n)=>{da("create",[i,n]);let r={type:"create",in:{model:e,options:ie({},t)}},o=[];e instanceof Uint8Array&&o.push(e.buffer),ji.postMessage(r,o)})}else return xC(e,t)}),YF=e=>J(void 0,null,function*(){if(ts())return fa(),new Promise((t,i)=>{da("release",[t,i]);let n={type:"release",in:e};ji.postMessage(n)});CC(e)}),JF=(e,t,i,n,r,o)=>J(void 0,null,function*(){if(ts()){if(i.some(s=>s[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(r.some(s=>s))throw new Error("pre-allocated output tensor is not supported for proxy.");return fa(),new Promise((s,a)=>{da("run",[s,a]);let u=i,c={type:"run",in:{sessionId:e,inputIndices:t,inputs:u,outputIndices:n,options:o}};ji.postMessage(c,SC(u))})}else return EC(e,t,i,n,r,o)}),XF=e=>J(void 0,null,function*(){if(ts())return fa(),new Promise((t,i)=>{da("end-profiling",[t,i]);let n={type:"end-profiling",in:e};ji.postMessage(n)});IC(e)})}),F1,CN,tz,hX=ue(()=>{"use strict";gr(),ez(),Fe(),eC(),YN(),F1=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${t()}`)}},CN=e=>{switch(e[3]){case"cpu":return new Ui(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!oC(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:i,download:n,dispose:r}=e[2];return Ui.fromGpuBuffer(i,{dataType:t,dims:e[1],download:n,dispose:r})}case"ml-tensor":{let t=e[0];if(!sC(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:i,download:n,dispose:r}=e[2];return Ui.fromMLTensor(i,{dataType:t,dims:e[1],download:n,dispose:r})}default:throw new Error(`invalid data location: ${e[3]}`)}},tz=class{fetchModelAndCopyToWasmMemory(e){return J(this,null,function*(){return ZF(yield aC(e))})}loadModel(e,t){return J(this,null,function*(){Lr();let i;typeof e=="string"?i=yield this.fetchModelAndCopyToWasmMemory(e):i=e,[this.sessionId,this.inputNames,this.outputNames]=yield QF(i,t),mr()})}dispose(){return J(this,null,function*(){return YF(this.sessionId)})}run(e,t,i){return J(this,null,function*(){Lr();let n=[],r=[];Object.entries(e).forEach(p=>{let m=p[0],v=p[1],b=this.inputNames.indexOf(m);if(b===-1)throw new Error(`invalid input '${m}'`);n.push(v),r.push(b)});let o=[],s=[];Object.entries(t).forEach(p=>{let m=p[0],v=p[1],b=this.outputNames.indexOf(m);if(b===-1)throw new Error(`invalid output '${m}'`);o.push(v),s.push(b)});let a=n.map((p,m)=>F1(p,()=>`input "${this.inputNames[r[m]]}"`)),u=o.map((p,m)=>p?F1(p,()=>`output "${this.outputNames[s[m]]}"`):null),c=yield JF(this.sessionId,r,a,s,u,i),f={};for(let p=0;p<c.length;p++)f[this.outputNames[s[p]]]=o[p]??CN(c[p]);return mr(),f})}startProfiling(){}endProfiling(){XF(this.sessionId)}}}),nz={};kf(nz,{OnnxruntimeWebAssemblyBackend:()=>Y1,initializeFlags:()=>Q1,wasmBackend:()=>iz});var Q1,Y1,iz,pX=ue(()=>{"use strict";gr(),ez(),hX(),Q1=()=>{if((typeof Yt.wasm.initTimeout!="number"||Yt.wasm.initTimeout<0)&&(Yt.wasm.initTimeout=0),Yt.wasm.simd===!1&&console.warn('Deprecated property "env.wasm.simd" is set to false. non-SIMD build is no longer provided, and this setting will be ignored.'),typeof Yt.wasm.proxy!="boolean"&&(Yt.wasm.proxy=!1),typeof Yt.wasm.trace!="boolean"&&(Yt.wasm.trace=!1),typeof Yt.wasm.numThreads!="number"||!Number.isInteger(Yt.wasm.numThreads)||Yt.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)Yt.wasm.numThreads=1;else{let e=typeof navigator>"u"?JY("node:os").cpus().length:navigator.hardwareConcurrency;Yt.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},Y1=class{init(e){return J(this,null,function*(){Q1(),yield GF(),yield KF(e)})}createInferenceSessionHandler(e,t){return J(this,null,function*(){let i=new tz;return yield i.loadModel(e,t),Promise.resolve(i)})}},iz=new Y1});gr();gr();gr();var mX="1.21.0";{let e=(pX(),Sg(nz)).wasmBackend;Ll("webgpu",e,5),Ll("webnn",e,5),Ll("cpu",e,10),Ll("wasm",e,10)}Object.defineProperty(Yt.versions,"web",{value:mX,enumerable:!0});var rz=(()=>{class e{router;global_service;mytext_app;path_img="";input_ml;constructor(i,n){this.router=i,this.global_service=n,this.mytext_app=n.text_app()}ngOnInit(){}ngOnDestroy(){}clickImg0(){this.path_img="/camerafeet1/assets/images/0.png",this.prepareToML()}clickImg1(){this.path_img="/camerafeet1/assets/images/1.png",this.prepareToML()}clickImg2(){this.path_img="/camerafeet1/assets/images/2.png",this.prepareToML()}clickImg3(){this.path_img="/camerafeet1/assets/images/3.png",this.prepareToML()}clickImg4(){this.path_img="/camerafeet1/assets/images/4.png",this.prepareToML()}clickImg5(){this.path_img="/camerafeet1/assets/images/5.png",this.prepareToML()}clickImg6(){this.path_img="/camerafeet1/assets/images/6.png",this.prepareToML()}clickImg7(){this.path_img="/camerafeet1/assets/images/7.png",this.prepareToML()}clickImg8(){this.path_img="/camerafeet1/assets/images/8.png",this.prepareToML()}clickImg9(){this.path_img="/camerafeet1/assets/images/9.png",this.prepareToML()}convertBlobToBase64(i){return J(this,null,function*(){return new Promise((n,r)=>{let o=new FileReader;o.onerror=r,o.onload=()=>{n(o.result)},o.readAsDataURL(i)})})}downloadImageAsBase64(){return J(this,null,function*(){let n=yield(yield fetch(this.path_img)).blob();return this.convertBlobToBase64(n)})}prepareToML(){this.downloadImageAsBase64().then(i=>{let n=i;this.convertImgToNumberArray(n).then(r=>{console.log(r);let o=r.length,s=new Float32Array(o);for(let u=0;u<o;u++)s[u]=r[u]/1;console.log(s);let a=new Ui("float32",s,[1,28,28]);this.input_ml={flatten_input:a},alert("TENSOR de entrada preparado para el MODELO")})})}convertImgToNumberArray(i){let n=new Image;n.src=i;let r=document.createElement("canvas"),o=r.getContext("2d");if(!o)throw new Error("Could not get context");return new Promise(s=>{n.onload=function(){r.width=28,r.height=28,o.drawImage(n,0,0,28,28);let a=o.getImageData(0,0,28,28),u=[];for(let c=0;c<a.data.length;c+=4){let f=(a.data[c]+a.data[c+1]+a.data[c+2])/3;u.push(f)}s(u)}})}actionRun(){this.asyncRun()}asyncRun(){return J(this,null,function*(){console.log("asyncRun");let n=yield this.global_service.get_ml_model().arrayBuffer();console.log(n);let s=(yield(yield Og.create(n)).run(this.input_ml,["dense_1"])).dense_1.data;console.log(".............."),console.log(s),console.log("..............");let a=new Number(s.indexOf(Math.max(...s)));var u=new String("El d\xEDgito deducido es = "),c=u.concat(a.toString());alert(c)})}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt))};static \u0275cmp=Oe({type:e,selectors:[["app-screen99ml"]],decls:87,vars:1,consts:[[1,"custom-toolbar"],[1,"example-fill-remaining-space"],[1,"span-custom"],[1,"custom-div-centered"],["src","assets/images/0.png",1,"custom-img-digit",3,"click"],["src","assets/images/linev.png",1,"custom-img-digit"],["src","assets/images/1.png",1,"custom-img-digit",3,"click"],["src","assets/images/2.png",1,"custom-img-digit",3,"click"],["src","assets/images/3.png",1,"custom-img-digit",3,"click"],["src","assets/images/4.png",1,"custom-img-digit",3,"click"],["src","assets/images/lineh.png",1,"custom-img-digit"],["src","assets/images/5.png",1,"custom-img-digit",3,"click"],["src","assets/images/6.png",1,"custom-img-digit",3,"click"],["src","assets/images/7.png",1,"custom-img-digit",3,"click"],["src","assets/images/8.png",1,"custom-img-digit",3,"click"],["src","assets/images/9.png",1,"custom-img-digit",3,"click"],["src","assets/images/lineh.png"],["mat-button","",2,"background-color","blue","color","white","width","180px",3,"click"]],template:function(n,r){n&1&&(N(0,"mat-toolbar",0)(1,"span"),K(2),O(),G(3,"span",1),O(),G(4,"br")(5,"br")(6,"br")(7,"br")(8,"br"),N(9,"span",2),K(10,"Primero pulsa sobre un DIGITO"),O(),N(11,"span",2),K(12,"\xA0"),O(),N(13,"span",2),K(14,"\xA0"),O(),N(15,"div",3)(16,"TABLE")(17,"tr")(18,"td")(19,"img",4),Ce("click",function(){return r.clickImg0()}),O()(),N(20,"td"),G(21,"img",5),O(),N(22,"td")(23,"img",6),Ce("click",function(){return r.clickImg1()}),O()(),N(24,"td"),G(25,"img",5),O(),N(26,"td")(27,"img",7),Ce("click",function(){return r.clickImg2()}),O()(),N(28,"td"),G(29,"img",5),O(),N(30,"td")(31,"img",8),Ce("click",function(){return r.clickImg3()}),O()(),N(32,"td"),G(33,"img",5),O(),N(34,"td")(35,"img",9),Ce("click",function(){return r.clickImg4()}),O()()(),N(36,"tr")(37,"td"),G(38,"img",10),O(),N(39,"td"),G(40,"img",10),O(),N(41,"td"),G(42,"img",10),O(),N(43,"td"),G(44,"img",10),O(),N(45,"td"),G(46,"img",10),O(),N(47,"td"),G(48,"img",10),O(),N(49,"td"),G(50,"img",10),O(),N(51,"td"),G(52,"img",10),O(),N(53,"td"),G(54,"img",10),O()(),N(55,"tr")(56,"td")(57,"img",11),Ce("click",function(){return r.clickImg5()}),O()(),N(58,"td"),G(59,"img",5),O(),N(60,"td")(61,"img",12),Ce("click",function(){return r.clickImg6()}),O()(),N(62,"td"),G(63,"img",5),O(),N(64,"td")(65,"img",13),Ce("click",function(){return r.clickImg7()}),O()(),N(66,"td"),G(67,"img",5),O(),N(68,"td")(69,"img",14),Ce("click",function(){return r.clickImg8()}),O()(),N(70,"td"),G(71,"img",5),O(),N(72,"td")(73,"img",15),Ce("click",function(){return r.clickImg9()}),O()()()()(),N(74,"div",3),G(75,"img",16),O(),N(76,"span",2),K(77,"Al ejecutar el MODELO se deducir\xE1 el d\xEDgito"),O(),N(78,"span",2),K(79,"a partir del stream de la imagen pulsada"),O(),N(80,"span",2),K(81,"\xA0"),O(),N(82,"span",2),K(83,"\xA0"),O(),N(84,"div",3)(85,"button",17),Ce("click",function(){return r.actionRun()}),K(86,"Ejecutar-Modelo"),O()()),n&2&&(U(2),fe(r.mytext_app))},dependencies:[Mt,Ft],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.custom-div-centered[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#fff}.custom-img-digit[_ngcontent-%COMP%]{width:28px;height:28px}.span-custom[_ngcontent-%COMP%]{width:100%;font-weight:700;font-size:14px;text-align:center;display:block}"]})}return e})();var PE=Object.defineProperty,_X=Object.getOwnPropertyDescriptor,vX=Object.getOwnPropertyNames,bX=Object.prototype.hasOwnProperty,yX=(e=>typeof hi<"u"?hi:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof hi<"u"?hi:t)[i]}):e)(function(e){if(typeof hi<"u")return hi.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),ce=(e,t)=>()=>(e&&(t=e(e=0)),t),qf=(e,t)=>{for(var i in t)PE(e,i,{get:t[i],enumerable:!0})},wX=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of vX(t))!bX.call(e,r)&&r!==i&&PE(e,r,{get:()=>t[r],enumerable:!(n=_X(t,r))||n.enumerable});return e},Yg=e=>wX(PE({},"__esModule",{value:!0}),e),Mf,rs,Wl,oz,F4,z4=ce(()=>{"use strict";Mf=new Map,rs=[],Wl=(e,t,i)=>{if(t&&typeof t.init=="function"&&typeof t.createInferenceSessionHandler=="function"){let n=Mf.get(e);if(n===void 0)Mf.set(e,{backend:t,priority:i});else{if(n.priority>i)return;if(n.priority===i&&n.backend!==t)throw new Error(`cannot register backend "${e}" using priority ${i}`)}if(i>=0){let r=rs.indexOf(e);r!==-1&&rs.splice(r,1);for(let o=0;o<rs.length;o++)if(Mf.get(rs[o]).priority<=i){rs.splice(o,0,e);return}rs.push(e)}return}throw new TypeError("not a valid backend")},oz=e=>J(void 0,null,function*(){let t=Mf.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let i=!!t.initPromise;try{return i||(t.initPromise=t.backend.init(e)),yield t.initPromise,t.initialized=!0,t.backend}catch(n){return i||(t.error=`${n}`,t.aborted=!0),t.error}finally{delete t.initPromise}}}),F4=e=>J(void 0,null,function*(){let t=e.executionProviders||[],i=t.map(u=>typeof u=="string"?u:u.name),n=i.length===0?rs:i,r,o=[],s=new Set;for(let u of n){let c=yield oz(u);typeof c=="string"?o.push({name:u,err:c}):(r||(r=c),r===c&&s.add(u))}if(!r)throw new Error(`no available backend found. ERR: ${o.map(u=>`[${u.name}] ${u.err}`).join(", ")}`);for(let{name:u,err:c}of o)i.includes(u)&&console.warn(`removing requested execution provider "${u}" from session options because it is not available: ${c}`);let a=t.filter(u=>s.has(typeof u=="string"?u:u.name));return[r,new Proxy(e,{get:(u,c)=>c==="executionProviders"?a:Reflect.get(u,c)})]})}),xX=ce(()=>{"use strict";z4()}),L4,CX=ce(()=>{"use strict";L4="1.21.0"}),DC,Wi,B4=ce(()=>{"use strict";CX(),DC="warning",Wi={wasm:{},webgl:{},webgpu:{},versions:{common:L4},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);DC=e}},get logLevel(){return DC}},Object.defineProperty(Wi,"logLevel",{enumerable:!0})}),Jt,EX=ce(()=>{"use strict";B4(),Jt=Wi}),j4,V4,IX=ce(()=>{"use strict";j4=(e,t)=>{let i=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);i.width=e.dims[3],i.height=e.dims[2];let n=i.getContext("2d");if(n!=null){let r,o;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(r=e.dims[2],o=e.dims[3]):(r=e.dims[3],o=e.dims[2]);let s=t?.format!==void 0?t.format:"RGB",a=t?.norm,u,c;a===void 0||a.mean===void 0?u=[255,255,255,255]:typeof a.mean=="number"?u=[a.mean,a.mean,a.mean,a.mean]:(u=[a.mean[0],a.mean[1],a.mean[2],0],a.mean[3]!==void 0&&(u[3]=a.mean[3])),a===void 0||a.bias===void 0?c=[0,0,0,0]:typeof a.bias=="number"?c=[a.bias,a.bias,a.bias,a.bias]:(c=[a.bias[0],a.bias[1],a.bias[2],0],a.bias[3]!==void 0&&(c[3]=a.bias[3]));let f=o*r,p=0,m=f,v=f*2,b=-1;s==="RGBA"?(p=0,m=f,v=f*2,b=f*3):s==="RGB"?(p=0,m=f,v=f*2):s==="RBG"&&(p=0,v=f,m=f*2);for(let w=0;w<o;w++)for(let C=0;C<r;C++){let x=(e.data[p++]-c[0])*u[0],y=(e.data[m++]-c[1])*u[1],I=(e.data[v++]-c[2])*u[2],S=b===-1?255:(e.data[b++]-c[3])*u[3];n.fillStyle="rgba("+x+","+y+","+I+","+S+")",n.fillRect(C,w,1,1)}if("toDataURL"in i)return i.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},V4=(e,t)=>{let i=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),n;if(i!=null){let r,o,s;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(r=e.dims[2],o=e.dims[1],s=e.dims[3]):(r=e.dims[3],o=e.dims[2],s=e.dims[1]);let a=t!==void 0&&t.format!==void 0?t.format:"RGB",u=t?.norm,c,f;u===void 0||u.mean===void 0?c=[255,255,255,255]:typeof u.mean=="number"?c=[u.mean,u.mean,u.mean,u.mean]:(c=[u.mean[0],u.mean[1],u.mean[2],255],u.mean[3]!==void 0&&(c[3]=u.mean[3])),u===void 0||u.bias===void 0?f=[0,0,0,0]:typeof u.bias=="number"?f=[u.bias,u.bias,u.bias,u.bias]:(f=[u.bias[0],u.bias[1],u.bias[2],0],u.bias[3]!==void 0&&(f[3]=u.bias[3]));let p=o*r;if(t!==void 0&&(t.format!==void 0&&s===4&&t.format!=="RGBA"||s===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let m=4,v=0,b=1,w=2,C=3,x=0,y=p,I=p*2,S=-1;a==="RGBA"?(x=0,y=p,I=p*2,S=p*3):a==="RGB"?(x=0,y=p,I=p*2):a==="RBG"&&(x=0,I=p,y=p*2),n=i.createImageData(r,o);for(let T=0;T<o*r;v+=m,b+=m,w+=m,C+=m,T++)n.data[v]=(e.data[x++]-f[0])*c[0],n.data[b]=(e.data[y++]-f[1])*c[1],n.data[w]=(e.data[I++]-f[2])*c[2],n.data[C]=S===-1?255:(e.data[S++]-f[3])*c[3]}else throw new Error("Can not access image data");return n}}),Ng,U4,H4,W4,q4,G4,SX=ce(()=>{"use strict";FE(),Ng=(e,t)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:i,width:n}=t,r=t.norm??{mean:255,bias:0},o,s;typeof r.mean=="number"?o=[r.mean,r.mean,r.mean,r.mean]:o=[r.mean[0],r.mean[1],r.mean[2],r.mean[3]??255],typeof r.bias=="number"?s=[r.bias,r.bias,r.bias,r.bias]:s=[r.bias[0],r.bias[1],r.bias[2],r.bias[3]??0];let a=t.format!==void 0?t.format:"RGBA",u=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",c=i*n,f=u==="RGBA"?new Float32Array(c*4):new Float32Array(c*3),p=4,m=0,v=1,b=2,w=3,C=0,x=c,y=c*2,I=-1;a==="RGB"&&(p=3,m=0,v=1,b=2,w=-1),u==="RGBA"?I=c*3:u==="RBG"?(C=0,y=c,x=c*2):u==="BGR"&&(y=0,x=c,C=c*2);for(let S=0;S<c;S++,m+=p,b+=p,v+=p,w+=p)f[C++]=(e[m]+s[0])/o[0],f[x++]=(e[v]+s[1])/o[1],f[y++]=(e[b]+s[2])/o[2],I!==-1&&w!==-1&&(f[I++]=(e[w]+s[3])/o[3]);return u==="RGBA"?new ki("float32",f,[1,4,i,n]):new ki("float32",f,[1,3,i,n])},U4=(e,t)=>J(void 0,null,function*(){let i=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,n=typeof ImageData<"u"&&e instanceof ImageData,r=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,o=typeof e=="string",s,a=t??{},u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},c=f=>typeof HTMLCanvasElement<"u"&&f instanceof HTMLCanvasElement||f instanceof OffscreenCanvas?f.getContext("2d"):null;if(i){let f=u();f.width=e.width,f.height=e.height;let p=c(f);if(p!=null){let m=e.height,v=e.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(m=t.resizedHeight,v=t.resizedWidth),t!==void 0){if(a=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");a.tensorFormat="RGBA",a.height=m,a.width=v}else a.tensorFormat="RGBA",a.height=m,a.width=v;p.drawImage(e,0,0),s=p.getImageData(0,0,v,m).data}else throw new Error("Can not access image data")}else if(n){let f,p;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(f=t.resizedHeight,p=t.resizedWidth):(f=e.height,p=e.width),t!==void 0&&(a=t),a.format="RGBA",a.height=f,a.width=p,t!==void 0){let m=u();m.width=p,m.height=f;let v=c(m);if(v!=null)v.putImageData(e,0,0),s=v.getImageData(0,0,p,f).data;else throw new Error("Can not access image data")}else s=e.data}else if(r){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");let f=u();f.width=e.width,f.height=e.height;let p=c(f);if(p!=null){let m=e.height,v=e.width;return p.drawImage(e,0,0,v,m),s=p.getImageData(0,0,v,m).data,a.height=m,a.width=v,Ng(s,a)}else throw new Error("Can not access image data")}else{if(o)return new Promise((f,p)=>{let m=u(),v=c(m);if(!e||!v)return p();let b=new Image;b.crossOrigin="Anonymous",b.src=e,b.onload=()=>{m.width=b.width,m.height=b.height,v.drawImage(b,0,0,m.width,m.height);let w=v.getImageData(0,0,m.width,m.height);a.height=m.height,a.width=m.width,f(Ng(w.data,a))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(s!==void 0)return Ng(s,a);throw new Error("Input data provided is not supported - aborted tensor creation")}),H4=(e,t)=>{let{width:i,height:n,download:r,dispose:o}=t,s=[1,n,i,4];return new ki({location:"texture",type:"float32",texture:e,dims:s,download:r,dispose:o})},W4=(e,t)=>{let{dataType:i,dims:n,download:r,dispose:o}=t;return new ki({location:"gpu-buffer",type:i??"float32",gpuBuffer:e,dims:n,download:r,dispose:o})},q4=(e,t)=>{let{dataType:i,dims:n,download:r,dispose:o}=t;return new ki({location:"ml-tensor",type:i??"float32",mlTensor:e,dims:n,download:r,dispose:o})},G4=(e,t,i)=>new ki({location:"cpu-pinned",type:e,data:t,dims:i??[t.length]})}),Ia,Bf,TC,K4,DX=ce(()=>{"use strict";Ia=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Bf=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),TC=!1,K4=()=>{if(!TC){TC=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,i=globalThis.Float16Array,n=typeof i<"u"&&i.from;e&&(Ia.set("int64",BigInt64Array),Bf.set(BigInt64Array,"int64")),t&&(Ia.set("uint64",BigUint64Array),Bf.set(BigUint64Array,"uint64")),n?(Ia.set("float16",i),Bf.set(i,"float16")):Ia.set("float16",Uint16Array)}}}),Z4,Q4,TX=ce(()=>{"use strict";FE(),Z4=e=>{let t=1;for(let i=0;i<e.length;i++){let n=e[i];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${i}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${i}] must be a non-negative integer, got: ${n}`);t*=n}return t},Q4=(e,t)=>{switch(e.location){case"cpu":return new ki(e.type,e.data,t);case"cpu-pinned":return new ki({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new ki({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new ki({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new ki({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),ki,FE=ce(()=>{"use strict";IX(),SX(),DX(),TX(),ki=class{constructor(e,t,i){K4();let n,r;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,n=e.type,r=e.dims,e.location){case"cpu-pinned":{let s=Ia.get(n);if(!s)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(e.data instanceof s))throw new TypeError(`buffer should be of type ${s.name}`);this.cpuData=e.data;break}case"texture":{if(n!=="float32")throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}case"ml-tensor":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint64"&&n!=="int8"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let s,a;if(typeof e=="string")if(n=e,a=i,e==="string"){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");s=t}else{let u=Ia.get(e);if(u===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t)){if(e==="float16"&&u===Uint16Array||e==="uint4"||e==="int4")throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${u.name} as data.`);e==="uint64"||e==="int64"?s=u.from(t,BigInt):s=u.from(t)}else if(t instanceof u)s=t;else if(t instanceof Uint8ClampedArray)if(e==="uint8")s=Uint8Array.from(t);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(e==="float16"&&t instanceof Uint16Array&&u!==Uint16Array)s=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length);else throw new TypeError(`A ${n} tensor's data must be type of ${u}`)}else if(a=t,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let u=typeof e[0];if(u==="string")n="string",s=e;else if(u==="boolean")n="bool",s=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${u}.`)}else if(e instanceof Uint8ClampedArray)n="uint8",s=Uint8Array.from(e);else{let u=Bf.get(e.constructor);if(u===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);n=u,s=e}if(a===void 0)a=[s.length];else if(!Array.isArray(a))throw new TypeError("A tensor's dims must be a number array");r=a,this.cpuData=s,this.dataLocation="cpu"}let o=Z4(r);if(this.cpuData&&o!==this.cpuData.length&&!((n==="uint4"||n==="int4")&&Math.ceil(o/2)===this.cpuData.length))throw new Error(`Tensor's size(${o}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=r,this.size=o}static fromImage(e,t){return J(this,null,function*(){return U4(e,t)})}static fromTexture(e,t){return H4(e,t)}static fromGpuBuffer(e,t){return W4(e,t)}static fromMLTensor(e,t){return q4(e,t)}static fromPinnedBuffer(e,t,i){return G4(e,t,i)}toDataURL(e){return j4(this,e)}toImageData(e){return V4(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}getData(e){return J(this,null,function*(){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=yield this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}})}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Q4(this,e)}}}),qi,Y4=ce(()=>{"use strict";FE(),qi=ki}),Jg,$C,jr,xr,J4=ce(()=>{"use strict";B4(),Jg=(e,t)=>{(typeof Wi.trace>"u"?!Wi.wasm.trace:!Wi.trace)||console.timeStamp(`${e}::ORT::${t}`)},$C=(e,t)=>{let i=new Error().stack?.split(/\r\n|\r|\n/g)||[],n=!1;for(let r=0;r<i.length;r++){if(n&&!i[r].includes("TRACE_FUNC")){let o=`FUNC_${e}::${i[r].trim().split(" ")[1]}`;t&&(o+=`::${t}`),Jg("CPU",o);return}i[r].includes("TRACE_FUNC")&&(n=!0)}},jr=e=>{(typeof Wi.trace>"u"?!Wi.wasm.trace:!Wi.trace)||$C("BEGIN",e)},xr=e=>{(typeof Wi.trace>"u"?!Wi.wasm.trace:!Wi.trace)||$C("END",e)}}),X4,$X=ce(()=>{"use strict";z4(),Y4(),J4(),X4=class ej{constructor(t){this.handler=t}run(t,i,n){return J(this,null,function*(){jr();let r={},o={};if(typeof t!="object"||t===null||t instanceof qi||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let s=!0;if(typeof i=="object"){if(i===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(i instanceof qi)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(i)){if(i.length===0)throw new TypeError("'fetches' cannot be an empty array.");s=!1;for(let c of i){if(typeof c!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(c)===-1)throw new RangeError(`'fetches' contains invalid output name: ${c}.`);r[c]=null}if(typeof n=="object"&&n!==null)o=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let c=!1,f=Object.getOwnPropertyNames(i);for(let p of this.outputNames)if(f.indexOf(p)!==-1){let m=i[p];(m===null||m instanceof qi)&&(c=!0,s=!1,r[p]=m)}if(c){if(typeof n=="object"&&n!==null)o=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else o=i}}else if(typeof i<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let c of this.inputNames)if(typeof t[c]>"u")throw new Error(`input '${c}' is missing in 'feeds'.`);if(s)for(let c of this.outputNames)r[c]=null;let a=yield this.handler.run(t,r,o),u={};for(let c in a)if(Object.hasOwnProperty.call(a,c)){let f=a[c];f instanceof qi?u[c]=f:u[c]=new qi(f.type,f.data,f.dims)}return xr(),u})}release(){return J(this,null,function*(){return this.handler.dispose()})}static create(t,i,n,r){return J(this,null,function*(){jr();let o,s={};if(typeof t=="string"){if(o=t,typeof i=="object"&&i!==null)s=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(o=t,typeof i=="object"&&i!==null)s=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer){let f=t,p=0,m=t.byteLength;if(typeof i=="object"&&i!==null)s=i;else if(typeof i=="number"){if(p=i,!Number.isSafeInteger(p))throw new RangeError("'byteOffset' must be an integer.");if(p<0||p>=f.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${f.byteLength}).`);if(m=t.byteLength-p,typeof n=="number"){if(m=n,!Number.isSafeInteger(m))throw new RangeError("'byteLength' must be an integer.");if(m<=0||p+m>f.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${f.byteLength-p}].`);if(typeof r=="object"&&r!==null)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof i<"u")throw new TypeError("'options' must be an object.");o=new Uint8Array(f,p,m)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[a,u]=yield F4(s),c=yield a.createInferenceSessionHandler(o,u);return xr(),new ej(c)})}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}}),o_,kX=ce(()=>{"use strict";$X(),o_=X4}),MX=ce(()=>{"use strict"}),AX=ce(()=>{"use strict"}),RX=ce(()=>{"use strict"}),OX=ce(()=>{"use strict"}),NX={};qf(NX,{InferenceSession:()=>o_,TRACE:()=>Jg,TRACE_FUNC_BEGIN:()=>jr,TRACE_FUNC_END:()=>xr,Tensor:()=>qi,env:()=>Jt,registerBackend:()=>Wl});var Cr=ce(()=>{"use strict";xX(),EX(),kX(),Y4(),MX(),AX(),J4(),RX(),OX()}),zE=ce(()=>{"use strict"}),tj={};qf(tj,{default:()=>nj});var kC,MC,nj,PX=ce(()=>{"use strict";oH(),Ma(),LE(),kC="ort-wasm-proxy-worker",MC=globalThis.self?.name===kC,MC&&(self.onmessage=e=>{let{type:t,in:i}=e.data;try{switch(t){case"init-wasm":BE(i.wasm).then(()=>{rI(i).then(()=>{postMessage({type:t})},n=>{postMessage({type:t,err:n})})},n=>{postMessage({type:t,err:n})});break;case"init-ep":{let{epName:n,env:r}=i;oI(r,n).then(()=>{postMessage({type:t})},o=>{postMessage({type:t,err:o})});break}case"copy-from":{let{buffer:n}=i,r=r_(n);postMessage({type:t,out:r});break}case"create":{let{model:n,options:r}=i;sI(n,r).then(o=>{postMessage({type:t,out:o})},o=>{postMessage({type:t,err:o})});break}case"release":aI(i),postMessage({type:t});break;case"run":{let{sessionId:n,inputIndices:r,inputs:o,outputIndices:s,options:a}=i;lI(n,r,o,s,new Array(s.length).fill(null),a).then(u=>{u.some(c=>c[3]!=="cpu")?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:u},cI([...o,...u]))},u=>{postMessage({type:t,err:u})});break}case"end-profiling":uI(i),postMessage({type:t});break;default:}}catch(n){postMessage({type:t,err:n})}}),nj=MC?null:e=>new Worker(e??$i,{type:"module",name:kC})}),ij={};qf(ij,{default:()=>rj});var AC,RC,rj,sz,FX=ce(()=>{"use strict";RC=(AC=import.meta.url,function(){return J(this,arguments,function*(e={}){var t,i,n=e,r=new Promise((l,d)=>{t=l,i=d}),o=typeof window=="object",s=typeof WorkerGlobalScope<"u",a=s&&self.name?.startsWith("em-pthread");n.mountExternalData=(l,d)=>{l.startsWith("./")&&(l=l.substring(2)),(n.Bd||(n.Bd=new Map)).set(l,d)},n.unmountExternalData=()=>{delete n.Bd};var u=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,shared:!0}).buffer.constructor;let c=()=>{let l=(h,g,_)=>(...E)=>{let D=un,M=g?.();E=h(...E);let A=g?.();return M!==A&&(h=A,_(M),g=_=null),un!=D?new Promise((B,q)=>{Is={resolve:B,reject:q}}):E},d=h=>(...g)=>J(this,null,function*(){try{if(n.Cd)throw Error("Session already started");let _=n.Cd={be:g[0],errors:[]},E=yield h(...g);if(n.Cd!==_)throw Error("Session mismatch");n.Dd?.flush();let D=_.errors;if(0<D.length){let M=yield Promise.all(D);if(M=M.filter(A=>A),0<M.length)throw Error(M.join(`
`))}return E}finally{n.Cd=null}});n._OrtCreateSession=l(n._OrtCreateSession,()=>n._OrtCreateSession,h=>n._OrtCreateSession=h),n._OrtRun=d(l(n._OrtRun,()=>n._OrtRun,h=>n._OrtRun=h)),n._OrtRunWithBinding=d(l(n._OrtRunWithBinding,()=>n._OrtRunWithBinding,h=>n._OrtRunWithBinding=h)),n._OrtBindInput=l(n._OrtBindInput,()=>n._OrtBindInput,h=>n._OrtBindInput=h),c=void 0};n.jsepInit=(l,d)=>{if(c?.(),l==="webgpu"){[n.Dd,n.Rd,n.Vd,n.Hd,n.Ud,n.hc,n.Wd,n.Zd,n.Sd,n.Td,n.Xd]=d;let h=n.Dd;n.jsepRegisterBuffer=(g,_,E,D)=>h.registerBuffer(g,_,E,D),n.jsepGetBuffer=g=>h.getBuffer(g),n.jsepCreateDownloader=(g,_,E)=>h.createDownloader(g,_,E),n.jsepOnCreateSession=g=>{h.onCreateSession(g)},n.jsepOnReleaseSession=g=>{h.onReleaseSession(g)},n.jsepOnRunStart=g=>h.onRunStart(g),n.$d=(g,_)=>{h.upload(g,_)}}else if(l==="webnn"){[n.Dd,n.Yd,n.Id,n.jsepEnsureTensor,n.Jd,n.jsepDownloadTensor]=d,n.jsepReleaseTensorId=n.Id,n.jsepUploadTensor=n.Jd;let h=n.Dd;n.jsepOnRunStart=g=>h.onRunStart(g),n.jsepOnRunEnd=h.onRunEnd.bind(h),n.jsepRegisterMLContext=(g,_)=>{h.registerMLContext(g,_)},n.jsepOnReleaseSession=g=>{h.onReleaseSession(g)},n.jsepCreateMLTensorDownloader=(g,_)=>h.createMLTensorDownloader(g,_),n.jsepRegisterMLTensor=(g,_,E,D)=>h.registerMLTensor(g,_,E,D),n.jsepCreateMLContext=g=>h.createMLContext(g),n.jsepRegisterMLConstant=(g,_,E,D,M)=>h.registerMLConstant(g,_,E,D,M,n.Bd),n.jsepRegisterGraphInput=h.registerGraphInput.bind(h),n.jsepIsGraphInput=h.isGraphInput.bind(h),n.jsepCreateTemporaryTensor=h.createTemporaryTensor.bind(h)}};var f,p,m=Object.assign({},n),v=(l,d)=>{throw d},b="";(o||s)&&(s?b=self.location.href:typeof document<"u"&&document.currentScript&&(b=document.currentScript.src),AC&&(b=AC),b=b.startsWith("blob:")?"":b.slice(0,b.replace(/[?#].*/,"").lastIndexOf("/")+1),s&&(p=l=>{var d=new XMLHttpRequest;return d.open("GET",l,!1),d.responseType="arraybuffer",d.send(null),new Uint8Array(d.response)}),f=l=>J(this,null,function*(){if(we(l))return new Promise((h,g)=>{var _=new XMLHttpRequest;_.open("GET",l,!0),_.responseType="arraybuffer",_.onload=()=>{_.status==200||_.status==0&&_.response?h(_.response):g(_.status)},_.onerror=g,_.send(null)});var d=yield fetch(l,{credentials:"same-origin"});if(d.ok)return d.arrayBuffer();throw Error(d.status+" : "+d.url)}));var w=console.log.bind(console),C=console.error.bind(console),x=w,y=C;Object.assign(n,m),m=null;var I,S,T,$,k,P,j,H,re,ae,L,ge,ye,Y=n.wasmBinary,ve=!1,we=l=>l.startsWith("file://");function X(){return I.buffer!=$.buffer&&Ot(),$}function xe(){return I.buffer!=$.buffer&&Ot(),k}function z(){return I.buffer!=$.buffer&&Ot(),P}function W(){return I.buffer!=$.buffer&&Ot(),j}function R(){return I.buffer!=$.buffer&&Ot(),H}function se(){return I.buffer!=$.buffer&&Ot(),re}function Ke(){return I.buffer!=$.buffer&&Ot(),ae}function zt(){return I.buffer!=$.buffer&&Ot(),ye}if(a){let l=function(d){try{var h=d.data,g=h.yd;if(g==="load"){let _=[];self.onmessage=E=>_.push(E),self.startWorker=()=>{postMessage({yd:"loaded"});for(let E of _)l(E);self.onmessage=l};for(let E of h.Od)n[E]&&!n[E].proxy||(n[E]=(...D)=>{postMessage({yd:"callHandler",Nd:E,args:D})},E=="print"&&(x=n[E]),E=="printErr"&&(y=n[E]));I=h.he,Ot(),Xe(h.ie)}else if(g==="run"){l_(h.xd),$s(h.xd,0,0,1,0,0),nu(),Cs(h.xd),vn||(Qu(),vn=!0);try{u_(h.de,h.Fd)}catch(_){if(_!="unwind")throw _}}else h.target!=="setimmediate"&&(g==="checkMailbox"?vn&&Hr():g&&(y(`worker: received unknown command ${g}`),y(h)))}catch(_){throw Yu(),_}};var gt=l,Xe,vn=!1;y=function(...d){d=d.join(" "),console.error(d)},self.alert=function(...d){postMessage({yd:"alert",text:d.join(" "),fe:Jr()})},self.onunhandledrejection=d=>{throw d.reason||d},self.onmessage=l}function Ot(){var l=I.buffer;n.HEAP8=$=new Int8Array(l),n.HEAP16=P=new Int16Array(l),n.HEAPU8=k=new Uint8Array(l),n.HEAPU16=j=new Uint16Array(l),n.HEAP32=H=new Int32Array(l),n.HEAPU32=re=new Uint32Array(l),n.HEAPF32=ae=new Float32Array(l),n.HEAPF64=ye=new Float64Array(l),n.HEAP64=L=new BigInt64Array(l),n.HEAPU64=ge=new BigUint64Array(l)}function Vr(){a?startWorker(n):F.Bb()}a||(I=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),Ot());var us,Gi=0,Ki=null;function Zl(){if(--Gi==0&&Ki){var l=Ki;Ki=null,l()}}function bn(l){throw y(l="Aborted("+l+")"),ve=!0,l=new WebAssembly.RuntimeError(l+". Build with -sASSERTIONS for more info."),i(l),l}function Ql(){return{a:{Ta:a_,Va:s_,W:c_,la:d_,b:h_,u:p_,R:m_,Za:g_,d:__,pb:su,g:f_,T:uu,Ga:cu,lb:fu,nb:hu,Ha:pu,Ea:mu,wb:gu,Da:_u,pa:vu,mb:bu,jb:yu,Fa:wu,kb:xu,Ma:v_,za:y_,eb:w_,cb:C_,ya:I_,V:S_,N:D_,db:T_,ma:N_,fb:P_,zb:F_,hb:z_,qb:L_,ab:B_,Aa:j_,yb:Cs,Ja:V_,S:U_,Wa:H_,$:G_,G:K_,E:Q_,m:ys,H:Y_,B:ev,X:tv,J:nv,v:iv,O:rv,D:ov,t:sv,A:av,z:lv,w:uv,r:cv,tb:dv,ub:fv,vb:hv,rb:Pu,sb:Fu,bb:zu,Oa:mv,La:vv,y:bv,ja:yv,Ba:wv,Ka:gv,qa:xv,Ia:Cv,ib:Ev,U:pv,fa:Iv,Sa:Sv,gb:Dv,Qa:Tv,Pa:$v,Ab:Vu,Ca:Uu,ob:ps,aa:Hu,oa:Wu,xb:qu,na:Gu,$a:nb,ia:mb,sa:yb,ga:eb,da:lb,ua:vb,p:Jv,e:Pv,c:Ov,ea:sb,f:Fv,n:Lv,k:Kv,Y:jv,ka:Zv,j:Xv,wa:ob,Ra:Cb,ca:hb,Ua:xb,P:ab,K:Uv,_:fb,Q:tb,Z:gb,x:Vv,l:Nv,va:db,i:Rv,h:Bv,ra:wb,ta:bb,o:zv,q:Hv,s:qv,I:Gv,C:Yv,L:Qv,xa:rb,_a:ib,F:pb,Ya:ub,ba:_b,M:Wv,Xa:cb,ha:Mv,a:I,Na:hs}}}var cs={1319426:()=>typeof wasmOffsetConverter<"u",1319483:(l,d,h,g,_)=>{if(n===void 0||!n.Bd)return 1;if((l=et(Number(l>>>0))).startsWith("./")&&(l=l.substring(2)),!(l=n.Bd.get(l)))return 2;if(d=Number(d>>>0),h=Number(h>>>0),g=Number(g>>>0),d+h>l.byteLength)return 3;try{let E=l.subarray(d,d+h);switch(_){case 0:xe().set(E,g>>>0);break;case 1:n.$d(g,E);break;default:return 4}return 0}catch{return 4}},1320198:(l,d,h)=>{n.Jd(l,xe().subarray(d>>>0,d+h>>>0))},1320261:()=>n.Yd(),1320302:l=>{n.Id(l)},1320338:()=>{n.Sd()},1320369:()=>{n.Td()},1320398:()=>{n.Xd()},1320423:l=>n.Rd(l),1320456:l=>n.Vd(l),1320488:(l,d,h)=>{n.Hd(Number(l),Number(d),Number(h),!0)},1320551:(l,d,h)=>{n.Hd(Number(l),Number(d),Number(h))},1320608:l=>{n.hc("Abs",l,void 0)},1320659:l=>{n.hc("Neg",l,void 0)},1320710:l=>{n.hc("Floor",l,void 0)},1320763:l=>{n.hc("Ceil",l,void 0)},1320815:l=>{n.hc("Reciprocal",l,void 0)},1320873:l=>{n.hc("Sqrt",l,void 0)},1320925:l=>{n.hc("Exp",l,void 0)},1320976:l=>{n.hc("Erf",l,void 0)},1321027:l=>{n.hc("Sigmoid",l,void 0)},1321082:(l,d,h)=>{n.hc("HardSigmoid",l,{alpha:d,beta:h})},1321161:l=>{n.hc("Log",l,void 0)},1321212:l=>{n.hc("Sin",l,void 0)},1321263:l=>{n.hc("Cos",l,void 0)},1321314:l=>{n.hc("Tan",l,void 0)},1321365:l=>{n.hc("Asin",l,void 0)},1321417:l=>{n.hc("Acos",l,void 0)},1321469:l=>{n.hc("Atan",l,void 0)},1321521:l=>{n.hc("Sinh",l,void 0)},1321573:l=>{n.hc("Cosh",l,void 0)},1321625:l=>{n.hc("Asinh",l,void 0)},1321678:l=>{n.hc("Acosh",l,void 0)},1321731:l=>{n.hc("Atanh",l,void 0)},1321784:l=>{n.hc("Tanh",l,void 0)},1321836:l=>{n.hc("Not",l,void 0)},1321887:(l,d,h)=>{n.hc("Clip",l,{min:d,max:h})},1321956:l=>{n.hc("Clip",l,void 0)},1322008:(l,d)=>{n.hc("Elu",l,{alpha:d})},1322066:l=>{n.hc("Gelu",l,void 0)},1322118:l=>{n.hc("Relu",l,void 0)},1322170:(l,d)=>{n.hc("LeakyRelu",l,{alpha:d})},1322234:(l,d)=>{n.hc("ThresholdedRelu",l,{alpha:d})},1322304:(l,d)=>{n.hc("Cast",l,{to:d})},1322362:l=>{n.hc("Add",l,void 0)},1322413:l=>{n.hc("Sub",l,void 0)},1322464:l=>{n.hc("Mul",l,void 0)},1322515:l=>{n.hc("Div",l,void 0)},1322566:l=>{n.hc("Pow",l,void 0)},1322617:l=>{n.hc("Equal",l,void 0)},1322670:l=>{n.hc("Greater",l,void 0)},1322725:l=>{n.hc("GreaterOrEqual",l,void 0)},1322787:l=>{n.hc("Less",l,void 0)},1322839:l=>{n.hc("LessOrEqual",l,void 0)},1322898:(l,d,h,g,_)=>{n.hc("ReduceMean",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1323073:(l,d,h,g,_)=>{n.hc("ReduceMax",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1323247:(l,d,h,g,_)=>{n.hc("ReduceMin",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1323421:(l,d,h,g,_)=>{n.hc("ReduceProd",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1323596:(l,d,h,g,_)=>{n.hc("ReduceSum",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1323770:(l,d,h,g,_)=>{n.hc("ReduceL1",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1323943:(l,d,h,g,_)=>{n.hc("ReduceL2",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1324116:(l,d,h,g,_)=>{n.hc("ReduceLogSum",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1324293:(l,d,h,g,_)=>{n.hc("ReduceSumSquare",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1324473:(l,d,h,g,_)=>{n.hc("ReduceLogSumExp",l,{keepDims:!!d,noopWithEmptyAxes:!!h,axes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1324653:l=>{n.hc("Where",l,void 0)},1324706:(l,d,h)=>{n.hc("Transpose",l,{perm:d?Array.from(R().subarray(Number(d)>>>0,Number(h)>>>0)):[]})},1324830:(l,d,h,g)=>{n.hc("DepthToSpace",l,{blocksize:d,mode:et(h),format:g?"NHWC":"NCHW"})},1324963:(l,d,h,g)=>{n.hc("DepthToSpace",l,{blocksize:d,mode:et(h),format:g?"NHWC":"NCHW"})},1325096:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe,Qt)=>{n.hc("ConvTranspose",l,{format:A?"NHWC":"NCHW",autoPad:d,dilations:[h],group:g,kernelShape:[_],pads:[E,D],strides:[M],wIsConst:()=>!!X()[B>>>0],outputPadding:q?Array.from(R().subarray(Number(q)>>>0,Number(oe)>>>0)):[],outputShape:pe?Array.from(R().subarray(Number(pe)>>>0,Number(Pe)>>>0)):[],activation:et(Qt)})},1325529:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>{n.hc("ConvTranspose",l,{format:M?"NHWC":"NCHW",autoPad:d,dilations:Array.from(R().subarray(Number(h)>>>0,2+(Number(h)>>>0)>>>0)),group:g,kernelShape:Array.from(R().subarray(Number(_)>>>0,2+(Number(_)>>>0)>>>0)),pads:Array.from(R().subarray(Number(E)>>>0,4+(Number(E)>>>0)>>>0)),strides:Array.from(R().subarray(Number(D)>>>0,2+(Number(D)>>>0)>>>0)),wIsConst:()=>!!X()[A>>>0],outputPadding:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],outputShape:oe?Array.from(R().subarray(Number(oe)>>>0,Number(pe)>>>0)):[],activation:et(Pe)})},1326190:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe,Qt)=>{n.hc("ConvTranspose",l,{format:A?"NHWC":"NCHW",autoPad:d,dilations:[h],group:g,kernelShape:[_],pads:[E,D],strides:[M],wIsConst:()=>!!X()[B>>>0],outputPadding:q?Array.from(R().subarray(Number(q)>>>0,Number(oe)>>>0)):[],outputShape:pe?Array.from(R().subarray(Number(pe)>>>0,Number(Pe)>>>0)):[],activation:et(Qt)})},1326623:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>{n.hc("ConvTranspose",l,{format:M?"NHWC":"NCHW",autoPad:d,dilations:Array.from(R().subarray(Number(h)>>>0,2+(Number(h)>>>0)>>>0)),group:g,kernelShape:Array.from(R().subarray(Number(_)>>>0,2+(Number(_)>>>0)>>>0)),pads:Array.from(R().subarray(Number(E)>>>0,4+(Number(E)>>>0)>>>0)),strides:Array.from(R().subarray(Number(D)>>>0,2+(Number(D)>>>0)>>>0)),wIsConst:()=>!!X()[A>>>0],outputPadding:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],outputShape:oe?Array.from(R().subarray(Number(oe)>>>0,Number(pe)>>>0)):[],activation:et(Pe)})},1327284:(l,d)=>{n.hc("GlobalAveragePool",l,{format:d?"NHWC":"NCHW"})},1327375:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>{n.hc("AveragePool",l,{format:Pe?"NHWC":"NCHW",auto_pad:d,ceil_mode:h,count_include_pad:g,storage_order:_,dilations:E?Array.from(R().subarray(Number(E)>>>0,Number(D)>>>0)):[],kernel_shape:M?Array.from(R().subarray(Number(M)>>>0,Number(A)>>>0)):[],pads:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],strides:oe?Array.from(R().subarray(Number(oe)>>>0,Number(pe)>>>0)):[]})},1327854:(l,d)=>{n.hc("GlobalAveragePool",l,{format:d?"NHWC":"NCHW"})},1327945:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>{n.hc("AveragePool",l,{format:Pe?"NHWC":"NCHW",auto_pad:d,ceil_mode:h,count_include_pad:g,storage_order:_,dilations:E?Array.from(R().subarray(Number(E)>>>0,Number(D)>>>0)):[],kernel_shape:M?Array.from(R().subarray(Number(M)>>>0,Number(A)>>>0)):[],pads:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],strides:oe?Array.from(R().subarray(Number(oe)>>>0,Number(pe)>>>0)):[]})},1328424:(l,d)=>{n.hc("GlobalMaxPool",l,{format:d?"NHWC":"NCHW"})},1328511:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>{n.hc("MaxPool",l,{format:Pe?"NHWC":"NCHW",auto_pad:d,ceil_mode:h,count_include_pad:g,storage_order:_,dilations:E?Array.from(R().subarray(Number(E)>>>0,Number(D)>>>0)):[],kernel_shape:M?Array.from(R().subarray(Number(M)>>>0,Number(A)>>>0)):[],pads:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],strides:oe?Array.from(R().subarray(Number(oe)>>>0,Number(pe)>>>0)):[]})},1328986:(l,d)=>{n.hc("GlobalMaxPool",l,{format:d?"NHWC":"NCHW"})},1329073:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>{n.hc("MaxPool",l,{format:Pe?"NHWC":"NCHW",auto_pad:d,ceil_mode:h,count_include_pad:g,storage_order:_,dilations:E?Array.from(R().subarray(Number(E)>>>0,Number(D)>>>0)):[],kernel_shape:M?Array.from(R().subarray(Number(M)>>>0,Number(A)>>>0)):[],pads:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],strides:oe?Array.from(R().subarray(Number(oe)>>>0,Number(pe)>>>0)):[]})},1329548:(l,d,h,g,_)=>{n.hc("Gemm",l,{alpha:d,beta:h,transA:g,transB:_})},1329652:l=>{n.hc("MatMul",l,void 0)},1329706:(l,d,h,g)=>{n.hc("ArgMax",l,{keepDims:!!d,selectLastIndex:!!h,axis:g})},1329814:(l,d,h,g)=>{n.hc("ArgMin",l,{keepDims:!!d,selectLastIndex:!!h,axis:g})},1329922:(l,d)=>{n.hc("Softmax",l,{axis:d})},1329985:(l,d)=>{n.hc("Concat",l,{axis:d})},1330045:(l,d,h,g,_)=>{n.hc("Split",l,{axis:d,numOutputs:h,splitSizes:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1330201:l=>{n.hc("Expand",l,void 0)},1330255:(l,d)=>{n.hc("Gather",l,{axis:Number(d)})},1330326:(l,d)=>{n.hc("GatherElements",l,{axis:Number(d)})},1330405:(l,d)=>{n.hc("GatherND",l,{batch_dims:Number(d)})},1330484:(l,d,h,g,_,E,D,M,A,B,q)=>{n.hc("Resize",l,{antialias:d,axes:h?Array.from(R().subarray(Number(h)>>>0,Number(g)>>>0)):[],coordinateTransformMode:et(_),cubicCoeffA:E,excludeOutside:D,extrapolationValue:M,keepAspectRatioPolicy:et(A),mode:et(B),nearestMode:et(q)})},1330846:(l,d,h,g,_,E,D)=>{n.hc("Slice",l,{starts:d?Array.from(R().subarray(Number(d)>>>0,Number(h)>>>0)):[],ends:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[],axes:E?Array.from(R().subarray(Number(E)>>>0,Number(D)>>>0)):[]})},1331110:l=>{n.hc("Tile",l,void 0)},1331162:(l,d,h)=>{n.hc("InstanceNormalization",l,{epsilon:d,format:h?"NHWC":"NCHW"})},1331276:(l,d,h)=>{n.hc("InstanceNormalization",l,{epsilon:d,format:h?"NHWC":"NCHW"})},1331390:l=>{n.hc("Range",l,void 0)},1331443:(l,d)=>{n.hc("Einsum",l,{equation:et(d)})},1331524:(l,d,h,g,_)=>{n.hc("Pad",l,{mode:d,value:h,pads:g?Array.from(R().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},1331667:(l,d,h,g,_,E)=>{n.hc("BatchNormalization",l,{epsilon:d,momentum:h,spatial:!!_,trainingMode:!!g,format:E?"NHWC":"NCHW"})},1331836:(l,d,h,g,_,E)=>{n.hc("BatchNormalization",l,{epsilon:d,momentum:h,spatial:!!_,trainingMode:!!g,format:E?"NHWC":"NCHW"})},1332005:(l,d,h)=>{n.hc("CumSum",l,{exclusive:Number(d),reverse:Number(h)})},1332102:(l,d,h)=>{n.hc("DequantizeLinear",l,{axis:d,blockSize:h})},1332192:(l,d,h,g,_)=>{n.hc("GridSample",l,{align_corners:d,mode:et(h),padding_mode:et(g),format:_?"NHWC":"NCHW"})},1332362:(l,d,h,g,_)=>{n.hc("GridSample",l,{align_corners:d,mode:et(h),padding_mode:et(g),format:_?"NHWC":"NCHW"})},1332532:(l,d)=>{n.hc("ScatterND",l,{reduction:et(d)})},1332617:(l,d,h,g,_,E,D,M,A)=>{n.hc("Attention",l,{numHeads:d,isUnidirectional:h,maskFilterValue:g,scale:_,doRotary:E,qkvHiddenSizes:D?Array.from(R().subarray(Number(M)>>>0,Number(M)+D>>>0)):[],pastPresentShareBuffer:!!A})},1332889:l=>{n.hc("BiasAdd",l,void 0)},1332944:l=>{n.hc("BiasSplitGelu",l,void 0)},1333005:l=>{n.hc("FastGelu",l,void 0)},1333061:(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe,Qt,Ji)=>{n.hc("Conv",l,{format:oe?"NHWC":"NCHW",auto_pad:d,dilations:h?Array.from(R().subarray(Number(h)>>>0,Number(g)>>>0)):[],group:_,kernel_shape:E?Array.from(R().subarray(Number(E)>>>0,Number(D)>>>0)):[],pads:M?Array.from(R().subarray(Number(M)>>>0,Number(A)>>>0)):[],strides:B?Array.from(R().subarray(Number(B)>>>0,Number(q)>>>0)):[],w_is_const:()=>!!X()[Number(pe)>>>0],activation:et(Pe),activation_params:Qt?Array.from(Ke().subarray(Number(Qt)>>>0,Number(Ji)>>>0)):[]})},1333645:l=>{n.hc("Gelu",l,void 0)},1333697:(l,d,h,g,_,E,D,M,A)=>{n.hc("GroupQueryAttention",l,{numHeads:d,kvNumHeads:h,scale:g,softcap:_,doRotary:E,rotaryInterleaved:D,smoothSoftmax:M,localWindowSize:A})},1333914:(l,d,h,g)=>{n.hc("LayerNormalization",l,{axis:d,epsilon:h,simplified:!!g})},1334025:(l,d,h,g)=>{n.hc("LayerNormalization",l,{axis:d,epsilon:h,simplified:!!g})},1334136:(l,d,h,g,_,E)=>{n.hc("MatMulNBits",l,{k:d,n:h,accuracyLevel:g,bits:_,blockSize:E})},1334263:(l,d,h,g,_,E)=>{n.hc("MultiHeadAttention",l,{numHeads:d,isUnidirectional:h,maskFilterValue:g,scale:_,doRotary:E})},1334422:(l,d)=>{n.hc("QuickGelu",l,{alpha:d})},1334486:(l,d,h,g,_)=>{n.hc("RotaryEmbedding",l,{interleaved:!!d,numHeads:h,rotaryEmbeddingDim:g,scale:_})},1334625:(l,d,h)=>{n.hc("SkipLayerNormalization",l,{epsilon:d,simplified:!!h})},1334727:(l,d,h)=>{n.hc("SkipLayerNormalization",l,{epsilon:d,simplified:!!h})},1334829:(l,d,h,g)=>{n.hc("GatherBlockQuantized",l,{gatherAxis:d,quantizeAxis:h,blockSize:g})},1334950:l=>{n.Wd(l)},1334984:(l,d)=>n.Zd(Number(l),Number(d),n.Cd.be,n.Cd.errors)};function s_(l,d,h){return ku(()=>J(this,null,function*(){yield n.Ud(Number(l),Number(d),Number(h))}))}function a_(){return typeof wasmOffsetConverter<"u"}class ds{name="ExitStatus";constructor(d){this.message=`Program terminated with exit(${d})`,this.status=d}}var Yl=l=>{l.terminate(),l.onmessage=()=>{}},fs=[],Jl=l=>{Rn.length==0&&(ru(),iu(Rn[0]));var d=Rn.pop();if(!d)return 6;Zi.push(d),Xn[l.xd]=d,d.xd=l.xd;var h={yd:"run",de:l.ce,Fd:l.Fd,xd:l.xd};return d.postMessage(h,l.Ld),0},An=0,Le=(l,d,...h)=>{for(var g=2*h.length,_=de(),E=Ms(8*g),D=E>>>3,M=0;M<h.length;M++){var A=h[M];typeof A=="bigint"?(L[D+2*M]=1n,L[D+2*M+1]=A):(L[D+2*M]=0n,zt()[D+2*M+1>>>0]=A)}return l=Ju(l,0,g,E,d),le(_),l};function hs(l){if(a)return Le(0,1,l);if(T=l,!(0<An)){for(var d of Zi)Yl(d);for(d of Rn)Yl(d);Rn=[],Zi=[],Xn={},ve=!0}v(0,new ds(l))}function Xl(l){if(a)return Le(1,0,l);ps(l)}var ps=l=>{if(T=l,a)throw Xl(l),"unwind";hs(l)},Rn=[],Zi=[],eu=[],Xn={},tu=l=>{var d=l.xd;delete Xn[d],Rn.push(l),Zi.splice(Zi.indexOf(l),1),l.xd=0,Xu(d)};function nu(){eu.forEach(l=>l())}var iu=l=>new Promise(d=>{l.onmessage=_=>{var E=(_=_.data).yd;if(_.Ed&&_.Ed!=Jr()){var D=Xn[_.Ed];D?D.postMessage(_,_.Ld):y(`Internal error! Worker sent a message "${E}" to target pthread ${_.Ed}, but that thread no longer exists!`)}else E==="checkMailbox"?Hr():E==="spawnThread"?Jl(_):E==="cleanupThread"?tu(Xn[_.ee]):E==="loaded"?(l.loaded=!0,d(l)):E==="alert"?alert(`Thread ${_.fe}: ${_.text}`):_.target==="setimmediate"?l.postMessage(_):E==="callHandler"?n[_.Nd](..._.args):E&&y(`worker sent an unknown command ${E}`)},l.onerror=_=>{throw y(`worker sent an error! ${_.filename}:${_.lineno}: ${_.message}`),_};var h,g=[];for(h of[])n.propertyIsEnumerable(h)&&g.push(h);l.postMessage({yd:"load",Od:g,he:I,ie:S})});function ru(){var l=new Worker(import.meta.url.startsWith("file:")?new URL("ort.webgpu.bundle.min.mjs",import.meta.url):new URL(import.meta.url),{type:"module",workerData:"em-pthread",name:"em-pthread"});Rn.push(l)}var l_=l=>{Ot();var d=se()[l+52>>>2>>>0];l=se()[l+56>>>2>>>0],nc(d,d-l),le(d)},u_=(l,d)=>{An=0,l=As(l,d),0<An?T=l:ks(l)},Ur=[];function c_(l){var d=new ms(l>>>=0);if(X()[d.wd+12>>>0]==0){var h=1;X()[d.wd+12>>>0]=h}return h=0,X()[d.wd+13>>>0]=h,Ur.push(d),rc(l),sc(l)}var bi=0,d_=()=>{he(0,0);var l=Ur.pop();ic(l.Gd),bi=0};class ms{constructor(d){this.Gd=d,this.wd=d-24}}function f_(l){throw bi||=l>>>0,bi}var gs=l=>{var d=bi;if(!d)return Yi(0),0;var h=new ms(d);se()[h.wd+16>>>2>>>0]=d;var g=se()[h.wd+4>>>2>>>0];if(!g)return Yi(0),d;for(var _ of l){if(_===0||_===g)break;if(oc(_,g,h.wd+16))return Yi(_),d}return Yi(g),d};function h_(){return gs([])}function p_(l){return gs([l>>>0])}function m_(l,d){return gs([l>>>0,d>>>0])}var g_=()=>{var l=Ur.pop();l||bn("no exception to throw");var d=l.Gd;if(X()[l.wd+13>>>0]==0){Ur.push(l);var h=1;X()[l.wd+13>>>0]=h,h=0,X()[l.wd+12>>>0]=h}throw bi=d};function __(l,d,h){var g=new ms(l>>>=0);throw d>>>=0,h>>>=0,se()[g.wd+16>>>2>>>0]=0,se()[g.wd+4>>>2>>>0]=d,se()[g.wd+8>>>2>>>0]=h,bi=l}function ou(l,d,h,g){return a?Le(2,1,l,d,h,g):su(l,d,h,g)}function su(l,d,h,g){if(l>>>=0,h>>>=0,g>>>=0,u===void 0)return 6;var _=[];return a&&_.length===0?ou(l,d>>>=0,h,g):(l={ce:h,xd:l,Fd:g,Ld:_},a?(l.yd="spawnThread",postMessage(l,_),0):Jl(l))}var au=typeof TextDecoder<"u"?new TextDecoder:void 0,lu=(l,d=0,h=NaN)=>{var g=(d>>>=0)+h;for(h=d;l[h]&&!(h>=g);)++h;if(16<h-d&&l.buffer&&au)return au.decode(l.buffer instanceof ArrayBuffer?l.subarray(d,h):l.slice(d,h));for(g="";d<h;){var _=l[d++];if(128&_){var E=63&l[d++];if((224&_)==192)g+=String.fromCharCode((31&_)<<6|E);else{var D=63&l[d++];65536>(_=(240&_)==224?(15&_)<<12|E<<6|D:(7&_)<<18|E<<12|D<<6|63&l[d++])?g+=String.fromCharCode(_):(_-=65536,g+=String.fromCharCode(55296|_>>10,56320|1023&_))}}else g+=String.fromCharCode(_)}return g},et=(l,d)=>(l>>>=0)?lu(xe(),l,d):"";function uu(l,d,h){return a?Le(3,1,l,d,h):0}function cu(l,d){if(a)return Le(4,1,l,d)}var du=l=>{for(var d=0,h=0;h<l.length;++h){var g=l.charCodeAt(h);127>=g?d++:2047>=g?d+=2:55296<=g&&57343>=g?(d+=4,++h):d+=3}return d},yi=(l,d,h)=>{var g=xe();if(d>>>=0,0<h){var _=d;h=d+h-1;for(var E=0;E<l.length;++E){var D=l.charCodeAt(E);if(55296<=D&&57343>=D&&(D=65536+((1023&D)<<10)|1023&l.charCodeAt(++E)),127>=D){if(d>=h)break;g[d++>>>0]=D}else{if(2047>=D){if(d+1>=h)break;g[d++>>>0]=192|D>>6}else{if(65535>=D){if(d+2>=h)break;g[d++>>>0]=224|D>>12}else{if(d+3>=h)break;g[d++>>>0]=240|D>>18,g[d++>>>0]=128|D>>12&63}g[d++>>>0]=128|D>>6&63}g[d++>>>0]=128|63&D}}g[d>>>0]=0,l=d-_}else l=0;return l};function fu(l,d){if(a)return Le(5,1,l,d)}function hu(l,d,h){if(a)return Le(6,1,l,d,h)}function pu(l,d,h){return a?Le(7,1,l,d,h):0}function mu(l,d){if(a)return Le(8,1,l,d)}function gu(l,d,h){if(a)return Le(9,1,l,d,h)}function _u(l,d,h,g){if(a)return Le(10,1,l,d,h,g)}function vu(l,d,h,g){if(a)return Le(11,1,l,d,h,g)}function bu(l,d,h,g){if(a)return Le(12,1,l,d,h,g)}function yu(l){if(a)return Le(13,1,l)}function wu(l,d){if(a)return Le(14,1,l,d)}function xu(l,d,h){if(a)return Le(15,1,l,d,h)}var Cu,On,v_=()=>bn(""),ln=l=>{for(var d="";xe()[l>>>0];)d+=Cu[xe()[l++>>>0]];return d},_s={},vs={},b_={};function yn(l,d,h={}){return function(g,_,E={}){var D=_.name;if(!g)throw new On(`type "${D}" must have a positive integer typeid pointer`);if(vs.hasOwnProperty(g)){if(E.Pd)return;throw new On(`Cannot register type '${D}' twice`)}vs[g]=_,delete b_[g],_s.hasOwnProperty(g)&&(_=_s[g],delete _s[g],_.forEach(M=>M()))}(l,d,h)}var Eu=(l,d,h)=>{switch(d){case 1:return h?g=>X()[g>>>0]:g=>xe()[g>>>0];case 2:return h?g=>z()[g>>>1>>>0]:g=>W()[g>>>1>>>0];case 4:return h?g=>R()[g>>>2>>>0]:g=>se()[g>>>2>>>0];case 8:return h?g=>L[g>>>3]:g=>ge[g>>>3];default:throw new TypeError(`invalid integer width (${d}): ${l}`)}};function y_(l,d,h){h>>>=0,yn(l>>>=0,{name:d=ln(d>>>0),fromWireType:g=>g,toWireType:function(g,_){if(typeof _!="bigint"&&typeof _!="number")throw _=_===null?"null":(g=typeof _)=="object"||g==="array"||g==="function"?_.toString():""+_,new TypeError(`Cannot convert "${_}" to ${this.name}`);return typeof _=="number"&&(_=BigInt(_)),_},zd:Nn,readValueFromPointer:Eu(d,h,d.indexOf("u")==-1),Ad:null})}var Nn=8;function w_(l,d,h,g){yn(l>>>=0,{name:d=ln(d>>>0),fromWireType:function(_){return!!_},toWireType:function(_,E){return E?h:g},zd:Nn,readValueFromPointer:function(_){return this.fromWireType(xe()[_>>>0])},Ad:null})}var bs=[],wn=[];function ys(l){9<(l>>>=0)&&--wn[l+1]==0&&(wn[l]=void 0,bs.push(l))}var Lt=l=>{if(!l)throw new On("Cannot use deleted val. handle = "+l);return wn[l]},Zt=l=>{switch(l){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let d=bs.pop()||wn.length;return wn[d]=l,wn[d+1]=1,d}};function ws(l){return this.fromWireType(se()[l>>>2>>>0])}var x_={name:"emscripten::val",fromWireType:l=>{var d=Lt(l);return ys(l),d},toWireType:(l,d)=>Zt(d),zd:Nn,readValueFromPointer:ws,Ad:null};function C_(l){return yn(l>>>0,x_)}var E_=(l,d)=>{switch(d){case 4:return function(h){return this.fromWireType(Ke()[h>>>2>>>0])};case 8:return function(h){return this.fromWireType(zt()[h>>>3>>>0])};default:throw new TypeError(`invalid float width (${d}): ${l}`)}};function I_(l,d,h){h>>>=0,yn(l>>>=0,{name:d=ln(d>>>0),fromWireType:g=>g,toWireType:(g,_)=>_,zd:Nn,readValueFromPointer:E_(d,h),Ad:null})}function S_(l,d,h,g,_){if(l>>>=0,h>>>=0,d=ln(d>>>0),_===-1&&(_=4294967295),_=M=>M,g===0){var E=32-8*h;_=M=>M<<E>>>E}var D=d.includes("unsigned")?function(M,A){return A>>>0}:function(M,A){return A};yn(l,{name:d,fromWireType:_,toWireType:D,zd:Nn,readValueFromPointer:Eu(d,h,g!==0),Ad:null})}function D_(l,d,h){function g(E){var D=se()[E>>>2>>>0];return E=se()[E+4>>>2>>>0],new _(X().buffer,E,D)}var _=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][d];yn(l>>>=0,{name:h=ln(h>>>0),fromWireType:g,zd:Nn,readValueFromPointer:g},{Pd:!0})}function T_(l,d){yn(l>>>=0,{name:d=ln(d>>>0),fromWireType:function(h){for(var g,_=se()[h>>>2>>>0],E=h+4,D=E,M=0;M<=_;++M){var A=E+M;M!=_&&xe()[A>>>0]!=0||(D=et(D,A-D),g===void 0?g=D:(g+="\0",g+=D),D=A+1)}return cn(h),g},toWireType:function(h,g){g instanceof ArrayBuffer&&(g=new Uint8Array(g));var _=typeof g=="string";if(!(_||g instanceof Uint8Array||g instanceof Uint8ClampedArray||g instanceof Int8Array))throw new On("Cannot pass non-string to std::string");var E=_?du(g):g.length,D=Xr(4+E+1),M=D+4;if(se()[D>>>2>>>0]=E,_)yi(g,M,E+1);else if(_)for(_=0;_<E;++_){var A=g.charCodeAt(_);if(255<A)throw cn(D),new On("String has UTF-16 code units that do not fit in 8 bits");xe()[M+_>>>0]=A}else for(_=0;_<E;++_)xe()[M+_>>>0]=g[_];return h!==null&&h.push(cn,D),D},zd:Nn,readValueFromPointer:ws,Ad(h){cn(h)}})}var Iu=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,$_=(l,d)=>{for(var h=l>>1,g=h+d/2;!(h>=g)&&W()[h>>>0];)++h;if(32<(h<<=1)-l&&Iu)return Iu.decode(xe().slice(l,h));for(h="",g=0;!(g>=d/2);++g){var _=z()[l+2*g>>>1>>>0];if(_==0)break;h+=String.fromCharCode(_)}return h},k_=(l,d,h)=>{if(h??=2147483647,2>h)return 0;var g=d;h=(h-=2)<2*l.length?h/2:l.length;for(var _=0;_<h;++_){var E=l.charCodeAt(_);z()[d>>>1>>>0]=E,d+=2}return z()[d>>>1>>>0]=0,d-g},M_=l=>2*l.length,A_=(l,d)=>{for(var h=0,g="";!(h>=d/4);){var _=R()[l+4*h>>>2>>>0];if(_==0)break;++h,65536<=_?(_-=65536,g+=String.fromCharCode(55296|_>>10,56320|1023&_)):g+=String.fromCharCode(_)}return g},R_=(l,d,h)=>{if(d>>>=0,h??=2147483647,4>h)return 0;var g=d;h=g+h-4;for(var _=0;_<l.length;++_){var E=l.charCodeAt(_);if(55296<=E&&57343>=E&&(E=65536+((1023&E)<<10)|1023&l.charCodeAt(++_)),R()[d>>>2>>>0]=E,(d+=4)+4>h)break}return R()[d>>>2>>>0]=0,d-g},O_=l=>{for(var d=0,h=0;h<l.length;++h){var g=l.charCodeAt(h);55296<=g&&57343>=g&&++h,d+=4}return d};function N_(l,d,h){if(l>>>=0,d>>>=0,h=ln(h>>>=0),d===2)var g=$_,_=k_,E=M_,D=M=>W()[M>>>1>>>0];else d===4&&(g=A_,_=R_,E=O_,D=M=>se()[M>>>2>>>0]);yn(l,{name:h,fromWireType:M=>{for(var A,B=se()[M>>>2>>>0],q=M+4,oe=0;oe<=B;++oe){var pe=M+4+oe*d;oe!=B&&D(pe)!=0||(q=g(q,pe-q),A===void 0?A=q:(A+="\0",A+=q),q=pe+d)}return cn(M),A},toWireType:(M,A)=>{if(typeof A!="string")throw new On(`Cannot pass non-string to C++ string type ${h}`);var B=E(A),q=Xr(4+B+d);return se()[q>>>2>>>0]=B/d,_(A,q+4,B+d),M!==null&&M.push(cn,q),q},zd:Nn,readValueFromPointer:ws,Ad(M){cn(M)}})}function P_(l,d){yn(l>>>=0,{Qd:!0,name:d=ln(d>>>0),zd:0,fromWireType:()=>{},toWireType:()=>{}})}function F_(l){$s(l>>>0,!s,1,!o,131072,!1),nu()}var xs=l=>{if(!ve)try{if(l(),!(0<An))try{a?ks(T):ps(T)}catch(d){d instanceof ds||d=="unwind"||v(0,d)}}catch(d){d instanceof ds||d=="unwind"||v(0,d)}};function Cs(l){l>>>=0,typeof Atomics.ge=="function"&&(Atomics.ge(R(),l>>>2,l).value.then(Hr),l+=128,Atomics.store(R(),l>>>2,1))}var Hr=()=>{var l=Jr();l&&(Cs(l),xs(tc))};function z_(l,d){(l>>>=0)==d>>>0?setTimeout(Hr):a?postMessage({Ed:l,yd:"checkMailbox"}):(l=Xn[l])&&l.postMessage({yd:"checkMailbox"})}var Es=[];function L_(l,d,h,g,_){for(d>>>=0,g/=2,Es.length=g,h=_>>>0>>>3,_=0;_<g;_++)Es[_]=L[h+2*_]?L[h+2*_+1]:zt()[h+2*_+1>>>0];return(d?cs[d]:Av[l])(...Es)}var B_=()=>{An=0};function j_(l){l>>>=0,a?postMessage({yd:"cleanupThread",ee:l}):tu(Xn[l])}function V_(l){}var Wr=(l,d)=>{var h=vs[l];if(h===void 0)throw l=Zu(l),h=ln(l),cn(l),new On(`${d} has unknown type ${h}`);return h},Su=(l,d,h)=>{var g=[];return l=l.toWireType(g,h),g.length&&(se()[d>>>2>>>0]=Zt(g)),l};function U_(l,d,h){return d>>>=0,h>>>=0,l=Lt(l>>>0),d=Wr(d,"emval::as"),Su(d,h,l)}function H_(l,d){return d>>>=0,l=Lt(l>>>0),(d=Wr(d,"emval::as")).toWireType(null,l)}var qr=l=>{try{l()}catch(d){bn(d)}},Pn=0,un=null,Du=0,Gr=[],Tu={},$u={},W_=0,Is=null,q_=[];function ku(l){return function(d){if(!ve){if(Pn===0){var h=!1,g=!1;d((_=0)=>{if(!ve&&(Du=_,h=!0,g)){Pn=2,qr(()=>Xc(un)),typeof MainLoop<"u"&&MainLoop.Md&&MainLoop.resume(),_=!1;try{var E=function(){var A=R()[un+8>>>2>>>0];return A=F[$u[A]],--An,A()}()}catch(A){E=A,_=!0}var D=!1;if(!un){var M=Is;M&&(Is=null,(_?M.reject:M.resolve)(E),D=!0)}if(_&&!D)throw E}}),g=!0,h||(Pn=1,un=function(){var _=Xr(65548),E=_+12;se()[_>>>2>>>0]=E,se()[_+4>>>2>>>0]=E+65536,E=Gr[0];var D=Tu[E];return D===void 0&&(D=W_++,Tu[E]=D,$u[D]=E),E=D,R()[_+8>>>2>>>0]=E,_}(),typeof MainLoop<"u"&&MainLoop.Md&&MainLoop.pause(),qr(()=>Yc(un)))}else Pn===2?(Pn=0,qr(ed),cn(un),un=null,q_.forEach(xs)):bn(`invalid state: ${Pn}`);return Du}}(d=>{l().then(d)})}function G_(l){return l>>>=0,ku(()=>J(this,null,function*(){var d=yield Lt(l);return Zt(d)}))}var Kr=[];function K_(l,d,h,g){return h>>>=0,g>>>=0,(l=Kr[l>>>0])(null,d=Lt(d>>>0),h,g)}var Z_={},Zr=l=>{var d=Z_[l];return d===void 0?ln(l):d};function Q_(l,d,h,g,_){return h>>>=0,g>>>=0,_>>>=0,(l=Kr[l>>>0])(d=Lt(d>>>0),d[h=Zr(h)],g,_)}var Mu=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Y_(l){return(l>>>=0)==0?Zt(Mu()):(l=Zr(l),Zt(Mu()[l]))}var J_=l=>{var d=Kr.length;return Kr.push(l),d},X_=(l,d)=>{for(var h=Array(l),g=0;g<l;++g)h[g]=Wr(se()[d+4*g>>>2>>>0],"parameter "+g);return h},Au=(l,d)=>Object.defineProperty(d,"name",{value:l});function ev(l,d,h){var g=(d=X_(l,d>>>0)).shift();l--;var _=`return function (obj, func, destructorsRef, args) {
`,E=0,D=[];h===0&&D.push("obj");for(var M=["retType"],A=[g],B=0;B<l;++B)D.push("arg"+B),M.push("argType"+B),A.push(d[B]),_+=`  var arg${B} = argType${B}.readValueFromPointer(args${E?"+"+E:""});
`,E+=d[B].zd;return _+=`  var rv = ${h===1?"new func":"func.call"}(${D.join(", ")});
`,g.Qd||(M.push("emval_returnValue"),A.push(Su),_+=`  return emval_returnValue(retType, destructorsRef, rv);
`),M.push(_+`};
`),l=function(q){var oe=Function;if(!(oe instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof oe} which is not a function`);var pe=Au(oe.name||"unknownFunctionName",function(){});return pe.prototype=oe.prototype,pe=new pe,(q=oe.apply(pe,q))instanceof Object?q:pe}(M)(...A),h=`methodCaller<(${d.map(q=>q.name).join(", ")}) => ${g.name}>`,J_(Au(h,l))}function tv(l){return l=Zr(l>>>0),Zt(n[l])}function nv(l,d){return d>>>=0,l=Lt(l>>>0),d=Lt(d),Zt(l[d])}function iv(l){9<(l>>>=0)&&(wn[l+1]+=1)}function rv(){return Zt([])}function ov(l){l=Lt(l>>>0);for(var d=Array(l.length),h=0;h<l.length;h++)d[h]=l[h];return Zt(d)}function sv(l){return Zt(Zr(l>>>0))}function av(){return Zt({})}function lv(l){for(var d=Lt(l>>>=0);d.length;){var h=d.pop();d.pop()(h)}ys(l)}function uv(l,d,h){d>>>=0,h>>>=0,l=Lt(l>>>0),d=Lt(d),h=Lt(h),l[d]=h}function cv(l,d){return d>>>=0,l=(l=Wr(l>>>0,"_emval_take_value")).readValueFromPointer(d),Zt(l)}function dv(l,d){l=-9007199254740992>l||9007199254740992<l?NaN:Number(l),d>>>=0,l=new Date(1e3*l),R()[d>>>2>>>0]=l.getUTCSeconds(),R()[d+4>>>2>>>0]=l.getUTCMinutes(),R()[d+8>>>2>>>0]=l.getUTCHours(),R()[d+12>>>2>>>0]=l.getUTCDate(),R()[d+16>>>2>>>0]=l.getUTCMonth(),R()[d+20>>>2>>>0]=l.getUTCFullYear()-1900,R()[d+24>>>2>>>0]=l.getUTCDay(),l=(l.getTime()-Date.UTC(l.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,R()[d+28>>>2>>>0]=l}var Ru=l=>l%4==0&&(l%100!=0||l%400==0),Ou=[0,31,60,91,121,152,182,213,244,274,305,335],Nu=[0,31,59,90,120,151,181,212,243,273,304,334];function fv(l,d){l=-9007199254740992>l||9007199254740992<l?NaN:Number(l),d>>>=0,l=new Date(1e3*l),R()[d>>>2>>>0]=l.getSeconds(),R()[d+4>>>2>>>0]=l.getMinutes(),R()[d+8>>>2>>>0]=l.getHours(),R()[d+12>>>2>>>0]=l.getDate(),R()[d+16>>>2>>>0]=l.getMonth(),R()[d+20>>>2>>>0]=l.getFullYear()-1900,R()[d+24>>>2>>>0]=l.getDay();var h=(Ru(l.getFullYear())?Ou:Nu)[l.getMonth()]+l.getDate()-1|0;R()[d+28>>>2>>>0]=h,R()[d+36>>>2>>>0]=-60*l.getTimezoneOffset(),h=new Date(l.getFullYear(),6,1).getTimezoneOffset();var g=new Date(l.getFullYear(),0,1).getTimezoneOffset();l=0|(h!=g&&l.getTimezoneOffset()==Math.min(g,h)),R()[d+32>>>2>>>0]=l}function hv(l){l>>>=0;var d=new Date(R()[l+20>>>2>>>0]+1900,R()[l+16>>>2>>>0],R()[l+12>>>2>>>0],R()[l+8>>>2>>>0],R()[l+4>>>2>>>0],R()[l>>>2>>>0],0),h=R()[l+32>>>2>>>0],g=d.getTimezoneOffset(),_=new Date(d.getFullYear(),6,1).getTimezoneOffset(),E=new Date(d.getFullYear(),0,1).getTimezoneOffset(),D=Math.min(E,_);return 0>h?R()[l+32>>>2>>>0]=+(_!=E&&D==g):0<h!=(D==g)&&(_=Math.max(E,_),d.setTime(d.getTime()+6e4*((0<h?D:_)-g))),R()[l+24>>>2>>>0]=d.getDay(),h=(Ru(d.getFullYear())?Ou:Nu)[d.getMonth()]+d.getDate()-1|0,R()[l+28>>>2>>>0]=h,R()[l>>>2>>>0]=d.getSeconds(),R()[l+4>>>2>>>0]=d.getMinutes(),R()[l+8>>>2>>>0]=d.getHours(),R()[l+12>>>2>>>0]=d.getDate(),R()[l+16>>>2>>>0]=d.getMonth(),R()[l+20>>>2>>>0]=d.getYear(),l=d.getTime(),BigInt(isNaN(l)?-1:l/1e3)}function Pu(l,d,h,g,_,E,D){return a?Le(16,1,l,d,h,g,_,E,D):-52}function Fu(l,d,h,g,_,E){if(a)return Le(17,1,l,d,h,g,_,E)}var Qi={},pv=()=>performance.timeOrigin+performance.now();function zu(l,d){if(a)return Le(18,1,l,d);if(Qi[l]&&(clearTimeout(Qi[l].id),delete Qi[l]),!d)return 0;var h=setTimeout(()=>{delete Qi[l],xs(()=>ec(l,performance.timeOrigin+performance.now()))},d);return Qi[l]={id:h,ke:d},0}function mv(l,d,h,g){l>>>=0,d>>>=0,h>>>=0,g>>>=0;var _=new Date().getFullYear(),E=new Date(_,0,1).getTimezoneOffset();_=new Date(_,6,1).getTimezoneOffset();var D=Math.max(E,_);se()[l>>>2>>>0]=60*D,R()[d>>>2>>>0]=+(E!=_),l=(d=M=>{var A=Math.abs(M);return`UTC${0<=M?"-":"+"}${String(Math.floor(A/60)).padStart(2,"0")}${String(A%60).padStart(2,"0")}`})(E),d=d(_),_<E?(yi(l,h,17),yi(d,g,17)):(yi(l,g,17),yi(d,h,17))}var gv=()=>Date.now(),_v=1;function vv(l,d,h){if(!(0<=l&&3>=l))return 28;if(l===0)l=Date.now();else{if(!_v)return 52;l=performance.timeOrigin+performance.now()}return L[h>>>0>>>3]=BigInt(Math.round(1e6*l)),0}var Ss=[],Lu=(l,d)=>{Ss.length=0;for(var h;h=xe()[l++>>>0];){var g=h!=105;d+=(g&=h!=112)&&d%8?4:0,Ss.push(h==112?se()[d>>>2>>>0]:h==106?L[d>>>3]:h==105?R()[d>>>2>>>0]:zt()[d>>>3>>>0]),d+=g?8:4}return Ss};function bv(l,d,h){return l>>>=0,d=Lu(d>>>0,h>>>0),cs[l](...d)}function yv(l,d,h){return l>>>=0,d=Lu(d>>>0,h>>>0),cs[l](...d)}var wv=()=>{};function xv(l,d){return y(et(l>>>0,d>>>0))}var Cv=()=>{throw An+=1,"unwind"};function Ev(){return 4294901760}var Iv=()=>navigator.hardwareConcurrency;function Sv(){return bn("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Dv(l){l>>>=0;var d=xe().length;if(l<=d||4294901760<l)return!1;for(var h=1;4>=h;h*=2){var g=d*(1+.2/h);g=Math.min(g,l+100663296);e:{g=(Math.min(4294901760,65536*Math.ceil(Math.max(l,g)/65536))-I.buffer.byteLength+65535)/65536|0;try{I.grow(g),Ot();var _=1;break e}catch{}_=void 0}if(_)return!0}return!1}var Qr=()=>(bn("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),wi={},Bu=l=>{l.forEach(d=>{var h=Qr();h&&(wi[h]=d)})};function Tv(){var l=Error().stack.toString().split(`
`);return l[0]=="Error"&&l.shift(),Bu(l),wi.Kd=Qr(),wi.ae=l,wi.Kd}function $v(l,d,h){if(l>>>=0,d>>>=0,wi.Kd==l)var g=wi.ae;else(g=Error().stack.toString().split(`
`))[0]=="Error"&&g.shift(),Bu(g);for(var _=3;g[_]&&Qr()!=l;)++_;for(l=0;l<h&&g[l+_];++l)R()[d+4*l>>>2>>>0]=Qr();return l}var Ds,Ts={},ju=()=>{if(!Ds){var l,d={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(l in Ts)Ts[l]===void 0?delete d[l]:d[l]=Ts[l];var h=[];for(l in d)h.push(`${l}=${d[l]}`);Ds=h}return Ds};function Vu(l,d){if(a)return Le(19,1,l,d);l>>>=0,d>>>=0;var h=0;return ju().forEach((g,_)=>{var E=d+h;for(_=se()[l+4*_>>>2>>>0]=E,E=0;E<g.length;++E)X()[_++>>>0]=g.charCodeAt(E);X()[_>>>0]=0,h+=g.length+1}),0}function Uu(l,d){if(a)return Le(20,1,l,d);l>>>=0,d>>>=0;var h=ju();se()[l>>>2>>>0]=h.length;var g=0;return h.forEach(_=>g+=_.length+1),se()[d>>>2>>>0]=g,0}function Hu(l){return a?Le(21,1,l):52}function Wu(l,d,h,g){return a?Le(22,1,l,d,h,g):52}function qu(l,d,h,g){return a?Le(23,1,l,d,h,g):70}var kv=[null,[],[]];function Gu(l,d,h,g){if(a)return Le(24,1,l,d,h,g);d>>>=0,h>>>=0,g>>>=0;for(var _=0,E=0;E<h;E++){var D=se()[d>>>2>>>0],M=se()[d+4>>>2>>>0];d+=8;for(var A=0;A<M;A++){var B=xe()[D+A>>>0],q=kv[l];B===0||B===10?((l===1?x:y)(lu(q)),q.length=0):q.push(B)}_+=M}return se()[g>>>2>>>0]=_,0}function Mv(l){return l>>>0}a||function(){for(var l=n.numThreads-1;l--;)ru();fs.unshift(()=>{Gi++,function(d){a?d():Promise.all(Rn.map(iu)).then(d)}(()=>Zl())})}();for(var Ku=Array(256),Yr=0;256>Yr;++Yr)Ku[Yr]=String.fromCharCode(Yr);Cu=Ku,On=n.BindingError=class extends Error{constructor(l){super(l),this.name="BindingError"}},n.InternalError=class extends Error{constructor(l){super(l),this.name="InternalError"}},wn.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=()=>wn.length/2-5-bs.length;var F,Av=[hs,Xl,ou,uu,cu,fu,hu,pu,mu,gu,_u,vu,bu,yu,wu,xu,Pu,Fu,zu,Vu,Uu,Hu,Wu,qu,Gu];(function(){return J(this,null,function*(){function l(g,_){return F=g.exports,F=function(){var E=F,D={};for(let[M,A]of Object.entries(E))D[M]=typeof A=="function"?(...B)=>{Gr.push(M);try{return A(...B)}finally{ve||(Gr.pop(),un&&Pn===1&&Gr.length===0&&(Pn=0,An+=1,qr(Jc),typeof Fibers<"u"&&Fibers.le()))}}:A;return D}(),F=function(){var E=F,D=A=>B=>A(B)>>>0,M=A=>()=>A()>>>0;return(E=Object.assign({},E)).Cb=D(E.Cb),E.fc=M(E.fc),E.ic=D(E.ic),E.vc=D(E.vc),E.wc=M(E.wc),E.Ac=D(E.Ac),E}(),eu.push(F.jc),S=_,Zl(),F}Gi++;var d=Ql();if(n.instantiateWasm)return new Promise(g=>{n.instantiateWasm(d,(_,E)=>{l(_,E),g(_.exports)})});if(a)return new Promise(g=>{Xe=_=>{var E=new WebAssembly.Instance(_,Ql());g(l(E,_))}});us??=n.locateFile?n.locateFile?n.locateFile("ort-wasm-simd-threaded.jsep.wasm",b):b+"ort-wasm-simd-threaded.jsep.wasm":new URL("ort-wasm-simd-threaded.jsep.wasm",import.meta.url).href;try{var h=yield function(g){return J(this,null,function*(){var _=us;if(!Y&&typeof WebAssembly.instantiateStreaming=="function"&&!we(_))try{var E=fetch(_,{credentials:"same-origin"});return yield WebAssembly.instantiateStreaming(E,g)}catch(D){y(`wasm streaming compile failed: ${D}`),y("falling back to ArrayBuffer instantiation")}return function(D,M){return J(this,null,function*(){try{var A=yield function(B){return J(this,null,function*(){if(!Y)try{var q=yield f(B);return new Uint8Array(q)}catch{}if(B==us&&Y)B=new Uint8Array(Y);else{if(!p)throw"both async and sync fetching of the wasm failed";B=p(B)}return B})}(D);return yield WebAssembly.instantiate(A,M)}catch(B){y(`failed to asynchronously prepare wasm: ${B}`),bn(B)}})}(_,g)})}(d);return l(h.instance,h.module)}catch(g){return i(g),Promise.reject(g)}})})();var Zu=l=>(Zu=F.Cb)(l),Qu=()=>(Qu=F.Db)();n._OrtInit=(l,d)=>(n._OrtInit=F.Eb)(l,d),n._OrtGetLastError=(l,d)=>(n._OrtGetLastError=F.Fb)(l,d),n._OrtCreateSessionOptions=(l,d,h,g,_,E,D,M,A,B)=>(n._OrtCreateSessionOptions=F.Gb)(l,d,h,g,_,E,D,M,A,B),n._OrtAppendExecutionProvider=(l,d)=>(n._OrtAppendExecutionProvider=F.Hb)(l,d),n._OrtAddFreeDimensionOverride=(l,d,h)=>(n._OrtAddFreeDimensionOverride=F.Ib)(l,d,h),n._OrtAddSessionConfigEntry=(l,d,h)=>(n._OrtAddSessionConfigEntry=F.Jb)(l,d,h),n._OrtReleaseSessionOptions=l=>(n._OrtReleaseSessionOptions=F.Kb)(l),n._OrtCreateSession=(l,d,h)=>(n._OrtCreateSession=F.Lb)(l,d,h),n._OrtReleaseSession=l=>(n._OrtReleaseSession=F.Mb)(l),n._OrtGetInputOutputCount=(l,d,h)=>(n._OrtGetInputOutputCount=F.Nb)(l,d,h),n._OrtGetInputName=(l,d)=>(n._OrtGetInputName=F.Ob)(l,d),n._OrtGetOutputName=(l,d)=>(n._OrtGetOutputName=F.Pb)(l,d),n._OrtFree=l=>(n._OrtFree=F.Qb)(l),n._OrtCreateTensor=(l,d,h,g,_,E)=>(n._OrtCreateTensor=F.Rb)(l,d,h,g,_,E),n._OrtGetTensorData=(l,d,h,g,_)=>(n._OrtGetTensorData=F.Sb)(l,d,h,g,_),n._OrtReleaseTensor=l=>(n._OrtReleaseTensor=F.Tb)(l),n._OrtCreateRunOptions=(l,d,h,g)=>(n._OrtCreateRunOptions=F.Ub)(l,d,h,g),n._OrtAddRunConfigEntry=(l,d,h)=>(n._OrtAddRunConfigEntry=F.Vb)(l,d,h),n._OrtReleaseRunOptions=l=>(n._OrtReleaseRunOptions=F.Wb)(l),n._OrtCreateBinding=l=>(n._OrtCreateBinding=F.Xb)(l),n._OrtBindInput=(l,d,h)=>(n._OrtBindInput=F.Yb)(l,d,h),n._OrtBindOutput=(l,d,h,g)=>(n._OrtBindOutput=F.Zb)(l,d,h,g),n._OrtClearBoundOutputs=l=>(n._OrtClearBoundOutputs=F._b)(l),n._OrtReleaseBinding=l=>(n._OrtReleaseBinding=F.$b)(l),n._OrtRunWithBinding=(l,d,h,g,_)=>(n._OrtRunWithBinding=F.ac)(l,d,h,g,_),n._OrtRun=(l,d,h,g,_,E,D,M)=>(n._OrtRun=F.bc)(l,d,h,g,_,E,D,M),n._OrtEndProfiling=l=>(n._OrtEndProfiling=F.cc)(l),n._JsepOutput=(l,d,h)=>(n._JsepOutput=F.dc)(l,d,h),n._JsepGetNodeName=l=>(n._JsepGetNodeName=F.ec)(l);var Jr=()=>(Jr=F.fc)(),cn=n._free=l=>(cn=n._free=F.gc)(l),Xr=n._malloc=l=>(Xr=n._malloc=F.ic)(l),$s=(l,d,h,g,_,E)=>($s=F.kc)(l,d,h,g,_,E),Yu=()=>(Yu=F.lc)(),Ju=(l,d,h,g,_)=>(Ju=F.mc)(l,d,h,g,_),Xu=l=>(Xu=F.nc)(l),ks=l=>(ks=F.oc)(l),ec=(l,d)=>(ec=F.pc)(l,d),tc=()=>(tc=F.qc)(),he=(l,d)=>(he=F.rc)(l,d),Yi=l=>(Yi=F.sc)(l),nc=(l,d)=>(nc=F.tc)(l,d),le=l=>(le=F.uc)(l),Ms=l=>(Ms=F.vc)(l),de=()=>(de=F.wc)(),ic=l=>(ic=F.xc)(l),rc=l=>(rc=F.yc)(l),oc=(l,d,h)=>(oc=F.zc)(l,d,h),sc=l=>(sc=F.Ac)(l),ac=n.dynCall_iii=(l,d,h)=>(ac=n.dynCall_iii=F.Bc)(l,d,h),lc=n.dynCall_vi=(l,d)=>(lc=n.dynCall_vi=F.Cc)(l,d),As=n.dynCall_ii=(l,d)=>(As=n.dynCall_ii=F.Dc)(l,d),uc=n.dynCall_vii=(l,d,h)=>(uc=n.dynCall_vii=F.Ec)(l,d,h),cc=n.dynCall_iiii=(l,d,h,g)=>(cc=n.dynCall_iiii=F.Fc)(l,d,h,g),dc=n.dynCall_viii=(l,d,h,g)=>(dc=n.dynCall_viii=F.Gc)(l,d,h,g),fc=n.dynCall_iiiii=(l,d,h,g,_)=>(fc=n.dynCall_iiiii=F.Hc)(l,d,h,g,_),hc=n.dynCall_viiii=(l,d,h,g,_)=>(hc=n.dynCall_viiii=F.Ic)(l,d,h,g,_),pc=n.dynCall_viiiiii=(l,d,h,g,_,E,D)=>(pc=n.dynCall_viiiiii=F.Jc)(l,d,h,g,_,E,D),mc=n.dynCall_viiiiiii=(l,d,h,g,_,E,D,M)=>(mc=n.dynCall_viiiiiii=F.Kc)(l,d,h,g,_,E,D,M),gc=n.dynCall_ji=(l,d)=>(gc=n.dynCall_ji=F.Lc)(l,d),_c=n.dynCall_v=l=>(_c=n.dynCall_v=F.Mc)(l),vc=n.dynCall_viiiii=(l,d,h,g,_,E)=>(vc=n.dynCall_viiiii=F.Nc)(l,d,h,g,_,E),bc=n.dynCall_i=l=>(bc=n.dynCall_i=F.Oc)(l),yc=n.dynCall_fii=(l,d,h)=>(yc=n.dynCall_fii=F.Pc)(l,d,h),wc=n.dynCall_viiiiiiii=(l,d,h,g,_,E,D,M,A)=>(wc=n.dynCall_viiiiiiii=F.Qc)(l,d,h,g,_,E,D,M,A),xc=n.dynCall_viiiiiiiiii=(l,d,h,g,_,E,D,M,A,B,q)=>(xc=n.dynCall_viiiiiiiiii=F.Rc)(l,d,h,g,_,E,D,M,A,B,q),Cc=n.dynCall_jiii=(l,d,h,g)=>(Cc=n.dynCall_jiii=F.Sc)(l,d,h,g),Ec=n.dynCall_dii=(l,d,h)=>(Ec=n.dynCall_dii=F.Tc)(l,d,h),Ic=n.dynCall_viiiiiiiii=(l,d,h,g,_,E,D,M,A,B)=>(Ic=n.dynCall_viiiiiiiii=F.Uc)(l,d,h,g,_,E,D,M,A,B),Sc=n.dynCall_viiiiiiiiiii=(l,d,h,g,_,E,D,M,A,B,q,oe)=>(Sc=n.dynCall_viiiiiiiiiii=F.Vc)(l,d,h,g,_,E,D,M,A,B,q,oe),Dc=n.dynCall_iiiiii=(l,d,h,g,_,E)=>(Dc=n.dynCall_iiiiii=F.Wc)(l,d,h,g,_,E),Tc=n.dynCall_iij=(l,d,h)=>(Tc=n.dynCall_iij=F.Xc)(l,d,h),$c=n.dynCall_iiiiiiiiii=(l,d,h,g,_,E,D,M,A,B)=>($c=n.dynCall_iiiiiiiiii=F.Yc)(l,d,h,g,_,E,D,M,A,B),kc=n.dynCall_iiiiiiiiiii=(l,d,h,g,_,E,D,M,A,B,q)=>(kc=n.dynCall_iiiiiiiiiii=F.Zc)(l,d,h,g,_,E,D,M,A,B,q),Mc=n.dynCall_vij=(l,d,h)=>(Mc=n.dynCall_vij=F._c)(l,d,h),Ac=n.dynCall_iiif=(l,d,h,g)=>(Ac=n.dynCall_iiif=F.$c)(l,d,h,g),Rc=n.dynCall_iiij=(l,d,h,g)=>(Rc=n.dynCall_iiij=F.ad)(l,d,h,g),Oc=n.dynCall_fiii=(l,d,h,g)=>(Oc=n.dynCall_fiii=F.bd)(l,d,h,g),Nc=n.dynCall_viiiiiiiiiiiii=(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)=>(Nc=n.dynCall_viiiiiiiiiiiii=F.cd)(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe),Pc=n.dynCall_vjiii=(l,d,h,g,_)=>(Pc=n.dynCall_vjiii=F.dd)(l,d,h,g,_),Fc=n.dynCall_vif=(l,d,h)=>(Fc=n.dynCall_vif=F.ed)(l,d,h),zc=n.dynCall_iiiiiii=(l,d,h,g,_,E,D)=>(zc=n.dynCall_iiiiiii=F.fd)(l,d,h,g,_,E,D),Lc=n.dynCall_iiiij=(l,d,h,g,_)=>(Lc=n.dynCall_iiiij=F.gd)(l,d,h,g,_),Bc=n.dynCall_iiiiiiii=(l,d,h,g,_,E,D,M)=>(Bc=n.dynCall_iiiiiiii=F.hd)(l,d,h,g,_,E,D,M),jc=n.dynCall_viiiiiiiiiiii=(l,d,h,g,_,E,D,M,A,B,q,oe,pe)=>(jc=n.dynCall_viiiiiiiiiiii=F.id)(l,d,h,g,_,E,D,M,A,B,q,oe,pe),Vc=n.dynCall_diii=(l,d,h,g)=>(Vc=n.dynCall_diii=F.jd)(l,d,h,g),Uc=n.dynCall_jiiii=(l,d,h,g,_)=>(Uc=n.dynCall_jiiii=F.kd)(l,d,h,g,_),Hc=n.dynCall_viiij=(l,d,h,g,_)=>(Hc=n.dynCall_viiij=F.ld)(l,d,h,g,_),Wc=n.dynCall_fiiii=(l,d,h,g,_)=>(Wc=n.dynCall_fiiii=F.md)(l,d,h,g,_),qc=n.dynCall_viiif=(l,d,h,g,_)=>(qc=n.dynCall_viiif=F.nd)(l,d,h,g,_),Gc=n.dynCall_diiii=(l,d,h,g,_)=>(Gc=n.dynCall_diiii=F.od)(l,d,h,g,_),Kc=n.dynCall_viiid=(l,d,h,g,_)=>(Kc=n.dynCall_viiid=F.pd)(l,d,h,g,_),Zc=n.dynCall_iiiijii=(l,d,h,g,_,E,D)=>(Zc=n.dynCall_iiiijii=F.qd)(l,d,h,g,_,E,D),Qc=n.dynCall_iiiiiij=(l,d,h,g,_,E,D)=>(Qc=n.dynCall_iiiiiij=F.rd)(l,d,h,g,_,E,D),Yc=l=>(Yc=F.sd)(l),Jc=()=>(Jc=F.td)(),Xc=l=>(Xc=F.ud)(l),ed=()=>(ed=F.vd)();function Rv(l,d,h){var g=de();try{uc(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function Ov(l,d,h){var g=de();try{return ac(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function Nv(l,d){var h=de();try{lc(l,d)}catch(g){if(le(h),g!==g+0)throw g;he(1,0)}}function Pv(l,d){var h=de();try{return As(l,d)}catch(g){if(le(h),g!==g+0)throw g;he(1,0)}}function Fv(l,d,h,g){var _=de();try{return cc(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;he(1,0)}}function zv(l,d,h,g,_){var E=de();try{hc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function Lv(l,d,h,g,_){var E=de();try{return fc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function Bv(l,d,h,g){var _=de();try{dc(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;he(1,0)}}function jv(l,d,h,g,_,E,D){var M=de();try{return zc(l,d,h,g,_,E,D)}catch(A){if(le(M),A!==A+0)throw A;he(1,0)}}function Vv(l){var d=de();try{_c(l)}catch(h){if(le(d),h!==h+0)throw h;he(1,0)}}function Uv(l,d,h){var g=de();try{return Tc(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function Hv(l,d,h,g,_,E){var D=de();try{vc(l,d,h,g,_,E)}catch(M){if(le(D),M!==M+0)throw M;he(1,0)}}function Wv(l,d,h){var g=de();try{Mc(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function qv(l,d,h,g,_,E,D){var M=de();try{pc(l,d,h,g,_,E,D)}catch(A){if(le(M),A!==A+0)throw A;he(1,0)}}function Gv(l,d,h,g,_,E,D,M){var A=de();try{mc(l,d,h,g,_,E,D,M)}catch(B){if(le(A),B!==B+0)throw B;he(1,0)}}function Kv(l,d,h,g,_,E){var D=de();try{return Dc(l,d,h,g,_,E)}catch(M){if(le(D),M!==M+0)throw M;he(1,0)}}function Zv(l,d,h,g,_,E,D,M){var A=de();try{return Bc(l,d,h,g,_,E,D,M)}catch(B){if(le(A),B!==B+0)throw B;he(1,0)}}function Qv(l,d,h,g,_,E,D,M,A,B){var q=de();try{Ic(l,d,h,g,_,E,D,M,A,B)}catch(oe){if(le(q),oe!==oe+0)throw oe;he(1,0)}}function Yv(l,d,h,g,_,E,D,M,A){var B=de();try{wc(l,d,h,g,_,E,D,M,A)}catch(q){if(le(B),q!==q+0)throw q;he(1,0)}}function Jv(l){var d=de();try{return bc(l)}catch(h){if(le(d),h!==h+0)throw h;he(1,0)}}function Xv(l,d,h,g,_,E,D,M,A,B){var q=de();try{return $c(l,d,h,g,_,E,D,M,A,B)}catch(oe){if(le(q),oe!==oe+0)throw oe;he(1,0)}}function eb(l,d,h){var g=de();try{return yc(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function tb(l,d,h,g){var _=de();try{return Cc(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;return he(1,0),0n}}function nb(l,d,h){var g=de();try{return Ec(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function ib(l,d,h,g,_,E,D,M,A,B,q,oe){var pe=de();try{Sc(l,d,h,g,_,E,D,M,A,B,q,oe)}catch(Pe){if(le(pe),Pe!==Pe+0)throw Pe;he(1,0)}}function rb(l,d,h,g,_,E,D,M,A,B,q){var oe=de();try{xc(l,d,h,g,_,E,D,M,A,B,q)}catch(pe){if(le(oe),pe!==pe+0)throw pe;he(1,0)}}function ob(l,d,h,g,_,E,D,M,A,B,q){var oe=de();try{return kc(l,d,h,g,_,E,D,M,A,B,q)}catch(pe){if(le(oe),pe!==pe+0)throw pe;he(1,0)}}function sb(l,d,h,g){var _=de();try{return Ac(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;he(1,0)}}function ab(l,d,h,g){var _=de();try{return Rc(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;he(1,0)}}function lb(l,d,h,g){var _=de();try{return Oc(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;he(1,0)}}function ub(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe){var Qt=de();try{Nc(l,d,h,g,_,E,D,M,A,B,q,oe,pe,Pe)}catch(Ji){if(le(Qt),Ji!==Ji+0)throw Ji;he(1,0)}}function cb(l,d,h,g,_){var E=de();try{Pc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function db(l,d,h){var g=de();try{Fc(l,d,h)}catch(_){if(le(g),_!==_+0)throw _;he(1,0)}}function fb(l,d){var h=de();try{return gc(l,d)}catch(g){if(le(h),g!==g+0)throw g;return he(1,0),0n}}function hb(l,d,h,g,_){var E=de();try{return Lc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function pb(l,d,h,g,_,E,D,M,A,B,q,oe,pe){var Pe=de();try{jc(l,d,h,g,_,E,D,M,A,B,q,oe,pe)}catch(Qt){if(le(Pe),Qt!==Qt+0)throw Qt;he(1,0)}}function mb(l,d,h,g){var _=de();try{return Vc(l,d,h,g)}catch(E){if(le(_),E!==E+0)throw E;he(1,0)}}function gb(l,d,h,g,_){var E=de();try{return Uc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;return he(1,0),0n}}function _b(l,d,h,g,_){var E=de();try{Hc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function vb(l,d,h,g,_){var E=de();try{return Wc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function bb(l,d,h,g,_){var E=de();try{qc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function yb(l,d,h,g,_){var E=de();try{return Gc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function wb(l,d,h,g,_){var E=de();try{Kc(l,d,h,g,_)}catch(D){if(le(E),D!==D+0)throw D;he(1,0)}}function xb(l,d,h,g,_,E,D){var M=de();try{return Zc(l,d,h,g,_,E,D)}catch(A){if(le(M),A!==A+0)throw A;he(1,0)}}function Cb(l,d,h,g,_,E,D){var M=de();try{return Qc(l,d,h,g,_,E,D)}catch(A){if(le(M),A!==A+0)throw A;he(1,0)}}return n.stackSave=()=>de(),n.stackRestore=l=>le(l),n.stackAlloc=l=>Ms(l),n.setValue=function(l,d,h="i8"){switch(h.endsWith("*")&&(h="*"),h){case"i1":case"i8":X()[l>>>0]=d;break;case"i16":z()[l>>>1>>>0]=d;break;case"i32":R()[l>>>2>>>0]=d;break;case"i64":L[l>>>3]=BigInt(d);break;case"float":Ke()[l>>>2>>>0]=d;break;case"double":zt()[l>>>3>>>0]=d;break;case"*":se()[l>>>2>>>0]=d;break;default:bn(`invalid type for setValue: ${h}`)}},n.getValue=function(l,d="i8"){switch(d.endsWith("*")&&(d="*"),d){case"i1":case"i8":return X()[l>>>0];case"i16":return z()[l>>>1>>>0];case"i32":return R()[l>>>2>>>0];case"i64":return L[l>>>3];case"float":return Ke()[l>>>2>>>0];case"double":return zt()[l>>>3>>>0];case"*":return se()[l>>>2>>>0];default:bn(`invalid type for getValue: ${d}`)}},n.UTF8ToString=et,n.stringToUTF8=yi,n.lengthBytesUTF8=du,function l(){if(0<Gi)Ki=l;else if(a)t(n),Vr();else{for(;0<fs.length;)fs.shift()(n);0<Gi?Ki=l:(n.calledRun=!0,ve||(Vr(),t(n)))}}(),n.PTR_SIZE=4,r})}),rj=RC,sz=globalThis.self?.name?.startsWith("em-pthread"),sz&&RC()}),OC,az,$i,oj,Pg,lz,uz,NC,cz,PC,sj,FC,aj,LE=ce(()=>{"use strict";zE(),OC=typeof location>"u"?void 0:location.origin,az=()=>import.meta.url?.startsWith("file:")?new URL(new URL("ort.webgpu.bundle.min.mjs",import.meta.url).href,OC).href:import.meta.url,$i=az(),oj=()=>{if($i&&!$i.startsWith("blob:"))return $i.substring(0,$i.lastIndexOf("/")+1)},Pg=(e,t)=>{try{let i=t??$i;return(i?new URL(e,i):new URL(e)).origin===OC}catch{return!1}},lz=(e,t)=>{let i=t??$i;try{return(i?new URL(e,i):new URL(e)).href}catch{return}},uz=(e,t)=>`${t??"./"}${e}`,NC=e=>J(void 0,null,function*(){let t=yield(yield fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)}),cz=e=>J(void 0,null,function*(){return(yield import(e)).default}),PC=(PX(),Yg(tj)).default,sj=()=>J(void 0,null,function*(){if(!$i)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Pg($i))return[void 0,PC()];let e=yield NC($i);return[e,PC(e)]}),FC=(FX(),Yg(ij)).default,aj=(e,t,i)=>J(void 0,null,function*(){if(!e&&!t&&FC&&$i&&Pg($i))return[void 0,FC];{let n="ort-wasm-simd-threaded.jsep.mjs",r=e??lz(n,t),o=i&&r&&!Pg(r,t),s=o?yield NC(r):r??uz(n,t);return[o?s:void 0,yield cz(s)]}})}),zC,Fg,Af,LC,dz,fz,BE,Sn,Ma=ce(()=>{"use strict";LE(),Fg=!1,Af=!1,LC=!1,dz=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},fz=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},BE=e=>J(void 0,null,function*(){if(Fg)return Promise.resolve();if(Af)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(LC)throw new Error("previous call to 'initializeWebAssembly()' failed.");Af=!0;let t=e.initTimeout,i=e.numThreads;if(!fz())throw new Error("WebAssembly SIMD is not supported in the current environment.");let n=dz();i>1&&!n&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+i+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=i=1);let r=e.wasmPaths,o=typeof r=="string"?r:void 0,s=r?.mjs,a=s?.href??s,u=r?.wasm,c=u?.href??u,f=e.wasmBinary,[p,m]=yield aj(a,o,i>1),v=!1,b=[];if(t>0&&b.push(new Promise(w=>{setTimeout(()=>{v=!0,w()},t)})),b.push(new Promise((w,C)=>{let x={numThreads:i};if(f)x.wasmBinary=f;else if(c||o)x.locateFile=y=>c??o+y;else if(a&&a.indexOf("blob:")!==0)x.locateFile=y=>new URL(y,a).href;else if(p){let y=oj();y&&(x.locateFile=I=>y+I)}m(x).then(y=>{Af=!1,Fg=!0,zC=y,w(),p&&URL.revokeObjectURL(p)},y=>{Af=!1,LC=!0,C(y)})})),yield Promise.race(b),v)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)}),Sn=()=>{if(Fg&&zC)return zC;throw new Error("WebAssembly is not initialized yet.")}}),Vn,Xg,St,jE=ce(()=>{"use strict";Ma(),Vn=(e,t)=>{let i=Sn(),n=i.lengthBytesUTF8(e)+1,r=i._malloc(n);return i.stringToUTF8(e,r,n),t.push(r),r},Xg=(e,t,i,n)=>{if(typeof e=="object"&&e!==null){if(i.has(e))throw new Error("Circular reference in options");i.add(e)}Object.entries(e).forEach(([r,o])=>{let s=t?t+r:r;if(typeof o=="object")Xg(o,s+".",i,n);else if(typeof o=="string"||typeof o=="number")n(s,o.toString());else if(typeof o=="boolean")n(s,o?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof o}`)})},St=e=>{let t=Sn(),i=t.stackSave();try{let n=t.PTR_SIZE,r=t.stackAlloc(2*n);t._OrtGetLastError(r,r+n);let o=Number(t.getValue(r,n===4?"i32":"i64")),s=t.getValue(r+n,"*"),a=s?t.UTF8ToString(s):"";throw new Error(`${e} ERROR_CODE: ${o}, ERROR_MESSAGE: ${a}`)}finally{t.stackRestore(i)}}}),lj,zX=ce(()=>{"use strict";Ma(),jE(),lj=e=>{let t=Sn(),i=0,n=[],r=e||{};try{if(e?.logSeverityLevel===void 0)r.logSeverityLevel=2;else if(typeof e.logSeverityLevel!="number"||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${e.logSeverityLevel}`);if(e?.logVerbosityLevel===void 0)r.logVerbosityLevel=0;else if(typeof e.logVerbosityLevel!="number"||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);e?.terminate===void 0&&(r.terminate=!1);let o=0;return e?.tag!==void 0&&(o=Vn(e.tag,n)),i=t._OrtCreateRunOptions(r.logSeverityLevel,r.logVerbosityLevel,!!r.terminate,o),i===0&&St("Can't create run options."),e?.extra!==void 0&&Xg(e.extra,"",new WeakSet,(s,a)=>{let u=Vn(s,n),c=Vn(a,n);t._OrtAddRunConfigEntry(i,u,c)!==0&&St(`Can't set a run config entry: ${s} - ${a}.`)}),[i,n]}catch(o){throw i!==0&&t._OrtReleaseRunOptions(i),n.forEach(s=>t._free(s)),o}}}),hz,pz,mz,gz,uj,LX=ce(()=>{"use strict";Ma(),jE(),hz=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},pz=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},mz=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(i=>(typeof i=="string"?i:i.name)==="webgpu")&&(e.enableMemPattern=!1)},gz=(e,t,i)=>{for(let n of t){let r=typeof n=="string"?n:n.name;switch(r){case"webnn":if(r="WEBNN",typeof n!="string"){let s=n?.deviceType;if(s){let a=Vn("deviceType",i),u=Vn(s,i);Sn()._OrtAddSessionConfigEntry(e,a,u)!==0&&St(`Can't set a session config entry: 'deviceType' - ${s}.`)}}break;case"webgpu":if(r="JS",typeof n!="string"){let s=n;if(s?.preferredLayout){if(s.preferredLayout!=="NCHW"&&s.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${s.preferredLayout}`);let a=Vn("preferredLayout",i),u=Vn(s.preferredLayout,i);Sn()._OrtAddSessionConfigEntry(e,a,u)!==0&&St(`Can't set a session config entry: 'preferredLayout' - ${s.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${r}`)}let o=Vn(r,i);Sn()._OrtAppendExecutionProvider(e,o)!==0&&St(`Can't append execution provider: ${r}.`)}},uj=e=>{let t=Sn(),i=0,n=[],r=e||{};mz(r);try{let o=hz(r.graphOptimizationLevel??"all"),s=pz(r.executionMode??"sequential"),a=typeof r.logId=="string"?Vn(r.logId,n):0,u=r.logSeverityLevel??2;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log serverity level is not valid: ${u}`);let c=r.logVerbosityLevel??0;if(!Number.isInteger(c)||c<0||c>4)throw new Error(`log verbosity level is not valid: ${c}`);let f=typeof r.optimizedModelFilePath=="string"?Vn(r.optimizedModelFilePath,n):0;if(i=t._OrtCreateSessionOptions(o,!!r.enableCpuMemArena,!!r.enableMemPattern,s,!!r.enableProfiling,0,a,u,c,f),i===0&&St("Can't create session options."),r.executionProviders&&gz(i,r.executionProviders,n),r.enableGraphCapture!==void 0){if(typeof r.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${r.enableGraphCapture}`);let p=Vn("enableGraphCapture",n),m=Vn(r.enableGraphCapture.toString(),n);t._OrtAddSessionConfigEntry(i,p,m)!==0&&St(`Can't set a session config entry: 'enableGraphCapture' - ${r.enableGraphCapture}.`)}if(r.freeDimensionOverrides)for(let[p,m]of Object.entries(r.freeDimensionOverrides)){if(typeof p!="string")throw new Error(`free dimension override name must be a string: ${p}`);if(typeof m!="number"||!Number.isInteger(m)||m<0)throw new Error(`free dimension override value must be a non-negative integer: ${m}`);let v=Vn(p,n);t._OrtAddFreeDimensionOverride(i,v,m)!==0&&St(`Can't set a free dimension override: ${p} - ${m}.`)}return r.extra!==void 0&&Xg(r.extra,"",new WeakSet,(p,m)=>{let v=Vn(p,n),b=Vn(m,n);t._OrtAddSessionConfigEntry(i,v,b)!==0&&St(`Can't set a session config entry: ${p} - ${m}.`)}),[i,n]}catch(o){throw i!==0&&t._OrtReleaseSessionOptions(i)!==0&&St("Can't release session options."),n.forEach(s=>t._free(s)),o}}}),Hl,Sa,Da,VE,e_,UE,HE,xE,ze=ce(()=>{"use strict";Hl=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},Sa=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},Da=(e,t)=>{let i=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],n=typeof t=="number"?t:t.reduce((r,o)=>r*o,1);return i>0?Math.ceil(n*i):void 0},VE=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},e_=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},UE=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",HE=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint64"||e==="int8"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",xE=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),WE,cj=ce(()=>{"use strict";zE(),WE=e=>J(void 0,null,function*(){if(typeof e=="string")if(0)try{}catch(o){if(o.code==="ERR_FS_FILE_TOO_LARGE")try{for(var t=KY(a),i,n,r;i=!(n=yield t.next()).done;i=!1){let c=n.value;;}}catch(n){r=[n]}finally{try{i&&(n=t.return)&&(yield n.call(t))}finally{if(r)throw r[0]}}}else{let o=yield fetch(e);if(!o.ok)throw new Error(`failed to load external data file: ${e}`);let s=o.headers.get("Content-Length"),a=s?parseInt(s,10):0;if(a<1073741824)return new Uint8Array(yield o.arrayBuffer());{if(!o.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let u=o.body.getReader(),c;try{c=new ArrayBuffer(a)}catch(p){if(p instanceof RangeError){let m=Math.ceil(a/65536);c=new WebAssembly.Memory({initial:m,maximum:m}).buffer}else throw p}let f=0;for(;;){let{done:p,value:m}=yield u.read();if(p)break;let v=m.byteLength;new Uint8Array(c,f,v).set(m),f+=v}return new Uint8Array(c,0,a)}}else return e instanceof Blob?new Uint8Array(yield e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)})}),_z,vz,bz,yz,qE,wz,mt,xo=ce(()=>{"use strict";ze(),_z=["V","I","W","E","F"],vz=(e,t)=>{console.log(`[${_z[e]},${new Date().toISOString()}]${t}`)},qE=(e,t)=>{bz=e,yz=t},wz=(e,t)=>{let i=e_(e),n=e_(bz);i>=n&&vz(i,typeof t=="function"?t():t)},mt=(...e)=>{yz&&wz(...e)}}),GE,dj=ce(()=>{"use strict";ze(),GE=(e,t)=>new(VE(t))(e)}),KE=ce(()=>{"use strict"}),BC,zg,Lg,xz,Cz,jC,CE,Ez,fj,BX=ce(()=>{"use strict";xo(),KE(),BC=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),zg=[],Lg=e=>Math.ceil(Number(e)/16)*16,xz=e=>{for(let t=0;t<zg.length;t++){let i=zg[t];if(e<=i)return i}return Math.ceil(e/16)*16},Cz=1,jC=()=>Cz++,CE=(e,t,i,n)=>J(void 0,null,function*(){let r=Lg(i),o=e.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let s=e.getCommandEncoder();e.endComputePass(),s.copyBufferToBuffer(t,0,o,0,r),e.flush(),yield o.mapAsync(GPUMapMode.READ);let a=o.getMappedRange();if(n){let u=n();return u.set(new Uint8Array(a,0,i)),u}else return new Uint8Array(a.slice(0,i))}finally{o.destroy()}}),Ez=class{constructor(e){this.backend=e,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[t]of BC)zg.push(t),this.freeBuffers.set(t,[]),this.freeUniformBuffers.set(t,[]);this.sessionCount=0}upload(e,t){let i=t.buffer,n=t.byteOffset,r=t.byteLength,o=Lg(r),s=this.storageCache.get(e);if(!s)throw new Error("gpu data for uploading does not exist");if(Number(s.originalSize)!==r)throw new Error(`inconsistent data size. gpu data size=${s.originalSize}, data size=${r}`);let a=this.backend.device.createBuffer({mappedAtCreation:!0,size:o,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),u=a.getMappedRange();new Uint8Array(u).set(new Uint8Array(i,n,r)),a.unmap();let c=this.backend.device.createCommandEncoder();c.copyBufferToBuffer(a,0,s.gpuData.buffer,0,o),this.backend.device.queue.submit([c.finish()]),a.destroy(),mt("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${e})`)}memcpy(e,t){let i=this.storageCache.get(e);if(!i)throw new Error("source gpu data for memcpy does not exist");let n=this.storageCache.get(t);if(!n)throw new Error("destination gpu data for memcpy does not exist");if(i.originalSize!==n.originalSize)throw new Error("inconsistent source and destination gpu data size");let r=Lg(i.originalSize),o=this.backend.getCommandEncoder();this.backend.endComputePass(),o.copyBufferToBuffer(i.gpuData.buffer,0,n.gpuData.buffer,0,r)}registerExternalBuffer(e,t,i){let n;if(i){if(n=i[0],e===i[1])return mt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${n}, buffer is the same, skip.`),n;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else n=jC();return this.storageCache.set(n,{gpuData:{id:n,type:0,buffer:e},originalSize:t}),mt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${n}, registered.`),n}unregisterExternalBuffer(e){e!==void 0&&(this.storageCache.delete(e),mt("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${e}`))}create(e,t=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let i=xz(e),n,r=(t&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,o=(t&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(r||o){let a=(r?this.freeBuffers:this.freeUniformBuffers).get(i);a?a.length>0?n=a.pop():n=this.backend.device.createBuffer({size:i,usage:t}):n=this.backend.device.createBuffer({size:i,usage:t})}else n=this.backend.device.createBuffer({size:i,usage:t});let s={id:jC(),type:0,buffer:n};return this.storageCache.set(s.id,{gpuData:s,originalSize:Number(e)}),mt("verbose",()=>`[WebGPU] GpuDataManager.create(size=${e}) => id=${s.id}`),s}get(e){return this.storageCache.get(e)?.gpuData}release(e){let t=typeof e=="bigint"?Number(e):e,i=this.storageCache.get(t);if(!i){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return mt("verbose",()=>`[WebGPU] GpuDataManager.release(id=${t}), gpuDataId=${i.gpuData.id}`),this.storageCache.delete(t),this.buffersPending.push(i.gpuData.buffer),i.originalSize}download(e,t){return J(this,null,function*(){let i=this.storageCache.get(Number(e));if(!i)throw new Error("data does not exist");yield CE(this.backend,i.gpuData.buffer,i.originalSize,t)})}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let e of this.buffersPending){let t=BC.get(e.size);if((e.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let i=this.freeBuffers.get(e.size)||[];t===void 0||i.length>=t?e.destroy():i.push(e)}else if((e.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let i=this.freeUniformBuffers.get(e.size)||[];t===void 0||i.length>=t?e.destroy():i.push(e)}else e.destroy()}this.buffersPending=[]}else{let e=this.capturedPendingBuffers.get(this.backend.currentSessionId);e||(e=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,e));for(let t of this.buffersPending)e.push(t);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.freeUniformBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(e){let t=this.capturedPendingBuffers.get(e);t&&(t.forEach(i=>{i.destroy()}),this.capturedPendingBuffers.delete(e)),this.sessionCount-=1,this.sessionCount===0&&(mt("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(i=>{i.gpuData.buffer.destroy()}),this.storageCache=new Map)}},fj=(...e)=>new Ez(...e)}),Iz,kt,sn=ce(()=>{"use strict";Iz=class{constructor(e){Object.assign(this,e)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(e=>`${this[e]}`).join(";")),this.key}},kt=e=>new Iz(e)}),Sz,Gl,Q,t_,hj,pj,mj,He=ce(()=>{"use strict";Sz=class{static calcMatMulShape(e,t){return e[1]!==t[0]?void 0:[e[0],t[1]]}},Gl=class{static calcShape(e,t,i=!1){let n=e.length,r=t.length;if(n===0)return t;if(r===0)return e;let o=Math.max(e.length,t.length),s=new Array(o);if(i){if(n<2||r<2)return;let a=Sz.calcMatMulShape([e[n-2],e[n-1]],[t[r-2],t[r-1]]);if(a===void 0)return;[s[o-2],s[o-1]]=a}for(let a=i?3:1;a<=o;a++){let u=n-a<0?1:e[n-a],c=r-a<0?1:t[r-a];if(u!==c&&u>1&&c>1)return;let f=Math.max(u,c);if(u&&c)s[o-a]=Math.max(u,c);else{if(f>1)return;s[o-a]=0}}return s}static isValidBroadcast(e,t){let i=e.length,n=t.length;if(i>n)return!1;for(let r=1;r<=i;r++)if(e[i-r]!==1&&e[i-r]!==t[n-r])return!1;return!0}},Q=class Zg{static size(t){return Zg.getSizeFromDimensionRange(t,0,t.length)}static convertShape(t,i=4){let n=t.length;if(n===0)return[];let r=new Array(n),o=n-1;for(;o>=0;){if(t[o]%i===0){r[o]=t[o]/i;break}if(i%t[o]!==0)throw new Error("cannot convert shape");r[o]=1,i/=t[o],o--}for(o--;o>=0;o--)r[o]=t[o];return r}static sizeFromDimension(t,i){if(i<0||i>t.length)throw new Error(`invalid dimension of ${i} for sizeFromDimension as Tensor has ${t.length} dimensions.`);return Zg.getSizeFromDimensionRange(t,i,t.length)}static sizeToDimension(t,i){if(i<0||i>t.length)throw new Error(`invalid dimension of ${i} for sizeToDimension as Tensor has ${t.length} dimensions.`);return Zg.getSizeFromDimensionRange(t,0,i)}static getSizeFromDimensionRange(t,i,n){let r=1;for(let o=i;o<n;o++){if(t[o]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");r*=Number(t[o])}return r}static computeStrides(t){let i=t.length;if(i===0)return[];if(i===1)return[1];let n=new Array(i);n[i-1]=1,n[i-2]=t[i-1];for(let r=i-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}static normalizeAxis(t,i){if(t<-i&&t>=i)throw new Error("unsupported axis for this operation.");return t<0?t+i:t}static normalizeAxes(t,i){return t.map(n=>this.normalizeAxis(n,i??t.length))}static sortBasedOnPerm(t,i){return i?i.map(n=>t[n]):t.slice().reverse()}static padShape(t,i){let n=t.length;return t.map((r,o)=>r+i[o]+i[o+n])}static areEqual(t,i){return t.length!==i.length?!1:t.every((n,r)=>n===i[r])}},t_=class jf{static adjustPoolAttributes(t,i,n,r,o,s){if(!t&&n.length!==i.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(t)for(let a=0;a<i.length-2;a++)a>=n.length?n.push(i[a+2]):n[a]=i[a+2];for(let a=0;a<n.length;a++)if(a<r.length){if(r[a]<0)throw new Error("strides should be greater than or equal to 1")}else r.push(1);for(let a=0;a<n.length;a++)if(a<o.length){if(o[a]<0)throw new Error("dilations should be greater than or equal to 1")}else o.push(1);for(let a=0;a<n.length*2;a++)if(a<s.length){if(s[a]<0)throw new Error("pad should be greater than or equal to 1")}else s.push(0);for(let a=0;a<n.length;a++){if(n[a]<=0)throw new Error("kernel shapes need to be greater than 0");if(s[a]>=n[a]||s[a+n.length]>=n[a])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(t,i,n,r,o,s,a){if(a){if(o.length!==2*(t.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(i.length!==t.length-2)throw new Error("length of strides should be the length of data dimensions");if(r.length!==t.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let u=0;u<t.length-2;u++)jf.adjustPadAndReturnShape(t[u+(s?1:2)],i[u],n[u],r[u],o,u,u+t.length-2,a)}}static computePoolOutputShape(t,i,n,r,o,s,a){if(i.length<=0)throw new Error("input shape must be of size greater than 0");let u=[i[0],i[1]];return jf.computeShapeHelper(t,i,u,n,r,o,s,a),u}static computeConvOutputShape(t,i,n,r,o,s,a){if(t.length<=0||i.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let u=[t[0],i[0]];return jf.computeShapeHelper(!1,t,u,n,r,o,s,a),u}static computeShapeHelper(t,i,n,r,o,s,a,u){if(t)for(let c=0;c<i.length-2;c++)n.push(1);else for(let c=0;c<i.length-2;c++)n.push(jf.adjustPadAndReturnShape(i[c+2],r[c],o[c],s[c],a,c,c+i.length-2,u))}static adjustPadAndReturnShape(t,i,n,r,o,s,a,u){let c=n*(r-1)+1;if(u&&u!=="NOTSET")switch(u){case"VALID":return o[s]=0,o[a]=0,Math.floor((t-c)/i+1);case"SAME_LOWER":case"SAME_UPPER":if(n!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let f=((t+i-1)/i-1)*i+r-t;return o[s]=Math.floor(u==="SAME_LOWER"?(f+1)/2:f/2),o[a]=f-o[s],Math.floor((t+f-r)/i+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((t+o[s]+o[a]-c)/i+1)}},hj=class{static getShapeOfGemmResult(e,t,i,n,r){if(e.length!==2||i.length!==2)throw new Error("shape need to be of size 2");let o,s,a;t?(o=e[1],s=e[0]):(o=e[0],s=e[1]);let u=-1;if(n?(a=i[0],u=1):(a=i[1],u=0),i[u]!==s)throw new Error("dimension mismatch");if(o<=0||a<=0||s<=0)throw new Error("invalid shape specified");if(r&&!Gl.isValidBroadcast(r,[o,a]))throw new Error("gemm: invalid bias shape for broadcast");return[o,a,s]}},pj=-34028234663852886e22,mj=34028234663852886e22}),Kl,Bg,Dn,Jn,$e,tn,EE,ql,as,De,Rf,te,Ie,gj,ZE,Dz,_j,Ye=ce(()=>{"use strict";ze(),He(),Kl=64,Bg=(e,t)=>{if(t===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(e)){case 10:return t>1?`vec${t}<f16>`:"f16";case 1:return t>1?`vec${t}<f32>`:"f32";case 6:return t>1?`vec${t}<i32>`:"i32";case 12:return t>1?`vec${t}<u32>`:"u32";case 7:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(t!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${e}`)}},Dn=(e,t=1)=>{let i=Bg(e,t);return typeof i=="string"?i:i[0]},Jn=(e,t=1)=>{let i=Bg(e,t);return typeof i=="string"?i:i[1]},$e=(...e)=>{let t=[];return e.forEach(i=>{i.length!==0&&t.push({type:12,data:i},{type:12,data:Q.computeStrides(i)})}),t},tn=e=>e%4===0?4:e%2===0?2:1,EE=(e="f32",t,i="0")=>!t||t===1?`${e}(${i})`:`vec${t}<${e}>(${i})`,ql=(e,t,i)=>e==="f32"?i:t===1?`f32(${i})`:`vec${t}<f32>(${i})`,as=(e,t)=>t===4?`(${e}.x + ${e}.y + ${e}.z + ${e}.w)`:t===2?`(${e}.x + ${e}.y)`:t===3?`(${e}.x + ${e}.y + ${e}.z)`:e,De=(e,t,i,n)=>e.startsWith("uniforms.")&&i>4?typeof t=="string"?n==="f16"?`${e}[(${t}) / 8][(${t}) % 8 / 4][(${t}) % 8 % 4]`:`${e}[(${t}) / 4][(${t}) % 4]`:n==="f16"?`${e}[${Math.floor(t/8)}][${Math.floor(t%8/4)}][${t%8%4}]`:`${e}[${Math.floor(t/4)}][${t%4}]`:i>1?`${e}[${t}]`:e,Rf=(e,t,i,n,r)=>{let o=typeof i=="number",s=o?i:i.length,a=[...new Array(s).keys()],u=s<2?"u32":s<=4?`vec${s}<u32>`:`array<u32, ${s}>`,c=Bg(t,r),f=typeof c=="string"?c:c[1],p=typeof c=="string"?c:c[0],m={indices:u,value:f,storage:p,tensor:t},v=z=>typeof z=="string"?z:`${z}u`,b={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},w=o?"uniforms.":"",C=`${w}${e}_shape`,x=`${w}${e}_strides`,y="";for(let z=0;z<s-1;z++)y+=`
    let dim${z} = current / ${De(x,z,s)};
    let rest${z} = current % ${De(x,z,s)};
    indices[${z}] = dim${z};
    current = rest${z};
    `;y+=`indices[${s-1}] = current;`;let I=s<2?"":`
  fn o2i_${e}(offset: u32) -> ${m.indices} {
    var indices: ${m.indices};
    var current = offset;
    ${y}
    return indices;
  }`,S=z=>(b.offsetToIndices=!0,s<2?z:`o2i_${e}(${z})`),T=[];if(s>=2)for(let z=s-1;z>=0;z--)T.push(`${De(x,z,s)} * (indices[${z}])`);let $=s<2?"":`
  fn i2o_${e}(indices: ${m.indices}) -> u32 {
    return ${T.join("+")};
  }`,k=z=>(b.indicesToOffset=!0,s<2?z:`i2o_${e}(${z})`),P=(...z)=>s===0?"0u":`${m.indices}(${z.map(v).join(",")})`,j=(z,W)=>s<2?`${z}`:`${De(z,W,s)}`,H=(z,W,R)=>s<2?`${z}=${R};`:`${De(z,W,s)}=${R};`,re={},ae=(z,W)=>{b.broadcastedIndicesToOffset=!0;let R=`${W.name}broadcastedIndicesTo${e}Offset`;if(R in re)return`${R}(${z})`;let se=[];for(let Ke=s-1;Ke>=0;Ke--){let zt=W.indicesGet("outputIndices",Ke+W.rank-s);se.push(`${j(x,Ke)} * (${zt} % ${j(C,Ke)})`)}return re[R]=`fn ${R}(outputIndices: ${W.type.indices}) -> u32 {
             return ${se.length>0?se.join("+"):"0u"};
           }`,`${R}(${z})`},L=(z,W)=>(()=>{if(m.storage===m.value)return`${e}[${z}]=${W};`;if(m.storage==="vec2<u32>"&&m.value==="i32")return`${e}[${z}]=vec2<u32>(u32(${W}), select(0u, 0xFFFFFFFFu, ${W} < 0));`;if(m.storage==="vec2<u32>"&&m.value==="u32")return`${e}[${z}]=vec2<u32>(u32(${W}), 0u);`;if(m.storage==="u32"&&m.value==="vec4<bool>")return`${e}[${z}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${W}));`;throw new Error(`not supported combination of storage type ${m.storage} and value type ${m.value} yet`)})(),ge=z=>(()=>{if(m.storage===m.value)return`${e}[${z}]`;if(m.storage==="vec2<u32>"&&m.value==="i32")return`i32(${e}[${z}].x)`;if(m.storage==="vec2<u32>"&&m.value==="u32")return`u32(${e}[${z}].x)`;if(m.storage==="u32"&&m.value==="vec4<bool>")return`vec4<bool>(bool(${e}[${z}] & 0xFFu), bool(${e}[${z}] & 0xFF00u), bool(${e}[${z}] & 0xFF0000u), bool(${e}[${z}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${m.storage} and value type ${m.value} yet`)})(),ye=s<2?"":`
  fn get_${e}ByIndices(indices: ${m.indices}) -> ${f} {
    return ${ge(`i2o_${e}(indices)`)};
  }`,Y=s<2?"":(()=>{let z=a.map(R=>`d${R}: u32`).join(", "),W=a.map(R=>`d${R}`).join(", ");return`
  fn get_${e}(${z}) -> ${f} {
    return get_${e}ByIndices(${P(W)});
  }`})(),ve=(...z)=>{if(z.length!==s)throw new Error(`indices length must be ${s}`);let W=z.map(v).join(",");return s===0?ge("0u"):s===1?ge(W[0]):(b.get=!0,b.getByIndices=!0,b.indicesToOffset=!0,`get_${e}(${W})`)},we=z=>s<2?ge(z):(b.getByIndices=!0,b.indicesToOffset=!0,`get_${e}ByIndices(${z})`),X=s<2?"":`
  fn set_${e}ByIndices(indices: ${m.indices}, value: ${f}) {
    ${L(`i2o_${e}(indices)`,"value")}
  }`,xe=s<2?"":(()=>{let z=a.map(R=>`d${R}: u32`).join(", "),W=a.map(R=>`d${R}`).join(", ");return`
  fn set_${e}(${z}, value: ${f}) {
    set_${e}ByIndices(${P(W)}, value);
  }`})();return{impl:()=>{let z=[],W=!1;return b.offsetToIndices&&(z.push(I),W=!0),b.indicesToOffset&&(z.push($),W=!0),b.broadcastedIndicesToOffset&&(Object.values(re).forEach(R=>z.push(R)),W=!0),b.set&&(z.push(xe),W=!0),b.setByIndices&&(z.push(X),W=!0),b.get&&(z.push(Y),W=!0),b.getByIndices&&(z.push(ye),W=!0),!o&&W&&z.unshift(`const ${C} = ${m.indices}(${i.join(",")});`,`const ${x} = ${m.indices}(${Q.computeStrides(i).join(",")});`),z.join(`
`)},type:m,offsetToIndices:S,indicesToOffset:k,broadcastedIndicesToOffset:ae,indices:P,indicesGet:j,indicesSet:H,set:(...z)=>{if(z.length!==s+1)throw new Error(`indices length must be ${s}`);let W=z[s];if(typeof W!="string")throw new Error("value must be string");let R=z.slice(0,s).map(v).join(",");return s===0?L("0u",W):s===1?L(R[0],W):(b.set=!0,b.setByIndices=!0,b.indicesToOffset=!0,`set_${e}(${R}, ${W})`)},setByOffset:L,setByIndices:(z,W)=>s<2?L(z,W):(b.setByIndices=!0,b.indicesToOffset=!0,`set_${e}ByIndices(${z}, ${W});`),get:ve,getByOffset:ge,getByIndices:we,usage:n,name:e,strides:x,shape:C,rank:s}},te=(e,t,i,n=1)=>Rf(e,t,i,"input",n),Ie=(e,t,i,n=1)=>Rf(e,t,i,"output",n),gj=(e,t,i)=>Rf(e,t,i,"atomicOutput",1),ZE=(e,t,i,n=1)=>Rf(e,t,i,"internal",n),Dz=class{constructor(e,t){this.normalizedDispatchGroup=e,this.limits=t,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(e){return`if (global_idx >= ${typeof e=="number"?`${e}u`:e}) { return; }`}mainStart(e=Kl){let t=typeof e=="number"?e:e[0],i=typeof e=="number"?1:e[1],n=typeof e=="number"?1:e[2];if(t>this.limits.maxComputeWorkgroupSizeX||i>this.limits.maxComputeWorkgroupSizeY||n>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${t}, ${i}, ${n}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(t*i*n>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${t}, ${i}, ${n}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let r=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,o=r?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,s=r?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${t*i*n}u + local_idx;`;return`@compute @workgroup_size(${t}, ${i}, ${n})
  fn main(${o}) {
    ${s}
  `}appendVariableUniforms(e){e.rank!==0&&(e.shape.startsWith("uniforms.")&&this.uniforms.push({name:e.shape.replace("uniforms.",""),type:"u32",length:e.rank}),e.strides.startsWith("uniforms.")&&this.uniforms.push({name:e.strides.replace("uniforms.",""),type:"u32",length:e.rank}))}declareVariable(e,t){if(e.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(e),this.appendVariableUniforms(e);let i=e.usage==="input"?"read":"read_write",n=e.usage==="atomicOutput"?"atomic<i32>":e.type.storage;return`@group(0) @binding(${t}) var<storage, ${i}> ${e.name}: array<${n}>;`}declareVariables(...e){return e.map(t=>this.declareVariable(t,this.variableIndex++)).join(`
`)}registerInternalVariable(e){if(e.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(e),this.appendVariableUniforms(e)}registerInternalVariables(...e){return e.forEach(t=>this.registerInternalVariable(t)),this}registerUniform(e,t,i=1){return this.uniforms.push({name:e,type:t,length:i}),this}registerUniforms(e){return this.uniforms=this.uniforms.concat(e),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let e=[];for(let{name:t,type:i,length:n}of this.uniforms)if(n&&n>4)i==="f16"?e.push(`@align(16) ${t}:array<mat2x4<${i}>, ${Math.ceil(n/8)}>`):e.push(`${t}:array<vec4<${i}>, ${Math.ceil(n/4)}>`);else{let r=n==null||n===1?i:`vec${n}<${i}>`;e.push(`${t}:${r}`)}return`
      struct Uniforms { ${e.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(e=>e.impl()).join(`
`)+this.internalVariables.map(e=>e.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let e=t=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(t)];return this.uniforms.map(t=>[e(t.type),t.length??1])}},_j=(e,t)=>new Dz(e,t)}),Tz,VC,$z,kz,Mz,Az,Mi,vj,bj,ls=ce(()=>{"use strict";ze(),He(),sn(),Ye(),Tz=(e,t)=>{if(!e||e.length!==1)throw new Error("Transpose requires 1 input.");if(t.length!==0&&t.length!==e[0].dims.length)throw new Error(`perm size ${t.length} does not match input rank ${e[0].dims.length}`)},VC=(e,t)=>t.length!==0?t:[...new Array(e).keys()].reverse(),$z=(e,t)=>Q.sortBasedOnPerm(e,VC(e.length,t)),kz=(e,t,i,n)=>{let r=`fn perm(i: ${n.type.indices}) -> ${i.type.indices} {
    var a: ${i.type.indices};`;for(let o=0;o<t;++o)r+=`a[${e[o]}]=i[${o}];`;return r+="return a;}"},Mz=(e,t)=>{let i=[],n=[];for(let r=0;r<e.length;++r)e[r]!==1&&i.push(e[r]),e[t[r]]!==1&&n.push(t[r]);return{newShape:i,newPerm:n}},Az=(e,t)=>{let i=0;for(let n=0;n<e.length;++n)if(t[e[n]]!==1){if(e[n]<i)return!1;i=e[n]}return!0},Mi=(e,t)=>{let i=e.dataType,n=e.dims.length,r=VC(n,t),o=$z(e.dims,r),s=e.dims,a=o,u=n<2||Az(r,e.dims),c;if(u)return c=b=>{let w=te("input",i,s,4),C=Ie("output",i,a,4);return`
  ${b.registerUniform("output_size","u32").declareVariables(w,C)}
  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let b=Q.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(b/64/4)},programUniforms:[{type:12,data:Math.ceil(b/4)}]}},getShaderSource:c};let{newShape:f,newPerm:p}=Mz(e.dims,r),m=Q.areEqual(p,[2,3,1]),v=Q.areEqual(p,[3,1,2]);if(f.length===2||m||v){s=m?[f[0],f[1]*f[2]]:v?[f[0]*f[1],f[2]]:f,a=[s[1],s[0]];let b=16;return c=w=>{let C=te("a",i,s.length),x=Ie("output",i,a.length);return`
  ${w.registerUniform("output_size","u32").declareVariables(C,x)}
  var<workgroup> tile : array<array<${x.type.value}, ${b+1}>, ${b}>;
  ${w.mainStart([b,b,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${b} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${b}u + local_id.x;
    let input_row = workgroup_id_x * ${b}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${C.getByIndices(`${C.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${b}u + local_id.x;
    let output_row = workgroup_id_y * ${b}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${x.setByIndices(`${x.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let w=Q.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(a[1]/b),y:Math.ceil(a[0]/b)},programUniforms:[{type:12,data:w},...$e(s,a)]}},getShaderSource:c}}return c=b=>{let w=te("a",i,s.length),C=Ie("output",i,a.length);return`
  ${b.registerUniform("output_size","u32").declareVariables(w,C)}

  ${kz(r,n,w,C)}

  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${C.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${C.setByOffset("global_idx",w.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${t}`,inputDependencies:["rank"]},getRunData:()=>{let b=Q.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:[{type:12,data:b},...$e(s,a)]}},getShaderSource:c}},vj=(e,t)=>{Tz(e.inputs,t.perm),e.compute(Mi(e.inputs[0],t.perm))},bj=e=>kt({perm:e.perm})}),Rz,Oz,Nz,Pz,Fz,zz,Lz,Bz,jz,Vz,_r,yj,wj,xj,Cj,Ej,Ij,Sj,Dj,Tj,$j,jX=ce(()=>{"use strict";ze(),He(),Ye(),QE(),ls(),Rz={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},Oz={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},Nz={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Pz={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},Fz=(e,t)=>{let i=[];for(let n=t-e;n<t;++n)i.push(n);return i},zz=(e,t)=>{let i=[],n=e.length;for(let o=0;o<n;o++)t.indexOf(o)===-1&&i.push(e[o]);let r=t.map(o=>e[o]);return[i,r]},Lz=(e,t)=>{let i=e.length+t.length,n=[],r=0;for(let o=0;o<i;o++)t.indexOf(o)===-1?n.push(e[r++]):n.push(1);return n},Bz=(e,t)=>{for(let i=0;i<e.length;++i)if(e[e.length-i-1]!==t-1-i)return!1;return!0},jz=(e,t)=>{let i=[];if(!Bz(e,t)){for(let n=0;n<t;++n)e.indexOf(n)===-1&&i.push(n);e.forEach(n=>i.push(n))}return i},Vz=(e,t,i,n,r,o,s)=>{let a=i[0].dims,u=Q.size(o),c=Q.size(s),f=te("_A",i[0].dataType,a),p=Ie("output",r,o),m=64;u===1&&(m=256);let v=`
          var<workgroup> aBestValues : array<f32, ${m}>;
       `,b=w=>`
        ${w.registerUniform("reduceSize","u32").declareVariables(f,p)}
        ${v}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${w.mainStart(m)}

          let outputIndex = global_idx / ${m};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${Nz[n]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${m}) {
           let candidate = f32(${f.getByOffset("offset + k")});
           bestValue = ${Rz[n]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${m}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${Oz[n]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${p.setByOffset("outputIndex",`${n==="mean"?`${p.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${p.type.storage}(${Pz[n]})`}`)};
         }
        }`;return{name:e,shaderCache:{hint:`${t};${m}`,inputDependencies:["type"]},getShaderSource:b,getRunData:()=>({outputs:[{dims:o,dataType:r}],dispatchGroup:{x:u},programUniforms:[{type:12,data:c}]})}},_r=(e,t,i,n)=>{let r=e.inputs.length===1?i:IE(e.inputs,i),o=r.axes;o.length===0&&!r.noopWithEmptyAxes&&(o=e.inputs[0].dims.map((v,b)=>b));let s=Q.normalizeAxes(o,e.inputs[0].dims.length),a=s,u=e.inputs[0],c=jz(a,e.inputs[0].dims.length);c.length>0&&(u=e.compute(Mi(e.inputs[0],c),{inputs:[0],outputs:[-1]})[0],a=Fz(a.length,u.dims.length));let[f,p]=zz(u.dims,a),m=f;r.keepDims&&(m=Lz(f,s)),e.compute(Vz(t,r.cacheKey,[u],n,e.inputs[0].dataType,m,p),{inputs:[u]})},yj=(e,t)=>{_r(e,"ReduceMeanShared",t,"mean")},wj=(e,t)=>{_r(e,"ReduceL1Shared",t,"l1")},xj=(e,t)=>{_r(e,"ReduceL2Shared",t,"l2")},Cj=(e,t)=>{_r(e,"ReduceLogSumExpShared",t,"logSumExp")},Ej=(e,t)=>{_r(e,"ReduceMaxShared",t,"max")},Ij=(e,t)=>{_r(e,"ReduceMinShared",t,"min")},Sj=(e,t)=>{_r(e,"ReduceProdShared",t,"prod")},Dj=(e,t)=>{_r(e,"ReduceSumShared",t,"sum")},Tj=(e,t)=>{_r(e,"ReduceSumSquareShared",t,"sumSquare")},$j=(e,t)=>{_r(e,"ReduceLogSumShared",t,"logSum")}}),vr,Uz,n_,IE,br,Hz,Wz,qz,Gz,Kz,Zz,Qz,Yz,Jz,Xz,yr,kj,Mj,Aj,Rj,Oj,Nj,Pj,Fj,zj,Lj,QE=ce(()=>{"use strict";ze(),He(),sn(),Ye(),jX(),vr=e=>{if(!e||e.length===0||e.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(e.length===2&&e[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Uz=e=>["","",`var value = ${e.getByIndices("input_indices")};`,""],n_=(e,t,i,n,r,o,s=!1,a=!1)=>{let u=[],c=i[0].dims,f=c.length,p=Q.normalizeAxes(r,f),m=!a&&p.length===0;c.forEach((w,C)=>{m||p.indexOf(C)>=0?s&&u.push(1):u.push(w)});let v=u.length,b=Q.size(u);return{name:e,shaderCache:t,getShaderSource:w=>{let C=[],x=te("_A",i[0].dataType,f),y=Ie("output",o,v),I=n(x,y,p),S=I[2];for(let T=0,$=0;T<f;T++)m||p.indexOf(T)>=0?(s&&$++,S=`for(var j${T}: u32 = 0; j${T} < ${c[T]}; j${T}++) {
                  ${I[2].includes("last_index")?`let last_index = j${T};`:""}
                  ${x.indicesSet("input_indices",T,`j${T}`)}
                  ${S}
                }`):(C.push(`${x.indicesSet("input_indices",T,y.indicesGet("output_indices",$))};`),$++);return`

        ${w.registerUniform("output_size","u32").declareVariables(x,y)}

        ${w.mainStart()}
          ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${x.type.indices};
          let output_indices = ${y.offsetToIndices("global_idx")};

          ${C.join(`
`)}
          ${I[0]}       // init ops for reduce max/min
          ${I[1]}
          ${S}
          ${I[3]}
          ${I.length===4?y.setByOffset("global_idx","value"):I.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:u,dataType:o}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:[{type:12,data:b},...$e(c,u)]})}},IE=(e,t)=>{let i=[];return e[1].dims[0]>0&&e[1].getBigInt64Array().forEach(n=>i.push(Number(n))),kt({axes:i,keepDims:t.keepDims,noopWithEmptyAxes:t.noopWithEmptyAxes})},br=(e,t,i,n)=>{let r=e.inputs,o=r.length===1?i:IE(r,i);e.compute(n_(t,{hint:o.cacheKey,inputDependencies:["rank"]},[r[0]],o.noopWithEmptyAxes&&o.axes.length===0?Uz:n,o.axes,r[0].dataType,o.keepDims,o.noopWithEmptyAxes),{inputs:[0]})},Hz=(e,t)=>{vr(e.inputs),br(e,"ReduceLogSum",t,(i,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${i.getByIndices("input_indices")};`,"value = log(value);"])},Wz=(e,t)=>{vr(e.inputs),br(e,"ReduceL1",t,(i,n)=>[`var value = ${n.type.storage}(0);`,"",`value += abs(${i.getByIndices("input_indices")});`,""])},qz=(e,t)=>{vr(e.inputs),br(e,"ReduceL2",t,(i,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${i.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},Gz=(e,t)=>{vr(e.inputs),br(e,"ReduceLogSumExp",t,(i,n)=>[`var value = ${n.type.storage}(0);`,"",`value += exp(${i.getByIndices("input_indices")});`,"value = log(value);"])},Kz=(e,t)=>{vr(e.inputs),br(e,"ReduceMax",t,(i,n,r)=>{let o=[];for(let s=0;s<i.rank;s++)(r.indexOf(s)>=0||r.length===0)&&o.push(i.indicesSet("input_indices",s,0));return[`${o.join(`
`)}`,`var value = ${i.getByIndices("input_indices")};`,`value = max(value, ${i.getByIndices("input_indices")});`,""]})},Zz=(e,t)=>{vr(e.inputs),br(e,"ReduceMean",t,(i,n,r)=>{let o=1;for(let s=0;s<i.rank;s++)(r.indexOf(s)>=0||r.length===0)&&(o*=e.inputs[0].dims[s]);return["var sum = f32(0);","",`sum += f32(${i.getByIndices("input_indices")});`,`let value = ${n.type.value}(sum / ${o});`]})},Qz=(e,t)=>{vr(e.inputs),br(e,"ReduceMin",t,(i,n,r)=>{let o=[];for(let s=0;s<i.rank;s++)(r.indexOf(s)>=0||r.length===0)&&o.push(`input_indices[${s}] = 0;`);return[`${o.join(`
`)}`,`var value = ${i.getByIndices("input_indices")};`,`value = min(value, ${i.getByIndices("input_indices")});`,""]})},Yz=(e,t)=>{vr(e.inputs),br(e,"ReduceProd",t,(i,n)=>[`var value = ${n.type.storage}(1);`,"",`value *= ${i.getByIndices("input_indices")};`,""])},Jz=(e,t)=>{vr(e.inputs),br(e,"ReduceSum",t,(i,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${i.getByIndices("input_indices")};`,""])},Xz=(e,t)=>{vr(e.inputs),br(e,"ReduceSumSquare",t,(i,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${i.getByIndices("input_indices")}; value += t * t;`,""])},yr=(e,t,i)=>{if(t.length===0)return i;let n=1,r=1;for(let o=0;o<t.length;o++)t.indexOf(o)===-1?n*=e[o]:r*=e[o];return r<32&&n>1024},kj=(e,t)=>{yr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Zz(e,t):yj(e,t)},Mj=(e,t)=>{yr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Wz(e,t):wj(e,t)},Aj=(e,t)=>{yr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?qz(e,t):xj(e,t)},Rj=(e,t)=>{yr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Gz(e,t):Cj(e,t)},Oj=(e,t)=>{yr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Kz(e,t):Ej(e,t)},Nj=(e,t)=>{yr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Qz(e,t):Ij(e,t)},Pj=(e,t)=>{yr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Yz(e,t):Sj(e,t)},Fj=(e,t)=>{yr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Jz(e,t):Dj(e,t)},zj=(e,t)=>{yr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Xz(e,t):Tj(e,t)},Lj=(e,t)=>{yr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Hz(e,t):$j(e,t)}}),UC,Bj,jj,SE,VX=ce(()=>{"use strict";ze(),sn(),QE(),UC=e=>{if(!e||e.length===0||e.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(e[0].dataType!==1)throw new Error("Invalid input type.")},Bj=(e,t)=>{UC(e.inputs);let i=(n,r,o)=>{let s=[];for(let a=0;a<n.rank;a++)(o.indexOf(a)>=0||o.length===0)&&s.push(`input_indices[${a}] = 0;`);return[`${s.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${t.selectLastIndex>0?"<=":"<"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",r.setByOffset("global_idx","best_index")]};e.compute(n_("ArgMin",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],i,[t.axis],7,t.keepDims),{inputs:[0]})},jj=(e,t)=>{UC(e.inputs);let i=(n,r,o)=>{let s=[];for(let a=0;a<n.rank;a++)(o.indexOf(a)>=0||o.length===0)&&s.push(`input_indices[${a}] = 0;`);return[`${s.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${t.selectLastIndex>0?">=":">"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",r.setByOffset("global_idx","best_index")]};e.compute(n_("argMax",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],i,[t.axis],7,t.keepDims),{inputs:[0]})},SE=e=>kt(e)}),eL,jg,tL,nL,iL,Wf,rL,Vj,YE=ce(()=>{"use strict";ze(),He(),KE(),Ye(),eL=(e,t)=>{let i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5];if(s&&a)throw new Error("Attention cannot have both past and attention_bias");if(i.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let u=i.dims[0],c=i.dims[1],f=i.dims[2];if(r.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(n.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(n.dims[0]!==f)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(r.dims[0]!==n.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let p=r.dims[0]/3,m=p,v=m;if(t.qkvHiddenSizes.length>0){if(t.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let I of t.qkvHiddenSizes)if(I%t.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");p=t.qkvHiddenSizes[0],m=t.qkvHiddenSizes[1],v=t.qkvHiddenSizes[2]}let b=c;if(p!==m)throw new Error("qkv_hidden_sizes first element should be same as the second");if(r.dims[0]!==p+m+v)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let w=0;if(s){if(m!==v)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(s.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(s.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(s.dims[1]!==u)throw new Error('Input "past" second dimension must be batch_size');if(s.dims[2]!==t.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(s.dims[4]!==m/t.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');t.pastPresentShareBuffer||(w=s.dims[3])}let C=b+w,x=-1,y=0;if(o)throw new Error("Mask not supported");if(s)throw new Error("past is not supported");if(a){if(a.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(a.dims[0]!==u||a.dims[1]!==t.numHeads||a.dims[2]!==c||a.dims[3]!==C)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:u,sequenceLength:c,pastSequenceLength:w,kvSequenceLength:b,totalSequenceLength:C,maxSequenceLength:x,inputHiddenSize:f,hiddenSize:p,vHiddenSize:v,headSize:Math.floor(p/t.numHeads),vHeadSize:Math.floor(v/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:y,scale:t.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},jg=(e,t,i)=>t&&e?`
      let total_sequence_length_input = u32(${t.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${e?.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${i?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,tL=(e,t,i,n,r,o,s,a)=>{let u=tn(s?1:o),c=64,f=o/u;f<c&&(c=32);let p=Math.ceil(o/u/c),m=[{type:12,data:t},{type:12,data:i},{type:12,data:n},{type:12,data:r},{type:12,data:f},{type:12,data:p}],v=Dn(e.dataType,u),b=Jn(1,u),w=["type"];s&&w.push("type"),a&&w.push("type");let C=x=>{let y=Ie("x",e.dataType,e.dims,u),I=[y],S=s?te("seq_lens",s.dataType,s.dims):void 0;S&&I.push(S);let T=a?te("total_sequence_length_input",a.dataType,a.dims):void 0;T&&I.push(T);let $=Jn(e.dataType),k=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${c}>;
  var<workgroup> thread_sum: array<f32, ${c}>;
  ${x.registerUniforms(k).declareVariables(...I)}
  ${x.mainStart([c,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${jg(S,T,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${c}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${s?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${b}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${b}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(u){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${u}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${c}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${b}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${b}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(u){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${u}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${c}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${y.type.value}(${$}(1.0) / ${$}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${b}(x[offset + i]);
        x[offset + i] = ${y.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${s?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${y.type.value}(${$}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${c};${v};${u}`,inputDependencies:w},getShaderSource:C,getRunData:()=>({outputs:[],dispatchGroup:{x:Math.ceil(o/c),y:r,z:t*i},programUniforms:m})}},nL=(e,t,i,n,r,o,s,a,u)=>{let c=s+o.kvSequenceLength,f=[o.batchSize,o.numHeads,o.sequenceLength,c],p=e>1&&n,m=o.kvNumHeads?o.kvNumHeads:o.numHeads,v=p?[o.batchSize,m,c,o.headSize]:void 0,b=o.nReps?o.nReps:1,w=o.scale===0?1/Math.sqrt(o.headSize):o.scale,C=tn(o.headSize),x=o.headSize/C,y=12,I={x:Math.ceil(c/y),y:Math.ceil(o.sequenceLength/y),z:o.batchSize*o.numHeads},S=[{type:12,data:o.sequenceLength},{type:12,data:x},{type:12,data:c},{type:12,data:o.numHeads},{type:12,data:o.headSize},{type:1,data:w},{type:12,data:s},{type:12,data:o.kvSequenceLength},{type:12,data:b}],T=p&&n&&Q.size(n.dims)>0,$=["type","type"];T&&$.push("type"),r&&$.push("type"),a&&$.push("type"),u&&$.push("type");let k=[{dims:f,dataType:t.dataType,gpuDataType:0}];p&&k.push({dims:v,dataType:t.dataType,gpuDataType:0});let P=j=>{let H=te("q",t.dataType,t.dims,C),re=te("key",i.dataType,i.dims,C),ae=[H,re];if(T){let X=te("past_key",n.dataType,n.dims,C);ae.push(X)}r&&ae.push(te("attention_bias",r.dataType,r.dims));let L=a?te("seq_lens",a.dataType,a.dims):void 0;L&&ae.push(L);let ge=u?te("total_sequence_length_input",u.dataType,u.dims):void 0;ge&&ae.push(ge);let ye=Ie("output",t.dataType,f),Y=[ye];p&&Y.push(Ie("present_key",t.dataType,v,C));let ve=Jn(1,C),we=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${y}u;

  var<workgroup> tileQ: array<${H.type.storage}, ${y*y}>;
  var<workgroup> tileK: array<${H.type.storage}, ${y*y}>;
  ${j.registerUniforms(we).declareVariables(...ae,...Y)}
  ${j.mainStart([y,y,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${b===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${b===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${jg(L,ge,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${T&&p?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${p?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${ve}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${T&&p?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${p?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${ve}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(C){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${C}`)}})()};
        output[outputIdx] = ${ye.type.value} (sum * uniforms.alpha) + ${r?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${C};${r!==void 0};${n!==void 0};${e}`,inputDependencies:$},getRunData:()=>({outputs:k,dispatchGroup:I,programUniforms:S}),getShaderSource:P}},iL=(e,t,i,n,r,o,s=void 0,a=void 0)=>{let u=o+r.kvSequenceLength,c=r.nReps?r.nReps:1,f=r.vHiddenSize*c,p=e>1&&n,m=r.kvNumHeads?r.kvNumHeads:r.numHeads,v=p?[r.batchSize,m,u,r.headSize]:void 0,b=[r.batchSize,r.sequenceLength,f],w=12,C={x:Math.ceil(r.vHeadSize/w),y:Math.ceil(r.sequenceLength/w),z:r.batchSize*r.numHeads},x=[{type:12,data:r.sequenceLength},{type:12,data:u},{type:12,data:r.vHeadSize},{type:12,data:r.numHeads},{type:12,data:r.headSize},{type:12,data:f},{type:12,data:o},{type:12,data:r.kvSequenceLength},{type:12,data:c}],y=p&&n&&Q.size(n.dims)>0,I=["type","type"];y&&I.push("type"),s&&I.push("type"),a&&I.push("type");let S=[{dims:b,dataType:t.dataType,gpuDataType:0}];p&&S.push({dims:v,dataType:t.dataType,gpuDataType:0});let T=$=>{let k=te("probs",t.dataType,t.dims),P=te("v",i.dataType,i.dims),j=[k,P];y&&j.push(te("past_value",n.dataType,n.dims));let H=s?te("seq_lens",s.dataType,s.dims):void 0;s&&j.push(H);let re=a?te("total_sequence_length_input",a.dataType,a.dims):void 0;a&&j.push(re);let ae=[Ie("output",t.dataType,b)];p&&ae.push(Ie("present_value",t.dataType,v));let L=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${w}u;
  var<workgroup> tileQ: array<${k.type.value}, ${w*w}>;
  var<workgroup> tileV: array<${k.type.value}, ${w*w}>;
  ${$.registerUniforms(L).declareVariables(...j,...ae)}
  ${$.mainStart([w,w,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${c===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${c===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${jg(H,re,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${y&&p?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${p?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${k.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${y&&p?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${p?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${n!==void 0};${e}`,inputDependencies:I},getRunData:()=>({outputs:S,dispatchGroup:C,programUniforms:x}),getShaderSource:T}},Wf=(e,t,i,n,r,o,s,a,u,c,f=void 0,p=void 0)=>{let m=Math.min(e.outputCount,1+(s?1:0)+(a?1:0)),v=m>1?c.pastSequenceLength:0,b=v+c.kvSequenceLength,w=u&&Q.size(u.dims)>0?u:void 0,C=[t,i];m>1&&s&&Q.size(s.dims)>0&&C.push(s),w&&C.push(w),f&&C.push(f),p&&C.push(p);let x=e.compute(nL(m,t,i,s,w,c,v,f,p),{inputs:C,outputs:m>1?[-1,1]:[-1]})[0];e.compute(tL(x,c.batchSize,c.numHeads,v,c.sequenceLength,b,f,p),{inputs:f&&p?[x,f,p]:[x],outputs:[]});let y=[x,n];m>1&&a&&Q.size(a.dims)>0&&y.push(a),f&&y.push(f),p&&y.push(p),e.compute(iL(m,x,n,a,c,v,f,p),{inputs:y,outputs:m>1?[0,2]:[0]})},rL=(e,t)=>{let i=[t.batchSize,t.numHeads,t.sequenceLength,t.headSize],n=t.sequenceLength,r=t.inputHiddenSize,o=t.headSize,s=12,a={x:Math.ceil(t.headSize/s),y:Math.ceil(t.sequenceLength/s),z:t.batchSize*t.numHeads},u=[e.inputs[0],e.inputs[1],e.inputs[2]],c=[{type:12,data:n},{type:12,data:r},{type:12,data:o},{type:12,data:t.numHeads},{type:12,data:t.headSize},{type:12,data:t.hiddenSize},{type:12,data:t.hiddenSize+t.hiddenSize+t.vHiddenSize}],f=p=>{let m=Ie("output_q",u[0].dataType,i),v=Ie("output_k",u[0].dataType,i),b=Ie("output_v",u[0].dataType,i),w=te("input",u[0].dataType,u[0].dims),C=te("weight",u[1].dataType,u[1].dims),x=te("bias",u[2].dataType,u[2].dims),y=w.type.storage,I=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${s}u;
  var<workgroup> tileInput: array<${y}, ${s*s}>;
  var<workgroup> tileWeightQ: array<${y}, ${s*s}>;
  var<workgroup> tileWeightK: array<${y}, ${s*s}>;
  var<workgroup> tileWeightV: array<${y}, ${s*s}>;
  ${p.registerUniforms(I).declareVariables(w,C,x,m,v,b)}
  ${p.mainStart([s,s,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${y}(0);
    var valueK = ${y}(0);
    var valueV = ${y}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return e.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:i,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:i,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:i,dataType:e.inputs[0].dataType,gpuDataType:0}],dispatchGroup:a,programUniforms:c}),getShaderSource:f},{inputs:u,outputs:[-1,-1,-1]})},Vj=(e,t)=>{let i=eL(e.inputs,t),[n,r,o]=rL(e,i);return Wf(e,n,r,o,e.inputs[4],void 0,void 0,void 0,e.inputs[5],i)}}),oL,sL,aL,Uj,UX=ce(()=>{"use strict";Cr(),ze(),He(),sn(),Ye(),oL=(e,t)=>{if(!e||e.length!==5)throw new Error("BatchNormalization requires 5 inputs");let i=(n,r,o)=>{let s=r.length;if(s!==n.length)throw new Error(`${o}: num dimensions != ${s}`);r.forEach((a,u)=>{if(a!==n[u])throw new Error(`${o}: dim[${u}] do not match`)})};if(e[0].dims.length>1){let n=t.format==="NHWC"?t.spatial?e[0].dims.slice(-1):e[0].dims.slice(-1).concat(e[0].dims.slice(1,e[0].dims.length-1)):e[0].dims.slice(1,t.spatial?2:void 0);i(e[1].dims,n,"Invalid input scale"),i(e[2].dims,n,"Invalid input B"),i(e[3].dims,n,"Invalid input mean"),i(e[4].dims,n,"Invalid input var")}else i(e[1].dims,[1],"Invalid input scale"),i(e[2].dims,[1],"Invalid input B"),i(e[3].dims,[1],"Invalid input mean"),i(e[4].dims,[1],"Invalid input var")},sL=(e,t)=>{let{epsilon:i,spatial:n,format:r}=t,o=e[0].dims,s=n?tn(o[o.length-1]):1,a=r==="NHWC"&&o.length>1?s:1,u=Q.size(o)/s,c=n,f=c?o.length:o,p=te("x",e[0].dataType,e[0].dims,s),m=te("scale",e[1].dataType,e[1].dims,a),v=te("bias",e[2].dataType,e[2].dims,a),b=te("inputMean",e[3].dataType,e[3].dims,a),w=te("inputVar",e[4].dataType,e[4].dims,a),C=Ie("y",e[0].dataType,f,s),x=()=>{let I="";if(n)I=`let cOffset = ${o.length===1?"0u":r==="NHWC"?`outputIndices[${o.length-1}] / ${s}`:"outputIndices[1]"};`;else if(r==="NCHW")I=`
            ${C.indicesSet("outputIndices","0","0")}
            let cOffset = ${C.indicesToOffset("outputIndices")};`;else{I=`var cIndices = ${m.type.indices}(0);
                       cIndices[0] = outputIndices[${o.length-1}];`;for(let S=1;S<m.rank;S++)I+=`cIndices[${S}] = outputIndices[${S}];`;I+=`let cOffset = ${m.indicesToOffset("cIndices")};`}return I},y=I=>`
  const epsilon = ${i};
  ${I.registerUniform("outputSize","u32").declareVariables(p,m,v,b,w,C)}
  ${I.mainStart()}
  ${I.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${C.offsetToIndices(`global_idx * ${s}`)};
    ${x()}
    let scale = ${m.getByOffset("cOffset")};
    let bias = ${v.getByOffset("cOffset")};
    let inputMean = ${b.getByOffset("cOffset")};
    let inputVar = ${w.getByOffset("cOffset")};
    let x = ${p.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${C.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${t.epsilon}_${t.format}_${n}_${s}`,inputDependencies:c?["rank","type","type","type","type"]:void 0},getShaderSource:y,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c?[{type:12,data:u},...$e(o)]:[{type:12,data:u}]})}},aL=e=>kt(e),Uj=(e,t)=>{let{inputs:i,outputCount:n}=e,r=aL(Ae(ie({},t),{outputCount:n}));if(Jt.webgpu.validateInputContent&&oL(i,r),t.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");e.compute(sL(i,r))}}),lL,uL,Hj,HX=ce(()=>{"use strict";He(),Ye(),lL=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(e[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},uL=e=>{let t=e[0].dims,i=e[0].dims[2],n=Q.size(t)/4,r=e[0].dataType,o=te("input",r,t,4),s=te("bias",r,[i],4),a=te("residual",r,t,4),u=Ie("output",r,t,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(n/64)}}),getShaderSource:c=>`
  const channels = ${i}u / 4;
  ${c.declareVariables(o,s,a,u)}

  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes(n)}
    let value = ${o.getByOffset("global_idx")}
      + ${s.getByOffset("global_idx % channels")} + ${a.getByOffset("global_idx")};
    ${u.setByOffset("global_idx","value")}
  }`}},Hj=e=>{lL(e.inputs),e.compute(uL(e.inputs))}}),cL,xt,Wj,qj,Gj,Kj,Zj,Qj,Yj,Jj,Xj,dL,eV,tV,nV,iV,Vf,rV,Qg,oV,sV,aV,lV,uV,cV,dV,fV,hV,pV,mV,gV,_V,vV,bV,yV,HC,wV,DE,TE,xV,CV,EV,fL,hL,IV,JE=ce(()=>{"use strict";ze(),He(),sn(),Ye(),cL=(e,t,i,n,r,o,s)=>{let a=Math.ceil(t/4),u="";typeof r=="string"?u=`${r}(a)`:u=r("a");let c=te("inputData",i,[a],4),f=Ie("outputData",n,[a],4),p=[{name:"vec_size",type:"u32"}];return s&&p.push(...s),`
      ${e.registerUniforms(p).declareVariables(c,f)}

  ${o??""}

  ${e.mainStart()}
    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${c.getByOffset("global_idx")};
    ${f.setByOffset("global_idx",u)}
  }`},xt=(e,t,i,n,r,o=e.dataType,s,a)=>{let u=[{type:12,data:Math.ceil(Q.size(e.dims)/4)}];return s&&u.push(...s),{name:t,shaderCache:{hint:r,inputDependencies:["type"]},getShaderSource:c=>cL(c,Q.size(e.dims),e.dataType,o,i,n,a),getRunData:c=>({outputs:[{dims:e.dims,dataType:o}],dispatchGroup:{x:Math.ceil(Q.size(c[0].dims)/64/4)},programUniforms:u})}},Wj=e=>{e.compute(xt(e.inputs[0],"Abs","abs"))},qj=e=>{e.compute(xt(e.inputs[0],"Acos","acos"))},Gj=e=>{e.compute(xt(e.inputs[0],"Acosh","acosh"))},Kj=e=>{e.compute(xt(e.inputs[0],"Asin","asin"))},Zj=e=>{e.compute(xt(e.inputs[0],"Asinh","asinh"))},Qj=e=>{e.compute(xt(e.inputs[0],"Atan","atan"))},Yj=e=>{e.compute(xt(e.inputs[0],"Atanh","atanh"))},Jj=e=>kt(e),Xj=(e,t)=>{let i;switch(t.to){case 10:i="vec4<f16>";break;case 1:i="vec4<f32>";break;case 12:i="vec4<u32>";break;case 6:i="vec4<i32>";break;case 9:i="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${t.to}`)}e.compute(xt(e.inputs[0],"Cast",i,void 0,t.cacheKey,t.to))},dL=e=>{let t,i,n=e.length>=2&&e[1].data!==0,r=e.length>=3&&e[2].data!==0;switch(e[0].dataType){case 1:t=n?e[1].getFloat32Array()[0]:-34028234663852886e22,i=r?e[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:t=n?e[1].getUint16Array()[0]:64511,i=r?e[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return kt({min:t,max:i})},eV=(e,t)=>{let i=t||dL(e.inputs),n=Jn(e.inputs[0].dataType);e.compute(xt(e.inputs[0],"Clip",r=>`clamp(${r}, vec4<${n}>(uniforms.min), vec4<${n}>(uniforms.max))`,void 0,i.cacheKey,void 0,[{type:e.inputs[0].dataType,data:i.min},{type:e.inputs[0].dataType,data:i.max}],[{name:"min",type:n},{name:"max",type:n}]),{inputs:[0]})},tV=e=>{e.compute(xt(e.inputs[0],"Ceil","ceil"))},nV=e=>{e.compute(xt(e.inputs[0],"Cos","cos"))},iV=e=>{e.compute(xt(e.inputs[0],"Cosh","cosh"))},Vf=e=>kt(e),rV=(e,t)=>{let i=Jn(e.inputs[0].dataType);e.compute(xt(e.inputs[0],"Elu",n=>`elu_vf32(${n})`,`
  const elu_alpha_ = ${i}(${t.alpha});

  fn elu_f32(a: ${i}) -> ${i} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${i}>) -> vec4<${i}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,t.cacheKey))},Qg=(e="f32")=>`
const r0: ${e} = 0.3275911;
const r1: ${e} = 0.254829592;
const r2: ${e} = -0.284496736;
const r3: ${e} = 1.421413741;
const r4: ${e} = -1.453152027;
const r5: ${e} = 1.061405429;

fn erf_vf32(v: vec4<${e}>) -> vec4<${e}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,oV=e=>{let t=Jn(e.inputs[0].dataType);e.compute(xt(e.inputs[0],"Erf",i=>`erf_vf32(${i})`,Qg(t)))},sV=e=>{e.compute(xt(e.inputs[0],"Exp","exp"))},aV=e=>{e.compute(xt(e.inputs[0],"Floor","floor"))},lV=e=>{let t=Jn(e.inputs[0].dataType);e.compute(xt(e.inputs[0],"Gelu",i=>`0.5 * ${i} * (1.0 + erf_vf32(${i} * 0.7071067811865475))`,Qg(t)))},uV=(e,t)=>{let i=Jn(e.inputs[0].dataType);e.compute(xt(e.inputs[0],"LeakyRelu",n=>`select(leaky_relu_alpha_ * ${n}, ${n}, ${n} >= vec4<${i}>(0.0))`,`const leaky_relu_alpha_ = ${i}(${t.alpha});`,t.cacheKey))},cV=e=>{e.compute(xt(e.inputs[0],"Not",t=>`!${t}`))},dV=e=>{e.compute(xt(e.inputs[0],"Neg",t=>`-${t}`))},fV=e=>{e.compute(xt(e.inputs[0],"Reciprocal",t=>`1.0/${t}`))},hV=e=>{let t=Jn(e.inputs[0].dataType);e.compute(xt(e.inputs[0],"Relu",i=>`select(vec4<${t}>(0.0), ${i}, ${i} > vec4<${t}>(0.0))`))},pV=e=>{e.compute(xt(e.inputs[0],"Sigmoid",t=>`(1.0 / (1.0 + exp(-${t})))`))},mV=e=>kt(e),gV=(e,t)=>{let i=Jn(e.inputs[0].dataType);e.compute(xt(e.inputs[0],"HardSigmoid",n=>`max(vec4<${i}>(0.0), min(vec4<${i}>(1.0), ${t.alpha} * ${n} + vec4<${i}>(${t.beta})))`,void 0,t.cacheKey))},_V=e=>{e.compute(xt(e.inputs[0],"Sin","sin"))},vV=e=>{e.compute(xt(e.inputs[0],"Sinh","sinh"))},bV=e=>{e.compute(xt(e.inputs[0],"Sqrt","sqrt"))},yV=e=>{e.compute(xt(e.inputs[0],"Tan","tan"))},HC=e=>`sign(${e}) * (1 - exp(-2 * abs(${e}))) / (1 + exp(-2 * abs(${e})))`,wV=e=>{e.compute(xt(e.inputs[0],"Tanh",HC))},DE=(e="f32")=>`
const fast_gelu_a: ${e} = 0.5;
const fast_gelu_b: ${e} = 0.7978845608028654;
const fast_gelu_c: ${e} = 0.035677408136300125;

fn tanh_v(v: vec4<${e}>) -> vec4<${e}> {
  return ${HC("v")};
}
`,TE=e=>`(fast_gelu_a + fast_gelu_a * tanh_v(${e} * (fast_gelu_c * ${e} * ${e} + fast_gelu_b))) * ${e}`,xV=e=>{let t=Jn(e.inputs[0].dataType);e.compute(xt(e.inputs[0],"FastGelu",TE,DE(t),void 0,e.inputs[0].dataType))},CV=(e,t)=>{let i=Jn(e.inputs[0].dataType);return e.compute(xt(e.inputs[0],"ThresholdedRelu",n=>`select(vec4<${i}>(0.0), ${n}, ${n} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${i}>(${t.alpha});`,t.cacheKey)),0},EV=e=>{e.compute(xt(e.inputs[0],"Log","log"))},fL=(e,t)=>`
const alpha = vec4<${e}>(${t});
const one = ${e}(1.0);
const zero = ${e}(0.0);

fn quick_gelu_impl(x: vec4<${e}>) -> vec4<${e}> {
  let v = x *alpha;
  var x1 : vec4<${e}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,hL=e=>`quick_gelu_impl(${e})`,IV=(e,t)=>{let i=Jn(e.inputs[0].dataType);e.compute(xt(e.inputs[0],"QuickGelu",hL,fL(i,t.alpha),t.cacheKey,e.inputs[0].dataType))}}),pL,mL,SV,WX=ce(()=>{"use strict";He(),Ye(),JE(),pL=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(e[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},mL=e=>{let t=e[0].dims.slice();t[2]=t[2]/2;let i=te("input",e[0].dataType,e[0].dims,4),n=te("bias",e[0].dataType,[e[0].dims[2]],4),r=Ie("output",e[0].dataType,t,4),o=Q.size(t)/4,s=Dn(e[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)}}),getShaderSource:a=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${e[0].dims[2]/4/2}u;

  ${a.declareVariables(i,n,r)}

  ${Qg(s)}

  ${a.mainStart()}
    ${a.guardAgainstOutOfBoundsWorkgroupSizes(o)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${r.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},SV=e=>{pL(e.inputs),e.compute(mL(e.inputs))}}),gL,_L,wr,DV,TV,$V,kV,MV,AV,RV,OV,NV,PV,qX=ce(()=>{"use strict";ze(),He(),Ye(),gL=(e,t,i,n,r,o,s,a,u,c,f,p)=>{let m,v;typeof a=="string"?m=v=(y,I)=>`${a}((${y}),(${I}))`:typeof a=="function"?m=v=a:(m=a.scalar,v=a.vector);let b=Ie("outputData",f,n.length,4),w=te("aData",u,t.length,4),C=te("bData",c,i.length,4),x;if(r)if(o){let y=Q.size(t)===1,I=Q.size(i)===1,S=t.length>0&&t[t.length-1]%4===0,T=i.length>0&&i[i.length-1]%4===0;y||I?x=b.setByOffset("global_idx",v(y?`${w.type.value}(${w.getByOffset("0")}.x)`:w.getByOffset("global_idx"),I?`${C.type.value}(${C.getByOffset("0")}.x)`:C.getByOffset("global_idx"))):x=`
            let outputIndices = ${b.offsetToIndices("global_idx * 4u")};
            let offsetA = ${w.broadcastedIndicesToOffset("outputIndices",b)};
            let offsetB = ${C.broadcastedIndicesToOffset("outputIndices",b)};
            ${b.setByOffset("global_idx",v(s||S?w.getByOffset("offsetA / 4u"):`${w.type.value}(${w.getByOffset("offsetA / 4u")}[offsetA % 4u])`,s||T?C.getByOffset("offsetB / 4u"):`${C.type.value}(${C.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else x=b.setByOffset("global_idx",v(w.getByOffset("global_idx"),C.getByOffset("global_idx")));else{if(!o)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let y=(I,S,T="")=>{let $=`aData[indexA${S}][componentA${S}]`,k=`bData[indexB${S}][componentB${S}]`;return`
            let outputIndices${S} = ${b.offsetToIndices(`global_idx * 4u + ${S}u`)};
            let offsetA${S} = ${w.broadcastedIndicesToOffset(`outputIndices${S}`,b)};
            let offsetB${S} = ${C.broadcastedIndicesToOffset(`outputIndices${S}`,b)};
            let indexA${S} = offsetA${S} / 4u;
            let indexB${S} = offsetB${S} / 4u;
            let componentA${S} = offsetA${S} % 4u;
            let componentB${S} = offsetB${S} % 4u;
            ${I}[${S}] = ${T}(${m($,k)});
          `};f===9?x=`
            var data = vec4<u32>(0);
            ${y("data",0,"u32")}
            ${y("data",1,"u32")}
            ${y("data",2,"u32")}
            ${y("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:x=`
            ${y("outputData[global_idx]",0)}
            ${y("outputData[global_idx]",1)}
            ${y("outputData[global_idx]",2)}
            ${y("outputData[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(w,C,b)}

        ${p??""}

        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${x}
      }`},_L=(e,t,i,n,r,o,s=i.dataType)=>{let a=i.dims.map(w=>Number(w)??1),u=n.dims.map(w=>Number(w)??1),c=!Q.areEqual(a,u),f=a,p=Q.size(a),m=!1,v=!1,b=[c];if(c){let w=Gl.calcShape(a,u,!1);if(!w)throw new Error("Can't perform binary op on the given tensors");f=w.slice(),p=Q.size(f);let C=Q.size(a)===1,x=Q.size(u)===1,y=a.length>0&&a[a.length-1]%4===0,I=u.length>0&&u[u.length-1]%4===0;b.push(C),b.push(x),b.push(y),b.push(I);let S=1;for(let T=1;T<f.length;T++){let $=a[a.length-T],k=u[u.length-T];if($===k)S*=$;else break}S%4===0?(v=!0,m=!0):(C||x||y||I)&&(m=!0)}else m=!0;return b.push(m),{name:e,shaderCache:{hint:t+b.map(w=>w.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:w=>gL(w,a,u,f,m,c,v,r,i.dataType,n.dataType,s,o),getRunData:()=>({outputs:[{dims:f,dataType:s}],dispatchGroup:{x:Math.ceil(p/64/4)},programUniforms:[{type:12,data:Math.ceil(Q.size(f)/4)},...$e(a,u,f)]})}},wr=(e,t,i,n,r,o)=>{e.compute(_L(t,r??"",e.inputs[0],e.inputs[1],i,n,o))},DV=e=>{wr(e,"Add",(t,i)=>`${t}+${i}`)},TV=e=>{wr(e,"Div",(t,i)=>`${t}/${i}`)},$V=e=>{wr(e,"Equal",{scalar:(t,i)=>`u32(${t}==${i})`,vector:(t,i)=>`vec4<u32>(${t}==${i})`},void 0,void 0,9)},kV=e=>{wr(e,"Mul",(t,i)=>`${t}*${i}`)},MV=e=>{let t=te("input",e.inputs[0].dataType,e.inputs[0].dims).type.value;wr(e,"Pow",{scalar:(i,n)=>`pow_custom(${i},${n})`,vector:(i,n)=>`pow_vector_custom(${i},${n})`},`
    fn pow_custom(a : ${t}, b : ${t}) -> ${t} {
      if (b == ${t}(0.0)) {
        return ${t}(1.0);
      } else if (a < ${t}(0.0) && f32(b) != floor(f32(b))) {
        return ${t}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${t}(1.0), round(f32(abs(b) % ${t}(2.0))) != 1.0) * ${t}(${t==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${t}>, b : vec4<${t}>) -> vec4<${t}> {
      // TODO: implement vectorized pow
      return vec4<${t}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},AV=e=>{wr(e,"Sub",(t,i)=>`${t}-${i}`)},RV=e=>{wr(e,"Greater",{scalar:(t,i)=>`u32(${t}>${i})`,vector:(t,i)=>`vec4<u32>(${t}>${i})`},void 0,void 0,9)},OV=e=>{wr(e,"Less",{scalar:(t,i)=>`u32(${t}<${i})`,vector:(t,i)=>`vec4<u32>(${t}<${i})`},void 0,void 0,9)},NV=e=>{wr(e,"GreaterOrEqual",{scalar:(t,i)=>`u32(${t}>=${i})`,vector:(t,i)=>`vec4<u32>(${t}>=${i})`},void 0,void 0,9)},PV=e=>{wr(e,"LessOrEqual",{scalar:(t,i)=>`u32(${t}<=${i})`,vector:(t,i)=>`vec4<u32>(${t}<=${i})`},void 0,void 0,9)}}),vL,bL,yL,wL,FV,zV,GX=ce(()=>{"use strict";ze(),He(),sn(),Ye(),vL=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");let i=0,n=e[i],r=n.dataType,o=n.dims.length;e.forEach((s,a)=>{if(a!==i){if(s.dataType!==r)throw new Error("input tensors should be one type");if(s.dims.length!==o)throw new Error("input tensors should have the same shape");s.dims.forEach((u,c)=>{if(c!==t&&u!==n.dims[c])throw new Error("non concat dimensions must match")})}})},bL=(e,t)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${e}u>(${t});
    for (var i: u32 = 0u; i < ${e}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${e}u;
  }`,yL=(e,t)=>{let i=e.length,n=[];for(let r=0;r<i;++r){let o=t.setByOffset("global_idx",e[r].getByIndices("indices"));i===1?n.push(o):r===0?n.push(`if (inputIndex == ${r}u) { ${o} }`):r===i-1?n.push(`else { ${o} }`):n.push(`else if (inputIndex == ${r}) { ${o} }`)}return n.join(`
`)},wL=(e,t,i,n)=>{let r=Q.size(i),o=new Array(e.length),s=new Array(e.length),a=0,u=[],c=[],f=[{type:12,data:r}];for(let w=0;w<e.length;++w)a+=e[w].dims[t],o[w]=a,c.push(e[w].dims.length),s[w]=te(`input${w}`,n,c[w]),u.push("rank"),f.push({type:12,data:o[w]});for(let w=0;w<e.length;++w)f.push(...$e(e[w].dims));f.push(...$e(i));let p=Ie("output",n,i.length),m=p.indicesGet("indices",t),v=Array.from(Array(o.length).keys()).map(w=>`uniforms.sizeInConcatAxis${w}`).join(","),b=w=>`

  ${(()=>{w.registerUniform("outputSize","u32");for(let C=0;C<e.length;C++)w.registerUniform(`sizeInConcatAxis${C}`,"u32");return w.declareVariables(...s,p)})()}

  ${bL(o.length,v)}

  ${w.mainStart()}
    ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${p.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${m});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${o.length}u>(${v});
      ${m} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${yL(s,p)}
  }`;return{name:"Concat",shaderCache:{hint:`${t}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:i,dataType:n}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:f}),getShaderSource:b}},FV=(e,t)=>{let i=e.inputs,n=i[0].dims,r=Q.normalizeAxis(t.axis,n.length);vL(i,r);let o=n.slice();o[r]=i.reduce((a,u)=>a+(u.dims.length>r?u.dims[r]:0),0);let s=i.filter(a=>Q.size(a.dims)>0);e.compute(wL(s,r,o,i[0].dataType),{inputs:s})},zV=e=>kt({axis:e.axis})}),Ta,$a,ka,XE,Aa=ce(()=>{"use strict";ze(),He(),Ta=(e,t,i="f32")=>{switch(e.activation){case"Relu":return`value = max(value, ${t}(0.0));`;case"Sigmoid":return`value = (${t}(1.0) / (${t}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${t}(${i}(uniforms.clip_min)), ${t}(${i}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${t}(0.0), min(${t}(1.0), ${i}(uniforms.alpha) * value + ${i}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${i}(uniforms.alpha) * value, value, value >= ${t}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${e.activation}`)}},$a=(e,t)=>{e.activation==="Clip"?t.push({type:1,data:e.clipMax},{type:1,data:e.clipMin}):e.activation==="HardSigmoid"?t.push({type:1,data:e.alpha},{type:1,data:e.beta}):e.activation==="LeakyRelu"&&t.push({type:1,data:e.alpha})},ka=(e,t)=>{e.activation==="Clip"?t.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):e.activation==="HardSigmoid"?t.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):e.activation==="LeakyRelu"&&t.push({name:"alpha",type:"f32"})},XE=e=>{let t=e?.activation||"";if(t==="HardSigmoid"){let[i,n]=e?.activation_params||[.2,.5];return{activation:t,alpha:i,beta:n}}else if(t==="Clip"){let[i,n]=e?.activation_params||[pj,mj];return{activation:t,clipMax:n,clipMin:i}}else if(t==="LeakyRelu"){let[i]=e?.activation_params||[.01];return{activation:t,alpha:i}}return{activation:t}}}),Mn,LV,eI=ce(()=>{"use strict";Mn=(e,t)=>{switch(e){case 1:return t;case 2:return`vec2<${t}>`;case 3:return`vec3<${t}>`;case 4:return`vec4<${t}>`;default:throw new Error(`${e}-component is not supported.`)}},LV=e=>`
      ${e?"value = value + getBiasByOutputCoords(coords);":""}
      `}),BV,KX=ce(()=>{"use strict";BV=e=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${e}.x), i32(${e}.y), i32(${e}.z), 1));
}
`}),Hf,tI,nI=ce(()=>{"use strict";ze(),He(),Ye(),Aa(),Hf=(e,t,i,n,r)=>{let o=n-i;return`
      ${Array.from({length:i}).map((s,a)=>`
      if (${De(t.shape,a,t.rank)} != 1) {
        ${t.indicesSet(e,a,De(r,a+o,n))}
      } else {
        ${t.indicesSet(e,a,0)}
      }`).join("")}
`},tI=(e,t,i,n,r=!1,o)=>{let s=e[0].dims,a=e[1].dims,u=s[s.length-2],c=a[a.length-1],f=s[s.length-1],p=tn(c),m=tn(f),v=tn(u),b=Q.size(i)/p/v,w=e.length>2,C=n?n.slice(0,-2):i.slice(0,-2),x=[Q.size(C),u,c],y=[{type:12,data:b},{type:12,data:u},{type:12,data:c},{type:12,data:f}];$a(t,y),y.push(...$e(C,s,a)),w&&y.push(...$e(e[2].dims)),y.push(...$e(x));let I=S=>{let T=ZE("batch_dims",e[0].dataType,C.length),$=te("a",e[0].dataType,s.length,m),k=te("b",e[1].dataType,a.length,p),P=Ie("output",e[0].dataType,x.length,p),j=Dn(P.type.tensor),H=Ta(t,P.type.value,j),re=[$,k],ae="";if(w){let ye=r?p:1;re.push(te("bias",e[2].dataType,e[2].dims.length,ye)),ae=`${r?`value += bias[col / ${ye}];`:`value += ${P.type.value}(bias[row + i]);`}`}let L=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];ka(t,L);let ge=()=>{let ye=`var a_data: ${$.type.value};`;for(let Y=0;Y<m;Y++)ye+=`
              let b_data${Y} = b[(b_offset + (k + ${Y}) * uniforms.N + col) / ${p}];`;for(let Y=0;Y<v;Y++){ye+=`a_data = a[(a_offset + (row + ${Y}) * uniforms.K + k) / ${m}];`;for(let ve=0;ve<m;ve++)ye+=`
            values[${Y}] = fma(${k.type.value}(a_data${m===1?"":`[${ve}]`}), b_data${ve}, values[${Y}]);
`}return ye};return`
  ${S.registerUniforms(L).registerInternalVariables(T).declareVariables(...re,P)}
  ${S.mainStart()}
    ${S.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${p})) * ${p};
    var index1 = global_idx / (uniforms.N / ${p});
    let stride1 = uniforms.M / ${v};
    let row = (index1 % stride1) * ${v};
    let batch = index1 / stride1;

    ${i.length===2?"":`let batch_indices = ${T.offsetToIndices("batch")};`}

    var a_indices: ${$.type.indices};
    ${Hf("a_indices",$,$.rank-2,T.rank,"batch_indices")}
    ${$.indicesSet("a_indices",$.rank-2,0)}
    ${$.indicesSet("a_indices",$.rank-1,0)}
    let a_offset = ${$.indicesToOffset("a_indices")};

    var b_indices: ${k.type.indices};
    ${Hf("b_indices",k,k.rank-2,T.rank,"batch_indices")}
    ${k.indicesSet("b_indices",k.rank-2,0)}
    ${k.indicesSet("b_indices",k.rank-1,0)}
    let b_offset = ${k.indicesToOffset("b_indices")};
    var values: array<${P.type.value}, ${v}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${m}) {
      ${ge()}
    }
    for (var i = 0u; i < ${v}u; i++) {
      var value = values[i];
      ${ae}
      ${H}
      let cur_indices = ${P.type.indices}(batch, row + i, col);
      let offset = ${P.indicesToOffset("cur_indices")};
      ${P.setByOffset(`offset / ${p}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${t.activation};${p};${m};${v};${r}`,inputDependencies:w?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:o?o(i):i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:y}),getShaderSource:I}}}),xL,CL,$E,WC,EL,kE,IL,i_,iI=ce(()=>{"use strict";ze(),He(),Ye(),Aa(),nI(),eI(),xL=(e,t)=>e?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${t?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${t?", batchIndices":""});
        `,CL=(e,t)=>e?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${t===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,$E=(e,t,i="f32",n,r=!1,o=32,s=!1,a=32)=>{let u=t[1]*e[1],c=t[0]*e[0],f=r?u:o,p=r?o:u,m=f/t[0],v=o/t[1];if(!((r&&m===4&&e[1]===4||!r&&(m===3||m===4))&&f%t[0]===0&&o%t[1]===0&&e[0]===4))throw new Error(`If transposeA ${r} is true, innerElementSize ${m} and workPerThread[1] ${e[1]} must be 4.
      Otherwise, innerElementSize ${m} must be 3 or 4.
  tileAWidth ${f} must be divisible by workgroupSize[0]${t[0]}. tileInner ${o} must be divisible by workgroupSize[1] ${t[1]}. colPerThread ${e[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${m}<${i}>, ${f/m}>, ${p}>;
var<workgroup> mm_Bsub: array<array<vec4<${i}>, ${c/e[0]}>, ${o}>;

const rowPerThread = ${e[1]};
const colPerThread = ${e[0]};
const innerElementSize = ${m};
const tileInner = ${o};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${s?"0":"i32(globalId.z)"};
  ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${u};

  let num_tiles = ${s?`${Math.ceil(a/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${s?`i32(globalId.z) * ${a}`:"0"};

  var acc: array<vec4<${i}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${v};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${xL(r,n)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${v}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${n?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${m===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${CL(r,m)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},WC=(e,t)=>e?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${t?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${t?", batchIndices":""});
            `,EL=e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",kE=(e,t,i="f32",n,r=!1,o=32,s=!1,a=32,u=!1)=>{let c=e[1]*t[1],f=e[0]*t[0],p=r?c:o,m=r?o:c;if(!(m%t[1]===0&&p%t[0]===0&&o%t[1]===0))throw new Error(`tileAHight ${m} must be divisible by workgroupSize[1]${t[1]}, tileAWidth ${p} must be divisible by workgroupSize[0]${t[0]}, tileInner ${o} must be divisible by workgroupSize[1]${t[1]}`);let v=m/t[1],b=p/t[0],w=o/t[1],C=u?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${c};
    let globalColStart = i32(workgroupId.x) * ${f};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${m}; inputRow = inputRow + ${t[1]}) {
        for (var inputCol = localCol; inputCol < ${p}; inputCol = inputCol + ${t[0]}) {
          ${WC(r,n)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${o}; inputRow = inputRow + ${t[1]}) {
            for (var inputCol = localCol; inputCol < ${f}; inputCol = inputCol + ${t[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${n?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${i}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${t[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${r?`mm_Asub[k][localRow + innerRow * ${t[1]}];`:`mm_Asub[localRow + innerRow * ${t[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${t[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${t[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${c};

let tileRowA = i32(localId.y) * ${v};
let tileColA = i32(localId.x) * ${b};
let tileRowB = i32(localId.y) * ${w};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${v}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${b}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${WC(r,n)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${w}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${n?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${i}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${EL(r)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${i}, ${p}>, ${m}>;
  var<workgroup> mm_Bsub : array<array<${i}, ${f}>, ${o}>;
  const rowPerThread = ${e[1]};
  const colPerThread = ${e[0]};
  const tileInner = ${o};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${s?"0":"i32(globalId.z)"};
    ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${s?`${Math.ceil(a/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${s?`i32(globalId.z) * ${a}`:"0"};

    var acc : array<array<${i}, colPerThread>, rowPerThread>;
    ${C}
  }
`},IL=(e,t,i,n,r=!1)=>{let[o,s,a,u]=n,c=Dn(n[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${o.type.indices}) -> ${Mn(e,c)} {
      var value = ${Mn(e,c)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${s.type.indices};
        ${Hf("aIndices",s,s.rank-2,o.rank,"batchIndices")}
        ${s.indicesSet("aIndices",s.rank-2,"u32(row)")}
        ${s.indicesSet("aIndices",s.rank-1,"u32(colIn)")}
        value = ${s.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${o.type.indices}) -> ${Mn(e,c)} {
      var value = ${Mn(e,c)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${a.type.indices};
        ${Hf("bIndices",a,a.rank-2,o.rank,"batchIndices")}
        ${a.indicesSet("bIndices",a.rank-2,"u32(row)")}
        ${a.indicesSet("bIndices",a.rank-1,"u32(colIn)")}
        value = ${a.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Mn(e,c)}) {
      let col = colIn * ${e};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${t?`value = value + ${r?"bias[colIn]":`${Mn(e,c)}(bias[row])`};`:""}
        ${i}
        ${u.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},i_=(e,t,i,n,r=!1,o)=>{let s=e[0].dims,a=e[1].dims,u=s.slice(0,-2),c=a.slice(0,-2),f=n?n.slice(0,-2):i.slice(0,-2),p=Q.size(f),m=s[s.length-2],v=s[s.length-1],b=a[a.length-1],w=v%4===0&&b%4===0,C=m<=8?[4,1,1]:[4,4,1],x=[8,8,1],y=[Math.ceil(b/x[0]/C[0]),Math.ceil(m/x[1]/C[1]),Math.ceil(p/x[2]/C[2])],I=w?4:1,S=[...u,m,v/I],T=S.length,$=[...c,v,b/I],k=$.length,P=[p,m,b/I],j=[{type:6,data:m},{type:6,data:b},{type:6,data:v}];$a(t,j),j.push(...$e(f,S,$));let H=["rank","rank"],re=e.length>2;re&&(j.push(...$e(e[2].dims)),H.push("rank")),j.push(...$e(P));let ae=L=>{let ge=f.length,ye=ZE("batchDims",e[0].dataType,ge,1),Y=Dn(e[0].dataType),ve=te("a",e[0].dataType,T,I),we=te("b",e[1].dataType,k,I),X=Ie("result",e[0].dataType,P.length,I),xe=[ve,we];if(re){let Ke=r?I:1;xe.push(te("bias",e[2].dataType,e[2].dims.length,Ke))}let z=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];ka(t,z);let W=Dn(X.type.tensor),R=Ta(t,X.type.value,W),se=IL(I,re,R,[ye,ve,we,X],r);return`
  ${L.registerUniforms(z).registerInternalVariables(ye).declareVariables(...xe,X)}
  ${se}
  ${w?$E(C,x,Y,ye):kE(C,x,Y,ye)}
                   `};return{name:"MatMul",shaderCache:{hint:`${C};${t.activation};${w};${r}`,inputDependencies:H},getRunData:()=>({outputs:[{dims:o?o(i):i,dataType:e[0].dataType}],dispatchGroup:{x:y[0],y:y[1],z:y[2]},programUniforms:j}),getShaderSource:ae}}}),SL,jV,ZX=ce(()=>{"use strict";ze(),xo(),Ye(),Aa(),eI(),KX(),iI(),SL=(e,t,i,n,r=!1,o,s=4,a=4,u=4,c="f32")=>{let f=j=>{switch(j){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${c}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${j} is not supported.`)}},p=j=>{switch(j){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${j} is not supported.`)}},m=e?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,v=e?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,b=e?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",w=e?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",C=e?"row":"col",x=e?"col":"row",y=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${C} / outWidth;
    let outCol = ${C} % outWidth;

    let WRow = ${x} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${x} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${x} % inChannels;
    var resData = ${Mn(s,c)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${b} && xCol >= 0 && xCol < ${w}) {
      ${m}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${f(s)}
    }
    return resData;`,I=e?t&&n?`
    let col = colIn * ${s};
    ${y}`:`
    let col = colIn * ${s};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${y}
    }
    return ${Mn(s,c)}(0.0);`:n&&i?`
    let col = colIn * ${s};
    ${y}`:`
    let col = colIn * ${s};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${y}
    }
    return ${Mn(s,c)}(0.0);`,S=e?n&&i?p(a):`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${p(a)}
    }
    return ${Mn(a,c)}(0.0);`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${p(a)}
    }
    return ${Mn(a,c)}(0.0);`,T=Mn(u,c),$=Mn(e?s:a,c),k=Mn(e?a:s,c),P=Ta(o,T,c);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${$} {
      ${e?I:S}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${k} {
      ${e?S:I}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${T}) {
      let col = colIn * ${u};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${v}
      ${LV(r)}
      ${P}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},jV=(e,t,i,n,r,o,s,a,u)=>{let c=t.format==="NHWC",f=c?e[0].dims[3]:e[0].dims[1],p=i[0],m=c?i[2]:i[3],v=c?i[1]:i[2],b=c?i[3]:i[1],w=c&&(f%4===0||f%3===0)&&b%4===0,C=c?b:m*v,x=c?m*v:b,y=[8,8,1],I=n<=8?[4,1,1]:[4,4,1],S=[Math.ceil(C/y[0]/I[0]),Math.ceil(x/y[1]/I[1]),Math.ceil(p/y[2]/I[2])];mt("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${S}`);let T=w?c&&f%4!==0?3:4:1,$=y[1]*I[1],k=y[0]*I[0],P=Math.max(y[0]*T,y[1]),j=n%$===0,H=r%k===0,re=o%P===0,ae=w?[T,4,4]:[1,1,1],L=[{type:6,data:n},{type:6,data:r},{type:6,data:o},{type:6,data:[t.pads[0],t.pads[1]]},{type:6,data:t.strides},{type:6,data:t.dilations}];$a(t,L),L.push(...$e(e[0].dims,e[1].dims));let ge=["rank","rank"];s&&(L.push(...$e(e[2].dims)),ge.push("rank")),L.push(...$e(i));let ye=Y=>{let ve=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];ka(t,ve);let we=w?4:1,X=Dn(e[0].dataType),xe=`
      fn setOutputAtIndex(flatIndex : i32, value : ${w?`vec4<${X}>`:X}) {
        result[flatIndex] = ${w?`vec4<${X}>`:X}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${w?`vec4<${X}>`:X}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${w?"/ 4":""}, value);
      }`,z=te("x",e[0].dataType,e[0].dims.length,T===3?1:T),W=te("w",e[1].dataType,e[1].dims.length,we),R=[z,W],se=Ie("result",e[0].dataType,i.length,we);if(s){let Ke=te("bias",e[2].dataType,e[2].dims.length,we);R.push(Ke),xe+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${w?`vec4<${X}>`:X} {
          return bias[coords.${c?"w":"y"}${w?"/ 4":""}];
        }`}return`
        ${BV("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${Y.registerUniforms(ve).declareVariables(...R,se)}
        ${xe}
        ${SL(c,j,H,re,s,t,ae[0],ae[1],ae[2],X)}
        ${w?$E(I,y,X,void 0,!c,P):kE(I,y,X,void 0,!c,P,!1,void 0,a)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${t.cacheKey};${T};${w};${j};${H};${re};${$};${k};${P}`,inputDependencies:ge},getRunData:()=>({outputs:[{dims:u?u(i):i,dataType:e[0].dataType}],dispatchGroup:{x:S[0],y:S[1],z:S[2]},programUniforms:L}),getShaderSource:ye}}}),DL,qC,Of,TL,GC,$L,VV,UV,QX=ce(()=>{"use strict";ze(),xo(),He(),Ye(),Aa(),eI(),DL=e=>{let t=1;for(let i=0;i<e.length;i++)t*=e[i];return t},qC=e=>typeof e=="number"?[e,e,e]:e,Of=(e,t)=>t<=1?e:e+(e-1)*(t-1),TL=(e,t,i,n=1)=>{let r=Of(t,n);return Math.floor((e[0]*(i-1)-i+r)/2)},GC=(e,t,i,n,r)=>{r==null&&(r=TL(e,t[0],n[0]));let o=[0,0,0,i];for(let s=0;s<3;s++)e[s]+2*r>=t[s]&&(o[s]=Math.trunc((e[s]-t[s]+2*r)/n[s]+1));return o},$L=(e,t,i,n,r,o,s,a,u,c)=>{let f,p,m,v;if(e==="VALID"&&(e=0),typeof e=="number"){f={top:e,bottom:e,left:e,right:e,front:e,back:e};let b=GC([t,i,n,1],[a,u,c],1,[r,o,s],e);p=b[0],m=b[1],v=b[2]}else if(Array.isArray(e)){if(!e.every((w,C,x)=>w===x[0]))throw Error(`Unsupported padding parameter: ${e}`);f={top:e[0],bottom:e[1],left:e[2],right:e[3],front:e[4],back:e[5]};let b=GC([t,i,n,1],[a,u,c],1,[r,o,s],e[0]);p=b[0],m=b[1],v=b[2]}else if(e==="SAME_UPPER"){p=Math.ceil(t/r),m=Math.ceil(i/o),v=Math.ceil(n/s);let b=(p-1)*r+a-t,w=(m-1)*o+u-i,C=(v-1)*s+c-n,x=Math.floor(b/2),y=b-x,I=Math.floor(w/2),S=w-I,T=Math.floor(C/2),$=C-T;f={top:I,bottom:S,left:T,right:$,front:x,back:y}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:f,outDepth:p,outHeight:m,outWidth:v}},VV=(e,t,i,n,r,o=!1,s="channelsLast")=>{let a,u,c,f,p;if(s==="channelsLast")[a,u,c,f,p]=e;else if(s==="channelsFirst")[a,p,u,c,f]=e;else throw new Error(`Unknown dataFormat ${s}`);let[m,,v,b,w]=t,[C,x,y]=qC(i),[I,S,T]=qC(n),$=Of(v,I),k=Of(b,S),P=Of(w,T),{padInfo:j,outDepth:H,outHeight:re,outWidth:ae}=$L(r,u,c,f,C,x,y,$,k,P),L=o?m*p:m,ge=[0,0,0,0,0];return s==="channelsFirst"?ge=[a,L,H,re,ae]:s==="channelsLast"&&(ge=[a,H,re,ae,L]),{batchSize:a,dataFormat:s,inDepth:u,inHeight:c,inWidth:f,inChannels:p,outDepth:H,outHeight:re,outWidth:ae,outChannels:L,padInfo:j,strideDepth:C,strideHeight:x,strideWidth:y,filterDepth:v,filterHeight:b,filterWidth:w,effectiveFilterDepth:$,effectiveFilterHeight:k,effectiveFilterWidth:P,dilationDepth:I,dilationHeight:S,dilationWidth:T,inShape:e,outShape:ge,filterShape:t}},UV=(e,t,i,n,r,o)=>{let s=o==="channelsLast",a=s?e[0].dims[3]:e[0].dims[1],u=!1,c=[64,1,1],f={x:i.map((y,I)=>I)},p=[Math.ceil(DL(f.x.map(y=>i[y]))/c[0]),1,1];mt("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${p}`);let m=u?s&&a%4!==0?3:4:1,v=Q.size(i),b=[{type:12,data:v},{type:12,data:n},{type:12,data:r},{type:12,data:t.strides},{type:12,data:t.dilations}];$a(t,b),b.push(...$e(e[0].dims,e[1].dims));let w=["rank","rank"],C=e.length===3;C&&(b.push(...$e(e[2].dims)),w.push("rank")),b.push(...$e(i));let x=y=>{let I=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:n.length},{name:"pads",type:"u32",length:r.length},{name:"strides",type:"u32",length:t.strides.length},{name:"dilations",type:"u32",length:t.dilations.length}];ka(t,I);let S=u?4:1,T=Dn(e[0].dataType),$=te("x",e[0].dataType,e[0].dims.length,m===3?1:m),k=te("W",e[1].dataType,e[1].dims.length,S),P=[$,k],j=Ie("result",e[0].dataType,i.length,S),H="";if(C){let L=te("bias",e[2].dataType,e[2].dims.length,S);P.push(L),H+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${u?`vec4<${T}>`:T} {
          return bias[${s?De("coords",4,5):De("coords",1,5)}${u?"/ 4":""}];
        }`}let re=Mn(m,T),ae=Ta(t,re,T);return`
            ${H}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${$.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${k.getByIndices("aIndices")};
            }
          ${y.registerUniforms(I).declareVariables(...P,j)}
          ${y.mainStart()}
          ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${j.offsetToIndices("global_idx")};
              let batch = ${De("coords",0,$.rank)};
              let d2 = ${s?De("coords",$.rank-1,$.rank):De("coords",1,$.rank)};
              let xFRCCorner = vec3<u32>(${s?De("coords",1,$.rank):De("coords",2,$.rank)},
              ${s?De("coords",2,$.rank):De("coords",3,$.rank)},
              ${s?De("coords",3,$.rank):De("coords",4,$.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${s?De("uniforms.x_shape",1,$.rank):De("uniforms.x_shape",2,$.rank)};
              let xShapeZ = ${s?De("uniforms.x_shape",2,$.rank):De("uniforms.x_shape",3,$.rank)};
              let xShapeW = ${s?De("uniforms.x_shape",3,$.rank):De("uniforms.x_shape",4,$.rank)};
              let xShapeU = ${s?De("uniforms.x_shape",4,$.rank):De("uniforms.x_shape",1,$.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${s?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${s?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${s?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${s?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${C?"value = value + getBiasByOutputCoords(coords)":""};
              ${ae}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${t.cacheKey};${s};${m};${C}`,inputDependencies:w},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:p[0],y:p[1],z:p[2]},programUniforms:b}),getShaderSource:x}}}),HV,WV,YX=ce(()=>{"use strict";ze(),He(),Ye(),Aa(),HV=(e,t,i,n)=>{let r=e.length>2,o=r?"value += b[output_channel];":"",s=e[0].dims,a=e[1].dims,u=t.format==="NHWC",c=u?i[3]:i[1],f=c/t.group,p=u&&f>=4?tn(c):1,m=Q.size(i)/p,v=[{type:12,data:m},{type:12,data:t.dilations},{type:12,data:[t.strides[0],t.strides[1]]},{type:12,data:[t.pads[0],t.pads[1]]},{type:12,data:f}];$a(t,v),v.push(...$e(s,[a[0],a[1],a[2],a[3]/p]));let b=r?["rank","rank","rank"]:["rank","rank"];v.push(...$e([i[0],i[1],i[2],i[3]/p]));let w=C=>{let x=Ie("output",e[0].dataType,i.length,p),y=Dn(x.type.tensor),I=Ta(t,x.type.value,y),S=te("x",e[0].dataType,s.length),T=te("w",e[1].dataType,a.length,p),$=[S,T];r&&$.push(te("b",e[2].dataType,e[2].dims,p));let k=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:t.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];ka(t,k);let P=u?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${S.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${T.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${S.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${T.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${C.registerUniforms(k).declareVariables(...$,x)}

  ${C.mainStart()}
    ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${x.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${u?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${u?1:2}], outputIndices[${u?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${p} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${u?2:1}];

    var value: ${x.type.value} = ${x.type.value}(0);
    ${P}
    ${o}
    ${I}
    ${x.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${t.cacheKey}_${p}`,inputDependencies:b},getRunData:()=>({outputs:[{dims:n?n(i):i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:v}),getShaderSource:w}},WV=(e,t,i,n)=>{let r=e.length>2,o=tn(i[3]),s=tn(i[2]),a=Q.size(i)/o/s,u=[e[0].dims[0],e[0].dims[1],e[0].dims[2],e[0].dims[3]/o],c=[e[1].dims[0],e[1].dims[1],e[1].dims[2],e[1].dims[3]/o],f=[i[0],i[1],i[2],i[3]/o],p=[{type:12,data:a},{type:6,data:[t.strides[0],t.strides[1]]},{type:6,data:[t.pads[0],t.pads[1]]}];$a(t,p),p.push(...$e(u,c,f));let m=(s-1)*t.strides[1]+c[1],v=b=>{let w=Ie("output",e[0].dataType,f.length,o),C=Dn(w.type.tensor),x=Ta(t,w.type.value,C),y=te("x",e[0].dataType,u.length,o),I=te("w",e[1].dataType,c.length,o),S=[y,I];r&&S.push(te("b",e[2].dataType,e[2].dims,o));let T=r?"value += b[output_channel];":"",$=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return ka(t,$),`
  ${b.registerUniforms($).declareVariables(...S,w)}
  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${s}u;
    let col = (index1 % width1) * ${s}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${y.type.value}, ${m}>;
    var values: array<${w.type.value}, ${s}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${c[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${m}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${y.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${y.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${c[1]}; w_width++) {
          let w_val = ${I.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${s}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${s}u; i++) {
      var value = values[i];
      ${T}
      ${x}
      ${w.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${t.cacheKey};${o};${s};${m};${c[0]};${c[1]}`,inputDependencies:r?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:n?n(i):i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:p}),getShaderSource:v}}}),kL,Vg,ML,Ug,ME,KC,AL,RL,AE,JX=ce(()=>{"use strict";He(),ZX(),QX(),iI(),YX(),Aa(),nI(),ls(),kL=(e,t,i,n,r,o)=>{let s=e[0],a=e.slice(o?1:2,o?3:4),u=a.length,c=t[0],f=t.slice(2).map((m,v)=>m+(m-1)*(i[v]-1)),p=a.map((m,v)=>m+n[v]+n[v+u]).map((m,v)=>Math.floor((m-f[v]+r[v])/r[v]));return p.splice(0,0,s),p.splice(o?3:1,0,c),p},Vg=[2,3,1,0],ML=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length>5)throw new Error("greater than 5D is not supported");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let i=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],n=e[1].dims[1]*t.group;if(i!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(e.length===3&&(e[2].dims.length!==1||e[1].dims[0]!==e[2].dims[0]))throw new Error("invalid bias");let r=e[0].dims.length-2;if(t.dilations.length!==r)throw new Error(`dilations should be ${r}D`);if(t.strides.length!==r)throw new Error(`strides should be ${r}D`);if(t.pads.length!==r*2)throw new Error(`pads should be ${r*2}D`);if(t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape")},Ug=(e,t)=>{let i=e.kernelShape.slice();i.length<t[1].dims.length-2&&i.push(...Array(t[1].dims.length-2-i.length).fill(0));for(let o=2;o<t[1].dims.length;++o)i[o-2]===0&&(i[o-2]=t[1].dims[o]);let n=e.pads.slice();t_.adjustPadsBasedOnAutoPad(t[0].dims,e.strides,e.dilations,i,n,e.format==="NHWC",e.autoPad);let r=Object.assign({},e);return Object.assign(r,{kernelShape:i,pads:n}),r},ME=e=>{let t=XE(e),i=e.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],r=e.dilations,o=e.group,s=e.kernel_shape,a=e.pads,u=e.strides,c=e.w_is_const();return Ae(ie({autoPad:n,format:i,dilations:r,group:o,kernelShape:s,pads:a,strides:u,wIsConst:c},t),{cacheKey:`${e.format};${t.activation};`})},KC=(e,t,i,n)=>{let r=i.format==="NHWC",o=kL(t[0].dims,t[1].dims,i.dilations,i.pads,i.strides,r);if(i.group!==1){let $=[t[0]];if(r){let k=e.kernelCustomData.wT??e.compute(Mi(t[1],Vg),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];i.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=k),$.push(k)}else $.push(t[1]);t.length===3&&$.push(t[2]),!e.adapterInfo.isArchitecture("ampere")&&r&&t[1].dims[0]===i.group&&t[1].dims[1]===1&&i.dilations[0]===1&&i.dilations[1]===1?e.compute(WV($,i,o,n),{inputs:$}):e.compute(HV($,i,o,n),{inputs:$});return}let s=t.length===3,a=t[0].dims[r?1:2],u=t[0].dims[r?2:3],c=t[0].dims[r?3:1],f=t[1].dims[2],p=t[1].dims[3],m=o[r?1:2],v=o[r?2:3],b=o[r?3:1],w=r&&f===a&&p===u&&i.pads[0]===0&&i.pads[1]===0;if(w||f===1&&p===1&&i.dilations[0]===1&&i.dilations[1]===1&&i.strides[0]===1&&i.strides[1]===1&&i.pads[0]===0&&i.pads[1]===0){let $=o[0],k,P,j,H=[];if(r){let L=e.kernelCustomData.wT??e.compute(Mi(t[1],Vg),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];if(i.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=L),w){let ge=a*u*c;k=t[0].reshape([1,$,ge]),P=L.reshape([1,ge,b]),j=[1,$,b]}else k=t[0].reshape([$,a*u,c]),P=L.reshape([1,c,b]),j=[$,m*v,b];H.push(k),H.push(P)}else k=t[0].reshape([$,c,a*u]),P=t[1].reshape([1,b,c]),j=[$,b,m*v],H.push(P),H.push(k);s&&H.push(t[2]);let re=j[2],ae=H[0].dims[H[0].dims.length-1];re<8&&ae<8?e.compute(tI(H,i,o,j,r,n),{inputs:H}):e.compute(i_(H,i,o,j,r,n),{inputs:H});return}let C=!0,x=e.kernelCustomData.wT??e.compute(Mi(t[1],Vg),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];i.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=x);let y=[t[0],x];s&&y.push(t[2]);let I=r?m*v:b,S=r?b:m*v,T=f*p*c;e.compute(jV(y,i,o,I,S,T,s,C,n),{inputs:y})},AL=(e,t)=>{let i=t.format==="NHWC",n=[e.inputs[0].reshape(i?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&n.push(e.inputs[2]);let r=[0,t.pads[0],0,t.pads[1]],o=[1].concat(t.strides),s=[1].concat(t.dilations),a=[1].concat(t.kernelShape),u=Ug(Ae(ie({},t),{pads:r,strides:o,dilations:s,kernelShape:a}),n);KC(e,n,u,c=>i?[c[0],c[2],c[3]]:[c[0],c[1],c[3]])},RL=(e,t,i)=>{let n=i.format==="NHWC"?"channelsLast":"channelsFirst",r=Ug(i,t),o=i.autoPad==="NOTSET"?i.pads:i.autoPad,s=VV(t[0].dims,t[1].dims,i.strides,i.dilations,o,!1,n);e.compute(UV(t,r,s.outShape,[s.filterDepth,s.filterHeight,s.filterWidth],[s.padInfo.front,s.padInfo.top,s.padInfo.left],n))},AE=(e,t)=>{if(ML(e.inputs,t),e.inputs[0].dims.length===3)AL(e,t);else if(e.inputs[0].dims.length===5)RL(e,e.inputs,t);else{let i=Ug(t,e.inputs);KC(e,e.inputs,i)}}}),qV,XX=ce(()=>{"use strict";ze(),xo(),He(),Ye(),qV=(e,t,i)=>{let n=e.length>2,r=t.outputShape,o=t.format==="NHWC",s=t.group,a=e[1].dims,u=a[2]/s,c=a[3],f=o?tn(u):1,p=o?tn(c):1,m=o?c===1?f:p:1,v=Q.size(r)/p,b=[Math.ceil(v/64),1,1];mt("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${b}`);let w=["rank","rank"],C=[t.strides[0],t.strides[1]],x=[t.kernelShape[o?1:2],t.kernelShape[o?2:3]],y=[t.dilations[0],t.dilations[1]],I=[x[0]+(t.dilations[0]<=1?0:(t.kernelShape[o?1:2]-1)*(t.dilations[0]-1)),x[1]+(t.dilations[1]<=1?0:(t.kernelShape[o?2:3]-1)*(t.dilations[1]-1))],S=[I[0]-1-Math.floor((t.pads[0]+t.pads[2])/2),I[1]-1-Math.floor((t.pads[1]+t.pads[3])/2)],T=[{type:12,data:v},{type:12,data:C},{type:12,data:x},{type:12,data:y},{type:12,data:I},{type:6,data:S},{type:12,data:u},{type:12,data:c},...$e(e[0].dims,e[1].dims)];n&&(T.push(...$e(e[2].dims)),w.push("rank")),T.push(...$e(r));let $=k=>{let P=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:C.length},{name:"filter_dims",type:"u32",length:x.length},{name:"dilations",type:"u32",length:x.length},{name:"effective_filter_dims",type:"u32",length:I.length},{name:"pads",type:"i32",length:S.length},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],j=Dn(e[0].dataType),H=o?1:2,re=o?2:3,ae=o?3:1,L=te("W",e[1].dataType,e[1].dims.length,m),ge=te("Dy",e[0].dataType,e[0].dims.length,f),ye=[ge,L];n&&ye.push(te("bias",e[2].dataType,[r[ae]].length,p));let Y=Ie("result",e[0].dataType,r.length,p),ve=()=>{let X="";if(f===1)X+=`
        let w_offset = ${L.indicesToOffset(`${L.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
        let wValue = ${L.getByOffset(`w_offset / ${m}`)};
        dotProd = dotProd + xValue * wValue;`;else if(c===1)X+=`
          let wValue = ${L.getByOffset(`${L.indicesToOffset(`${L.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)} / ${m}`)};
          dotProd = dotProd + dot(xValue, wValue);`;else for(let xe=0;xe<f;xe++)X+=`
            let wValue${xe} = ${L.getByOffset(`${L.indicesToOffset(`${L.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${xe}, wOutChannel)`)} / ${m}`)};
            dotProd = dotProd + xValue[${xe}] * wValue${xe};`;return X},we=`
            let outputIndices = ${Y.offsetToIndices(`global_idx * ${p}`)};
            let batch = ${Y.indicesGet("outputIndices",0)};
            let d1 = ${Y.indicesGet("outputIndices",ae)};
            let r = ${Y.indicesGet("outputIndices",H)};
            let c = ${Y.indicesGet("outputIndices",re)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${Y.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${j}(dyRCorner) + ${j}(wR)) / ${j}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${j}(uniforms.Dy_shape[${H}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }

              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${j}(dyCCorner) + ${j}(wC)) / ${j}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${j}(uniforms.Dy_shape[${re}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group; d2 = d2 + ${f}) {
                  let xValue = ${o?ge.getByOffset(`${ge.indicesToOffset(`${ge.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${f}`):ge.get("batch","inputChannel","idyR","idyC")};
                  ${ve()}
                  inputChannel = inputChannel + ${f};
                }
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${n?` + bias[d1 / ${p}]`:""};
            ${Y.setByOffset("global_idx","value")};
          `;return`
    ${k.registerUniforms(P).declareVariables(...ye,Y)}
      ${k.mainStart()}
      ${k.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${we}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${t.cacheKey};${f}${m}${p}${c===1}`,inputDependencies:w},getRunData:()=>({dispatchGroup:{x:b[0],y:b[1],z:b[2]},outputs:[{dims:i?i(r):r,dataType:e[0].dataType}],programUniforms:T}),getShaderSource:$}}}),OL,NL,PL,ZC,GV,FL,QC,zL,KV,eee=ce(()=>{"use strict";XX(),Aa(),ls(),OL=(e,t,i,n,r,o)=>(e-1)*t+i+(n-1)*r+1-o,NL=(e,t,i,n,r)=>{let o=Math.floor(e/2);t==="SAME_UPPER"?(i[n]=o,i[r]=e-o):t==="SAME_LOWER"&&(i[n]=e-o,i[r]=o)},PL=(e,t,i,n,r,o,s,a,u,c)=>{let f=e.length-2,p=c.length===0;u.length<f&&u.push(...Array(f-u.length).fill(0));let m=e[0],v=t[a?3:1]*r;for(let b=0,w=e.length-f-(a?1:0);b<f;++b,++w){let C=e[w],x=p?C*s[b]:c[b],y=OL(C,s[b],o[b],t[w],i[b],x);NL(y,n,o,b,b+f),p&&c.push(s[b]*(C-1)+u[b]+(t[w]-1)*i[b]+1-o[b]-o[b+f])}c.splice(0,0,m),c.splice(a?3:1,0,v)},ZC=(e,t)=>{let i=e.kernelShape.slice();if(e.kernelShape.length===0||e.kernelShape.reduce((p,m)=>p*m,1)===0){i.length=0;for(let p=2;p<t[1].dims.length;++p)i.push(t[1].dims[p])}let n=e.format==="NHWC";i.splice(0,0,t[1].dims[0]),i.splice(n?3:1,0,t[1].dims[1]);let r=e.pads.slice(),o=e.outputShape.slice(),s=e.outputPadding.slice(),a=t[0].dims,u=e.dilations.slice();if(u.reduce((p,m)=>p+m,0)===0){let p=t[0].dims.length-2;u=new Array(p).fill(1)}let c=e.strides.slice();if(c.reduce((p,m)=>p+m,0)===0){let p=t[0].dims.length-2;c=new Array(p).fill(1)}PL(a,i,u,e.autoPad,e.group,r,c,n,s,o);let f=Object.assign({},e);return Object.assign(f,{kernelShape:i,pads:r,outputPadding:s,outputShape:o,dilations:u,strides:c}),f},GV=e=>{let t=XE(e),i=e.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof e.autoPad>"u"?0:e.autoPad],r=e.dilations,o=e.group,s=e.kernelShape,a=e.pads,u=e.strides,c=e.wIsConst(),f=e.outputPadding,p=e.outputShape;return Ae(ie({autoPad:n,format:i,dilations:r,group:o,kernelShape:s,outputPadding:f,outputShape:p,pads:a,strides:u,wIsConst:c},t),{cacheKey:`${e.format};${t.activation};`})},FL=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length!==4&&e[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let i=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],n=e[1].dims[0];if(i!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let r=e[1].dims[1]*t.group;if(e.length===3&&(e[2].dims.length!==1||e[2].dims[0]!==r))throw new Error("invalid bias");let o=e[0].dims.length-2;if(t.dilations.reduce((s,a)=>s+a,0)>0&&t.dilations.length!==o)throw new Error(`dilations should be ${o}D`);if(t.strides.reduce((s,a)=>s+a,0)>0&&t.strides.length!==o)throw new Error(`strides should be ${o}D`);if(t.pads.reduce((s,a)=>s+a,0)>0&&t.pads.length!==o*2)throw new Error(`pads should be ${o*2}D`);if(t.outputPadding.length!==o&&t.outputPadding.length!==0)throw new Error(`output_padding should be ${o}D`);if(t.kernelShape.reduce((s,a)=>s+a,0)>0&&t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape");if(t.outputShape.length!==0&&t.outputShape.length!==e[0].dims.length-2)throw new Error("invalid output shape")},QC=(e,t,i,n)=>{let r=e.kernelCustomData.wT??e.compute(Mi(t[1],[2,3,0,1]),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];i.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=r);let o=[t[0],r];t.length===3&&o.push(t[2]),e.compute(qV(o,i,n),{inputs:o})},zL=(e,t)=>{let i=t.format==="NHWC",n=[e.inputs[0].reshape(i?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&n.push(e.inputs[2]);let r=t.kernelShape;(r.length===0||r[0]===0)&&(r=[e.inputs[1].dims[2]]);let o=t.dilations;(o.length===0||o[0]===0)&&(o=[1]);let s=t.strides;(s.length===0||s[0]===0)&&(s=[1]);let a=t.pads;a.length===0&&(a=[0,0]),a=[0,a[0],0,a[1]],s=[1].concat(s),o=[1].concat(o),r=[1].concat(r);let u=t.outputPadding;u=[0].concat(u);let c=ZC(Ae(ie({},t),{pads:a,strides:s,dilations:o,kernelShape:r,outputPadding:u}),n);QC(e,n,c,f=>i?[f[0],f[2],f[3]]:[f[0],f[1],f[3]])},KV=(e,t)=>{if(FL(e.inputs,t),e.inputs[0].dims.length===3)zL(e,t);else{let i=ZC(t,e.inputs);QC(e,e.inputs,i)}}}),LL,ZV,QV,tee=ce(()=>{"use strict";ze(),He(),sn(),Ye(),LL=(e,t,i,n)=>{let r=Q.size(t),o=t.length,s=te("input",e,o),a=Ie("output",e,o),u=i.dataType===6?i.getInt32Array()[0]:Number(i.getBigInt64Array()[0]),c=Q.normalizeAxis(u,o),f=p=>{let m=` i32(${s.indicesGet("inputIndices","uniforms.axis")}) `,v=De("uniforms.input_shape","uniforms.axis",o),b=n.reverse?m+(n.exclusive?" + 1":""):"0",w=n.reverse?v:m+(n.exclusive?"":" + 1");return`
                ${p.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(s,a)}
                ${p.mainStart()}
                  ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${a.offsetToIndices("global_idx")};
                  var sum = ${a.type.value}(0);
                  let first : i32 = ${b};
                  let last : i32 = ${w};
                  for (var i : i32 = first; i < last; i++) {
                    ${s.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${s.getByIndices("inputIndices")};
                  }
                  ${a.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:n.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:t,dataType:e}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:[{type:12,data:r},{type:12,data:c},...$e(t,t)]}),getShaderSource:f}},ZV=(e,t)=>{let i=e.inputs[0].dims,n=e.inputs[0].dataType,r=e.inputs[1];e.compute(LL(n,i,r,t),{inputs:[0]})},QV=e=>{let t=e.exclusive===1,i=e.reverse===1;return kt({exclusive:t,reverse:i})}}),BL,jL,VL,YV,JV,nee=ce(()=>{"use strict";ze(),He(),sn(),Ye(),BL=e=>{if(!e||e.length!==1)throw new Error("DepthToSpace requires 1 input.");if(e[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},jL=(e,t,i,n)=>{let r=[];r.push(`fn perm(i: ${n.type.indices}) -> ${i.type.indices} {
    var a: ${i.type.indices};`);for(let o=0;o<t;++o)r.push(i.indicesSet("a",e[o],`i[${o}]`));return r.push("return a;}"),r.join(`
`)},VL=(e,t)=>{let i,n,r,o,s,a,u=t.format==="NHWC",c=t.blocksize,f=t.mode==="DCR";u?([i,n,r,o]=e.dims,s=f?[i,n,r,c,c,o/c**2]:[i,n,r,o/c**2,c,c],a=f?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([i,n,r,o]=[e.dims[0],e.dims[2],e.dims[3],e.dims[1]],s=f?[i,c,c,o/c**2,n,r]:[i,o/c**2,c,c,n,r],a=f?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let p=e.reshape(s),m=p.dims.length,v=e.dataType,b=te("a",v,m),w=Ie("output",v,m),C=x=>`
  ${x.registerUniform("output_size","u32").declareVariables(b,w)}

  ${jL(a,m,b,w)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${w.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${w.setByOffset("global_idx",b.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${e.dims};${t.blocksize};${t.mode}`,inputDependencies:["rank"]},getRunData:x=>{let y=u?[i,n*c,r*c,o/c**2]:[i,o/c**2,n*c,r*c],I=Q.size(y),S=p.dims,T=Q.sortBasedOnPerm(S,a);return{outputs:[{dims:y,dataType:x[0].dataType}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:[{type:12,data:I},...$e(S,T)]}},getShaderSource:C}},YV=(e,t)=>{BL(e.inputs),e.compute(VL(e.inputs[0],t))},JV=e=>kt({blocksize:e.blocksize,mode:e.mode,format:e.format})}),Hg,Nf,YC,UL,HL,WL,qL,JC,GL,XV,eU,iee=ce(()=>{"use strict";ze(),He(),sn(),Ye(),Hg="[a-zA-Z]|\\.\\.\\.",Nf="("+Hg+")+",YC="^"+Nf+"$",UL="("+Nf+",)*"+Nf,HL="^"+UL+"$",WL=class{constructor(e=-1){this.symbolToIndices=new Map,this.inputIndex=e}addSymbol(e,t){let i=this.symbolToIndices.get(e);i===void 0?i=[t]:i.push(t),this.symbolToIndices.set(e,i)}},qL=class{constructor(e,t){this.equation=t,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[i,n]=t.includes("->")?t.split("->",2):[t,""];if(!i.match(RegExp(HL)))throw new Error("Invalid LHS term");if(i.split(",").forEach((r,o)=>{let s=e[o].dims.slice();if(!r.match(RegExp(YC)))throw new Error("Invalid LHS term");let a=this.processTerm(r,!0,s,o);this.lhs.push(a)}),n==="")n+=[...this.symbolToInfo.entries()].filter(([r,o])=>o.count===1||r==="...").map(([r])=>r).join("");else if(!n.match(RegExp(Nf)))throw new Error("Invalid RHS");n.match(RegExp(Hg,"g"))?.forEach(r=>{if(r==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let o=this.symbolToInfo.get(r);if(o===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(o.dimValue)}}),this.rhs=this.processTerm(n,!1,this.outputDims)}addSymbol(e,t,i){let n=this.symbolToInfo.get(e);if(n!==void 0){if(n.dimValue!==t&&n.count!==1)throw new Error("Dimension mismatch");n.count++,n.inputIndices.push(i)}else n={count:1,dimValue:t,inputIndices:[i]};this.symbolToInfo.set(e,n)}processTerm(e,t,i,n=-1){let r=i.length,o=!1,s=[],a=0;if(!e.match(RegExp(YC))&&!t&&e!=="")throw new Error("Invalid LHS term");let u=e.match(RegExp(Hg,"g")),c=new WL(n);return u?.forEach((f,p)=>{if(f==="..."){if(o)throw new Error("Only one ellipsis is allowed per input term");o=!0;let m=r-u.length+1;if(m<0)throw new Error("Ellipsis out of bounds");if(s=i.slice(a,a+m),this.hasEllipsis){if(this.ellipsisDims.length!==s.length||this.ellipsisDims.toString()!==s.toString())throw new Error("Ellipsis dimensions mismatch")}else if(t)this.hasEllipsis=!0,this.ellipsisDims=s;else throw new Error("Ellipsis must be specified in the LHS");for(let v=0;v<s.length;v++){let b=String.fromCharCode(48+v);c.addSymbol(b,p+v),this.addSymbol(b,i[a++],n)}}else c.addSymbol(f,p+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(f,i[a++],n)}),c}},JC=e=>e+"_max",GL=(e,t,i,n)=>{let r=e.map(c=>c.length).map((c,f)=>te(`input${f}`,t,c)),o=Q.size(n),s=Ie("output",t,n.length),a=[...i.symbolToInfo.keys()].filter(c=>!i.rhs.symbolToIndices.has(c)),u=c=>{let f=[],p="var prod = 1.0;",m="var sum = 0.0;",v="sum += prod;",b=[],w=[],C=[],x=[],y=i.symbolToInfo.size===i.rhs.symbolToIndices.size;i.symbolToInfo.forEach((S,T)=>{if(i.rhs.symbolToIndices.has(T)){let $=i.rhs.symbolToIndices.get(T)?.[0];$!==void 0&&i.lhs.forEach((k,P)=>{if(S.inputIndices.includes(P)){let j=k.symbolToIndices.get(T);if(j===void 0)throw new Error("Invalid symbol error");j.forEach(H=>{f.push(`${r[P].indicesSet(`input${P}Indices`,H,s.indicesGet("outputIndices",$))}`)})}})}else i.lhs.forEach(($,k)=>{if(S.inputIndices.includes(k)){let P=$.symbolToIndices.get(T);if(P===void 0)throw new Error("Invalid symbol error");P.forEach(j=>{b.push(`${r[k].indicesSet(`input${k}Indices`,j,`${T}`)}`)}),x.push(`prod *= ${r[k].getByIndices(`input${k}Indices`)};`)}}),w.push(`for(var ${T}: u32 = 0; ${T} < uniforms.${JC(T)}; ${T}++) {`),C.push("}")});let I=y?[...f,`let sum = ${r.map((S,T)=>S.getByIndices(`input${T}Indices`)).join(" * ")};`]:[...f,m,...w,...b,p,...x,v,...C];return`
            ${c.registerUniforms(a.map(S=>({name:`${JC(S)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...r,s)}

            ${c.mainStart()}
            ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${s.offsetToIndices("global_idx")};
            ${r.map((S,T)=>`var input${T}Indices: ${r[T].type.indices};`).join(`
`)}
            ${I.join(`
`)};
            ${s.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:i.equation,inputDependencies:e.map(()=>"rank")},getRunData:()=>{let c=a.filter(p=>i.symbolToInfo.has(p)).map(p=>({type:12,data:i.symbolToInfo.get(p)?.dimValue||0}));c.push({type:12,data:o});let f=e.map((p,m)=>[...$e(p)]).reduce((p,m)=>p.concat(m),c);return f.push(...$e(n)),{outputs:[{dims:n,dataType:t}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:f}},getShaderSource:u}},XV=(e,t)=>{let i=new qL(e.inputs,t.equation),n=i.outputDims,r=e.inputs.map((o,s)=>o.dims);e.compute(GL(r,e.inputs[0].dataType,i,n))},eU=e=>{let t=e.equation.replace(/\s+/g,"");return kt({equation:t})}}),KL,XC,ZL,QL,tU,ree=ce(()=>{"use strict";ze(),He(),Ye(),KL=e=>{if(!e||e.length!==2)throw new Error("Expand requires 2 input.");let t=e[0].dims,i=Array.from(e[1].getBigInt64Array(),Number),n=i.length<t.length?0:i.length-t.length,r=t.length<i.length?0:t.length-i.length;for(;n<i.length&&r<t.length;++n,++r)if(i[n]!==t[r]&&i[n]!==1&&t[r]!==1)throw new Error("Expand requires shape to be broadcastable to input")},XC=(e,t)=>{let i=e.length-t.length,n=[];for(let r=0;r<i;++r)n.push(e[r]);for(let r=0;r<t.length;++r)n.push(t[r]===1?e[r+i]:t[r]);return n},ZL=(e,t)=>e.length>t.length?XC(e,t):XC(t,e),QL=e=>{let t=e[0].dims,i=Array.from(e[1].getBigInt64Array(),Number),n=ZL(t,i),r=e[0].dataType,o=r===9||Q.size(t)===1,s=r===9||t.length>0&&t[t.length-1]%4===0?4:1,a=o||n.length>0&&n[n.length-1]%4===0?4:1,u=Math.ceil(Q.size(n)/a),c=p=>{let m=te("input",r,t.length,s),v=Ie("output",r,n.length,a),b;if(r===9){let w=(C,x,y="")=>`
          let outputIndices${x} = ${v.offsetToIndices(`outputOffset + ${x}u`)};
          let offset${x} = ${m.broadcastedIndicesToOffset(`outputIndices${x}`,v)};
          let index${x} = offset${x} / 4u;
          let component${x} = offset${x} % 4u;
          ${C}[${x}] = ${y}(${m.getByOffset(`index${x}`)}[component${x}]);
        `;b=`
        let outputOffset = global_idx * ${a};
        var data = vec4<u32>(0);
        ${w("data",0,"u32")}
        ${w("data",1,"u32")}
        ${w("data",2,"u32")}
        ${w("data",3,"u32")}
        ${v.setByOffset("global_idx","data")}
      }`}else b=`
        let outputIndices = ${v.offsetToIndices(`global_idx * ${a}`)};
        let inputOffset = ${m.broadcastedIndicesToOffset("outputIndices",v)};
        let data = ${v.type.value}(${m.getByOffset(`inputOffset / ${s}`)});
        ${v.setByOffset("global_idx","data")}
      }`;return`
    ${p.registerUniform("vec_size","u32").declareVariables(m,v)}
    ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${b}`},f=[{type:12,data:u},...$e(t,n)];return{name:"Expand",shaderCache:{hint:`${n.length};${s}${a}`,inputDependencies:["rank"]},getShaderSource:c,getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:f})}},tU=e=>{KL(e.inputs),e.compute(QL(e.inputs),{inputs:[0]})}}),YL,nU,oee=ce(()=>{"use strict";ze(),He(),Ye(),JE(),YL=e=>{let t=e[0].dataType,i=Q.size(e[0].dims),n=Q.size(e[1].dims),r=n%4===0,o=s=>{let a=te("x",t,[1],4),u=te("bias",t,[1],4),c=Ie("y",t,[1],4),f=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],p=v=>`
      let bias${v}_offset: u32 = (global_idx * 4 + ${v}) % uniforms.bias_size;
      let bias${v} = ${u.getByOffset(`bias${v}_offset / 4`)}[bias${v}_offset % 4];`,m=r?`
      let bias = ${u.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${p(0)}${p(1)}${p(2)}${p(3)}
      let bias = ${a.type.value}(bias0, bias1, bias2, bias3);`;return`${s.registerUniforms(f).declareVariables(a,u,c)}

    ${DE(Jn(t))}

    ${s.mainStart(Kl)}
      ${s.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${a.getByOffset("global_idx")};
      ${m}
      let x_in = x + bias;
      ${c.setByOffset("global_idx",TE("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${r}`,inputDependencies:["type","type"]},getShaderSource:o,getRunData:s=>({outputs:[{dims:s[0].dims,dataType:s[0].dataType}],programUniforms:[{type:12,data:Math.ceil(i/4)},{type:12,data:n}],dispatchGroup:{x:Math.ceil(i/Kl/4)}})}},nU=e=>{e.inputs.length<2||Q.size(e.inputs[1].dims)===0?xV(e):e.compute(YL(e.inputs))}}),JL,XL,iU,rU,see=ce(()=>{"use strict";ze(),He(),sn(),Ye(),JL=e=>{if(!e||e.length!==2)throw new Error("Gather requires 2 inputs.")},XL=(e,t)=>{let i=e[0].dims,n=e[1].dims,r=i.length,o=Q.normalizeAxis(t.axis,r),s=i.slice(0);s.splice(o,1,...n);let a=i[o],u=e[0].dataType===9?4:1,c=Math.ceil(Q.size(s)/u),f=[{type:12,data:c},{type:6,data:a},{type:12,data:o},...$e(e[0].dims,e[1].dims,s)],p=m=>{let v=te("data",e[0].dataType,e[0].dims.length,u),b=te("inputIndices",e[1].dataType,e[1].dims.length),w=Ie("output",e[0].dataType,s.length,u),C=y=>{let I=n.length,S=`var indicesIndices${y}  = ${b.type.indices}(0);`;for(let T=0;T<I;T++)S+=`${I>1?`indicesIndices${y}[${T}]`:`indicesIndices${y}`} = ${s.length>1?`outputIndices${y}[uniforms.axis + ${T}]`:`outputIndices${y}`};`;S+=`
          var idx${y} = ${b.getByIndices(`indicesIndices${y}`)};
          if (idx${y} < 0) {
            idx${y} = idx${y} + uniforms.axisDimLimit;
          }
          var dataIndices${y} : ${v.type.indices};
        `;for(let T=0,$=0;T<r;T++)T===o?(S+=`${r>1?`dataIndices${y}[${T}]`:`dataIndices${y}`} = u32(idx${y});`,$+=I):(S+=`${r>1?`dataIndices${y}[${T}]`:`dataIndices${y}`} = ${s.length>1?`outputIndices${y}[${$}]`:`outputIndices${y}`};`,$++);return S},x;if(e[0].dataType===9){let y=(I,S,T="")=>`
          let outputIndices${S} = ${w.offsetToIndices(`outputOffset + ${S}u`)};
          ${C(S)};
          let offset${S} = ${v.indicesToOffset(`dataIndices${S}`)};
          let index${S} = offset${S} / 4u;
          let component${S} = offset${S} % 4u;
          ${I}[${S}] = ${T}(${v.getByOffset(`index${S}`)}[component${S}]);
        `;x=`
        let outputOffset = global_idx * ${u};
        var value = vec4<u32>(0);
        ${y("value",0,"u32")}
        ${y("value",1,"u32")}
        ${y("value",2,"u32")}
        ${y("value",3,"u32")}
        ${w.setByOffset("global_idx","value")}
      `}else x=`
      let outputIndices = ${w.offsetToIndices("global_idx")};
      ${C("")};
      let value = ${v.getByIndices("dataIndices")};
      ${w.setByOffset("global_idx","value")};
      `;return`
      ${m.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(v,b,w)}
      ${m.mainStart()}
        ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${x}
      }`};return{name:"Gather",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:f}),getShaderSource:p}},iU=e=>kt({axis:e.axis}),rU=(e,t)=>{let i=e.inputs;JL(i),e.compute(XL(e.inputs,t))}}),eB,oU,sU,aee=ce(()=>{"use strict";ze(),He(),Ye(),eB=(e,t,i,n,r,o,s,a,u)=>{let c=[{type:12,data:o},{type:12,data:n},{type:12,data:r},{type:12,data:i},{type:12,data:s},{type:12,data:a},{type:12,data:u}],f=[o];c.push(...$e(t.dims,f));let p=m=>{let v=te("indices_data",t.dataType,t.dims.length),b=Ie("input_slice_offsets_data",12,1,1),w=[v,b],C=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:r.length},{name:"sizes_from_slice_dims_data",type:"u32",length:i.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${m.registerUniforms(C).declareVariables(...w)}
  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${r.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${i.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return e.compute({name:"computeSliceOffsets",shaderCache:{hint:`${r.length}_${i.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:f,dataType:e.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:c}),getShaderSource:p},{inputs:[t],outputs:[-1]})[0]},oU=(e,t)=>{let i=e.inputs,n=i[0].dims,r=i[0].dataType,o=i[1].dims,s=o[o.length-1],a=Q.sizeToDimension(o,o.length-1),u=Q.sizeFromDimension(n,t.batchDims+s),c=Q.sizeToDimension(n,t.batchDims),f=Q.sizeFromDimension(n,t.batchDims),p=a/c,m=new Array(s),v=u;for(let S=0;S<s;++S)m[s-1-S]=v,v*=n[t.batchDims+s-1-S];let b=eB(e,i[1],m,t.batchDims,n,a,p,f,s),w=t.batchDims+s;if(w>n.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let C=o.slice(0,-1).concat(n.slice(w)),x=Q.size(C),y=[{type:12,data:x},{type:12,data:u},...$e(i[0].dims,b.dims,C)],I=S=>{let T=te("data",i[0].dataType,i[0].dims.length),$=te("slice_offsets",12,b.dims.length),k=Ie("output",i[0].dataType,C.length);return`
          ${S.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(T,$,k)}
            ${S.mainStart()}
            ${S.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};e.compute({name:"GatherND",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:C,dataType:r}],dispatchGroup:{x:Math.ceil(x/64)},programUniforms:y}),getShaderSource:I},{inputs:[i[0],b]})},sU=e=>({batchDims:e.batch_dims,cacheKey:""})}),tB,nB,aU,lU,lee=ce(()=>{"use strict";ze(),He(),sn(),Ye(),tB=(e,t)=>{if(e.length<3||e.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let i=Q.normalizeAxis(t.quantizeAxis,e[0].dims.length),n=t.blockSize,r=e[0],o=e[2],s=e.length===4?e[3]:void 0;if(o.dims.length!==r.dims.length||!r.dims.map((a,u)=>u===i?Math.ceil(a/n)===o.dims[u]:a===o.dims[u]).reduce((a,u)=>a&&u,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(s){if(s.dataType!==r.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(s.dims.length!==o.dims.length||!s.dims.map((a,u)=>a===o.dims[u]).reduce((a,u)=>a&&u,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},nB=(e,t)=>{let i=e[0].dims,n=e[1].dims,r=i.length,o=Q.normalizeAxis(t.gatherAxis,r),s=Q.normalizeAxis(t.quantizeAxis,r),a=i.slice(0);a.splice(o,1,...n);let u=Q.size(a),c=e[2].dataType,f=e[0].dataType===22,p=[{type:12,data:u},{type:12,data:s},{type:12,data:o},{type:12,data:t.blockSize},...$e(...e.map((v,b)=>v.dims),a)],m=v=>{let b=te("data",e[0].dataType,e[0].dims.length),w=te("inputIndices",e[1].dataType,e[1].dims.length),C=te("scales",e[2].dataType,e[2].dims.length),x=e.length>3?te("zeroPoint",e[3].dataType,e[3].dims.length):void 0,y=Ie("output",c,a.length),I=[b,w,C];x&&I.push(x);let S=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${v.registerUniforms(S).declareVariables(...I,y)}
        ${v.mainStart()}
        let output_indices = ${y.offsetToIndices("global_idx")};
        var indices_indices = ${w.type.indices}(0);
        ${n.length>1?`
          for (var i: u32 = 0; i < ${n.length}; i++) {
            let index = ${y.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${w.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${y.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${b.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${y.indicesGet("output_indices","i")};
          ${b.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${w.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${i[o]};
        }
        ${b.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${a.length}; i++) {
          let index = ${y.indicesGet("output_indices",`i + ${n.length} - 1`)};
          ${b.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${b.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${b.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${f?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${C.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${C.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${C.getByIndices("scale_indices")};
        ${x?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${x.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${x.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${f?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${Jn(c)}(quantized_data - zero_point) * scale;
        ${y.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${t.cacheKey};${e.filter((v,b)=>b!==1).map(v=>v.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:e.length},(v,b)=>"rank")},getRunData:()=>({outputs:[{dims:a,dataType:c}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:p}),getShaderSource:m}},aU=(e,t)=>{let i=e.inputs;tB(i,t),e.compute(nB(e.inputs,t))},lU=e=>kt({blockSize:e.blockSize,gatherAxis:e.gatherAxis,quantizeAxis:e.quantizeAxis})}),iB,rB,uU,cU,uee=ce(()=>{"use strict";ze(),He(),sn(),Ye(),iB=e=>{if(!e||e.length!==2)throw new Error("GatherElements requires 2 inputs.");if(e[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(e[0].dims.length!==e[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},rB=(e,t)=>{let i=e[0].dims,n=e[0].dataType,r=i.length,o=e[1].dims,s=e[1].dataType,a=Q.normalizeAxis(t.axis,r),u=i[a],c=o.slice(0),f=Q.size(c),p=te("input",n,r),m=te("indicesInput",s,o.length),v=Ie("output",n,c.length),b=[{type:12,data:f},{type:6,data:u},{type:12,data:a}];return b.push(...$e(i,o,c)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:c,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:b}),getShaderSource:w=>`
      ${w.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(p,m,v)}
      ${w.mainStart()}
      ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${v.offsetToIndices("global_idx")};

      var idx = ${m.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${p.type.indices}(outputIndices);
      ${p.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${p.getByIndices("inputIndices")};

      ${v.setByOffset("global_idx","value")};
  }`}},uU=e=>kt({axis:e.axis}),cU=(e,t)=>{let i=e.inputs;iB(i),e.compute(rB(e.inputs,t))}}),oB,sB,dU,fU,cee=ce(()=>{"use strict";ze(),He(),Ye(),oB=e=>{if(!e)throw new Error("Input is missing");if(e.length<2||e.length>3)throw new Error("Invaid input number.");if(e.length===3&&e[2].dims.length>2)throw new Error("Invalid input shape of C");if(e[0].dataType!==e[1].dataType||e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("Input types are mismatched")},sB=(e,t)=>{let i=e[0].dims.slice(),n=e[1].dims.slice(),[r,o,s]=hj.getShapeOfGemmResult(i,t.transA,n,t.transB,e.length===3?e[2].dims:void 0),a=[r,o];if(!a)throw new Error("Can't use gemm on the given tensors");let u=16,c=Math.ceil(o/u),f=Math.ceil(r/u),p=!0,m=Q.size(a),v=[{type:12,data:p?c:m},{type:12,data:r},{type:12,data:o},{type:12,data:s},{type:1,data:t.alpha},{type:1,data:t.beta}],b=["type","type"];e.length===3&&(v.push(...$e(e[2].dims)),b.push("rank")),v.push(...$e(a));let w=x=>{let y="";t.transA&&t.transB?y="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":t.transA&&!t.transB?y="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!t.transA&&t.transB?y="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!t.transA&&!t.transB&&(y="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let I=t.alpha===1?"":"value *= uniforms.alpha;",S=te("a",e[0].dataType,e[0].dims),T=te("b",e[1].dataType,e[1].dims),$=S.type.value,k=null,P=[S,T];e.length===3&&(k=te("c",e[2].dataType,e[2].dims.length),P.push(k));let j=Ie("output",e[0].dataType,a.length);P.push(j);let H=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${x.registerUniforms(H).declareVariables(...P)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${$}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${y}
    }

    ${I}
    ${k!=null?`let cOffset = ${k.broadcastedIndicesToOffset("vec2(m, n)",j)}; value += ${$}(uniforms.beta) * ${k.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},C=x=>{let y=te("a",e[0].dataType,e[0].dims),I=te("b",e[1].dataType,e[1].dims),S=null,T=[y,I];e.length===3&&(S=te("c",e[2].dataType,e[2].dims.length),T.push(S));let $=Ie("output",e[0].dataType,a.length);T.push($);let k=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],P="",j="";t.transA&&t.transB?(j=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${I.type.value}(0);
      }
      `,P="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):t.transA&&!t.transB?(j=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${I.type.value}(0);
      }
      `,P="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!t.transA&&t.transB?(j=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${I.type.value}(0);
      }
      `,P="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!t.transA&&!t.transB&&(j=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${I.type.value}(0);
      }
      `,P="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let H=t.alpha===1?"":"value *= uniforms.alpha;";return`
  ${x.registerUniforms(k).declareVariables(...T)}
  var<workgroup> tile_a: array<array<${y.type.storage}, ${u}>, ${u}>;
  var<workgroup> tile_b: array<array<${I.type.storage}, ${u}>, ${u}>;
  ${x.mainStart([u,u,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${u};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${u};
    let num_tiles = (uniforms.K - 1) / ${u} + 1;
    var k_start = 0u;
    var value = ${$.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${j}
      k_start = k_start + ${u};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${u}; k++) {
        ${P}
      }
      workgroupBarrier();
    }

    ${H}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${S!=null?`let cOffset = ${S.broadcastedIndicesToOffset("vec2(m, n)",$)}; value += ${$.type.value}(uniforms.beta) * ${S.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return p?{name:"GemmShared",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:b},getRunData:()=>({outputs:[{dims:a,dataType:e[0].dataType}],dispatchGroup:{x:c*f},programUniforms:v}),getShaderSource:C}:{name:"Gemm",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:b},getRunData:()=>({outputs:[{dims:a,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:v}),getShaderSource:w}},dU=e=>{let t=e.transA,i=e.transB,n=e.alpha,r=e.beta;return{transA:t,transB:i,alpha:n,beta:r,cacheKey:`${e.transA};${e.transB};${e.alpha===1}`}},fU=(e,t)=>{oB(e.inputs),e.compute(sB(e.inputs,t))}}),Br,wo,wa,xa,aB,lB,uB,cB,dB,fB,hB,pB,hU,pU,dee=ce(()=>{"use strict";ze(),He(),sn(),Ye(),[Br,wo,wa,xa]=[0,1,2,3],aB=e=>{if(e[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(e[0].dims.length!==e[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(e[0].dims.length-2!==e[1].dims[e[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${e[0].dims.length-2}`);if(e[0].dims[0]!==e[1].dims[0])throw new Error("grid batch size must match input batch size")},lB=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,uB=e=>`
  fn gs_bicubic_interpolate(p: mat4x4<${e}>, x: f32, y: f32) -> ${e} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${e}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,cB=e=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${e.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,dB=e=>`
  ${e.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,fB=(e,t,i)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${t} {
     var pixel = ${t}(0);
     var indices = vec4<u32>(0);
     indices[${Br}] = batch;
     indices[${wo}] = channel;`+(()=>{switch(i.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${wa}] = u32(r);
            indices[${xa}] = u32(c);
          }
        `;case"border":return`
          indices[${wa}] = u32(clamp(r, 0, H - 1));
          indices[${xa}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${wa}] = gs_reflect(r, border[1], border[3]);
          indices[${xa}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${i.paddingMode} is not supported`)}})()+`
    return ${e.getByIndices("indices")};
  }
`,hB=(e,t,i)=>(()=>{switch(i.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${Br}], indices[${wo}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${Br}], indices[${wo}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${Br}], indices[${wo}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${Br}], indices[${wo}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${Br}], indices[${wo}], border);

          let dx2 = ${t}(f32(x2) - x);
          let dx1 = ${t}(x - f32(x1));
          let dy2 = ${t}(f32(y2) - y);
          let dy1 = ${t}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${t}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${Br}], indices[${wo}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${i.mode} is not supported`)}})()+`${e.setByOffset("global_idx","result")}`,pB=(e,t)=>{let i=te("x",e[0].dataType,e[0].dims.length),n=[e[1].dims[0],e[1].dims[1],e[1].dims[2]],r=te("grid",e[1].dataType,n.length,2),o=[e[0].dims[0],e[0].dims[1],e[1].dims[1],e[1].dims[2]];t.format==="NHWC"&&(o=[e[0].dims[0],e[1].dims[1],e[1].dims[2],e[0].dims[3]],[Br,wo,wa,xa]=[0,3,1,2]);let s=Ie("output",e[0].dataType,o.length),a=i.type.value,u=Q.size(o),c=[{type:12,data:u},...$e(e[0].dims,n,o)],f=p=>`
  ${p.registerUniform("output_size","u32").declareVariables(i,r,s)}
  ${lB}
  ${uB(a)}
  ${cB(t)}
  ${dB(t)}
  ${fB(i,a,t)}

  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${wa}]);
      let W_in = i32(uniforms.x_shape[${xa}]);

      ${t.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${s.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${Br}], indices[${wa}], indices[${xa}]);
      let nxy = ${r.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${hB(s,a,t)}
  }`;return{name:"GridSample",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:["type","type"]},getRunData:p=>{let m=Q.size(o);return{outputs:[{dims:o,dataType:p[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:c}},getShaderSource:f}},hU=(e,t)=>{aB(e.inputs),e.compute(pB(e.inputs,t))},pU=e=>kt({alignCorners:e.align_corners,mode:e.mode,paddingMode:e.padding_mode,format:e.format})}),fi,mB,mU,eE,gB,Uf,gU,_U=ce(()=>{"use strict";ze(),He(),sn(),KE(),YE(),Ye(),ls(),fi=(e,t)=>e.length>t&&e[t].dims.length>0?e[t]:void 0,mB=(e,t)=>{let i=e[0],n=fi(e,1),r=fi(e,2),o=fi(e,3),s=fi(e,4),a=fi(e,5),u=fi(e,6),c=fi(e,7);if(i.dims.length!==3&&i.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let f=i.dims[0],p=i.dims[1],m=i.dims.length===3?i.dims[2]:t.numHeads*i.dims[4],v=p,b=0,w=0,C=Math.floor(m/t.numHeads);if(u&&c&&Q.size(u.dims)&&Q.size(c.dims)){if(u.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(u.dims[0]!==f||u.dims[1]!==t.numHeads||u.dims[3]!==C)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(c.dims[0]!==f||c.dims[1]!==t.numHeads||c.dims[3]!==C)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(u.dims[2]!==c.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(c.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');b=u.dims[2],w=u.dims[2]}else if(u&&Q.size(u.dims)||c&&Q.size(c.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let x;if(n&&Q.size(n.dims)>0){if(i.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(i.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(n.dims[2]!==i.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');x=2,v=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==t.numHeads||n.dims[3]!==2||n.dims[4]!==C)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(r)throw new Error('Expect "value" be none when "key" has packed kv format.');x=5,v=n.dims[1]}else{if(n.dims[1]!==t.numHeads||n.dims[3]!==C)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');x=0,v=n.dims[2]}}else{if(i.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(i.dims[2]!==t.numHeads||i.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');x=3}if(o&&Q.size(o.dims)>0){if(o.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(n&&n.dims.length===5&&n.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let y=b+v,I=0;if(s&&Q.size(s.dims)>0){I=8;let k=s.dims;throw k.length===1?k[0]===f?I=1:k[0]===3*f+2&&(I=3):k.length===2&&k[0]===f&&k[1]===y&&(I=5),I===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let S=!1,T=m;if(r&&Q.size(r.dims)>0){if(r.dims.length!==3&&r.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(i.dims[0]!==r.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(r.dims.length===3){if(v!==r.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');T=r.dims[2]}else{if(v!==r.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');T=r.dims[1]*r.dims[3],S=!0}}let $=!1;if(s&&Q.size(s.dims)>0)throw new Error("Key padding mask is not supported");if(a&&Q.size(a.dims)>0){if(a.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(a.dims[0]!==f||a.dims[1]!==t.numHeads||a.dims[2]!==p||a.dims[3]!==y)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:f,sequenceLength:p,pastSequenceLength:b,kvSequenceLength:v,totalSequenceLength:y,maxSequenceLength:w,inputHiddenSize:0,hiddenSize:m,vHiddenSize:T,headSize:C,vHeadSize:Math.floor(T/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:I,scale:t.scale,broadcastResPosBias:$,passPastInKv:S,qkvFormat:x}},mU=e=>kt(ie({},e)),eE=kt({perm:[0,2,1,3]}),gB=(e,t,i,n,r,o,s)=>{let a=[n,r,o],u=Q.size(a),c=[{type:12,data:u},{type:12,data:s},{type:12,data:o}],f=p=>{let m=Ie("qkv_with_bias",t.dataType,a),v=te("qkv",t.dataType,a),b=te("bias",i.dataType,a),w=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${p.registerUniforms(w).declareVariables(v,b,m)}
  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return e.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:a,dataType:t.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c}),getShaderSource:f},{inputs:[t,i],outputs:[-1]})[0]},Uf=(e,t,i,n,r,o,s,a)=>{let u=o;if(s&&Q.size(s.dims)>0){if(n===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return u=gB(e,o,s,t,n,i*r,a),u=u.reshape([t,n,i,r]),i===1||n===1?u:e.compute(Mi(u,eE.perm),{inputs:[u],outputs:[-1]})[0]}else return o.dims.length===3&&(u=o.reshape([t,n,i,r])),i===1||n===1?u:e.compute(Mi(u,eE.perm),{inputs:[u],outputs:[-1]})[0]},gU=(e,t)=>{let i=mB(e.inputs,t),n=e.inputs[0],r=fi(e.inputs,1),o=fi(e.inputs,2),s=fi(e.inputs,3),a=fi(e.inputs,4),u=fi(e.inputs,5),c=fi(e.inputs,6),f=fi(e.inputs,7);if(n.dims.length===5)throw new Error("Packed QKV is not implemented");if(r?.dims.length===5)throw new Error("Packed KV is not implemented");let p=r&&o&&r.dims.length===4&&o.dims.length===4,m=Uf(e,i.batchSize,i.numHeads,i.sequenceLength,i.headSize,n,s,0);if(p)return Wf(e,m,r,o,a,void 0,c,f,u,i);if(!r||!o)throw new Error("key and value must be provided");let v=Uf(e,i.batchSize,i.numHeads,i.kvSequenceLength,i.headSize,r,s,i.hiddenSize),b=Uf(e,i.batchSize,i.numHeads,i.kvSequenceLength,i.vHeadSize,o,s,2*i.hiddenSize);Wf(e,m,v,b,a,void 0,c,f,u,i)}}),_B,vB,bB,yB,RE,vU,bU,yU=ce(()=>{"use strict";ze(),He(),sn(),Ye(),_B=e=>{if(!e||e.length<1)throw new Error("too few inputs")},vB=(e,t)=>{let i=[],n=t.numOutputs;return e[1].dims[0]>0&&(e[1].getBigInt64Array().forEach(r=>i.push(Number(r))),n=i.length),kt({numOutputs:n,axis:t.axis,splitSizes:i})},bB=e=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${e}u; i += 1u ) {
    if (index < ${De("uniforms.size_in_split_axis","i",e)}) {
        return i;
    }
    }
    return ${e}u;
}`,yB=e=>{let t=e.length,i=[];for(let n=0;n<t;++n){let r=e[n].setByIndices("indices","input[global_idx]");t===1?i.push(r):n===0?i.push(`if (output_number == ${n}u) { ${r} }`):n===t-1?i.push(`else { ${r} }`):i.push(`else if (output_number == ${n}) { ${r} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${e[0].type.indices}, global_idx: u32) {
        ${i.join(`
`)}
      }`},RE=(e,t)=>{let i=e[0].dims,n=Q.size(i),r=e[0].dataType,o=Q.normalizeAxis(t.axis,i.length),s=new Array(t.numOutputs),a=te("input",r,i.length),u=new Array(t.numOutputs),c=[],f=[],p=0,m=[{type:12,data:n}];for(let b=0;b<t.numOutputs;b++){p+=t.splitSizes[b],u[b]=p;let w=i.slice();w[o]=t.splitSizes[b],f.push(w),s[b]=Ie(`output${b}`,r,w.length),c.push({dims:f[b],dataType:e[0].dataType})}m.push({type:12,data:u},...$e(i,...f));let v=b=>`
  ${b.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",u.length).declareVariables(a,...s)}
  ${bB(u.length)}
  ${yB(s)}

  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${a.offsetToIndices("global_idx")};
    var index = ${a.indicesGet("indices",o)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${De("uniforms.size_in_split_axis","output_number - 1u",u.length)};
      ${a.indicesSet("indices",o,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:t.cacheKey,inputDependencies:["rank"]},getShaderSource:v,getRunData:()=>({outputs:c,dispatchGroup:{x:Math.ceil(n/64)},programUniforms:m})}},vU=(e,t)=>{_B(e.inputs);let i=e.inputs.length===1?t:vB(e.inputs,t);e.compute(RE(e.inputs,i),{inputs:[0]})},bU=e=>{let t=e.axis,i=e.splitSizes,n=e.numOutputs<0?i.length:e.numOutputs;if(n!==i.length)throw new Error("numOutputs and splitSizes lengh must be equal");return kt({axis:t,numOutputs:n,splitSizes:i})}}),wB,xB,tE,wU,fee=ce(()=>{"use strict";sn(),YE(),_U(),yU(),ls(),wB=(e,t)=>{if(t.doRotary)throw new Error("GroupQuerryAttention do_rotary attribute is not supported");if(t.doRotary&&e.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let i=e[0],n=e[1],r=e[2],o=e[3],s=e[4];if(t.localWindowSize!==-1)throw new Error("Local attention is not supported");if(t.softcap!==0)throw new Error("Softcap is not supported");if(t.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(t.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(i.dims.length!==3&&i.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let a=!1,u=i.dims[0],c=i.dims[1],f=i.dims.length===3?a?i.dims[2]/3:i.dims[2]:t.numHeads*i.dims[4],p=c,m=0,v=!n||n.dims.length===0,b=Math.floor(v?f/(t.numHeads+2*t.kvNumHeads):f/t.numHeads);v&&(f=b*t.numHeads);let w=o&&o.dims.length!==0,C=s&&s.dims.length!==0;if(w&&o.dims.length===4&&o.dims[0]===u&&o.dims[1]!==t.kvNumHeads&&o.dims[2]===t.kvNumHeads&&o.dims[3]===b)throw new Error("BSNH pastKey/pastValue is not supported");if(w&&C){if(o.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(s.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');m=o.dims[2]}else if(w||C)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let x=1;if(n&&n.dims.length>0){if(i.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(i.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(i.dims[2]%n.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');p=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==t.numHeads||n.dims[3]!==2||n.dims[4]!==b)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(r)throw new Error('Expect "value" be none when "key" has packed kv format.');p=n.dims[1]}else{if(n.dims[1]!==t.numHeads||n.dims[3]!==b)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');p=n.dims[2]}}else{if(i.dims.length!==3&&i.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(i.dims.length===5&&(i.dims[2]!==t.numHeads||i.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');x=3}let y=0,I=!1,S=t.kvNumHeads?b*t.kvNumHeads:f;if(r&&r.dims.length>0){if(r.dims.length!==3&&r.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(i.dims[0]!==r.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(r.dims.length===3){if(p!==r.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');S=r.dims[2]}else{if(p!==r.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');S=r.dims[1]*r.dims[3],I=!0}}let T=e.length>4?e[5]:void 0;if(T&&T.dims.length!==1&&T.dims[0]!==u)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:u,sequenceLength:c,pastSequenceLength:m,kvSequenceLength:p,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:f,vHiddenSize:S,headSize:b,vHeadSize:Math.floor(S/t.kvNumHeads),numHeads:t.numHeads,kvNumHeads:t.kvNumHeads,nReps:t.numHeads/t.kvNumHeads,pastPresentShareBuffer:!1,maskType:y,scale:t.scale,broadcastResPosBias:!1,passPastInKv:I,qkvFormat:x}},xB=kt({perm:[0,2,1,3]}),tE=(e,t,i)=>{let n=t,r=i.kvNumHeads;return t.dims.length===3&&i.kvSequenceLength!==0&&(n=t.reshape([i.batchSize,i.kvSequenceLength,r,i.headSize]),n=e.compute(Mi(n,xB.perm),{inputs:[n],outputs:[-1]})[0]),n},wU=(e,t)=>{let i=wB(e.inputs,t);if(e.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(e.inputs[1]?.dims.length===5)throw new Error("Packed KV is not implemented");let n=e.inputs[0],r=e.inputs[1]&&e.inputs[1].dims.length>0?e.inputs[1]:void 0,o=e.inputs[2]&&e.inputs[2].dims.length>0?e.inputs[2]:void 0,s=e.inputs[3]&&e.inputs[3].dims.length!==0?e.inputs[3]:void 0,a=e.inputs[4]&&e.inputs[4].dims.length!==0?e.inputs[4]:void 0,u=e.inputs.length>4?e.inputs[5]:void 0,c=e.inputs.length>5?e.inputs[6]:void 0,f=i.kvNumHeads?i.kvNumHeads:i.numHeads,p=kt({axis:2,numOutputs:3,splitSizes:[i.numHeads*i.headSize,f*i.headSize,f*i.headSize]}),[m,v,b]=!r&&!o?e.compute(RE([n],p),{inputs:[n],outputs:[-1,-1,-1]}):[n,r,o],w=Uf(e,i.batchSize,i.numHeads,i.sequenceLength,i.headSize,m,void 0,0);Wf(e,w,tE(e,v,i),tE(e,b,i),void 0,void 0,s,a,void 0,i,u,c)}}),nE,CB,EB,xU,hee=ce(()=>{"use strict";ze(),He(),ls(),Ye(),nE=(e,t,i,n,r,o,s,a)=>{let u=tn(o),c=u===1?"f32":`vec${u}f`,f=u===1?"vec2f":`mat2x${u}f`,p=r*s,m=64;p===1&&(m=256);let v=[r,s,o/u],b=[r,s,2],w=["rank","type","type"],C=[];C.push(...$e(v,b));let x=y=>{let I=te("x",t.dataType,3,u),S=te("scale",i.dataType,i.dims),T=te("bias",n.dataType,n.dims),$=Ie("output",1,3,2),k=[I,S,T,$];return`
  var<workgroup> workgroup_shared : array<${f}, ${m}>;
  const workgroup_size = ${m}u;
  ${y.declareVariables(...k)}
  ${y.mainStart(m)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${c}(0);
    var squared_sum = ${c}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${c}(${I.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${f}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${as("workgroup_shared[0][0]",u)} / f32(hight * ${u});
      let squared_sum_final = ${as("workgroup_shared[0][1]",u)} / f32(hight * ${u});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${a}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return e.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${u};${a};${m}`,inputDependencies:w},getRunData:()=>({outputs:[{dims:b,dataType:1}],dispatchGroup:{x:p},programUniforms:C}),getShaderSource:x},{inputs:[t,i,n],outputs:[-1]})[0]},CB=(e,t,i)=>{let n=t[0].dims,r=n,o=2,s=n[0],a=n[1],u=Q.sizeFromDimension(n,o),c=tn(u),f=Q.size(r)/c,p=nE(e,t[0],t[1],t[2],s,u,a,i.epsilon),m=[s,a,u/c],v=[s,a],b=["type","none"],w=C=>{let x=te("x",t[0].dataType,m.length,c),y=te("scale_shift",1,v.length,2),I=Ie("output",t[0].dataType,m.length,c),S=[x,y,I];return`
  ${C.registerUniform("output_size","u32").declareVariables(...S)}
  ${C.mainStart()}
  ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${I.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${y.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${x.getByOffset("global_idx")} * ${I.type.value}(scale_shift.x) + ${I.type.value}(scale_shift.y);
      ${I.setByOffset("global_idx","value")};
  }`};e.compute({name:"InstanceNormalization",shaderCache:{hint:`${c}`,inputDependencies:b},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:[{type:12,data:f},...$e(m,v,m)]}),getShaderSource:w},{inputs:[t[0],p]})},EB=(e,t,i)=>{let n=t[0].dims,r=n,o=n[0],s=n[n.length-1],a=Q.sizeFromDimension(n,1)/s,u=tn(s),c=Q.size(r)/u,f=[{type:12,data:a},{type:12,data:Math.floor(s/u)}],p=["type","type"],m=!1,v=[0,n.length-1];for(let x=0;x<n.length-2;x++)m=m||n[x+1]!==1,v.push(x+1);m=m&&n[n.length-1]!==1;let b=m?e.compute(Mi(e.inputs[0],v),{inputs:[e.inputs[0]],outputs:[-1]})[0]:e.inputs[0].reshape(Array.from({length:n.length},(x,y)=>n[v[y]])),w=nE(e,b,t[1],t[2],o,a,s,i.epsilon),C=x=>{let y=Dn(t[0].dataType),I=u===1?"vec2f":`mat${u}x2f`,S=k=>{let P=k===0?"x":"y",j=u===1?"f32":`vec${u}f`;switch(u){case 1:return`${y}(${j}(scale.${P}))`;case 2:return`vec2<${y}>(${j}(scale[0].${P}, scale[1].${P}))`;case 4:return`vec4<${y}>(${j}(scale[0].${P}, scale[1].${P}, scale[2].${P}, scale[3].${P}))`;default:throw new Error(`Not supported compoents ${u}`)}},T=te("input",t[0].dataType,t[0].dims,u),$=Ie("output",t[0].dataType,r,u);return`
  @group(0) @binding(0) var<storage, read> input : array<${T.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${I}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${$.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${x.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${S(0)}, ${S(1)});
  }`};e.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${u}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:f}),getShaderSource:C},{inputs:[t[0],w]})},xU=(e,t)=>{t.format==="NHWC"?EB(e,e.inputs,t):CB(e,e.inputs,t)}}),IB,SB,CU,pee=ce(()=>{"use strict";ze(),He(),Ye(),IB=e=>{if(!e||e.length<2)throw new Error("layerNorm requires at least 2 inputs.")},SB=(e,t,i)=>{let n=t.simplified,r=e[0].dims,o=e[1],s=!n&&e[2],a=r,u=Q.normalizeAxis(t.axis,r.length),c=Q.sizeToDimension(r,u),f=Q.sizeFromDimension(r,u),p=Q.size(o.dims),m=s?Q.size(s.dims):0;if(p!==f||s&&m!==f)throw new Error(`Size of X.shape()[axis:] == ${f}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${p} and bias size of ${m}`);let v=[];for(let T=0;T<r.length;++T)T<u?v.push(r[T]):v.push(1);let b=tn(f),w=["type","type"],C=[{type:12,data:c},{type:1,data:f},{type:12,data:Math.floor(f/b)},{type:1,data:t.epsilon}];s&&w.push("type");let x=i>1,y=i>2,I=T=>{let $=Dn(e[0].dataType),k=[te("x",e[0].dataType,e[0].dims,b),te("scale",o.dataType,o.dims,b)];s&&k.push(te("bias",s.dataType,s.dims,b)),k.push(Ie("output",e[0].dataType,a,b)),x&&k.push(Ie("mean_data_output",1,v)),y&&k.push(Ie("inv_std_output",1,v));let P=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${T.registerUniforms(P).declareVariables(...k)}
  ${T.mainStart()}
    ${T.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${EE("f32",b)};
    var mean_square_vector = ${EE("f32",b)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${ql($,b,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${as("mean_vector",b)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${as("mean_square_vector",b)} / uniforms.norm_size ${n?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${ql($,b,"x[j + offset]")};
      let f32scale = ${ql($,b,"scale[j]")};
      output[j + offset] = ${k[0].type.value}((f32input ${n?"":"- mean"}) * inv_std_dev * f32scale
        ${s?`+ ${ql($,b,"bias[j]")}`:""}
      );
    }

    ${x?"mean_data_output[global_idx] = mean":""};
    ${y?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},S=[{dims:a,dataType:e[0].dataType}];return x&&S.push({dims:v,dataType:1}),y&&S.push({dims:v,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${b};${i};${n}`,inputDependencies:w},getRunData:()=>({outputs:S,dispatchGroup:{x:Math.ceil(c/64)},programUniforms:C}),getShaderSource:I}},CU=(e,t)=>{IB(e.inputs),e.compute(SB(e.inputs,t,e.outputCount))}}),DB,EU,mee=ce(()=>{"use strict";He(),nI(),iI(),DB=e=>{if(!e||e.length!==2)throw new Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw new Error("shared dimension does not match.")},EU=e=>{DB(e.inputs);let t=Gl.calcShape(e.inputs[0].dims,e.inputs[1].dims,!0);if(!t)throw new Error("Can't use matmul on the given tensors");let i=t[t.length-1],n=e.inputs[0].dims[e.inputs[0].dims.length-1];if(i<8&&n<8)e.compute(tI(e.inputs,{activation:""},t));else{let r=t[t.length-2],o=Q.size(e.inputs[0].dims.slice(0,-2)),s=Q.size(e.inputs[1].dims.slice(0,-2));if(o!==1&&r===1&&s===1){let a=e.inputs[0].reshape([1,o,n]),u=e.inputs[1].reshape([1,n,i]),c=[1,o,i],f=[a,u];e.compute(i_(f,{activation:""},t,c),{inputs:f})}else e.compute(i_(e.inputs,{activation:""},t))}}}),TB,$B,kB,IU,SU,gee=ce(()=>{"use strict";ze(),He(),sn(),Ye(),TB=(e,t)=>{if(e.length<3||e.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let i=e[0],n=i.dims.length;if(i.dims[n-1]!==t.k)throw new Error("The last dim of input shape does not match the k value");let r=Math.floor((t.k+t.blockSize-1)/t.blockSize),o=t.blockSize/8*t.bits,s=e[1];if(!Q.areEqual(s.dims,[t.n,r,o]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let a=e[2].dims;if(Q.size(a)!==t.n*r)throw new Error("scales input size error.");if(e.length===4){let u=e[3].dims,c=t.bits>4?t.n*r:t.n*Math.floor((r+1)/2);if(Q.size(u)!==c)throw new Error("zeroPoints input size error.")}},$B=(e,t)=>{let i=e[0].dims,n=i.length,r=i[n-2],o=t.k,s=t.n,a=i.slice(0,n-2),u=Q.size(a),c=e[1].dims[2]/4,f=e[0].dataType,p=tn(t.k),m=tn(c),v=tn(s),b=a.concat([r,s]),w=r>1&&s/v%2===0?2:1,C=Q.size(b)/v/w,x=64,y=[],I=[u,r,o/p],S=Q.convertShape(e[1].dims).slice();S.splice(-1,1,c/m),y.push(...$e(I)),y.push(...$e(S)),y.push(...$e(e[2].dims)),e.length===4&&y.push(...$e(Q.convertShape(e[3].dims)));let T=[u,r,s/v];y.push(...$e(T));let $=k=>{let P=I.length,j=te("a",e[0].dataType,P,p),H=te("b",12,S.length,m),re=te("scales",e[2].dataType,e[2].dims.length),ae=[j,H,re],L=e.length===4?te("zero_points",12,e[3].dims.length):void 0;L&&ae.push(L);let ge=T.length,ye=Ie("output",e[0].dataType,ge,v),Y=Dn(e[0].dataType),ve=(()=>{switch(p){case 1:return`array<${Y}, 8>`;case 2:return`mat4x2<${Y}>`;case 4:return`mat2x4<${Y}>`;default:throw new Error(`${p}-component is not supported.`)}})(),we=()=>{let z=`
          // reuse a data
            var input_offset = ${j.indicesToOffset(`${j.type.indices}(batch, row, word_offset)`)};
            var a_data: ${ve};
            for (var j: u32 = 0; j < ${8/p}; j++) {
              a_data[j] = ${j.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let W=0;W<v*w;W++)z+=`
            b_value = ${m===1?`b${W}_data`:`b${W}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${ve}(${Array.from({length:4},(R,se)=>`${Y}(b_value_lower[${se}]), ${Y}(b_value_upper[${se}])`).join(", ")});
            b_dequantized_values = ${p===1?`${ve}(${Array.from({length:8},(R,se)=>`(b_quantized_values[${se}] - ${L?`zero_point${W}`:"zero_point"}) * scale${W}`).join(", ")});`:`(b_quantized_values - ${ve}(${Array(8).fill(`${L?`zero_point${W}`:"zero_point"}`).join(",")})) * scale${W};`};
            workgroup_shared[local_id.x * ${w} + ${Math.floor(W/v)}]${v>1?`[${W%v}]`:""} += ${Array.from({length:8/p},(R,se)=>`${p===1?`a_data[${se}] * b_dequantized_values[${se}]`:`dot(a_data[${se}], b_dequantized_values[${se}])`}`).join(" + ")};
          `;return z},X=()=>{let z=`
            var col_index = col * ${v};
            ${L?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Y}(8);`}
            `;for(let W=0;W<v*w;W++)z+=`
            let scale${W} = ${re.getByOffset("col_index * nBlocksPerCol + block")};
            ${L?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${L.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${W} = ${Y}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return z},xe=()=>{let z=`col_index = col * ${v};`;for(let W=0;W<v*w;W++)z+=`
            let b${W}_data = ${H.getByIndices(`${H.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return z+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${ve};
            var b_dequantized_values: ${ve};`,z};return`
        var<workgroup> workgroup_shared: array<${ye.type.value}, ${w*x}>;
        ${k.declareVariables(...ae,ye)}
        ${k.mainStart([x,1,1])}
          let output_indices = ${ye.offsetToIndices(`(global_idx / ${x}) * ${w}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${x}) {
            //process one block
            var word_offset: u32 = block * ${t.blockSize/p};
            ${X()}
            for (var word: u32 = 0; word < ${c}; word += ${m}) {
              ${xe()}
              for (var i: u32 = 0; i < ${m}; i++) {
                ${we()}
                word_offset += ${8/p};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${w}) {
            var output_value: ${ye.type.value} = ${ye.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${x}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${w};
            }
            ${ye.setByIndices(`${ye.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${t.blockSize};${t.bits};${p};${m};${v};${w};${x}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:b,dataType:f}],dispatchGroup:{x:C},programUniforms:y}),getShaderSource:$}},kB=(e,t)=>{let i=e[0].dims,n=i.length,r=i[n-2],o=t.k,s=t.n,a=i.slice(0,n-2),u=Q.size(a),c=e[1].dims[2]/4,f=e[0].dataType,p=tn(t.k),m=tn(c),v=a.concat([r,s]),b=128,w=s%8===0?8:s%4===0?4:1,C=b/w,x=C*m*8,y=x/p,I=x/t.blockSize,S=Q.size(v)/w,T=[],$=[u,r,o/p],k=Q.convertShape(e[1].dims).slice();k.splice(-1,1,c/m),T.push(...$e($)),T.push(...$e(k)),T.push(...$e(e[2].dims)),e.length===4&&T.push(...$e(Q.convertShape(e[3].dims)));let P=[u,r,s];T.push(...$e(P));let j=H=>{let re=$.length,ae=te("a",e[0].dataType,re,p),L=te("b",12,k.length,m),ge=te("scales",e[2].dataType,e[2].dims.length),ye=[ae,L,ge],Y=e.length===4?te("zero_points",12,e[3].dims.length):void 0;Y&&ye.push(Y);let ve=P.length,we=Ie("output",e[0].dataType,ve),X=Dn(e[0].dataType),xe=()=>{switch(p){case 1:return`
          let a_data0 = vec4<${X}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${X}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${X}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${X}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${p}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${ae.type.value}, ${y}>;
        var<workgroup> inter_results: array<array<${we.type.value}, ${C}>, ${w}>;
        ${H.declareVariables(...ye,we)}
        ${H.mainStart([C,w,1])}
          let output_indices = ${we.offsetToIndices(`workgroup_index * ${w}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${I} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${y};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${y}; a_offset += ${b})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${ae.getByIndices(`${ae.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${ae.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${I} + local_id.x;
            ${Y?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${Y.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${X}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${X}(8);`}
            let scale = ${ge.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${L.getByIndices(`${L.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${t.blockSize/p};
            for (var i: u32 = 0; i < ${m}; i++) {
              ${xe()}
              let b_value = ${m===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${X}>(${Array.from({length:4},(z,W)=>`${X}(b_value_lower[${W}]), ${X}(b_value_upper[${W}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${X}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(z,W)=>`${`dot(a_data${W}, b_dequantized_values[${W}])`}`).join(" + ")};
              word_offset += ${8/p};
            }
            workgroupBarrier();
          }

          if (local_idx < ${w}) {
            var output_value: ${we.type.value} = ${we.type.value}(0);
            for (var b = 0u; b < ${C}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${we.setByIndices(`${we.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${t.blockSize};${p};${m};${C};${w}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:v,dataType:f}],dispatchGroup:{x:S},programUniforms:T}),getShaderSource:j}},IU=(e,t)=>{TB(e.inputs,t),t.blockSize===32&&e.adapterInfo.isVendor("intel")&&e.adapterInfo.isArchitecture("gen-12lp")?e.compute(kB(e.inputs,t)):e.compute($B(e.inputs,t))},SU=e=>kt(e)}),MB,AB,RB,OB,NB,PB,FB,zB,DU,_ee=ce(()=>{"use strict";ze(),He(),Ye(),MB=e=>{if(!e||e.length<1)throw new Error("Too few inputs");if(e[0].dataType!==1&&e[0].dataType!==10)throw new Error("Input type must be float or float16.");if(e.length>=2){let t=e[0].dims.length*2===e[1].dims[0];if(e.length===4&&(t=e[3].dims[0]*2===e[1].dims[0]),!t)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},AB=(e,t,i)=>{let n="";for(let r=t-1;r>=0;--r)n+=`
            k = i32(${e.indicesGet("indices",r)}) - ${De("uniforms.pads",r,i)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${De("uniforms.x_shape",r,t)})) {
              break;
            }
            offset += k * i32(${De("uniforms.x_strides",r,t)});
        `;return`
          value = ${e.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${n}
            value = x[offset];
          }
      `},RB=(e,t,i)=>{let n="";for(let r=t-1;r>=0;--r)n+=`
                k = i32(${e.indicesGet("indices",r)}) - ${De("uniforms.pads",r,i)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${De("uniforms.x_shape",r,t)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${De("uniforms.x_shape",r,t)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${De("uniforms.x_strides",r,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},OB=(e,t,i)=>{let n="";for(let r=t-1;r>=0;--r)n+=`
                k = i32(${e.indicesGet("indices",r)}) - ${De("uniforms.pads",r,i)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${De("uniforms.x_shape",r,t)})) {
                  k = i32(${De("uniforms.x_shape",r,t)}) - 1;
                }
                offset += k * i32(${De("uniforms.x_strides",r,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},NB=(e,t,i)=>{let n="";for(let r=t-1;r>=0;--r)n+=`
                k = i32(${e.indicesGet("indices",r)}) - ${De("uniforms.pads",r,i)};
                if (k < 0)  {
                  k += i32(${De("uniforms.x_shape",r,t)}]);
                }
                if (k >= i32(${De("uniforms.x_shape",r,t)})) {
                  k -= i32(${De("uniforms.x_shape",r,t)});
                }
                offset += k * i32(${De("uniforms.x_strides",r,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},PB=(e,t,i)=>{switch(i.mode){case 0:return AB(e,t,i.pads.length);case 1:return RB(e,t,i.pads.length);case 2:return OB(e,t,i.pads.length);case 3:return NB(e,t,i.pads.length);default:throw new Error("Invalid mode")}},FB=(e,t)=>{let i=Q.padShape(e[0].dims.slice(),t.pads),n=e[0].dims,r=Q.size(i),o=[{type:12,data:r},{type:6,data:t.pads}],s=e.length>=3&&e[2].data;t.mode===0&&o.push({type:s?e[2].dataType:1,data:t.value}),o.push(...$e(e[0].dims,i));let a=["rank"],u=c=>{let f=Ie("output",e[0].dataType,i.length),p=te("x",e[0].dataType,n.length),m=p.type.value,v=PB(f,n.length,t),b=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:t.pads.length}];return t.mode===0&&b.push({name:"constant_value",type:s?m:"f32"}),`
            ${c.registerUniforms(b).declareVariables(p,f)}
            ${c.mainStart()}
            ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${f.offsetToIndices("global_idx")};

            var value = ${m}(0);
            ${v}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${t.mode}${s}`,inputDependencies:a},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Q.size(i)/64)},programUniforms:o}),getShaderSource:u}},zB=(e,t)=>{if(e.length>1){let i=e[1].getBigInt64Array(),n=e.length>=3&&e[2].data?e[2].dataType===10?e[2].getUint16Array()[0]:e[2].getFloat32Array()[0]:0,r=e[0].dims.length,o=new Int32Array(2*r).fill(0);if(e.length>=4){let a=e[3].getBigInt64Array();for(let u=0;u<a.length;u++)o[Number(a[u])]=Number(i[u]),o[Number(a[u])+r]=Number(i[u+a.length])}else i.forEach((a,u)=>o[Number(u)]=Number(a));let s=[];return o.forEach(a=>s.push(a)),{mode:t.mode,value:n,pads:s}}else return t},DU=(e,t)=>{MB(e.inputs);let i=zB(e.inputs,t);e.compute(FB(e.inputs,i),{inputs:[0]})}}),Pf,iE,rE,oE,sE,LB,BB,aE,lE,TU,$U,uE,kU,MU,cE,AU,RU,OU,NU,vee=ce(()=>{"use strict";Cr(),ze(),He(),Ye(),Pf=e=>{if(Jt.webgpu.validateInputContent&&(!e||e.length!==1))throw new Error("Pool ops requires 1 input.")},iE=(e,t,i)=>{let n=t.format==="NHWC",r=e.dims.slice();n&&r.splice(1,0,r.pop());let o=Object.hasOwnProperty.call(t,"dilations"),s=t.kernelShape.slice(),a=t.strides.slice(),u=o?t.dilations.slice():[],c=t.pads.slice();t_.adjustPoolAttributes(i,r,s,a,u,c);let f=t_.computePoolOutputShape(i,r,a,u,s,c,t.autoPad),p=Object.assign({},t);o?Object.assign(p,{kernelShape:s,strides:a,pads:c,dilations:u,cacheKey:t.cacheKey}):Object.assign(p,{kernelShape:s,strides:a,pads:c,cacheKey:t.cacheKey});let m=f.slice();return m.push(m.splice(1,1)[0]),[p,n?m:f]},rE=(e,t)=>{let i=t.format==="NHWC",n=Q.size(e),r=Q.size(t.kernelShape),o=[{type:12,data:n},{type:12,data:r}],s=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(t.kernelShape.length<=2){let a=t.kernelShape[t.kernelShape.length-1],u=t.strides[t.strides.length-1],c=t.pads[t.pads.length/2-1],f=t.pads[t.pads.length-1],p=!!(c+f);o.push({type:12,data:a},{type:12,data:u},{type:12,data:c},{type:12,data:f}),s.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let m=!1;if(t.kernelShape.length===2){let v=t.kernelShape[t.kernelShape.length-2],b=t.strides[t.strides.length-2],w=t.pads[t.pads.length/2-2],C=t.pads[t.pads.length-2];m=!!(w+C),o.push({type:12,data:v},{type:12,data:b},{type:12,data:w},{type:12,data:C}),s.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[o,s,!0,p,m]}else{if(i)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let a=Q.computeStrides(t.kernelShape);o.push({type:12,data:a},{type:12,data:t.pads},{type:12,data:t.strides}),s.push({name:"kernelStrides",type:"u32",length:a.length},{name:"pads",type:"u32",length:t.pads.length},{name:"strides",type:"u32",length:t.strides.length});let u=t.pads.reduce((c,f)=>c+f);return[o,s,!!u,!1,!1]}},oE=(e,t,i,n,r,o,s,a,u,c,f,p)=>{let m=r.format==="NHWC",v=t.type.value,b=Ie("output",t.type.tensor,n);if(r.kernelShape.length<=2){let w="",C="",x="",y=i-(m?2:1);if(f?w=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${y}] = indices[${y}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${y}] < 0 || xIndices[${y}]
                      >= uniforms.x_shape[${y}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${o}
                }`:w=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${y}] = indices[${y}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${o}
                }`,r.kernelShape.length===2){let I=i-(m?3:2);p?C=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${I}] = indices[${I}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${I}] < 0 || xIndices[${I}] >= uniforms.x_shape[${I}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:C=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${I}] = indices[${I}] * uniforms.sh - uniforms.phStart + j;
                `,x=`
              }
            `}return`
            ${e.registerUniforms(u).declareVariables(t,b)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${b.offsetToIndices("global_idx")};
              var xIndices = ${b.offsetToIndices("global_idx")};

              var value = ${v}(${a});
              var pad = 0;
              ${C}
              ${w}
              ${x}
              ${s}

              output[global_idx] = value;
            }`}else{if(m)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let w=r.kernelShape.length,C=r.pads.length,x="";return c?x=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${t.indicesToOffset("xIndices")}];
                ${o}
              }`:x=`
              }
              let x_val = x[${t.indicesToOffset("xIndices")}];
              ${o}
            `,`
            ${e.registerUniforms(u).declareVariables(t,b)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${b.offsetToIndices("global_idx")};
              var xIndices = ${b.offsetToIndices("global_idx")};

              var offsets: array<u32, ${w}>;

              var value = ${v}(${a});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${w-1}u; j++) {
                  offsets[j] = offset / ${De("uniforms.kernelStrides","j",w)};
                  offset -= offsets[j] * ${De("uniforms.kernelStrides","j",w)};
                }
                offsets[${w-1}] = offset;

                isPad = false;
                for (var j = ${i-w}u; j < ${i}u; j++) {
                  xIndices[j] = indices[j] * ${De("uniforms.strides",`j - ${i-w}u`,w)}
                    + offsets[j - ${i-w}u] - ${De("uniforms.pads","j - 2u",C)};
                  ${x}
              }
              ${s}

              output[global_idx] = value;
            }`}},sE=e=>`${e.format};${e.ceilMode};${e.autoPad};${e.kernelShape.length}`,LB=e=>`${sE(e)};${e.countIncludePad}`,BB=e=>`${sE(e)};${e.storageOrder};${e.dilations}`,aE=e=>({format:e.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],ceilMode:e.ceil_mode,kernelShape:e.kernel_shape,strides:e.strides,pads:e.pads}),lE=(e,t,i,n)=>{let[r,o]=iE(t,n,i),s=te("x",t.dataType,t.dims.length),a=s.type.value,u="value += x_val;",c="";r.countIncludePad?c+=`value /= ${a}(uniforms.kernelSize);`:c+=`value /= ${a}(i32(uniforms.kernelSize) - pad);`;let[f,p,m,v,b]=rE(o,r);f.push(...$e(t.dims,o));let w=["rank"];return{name:e,shaderCache:{hint:`${n.cacheKey};${m};${v};${b}`,inputDependencies:w},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Q.size(o)/64)},programUniforms:f}),getShaderSource:C=>oE(C,s,t.dims.length,o.length,r,u,c,0,p,m,v,b)}},TU=e=>{let t=e.count_include_pad!==0,i=aE(e);if(i.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let n=Ae(ie({countIncludePad:t},i),{cacheKey:""});return Ae(ie({},n),{cacheKey:LB(n)})},$U=(e,t)=>{Pf(e.inputs),e.compute(lE("AveragePool",e.inputs[0],!1,t))},uE={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},kU=e=>{let t=e.format;return Ae(ie({format:t},uE),{cacheKey:t})},MU=(e,t)=>{Pf(e.inputs),e.compute(lE("GlobalAveragePool",e.inputs[0],!0,t))},cE=(e,t,i,n)=>{let[r,o]=iE(t,n,i),s=`
      value = max(x_val, value);
    `,a="",u=te("x",t.dataType,t.dims.length),c=["rank"],[f,p,m,v,b]=rE(o,r);return f.push(...$e(t.dims,o)),{name:e,shaderCache:{hint:`${n.cacheKey};${m};${v};${b}`,inputDependencies:c},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Q.size(o)/64)},programUniforms:f}),getShaderSource:w=>oE(w,u,t.dims.length,o.length,r,s,a,t.dataType===10?-65504:-1e5,p,m,v,b)}},AU=(e,t)=>{Pf(e.inputs),e.compute(cE("MaxPool",e.inputs[0],!1,t))},RU=e=>{let t=e.storage_order,i=e.dilations,n=aE(e);if(t!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(n.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let r=Ae(ie({storageOrder:t,dilations:i},n),{cacheKey:""});return Ae(ie({},r),{cacheKey:BB(r)})},OU=e=>{let t=e.format;return Ae(ie({format:t},uE),{cacheKey:t})},NU=(e,t)=>{Pf(e.inputs),e.compute(cE("GlobalMaxPool",e.inputs[0],!0,t))}}),jB,VB,PU,FU,bee=ce(()=>{"use strict";ze(),He(),sn(),Ye(),jB=(e,t)=>{if(e.length<2||e.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(e.length===3&&e[1].dims===e[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[0].dataType===6&&e.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(e[1].dims.length!==0&&e[1].dims.length!==1&&e[1].dims.length!==e[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(e.length>2){if(e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[1].dims.length!==e[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!e[1].dims.map((i,n)=>i===e[2].dims[n]).reduce((i,n)=>i&&n,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(t.blockSize>0){if(e[1].dims.length===0||e[1].dims.length===1&&e[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!e[1].dims.map((r,o)=>o===t.axis||r===e[0].dims[o]).reduce((r,o)=>r&&o,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(e[1].dims.length!==e[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let i=e[0].dims[t.axis],n=e[1].dims[t.axis];if(t.blockSize<Math.ceil(i/n)||t.blockSize>Math.ceil(i/(n-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},VB=(e,t)=>{let i=Q.normalizeAxis(t.axis,e[0].dims.length),n=e[0].dataType,r=n===3,o=e[0].dims,s=e[1].dataType,a=Q.size(o),u=n===3||n===2,c=u?[Math.ceil(Q.size(e[0].dims)/4)]:e[0].dims,f=e[1].dims,p=e.length>2?e[2]:void 0,m=p?u?[Math.ceil(Q.size(p.dims)/4)]:p.dims:void 0,v=f.length===0||f.length===1&&f[0]===1,b=v===!1&&f.length===1,w=tn(a),C=v&&(!u||w===4),x=C?w:1,y=C&&!u?w:1,I=te("input",u?12:n,c.length,y),S=te("scale",s,f.length),T=p?te("zero_point",u?12:n,m.length):void 0,$=Ie("output",s,o.length,x),k=[I,S];T&&k.push(T);let P=[c,f];p&&P.push(m);let j=[{type:12,data:a/x},{type:12,data:i},{type:12,data:t.blockSize},...$e(...P,o)],H=re=>{let ae=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${re.registerUniforms(ae).declareVariables(...k,$)}
      ${re.mainStart()}
          ${re.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${$.offsetToIndices("global_idx")};

          // Set input x
          ${u?`
            let input = ${I.getByOffset("global_idx / 4")};
            let x_vec = ${r?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${x===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${I.getByOffset("global_idx")};`};

          // Set scale input
          ${v?`let scale_value= ${S.getByOffset("0")}`:b?`
            let scale_index = ${$.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${S.getByOffset("scale_index")};`:`
            var scale_indices: ${S.type.indices} = output_indices;
            let index = ${S.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${S.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${S.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${T?v?u?`
                let zero_point_input = ${T.getByOffset("0")};
                let zero_point_vec =  ${r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${T.getByOffset("0")}`:b?u?`
                let zero_point_index = ${$.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${T.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${$.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${T.getByOffset("zero_point_index")};`:u?`
                let zero_point_offset = ${S.indicesToOffset("scale_indices")};
                let zero_point_input = ${T.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${T.getByIndices("scale_indices")};`:`let zero_point_value = ${u?r?"i32":"u32":I.type.value}(0);`};
      // Compute and write output
      ${$.setByOffset("global_idx",`${$.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:t.cacheKey,inputDependencies:T?["rank","rank","rank"]:["rank","rank"]},getShaderSource:H,getRunData:()=>({outputs:[{dims:o,dataType:s}],dispatchGroup:{x:Math.ceil(a/x/64),y:1,z:1},programUniforms:j})}},PU=(e,t)=>{jB(e.inputs,t),e.compute(VB(e.inputs,t))},FU=e=>kt({axis:e.axis,blockSize:e.blockSize})}),UB,HB,zU,yee=ce(()=>{"use strict";Cr(),ze(),Ye(),UB=(e,t,i)=>{let n=e===t,r=e<t&&i<0,o=e>t&&i>0;if(n||r||o)throw new Error("Range these inputs' contents are invalid.")},HB=(e,t,i,n)=>{let r=Math.abs(Math.ceil((t-e)/i)),o=[r],s=r,a=[{type:12,data:s},{type:n,data:e},{type:n,data:i},...$e(o)],u=c=>{let f=Ie("output",n,o.length),p=f.type.value,m=[{name:"outputSize",type:"u32"},{name:"start",type:p},{name:"delta",type:p}];return`
        ${c.registerUniforms(m).declareVariables(f)}
        ${c.mainStart()}
        ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${p}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${n}`},getShaderSource:u,getRunData:()=>({outputs:[{dims:o,dataType:n}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:a})}},zU=e=>{let t=0,i=0,n=0;e.inputs[0].dataType===6?(t=e.inputs[0].getInt32Array()[0],i=e.inputs[1].getInt32Array()[0],n=e.inputs[2].getInt32Array()[0]):e.inputs[0].dataType===1&&(t=e.inputs[0].getFloat32Array()[0],i=e.inputs[1].getFloat32Array()[0],n=e.inputs[2].getFloat32Array()[0]),Jt.webgpu.validateInputContent&&UB(t,i,n),e.compute(HB(t,i,n,e.inputs[0].dataType),{inputs:[]})}}),WB,qB,LU,BU,wee=ce(()=>{"use strict";ze(),He(),sn(),Ye(),WB=(e,t,i,n)=>{if(e!=="none"&&n!=="i32"&&n!=="u32"&&n!=="f32")throw new Error(`Input ${n} is not supported with reduction ${e}.`);let r=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,o=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${t}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(e){case"none":return`${t}=${i};`;case"add":return n==="i32"||n==="u32"?`atomicAdd(&${t}, bitcast<${n}>(${i}));`:`
              ${r}bitcast<${n}>(oldValue) + (${i})${o}`;case"max":return n==="i32"||n==="u32"?`atomicMax(&${t}, bitcast<${n}>(${i}));`:`
                ${r}max(bitcast<f32>(oldValue), (${i}))${o}`;case"min":return n==="i32"||n==="u32"?`atomicMin(&${t}, bitcast<${n}>(${i}));`:`${r}min(bitcast<${n}>(oldValue), (${i}))${o}`;case"mul":return`${r}(bitcast<${n}>(oldValue) * (${i}))${o}`;default:throw new Error(`Reduction ${e} is not supported.`)}},qB=(e,t)=>{let i=e[0].dims,n=e[1].dims,r=i,o=1,s=Math.ceil(Q.size(n)/o),a=n[n.length-1],u=Q.sizeFromDimension(i,a),c=[{type:12,data:s},{type:12,data:a},{type:12,data:u},...$e(e[1].dims,e[2].dims,r)],f=p=>{let m=te("indices",e[1].dataType,e[1].dims.length),v=te("updates",e[2].dataType,e[2].dims.length,o),b=t.reduction!=="none"&&t.reduction!==""?gj("output",e[0].dataType,r.length):Ie("output",e[0].dataType,r.length,o);return`
      ${p.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(m,v,b)}
      ${p.mainStart()}
        ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var hasDuplicates = false;
  if (${t.reduction==="none"}) {
    let n = ${Q.size(n)};
    for (var i = 0; i < n; i = i + 1) {
      for (var j = i + 1; j < n; j = j + 1) {
        var index_i = i32(indices[i].x);
        var index_j = i32(indices[j].x);
        if (index_i == index_j) {
          hasDuplicates = true;
          break;
        }
      }
      if (hasDuplicates) {
        break;
      }
    }
  }

  var data_offset = 0u;
  var indices_start = uniforms.last_index_dimension * global_idx;
  if (${t.reduction==="none"} && hasDuplicates) {
    if (global_idx != 0u) {
      return;
    }
    indices_start = 0u;
  }
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${e[0].dims.length===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start + uniforms.last_index_dimension];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${WB(t.reduction,"output[data_offset + i]","value",b.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${t.cacheKey}_${t.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:c}),getShaderSource:f}},LU=e=>kt({reduction:e.reduction}),BU=(e,t)=>{e.compute(qB(e.inputs,t),{inputs:[e.inputs[1],e.inputs[2]],outputs:[]})}}),GB,KB,ZB,dE,QB,YB,JB,XB,e4,t4,n4,i4,fE,r4,o4,s4,a4,l4,jU,VU,xee=ce(()=>{"use strict";ze(),He(),sn(),Ye(),GB=(e,t)=>{if(e.every(i=>i>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),e.length>0){if(t.mode==="linear"){if(!(e.length===2||e.length===3||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1||e.length===5&&e[0]===1&&e[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(t.mode==="cubic"&&!(e.length===2||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},KB=(e,t,i)=>{t.every(r=>r>=0&&r<i||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let n=new Array(i).fill(1);return t.forEach((r,o)=>n[r]=e[o]),n},ZB=(e,t,i,n,r,o)=>{let[s,a,u]=i>10?[1,2,3]:[-1,e.length>1?1:-1,-1],c=e[0].dims.length;if(s>0&&e.length>s&&e[s].dims.length>0)e[s].getFloat32Array().forEach(f=>o.push(f));else if(t.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(a>0&&e.length>a&&e[a].dims.length===1&&e[a].dims[0]>0){if(e[a].getFloat32Array().forEach(f=>n.push(f)),n.length!==0&&n.length!==c&&i>=18&&n.length!==t.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");GB(n,t),t.axes.length>0&&KB(n,t.axes,c).forEach((f,p)=>n[p]=f)}if(u>0&&e.length>u&&e[u].dims.length===1&&e[u].dims[0]>0&&(e[u].getBigInt64Array().forEach(f=>r.push(Number(f))),r.length!==0&&r.length!==c&&i>=18&&r.length!==t.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(t.axes.length>0){if(n.length!==0&&n.length!==t.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(r.length!==0&&r.length!==t.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof n<"u"&&typeof r<"u"&&n.length>0&&r.length>c)throw new Error("Resize requires only of scales or sizes to be specified")},dE=(e,t,i,n)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${e}) * (${t});
  let whole = ${n}(big / (${i}));
  let fract = ${n}(big % (${i})) / ${n}(${i});
  return whole + fract;
`,QB=(e,t)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${t} { `+(()=>{switch(e){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${t}(xResized) / ${t}(xScale);
          } else {
            ${dE("xResized","lengthOriginal","lengthResized",t)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${t}(xResized) + 0.5) / ${t}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${t}(xResized) + 0.5) / ${t}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${dE("xResized","lengthOriginal - 1","lengthResized - 1",t)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${t}(roiStart) * ${t}(lengthOriginal - 1) +
                        (${t}(xResized) * ${t}(roiEnd - roiStart) * ${t}(lengthOriginal - 1)) /
                        ${t}(lengthResized - 1);
                  } else {
                    return 0.5 * ${t}(roiStart + roiEnd) * ${t}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${t}xScale * ${t}(lengthResized);
                  const adjustment = ${t}(lengthResized) / outputWidth;
                  const center = ${t}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;case"half_pixel":return`return ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${e} is not supported`)}})()+"}",YB=(e,t,i)=>`fn getNearestPixelFromOriginal(xOriginal: ${i}, isDownSample: bool) -> ${i} {`+(()=>{switch(e){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(t<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${e} is not supported`)}})()+"}",JB=(e,t,i)=>{let n=new Array(i).fill(0).concat(new Array(i).fill(1)),r=e.length===0?n:e.slice();return t.length>0?(t.forEach((o,s)=>{n[o]=r[s],n[s+i]=r[t.length+s]}),n):r},XB=(e,t,i,n)=>{let r=[];if(i.length>0)if(n.length>0){if(e.forEach(o=>r.push(o)),Math.max(...n)>e.length)throw new Error("axes is out of bound");n.forEach((o,s)=>r[o]=i[s])}else i.forEach(o=>r.push(o));else{if(t.length===0)throw new Error("Resize requires either scales or sizes.");r=e.map((o,s)=>Math.round(o*t[s]))}return r},e4=(e,t,i)=>{let n=(()=>{switch(i.keepAspectRatioPolicy){case"not_larger":return i.axes.length>0?Math.min(...i.axes.map(o=>t[o]),Number.MAX_VALUE):Math.min(...t,Number.MAX_VALUE);case"not_smaller":return i.axes.length>0?Math.max(...i.axes.map(o=>t[o]),Number.MIN_VALUE):Math.max(...t,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${i.keepAspectRatioPolicy} is not supported`)}})();t.fill(1,0,t.length);let r=e.slice();return i.axes.length>0?(i.axes.forEach(o=>t[o]=n),i.axes.forEach(o=>r[o]=Math.round(e[o]*t[o]))):(t.fill(n,0,t.length),r.forEach((o,s)=>r[s]=Math.round(o*t[s]))),r},t4=(e,t,i,n,r)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> array<${e.type.value}, ${i.length}> {
      var original_indices: array<${e.type.value}, ${i.length}>;
      for (var i:u32 = 0; i < ${i.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var scale = ${De("uniforms.scales","i",n)};
        var roi_low = ${De("uniforms.roi","i",r)};
        var roi_hi = ${De("uniforms.roi",`i + ${t.length}`,r)};
        if (scale == 1.0) {
          original_indices[i] = ${e.type.value}(output_index);
        } else {
          var input_shape_i = ${De("uniforms.input_shape","i",t.length)};
          var output_shape_i = ${De("uniforms.output_shape","i",i.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,n4=(e,t,i,n,r,o,s)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
      var input_indices: ${e.type.indices};
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${De("uniforms.scales","i",r)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${De("uniforms.roi","i",o)};
          var roi_hi = ${De("uniforms.roi",`i + ${i.length}`,o)};
          var input_shape_i = ${De("uniforms.input_shape","i",i.length)};
          var output_shape_i = ${De("uniforms.output_shape","i",n.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${s} || (original_idx >= 0 && original_idx < ${t.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${t.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${e.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,i4=(e,t)=>`
    fn checkInputIndices(input_indices: ${e.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${t.length}; i++) {
        var input_index = ${e.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${De("uniforms.input_shape","i",t.length)}) {
          return false;
        }
      }
      return true;
    }`,fE=(e,t,i,n)=>e.rank>n?`
    ${e.indicesSet("input_indices",t,"channel")};
    ${e.indicesSet("input_indices",i,"batch")};
`:"",r4=(e,t,i,n,r)=>{let[o,s,a,u]=i.length===2?[-1,0,1,-1]:[0,2,3,1],c=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${c} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",s,`max(0, min(row, ${i[s]} - 1))`)};
      ${e.indicesSet("input_indices",a,`max(0, min(col, ${i[a]} - 1))`)};
      ${fE(e,u,o,2)}
      return ${e.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${t.type.indices}) -> ${c} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${c} = originalIndices[${s}];
      var col:${c} = originalIndices[${a}];
      ${n?`if (row < 0 || row > (${i[s]} - 1) || col < 0 || col > (${i[a]} - 1)) {
        return ${r};
      }`:""};
      row = max(0, min(row, ${i[s]} - 1));
      col = max(0, min(col, ${i[a]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${i.length>2?`u32(originalIndices[${u}])`:"0"};
      var batch: u32 =  ${i.length>2?`u32(originalIndices[${o}])`:"0"};
      var x11: ${c} = getInputValue(batch, channel, row1, col1);
      var x12: ${c} = getInputValue(batch, channel, row1, col2);
      var x21: ${c} = getInputValue(batch, channel, row2, col1);
      var x22: ${c} = getInputValue(batch, channel, row2, col2);
      var dx1: ${c} = abs(row - ${c}(row1));
      var dx2: ${c} = abs(${c}(row2) - row);
      var dy1: ${c} = abs(col - ${c}(col1));
      var dy2: ${c} = abs(${c}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},o4=(e,t,i,n,r,o,s,a,u,c)=>{let f=i.length===2,p=!0,[m,v]=f?[0,1]:p?[2,3]:[1,2],b=e.type.value,w=C=>{let x=C===m?"row":"col";return`
      fn ${x}CubicInterpolation(input_indices: ${e.type.indices}, output_indices: ${t.type.indices}) -> ${b} {
        var output_index = ${t.indicesGet("output_indices",C)};
        var originalIdx: ${b} = getOriginalCoordinateFromResizedCoordinate(output_index, ${r[C]},
        ${n[C]}, ${i[C]}, ${o[C]}, ${o[C]} + ${i.length});
        var fractOriginalIdx: ${b} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${a} && (originalIdx < 0 || originalIdx > (${i[C]} - 1))) {
          return ${u};
        }
        var data: array<${b}, 4> = array<${b}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${x}: ${b} = originalIdx + ${b}(i);
          if (${x} < 0 || ${x} >= ${i[C]}) {
            ${c?`coefs[i + 1] = 0.0;
                        continue;`:a?`return ${u};`:`${x} = max(0, min(${x}, ${i[C]} - 1));`};
          }
        var input_indices_copy: ${e.type.indices} = input_indices;
          ${e.indicesSet("input_indices_copy",C,`u32(${x})`)};
          data[i + 1] = ${C===m?e.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${w(m)};
    ${w(v)};
  fn getCubicInterpolationCoefs(s: ${b}) -> array<${b}, 4> {
    var absS = abs(s);
    var coeffs: array<${b}, 4> = array<${b}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${b} = 1.0 - absS;
    var twoMinusAbsS: ${b} = 2.0 - absS;
    var onePlusAbsS: ${b} = 1.0 + absS;
    coeffs[0] = ((${s} * onePlusAbsS - 5 * ${s}) * onePlusAbsS + 8 * ${s}) * onePlusAbsS - 4 * ${s};
    coeffs[1] = ((${s} + 2) * absS - (${s} + 3)) * absS * absS + 1;
    coeffs[2] = ((${s} + 2) * oneMinusAbsS - (${s} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${s} * twoMinusAbsS - 5 * ${s}) * twoMinusAbsS + 8 * ${s}) * twoMinusAbsS - 4 * ${s};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${b}, 4>, coefs: array<${b}, 4>) -> ${b} {
    var coefsSum: ${b} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${t.type.indices}) -> ${b} {
    var input_indices: ${e.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},s4=(e,t,i,n,r)=>{let[o,s,a,u,c]=i.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],f=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${f} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",s,`max(0, min(depth, ${i[s]} - 1))`)};
      ${e.indicesSet("input_indices",a,`max(0, min(height, ${i[a]} - 1))`)};
      ${e.indicesSet("input_indices",u,`max(0, min(width, ${i[u]} - 1))`)};
      ${fE(e,c,o,3)}
      return ${e.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${t.type.indices}) -> ${f} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${f} = originalIndices[${s}];
      var height:${f} = originalIndices[${a}];
      var width:${f} = originalIndices[${u}];
      ${n?`if (depth < 0 || depth > (${i[s]} - 1) || height < 0 || height > (${i[a]} - 1) || width < 0 || (width > ${i[u]} - 1)) {
      return ${r};
        }`:""};

    depth = max(0, min(depth, ${i[s]} - 1));
      height = max(0, min(height, ${i[a]} - 1));
      width = max(0, min(width, ${i[u]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${i.length>3?`u32(originalIndices[${c}])`:"0"};
      var batch: u32 =  ${i.length>3?`u32(originalIndices[${o}])`:"0"};

      var x111: ${f} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${f} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${f} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${f} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${f} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${f} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${f} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${f} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${f} = abs(depth - ${f}(depth1));
      var dx2: ${f} = abs(${f}(depth2) - depth);
      var dy1: ${f} = abs(height - ${f}(height1));
      var dy2: ${f} = abs(${f}(height2) - height);
      var dz1: ${f} = abs(width - ${f}(width1));
      var dz2: ${f} = abs(${f}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},a4=(e,t,i,n,r,o)=>{let s=e.dims,a=JB(o,t.axes,s.length),u=XB(s,n,r,t.axes),c=n.slice();n.length===0&&(c=s.map((y,I)=>y===0?1:u[I]/y),t.keepAspectRatioPolicy!=="stretch"&&(u=e4(s,c,t)));let f=Ie("output",e.dataType,u.length),p=te("input",e.dataType,s.length),m=Q.size(u),v=s.length===u.length&&s.every((y,I)=>y===u[I]),b=t.coordinateTransformMode==="tf_crop_and_resize",w=t.extrapolationValue,C=p.type.value,x=y=>`
      ${v?"":`
      ${QB(t.coordinateTransformMode,C)};
      ${(()=>{switch(t.mode){case"nearest":return`
              ${i4(p,s)};
              ${YB(t.nearestMode,i,C)};
              ${n4(p,f,s,u,c.length,a.length,b)};
              `;case"linear":return`
              ${t4(f,s,u,c.length,a.length)};
              ${(()=>{if(s.length===2||s.length===4)return`${r4(p,f,s,b,w)}`;if(s.length===3||s.length===5)return`${s4(p,f,s,b,w)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(s.length===2||s.length===4)return`${o4(p,f,s,u,c,a,t.cubicCoeffA,b,t.extrapolationValue,t.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${y.registerUniform("output_size","u32").registerUniform("scales","f32",c.length).registerUniform("roi","f32",a.length).declareVariables(p,f)}
      ${y.mainStart()}
        ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${v?"output[global_idx] = input[global_idx];":`
        let output_indices = ${f.offsetToIndices("global_idx")};
        var input_indices: ${p.type.indices};
        ${(()=>{switch(t.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${p.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${t.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${s.length===2||s.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${t.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${t.cacheKey}|${i}|${c.length>0?t.mode==="cubic"?c:c.length:""}|${r.length>0?r:""}|${a.length>0?a:""}|${v}|${t.mode==="nearest"?s.length:s}`,inputDependencies:["rank"]},getShaderSource:x,getRunData:()=>({outputs:[{dims:u,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:[{type:12,data:m},{type:1,data:c},{type:1,data:a},...$e(s,u)]})}},l4=e=>{let t=e.customDataBuffer;return new Uint32Array(t,t.byteOffset,1)[0]},jU=(e,t)=>{let i=[],n=[],r=[],o=l4(e);if(t.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");ZB(e.inputs,t,o,i,n,r),e.compute(a4(e.inputs[0],t,o,i,n,r),{inputs:[0]})},VU=e=>{let t=e.antialias,i=e.axes,n=e.coordinateTransformMode,r=e.cubicCoeffA,o=e.excludeOutside!==0,s=e.extrapolationValue,a=e.keepAspectRatioPolicy,u=e.mode,c=e.nearestMode===""?"simple":e.nearestMode;return kt({antialias:t,axes:i,coordinateTransformMode:n,cubicCoeffA:r,excludeOutside:o,extrapolationValue:s,keepAspectRatioPolicy:a,mode:u,nearestMode:c})}}),u4,c4,UU,Cee=ce(()=>{"use strict";ze(),He(),sn(),Ye(),u4=(e,t)=>{let[i,n,r,o]=e,{numHeads:s,rotaryEmbeddingDim:a}=t;if(i.dims.length!==3&&i.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${i.dims.length}`);if(!Q.areEqual(n.dims,[])&&!Q.areEqual(n.dims,[1])&&n.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${n.dims.length}`);if(r.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${r.dims.length}`);if(o.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${o.dims.length}`);if(!Q.areEqual(r.dims,o.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(a>0&&s===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let u=i.dims[0],c=i.dims[i.dims.length-2],f=r.dims[0],p=Q.sizeFromDimension(i.dims,1)/c,m=a===0?r.dims[1]*2:p/s;if(a>m)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(n.dims.length===2){if(u!==n.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${n.dims[0]}`);if(c!==n.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${n.dims[1]}`)}if(m/2!==r.dims[1]&&a/2!==r.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${r.dims[1]}`);if(c>f)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},c4=(e,t)=>{let{interleaved:i,numHeads:n,rotaryEmbeddingDim:r,scale:o}=t,s=e[0].dims[0],a=Q.sizeFromDimension(e[0].dims,1),u=e[0].dims[e[0].dims.length-2],c=a/u,f=e[2].dims[1],p=r===0?f*2:c/n,m=new Array(s,u,c/p,p-f),v=Q.computeStrides(m),b=[{type:1,data:o},{type:12,data:m},{type:12,data:v},...e[0].dims.length===3?new Array({type:12,data:[a,c,p,1]}):[],...e[0].dims.length===4?new Array({type:12,data:[a,p,u*p,1]}):[],...$e(e[0].dims,e[1].dims,e[2].dims,e[3].dims,e[0].dims)],w=C=>{let x=te("input",e[0].dataType,e[0].dims.length),y=te("position_ids",e[1].dataType,e[1].dims.length),I=te("cos_cache",e[2].dataType,e[2].dims.length),S=te("sin_cache",e[3].dataType,e[3].dims.length),T=Ie("output",e[0].dataType,e[0].dims.length);return C.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:m.length},{name:"global_strides",type:"u32",length:v.length},{name:"input_output_strides",type:"u32",length:v.length}]),`
        ${C.declareVariables(x,y,I,S,T)}

        ${C.mainStart(Kl)}
          let half_rotary_emb_dim = uniforms.${I.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${C.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${y.broadcastedIndicesToOffset("bsnh.xy",Ie("",y.type.tensor,2))};
            let position_id =
                u32(${y.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${i});
            let j = i + select(half_rotary_emb_dim, 1, ${i});
            let re = ${x.getByOffset("i")} * ${I.get("position_id","bsnh[3]")} -
                ${x.getByOffset("j")} * ${S.get("position_id","bsnh[3]")};
            ${T.setByOffset("i","re")}
            let im = ${x.getByOffset("i")} * ${S.get("position_id","bsnh[3]")} +
                ${x.getByOffset("j")} * ${I.get("position_id","bsnh[3]")};
            ${T.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${T.setByOffset("k",x.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:kt({interleaved:i}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:w,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Q.size(m)/Kl)},programUniforms:b})}},UU=(e,t)=>{u4(e.inputs,t),e.compute(c4(e.inputs,t))}}),d4,f4,HU,Eee=ce(()=>{"use strict";ze(),He(),Ye(),d4=e=>{if(!e||e.length<3)throw new Error("layerNorm requires at least 3 inputs.");let t=e[0],i=e[1],n=e[2];if(t.dataType!==i.dataType||t.dataType!==n.dataType)throw new Error("All inputs must have the same data type");if(t.dims.length!==3&&t.dims.length!==2)throw new Error("Input must be 2D or 3D");if(i.dims.length!==3&&i.dims.length!==2)throw new Error("Skip must be 2D or 3D");let r=t.dims[t.dims.length-1],o=t.dims[t.dims.length-2];if(i.dims[i.dims.length-1]!==r)throw new Error("Skip must have the same hidden size as input");if(i.dims[i.dims.length-2]!==o)throw new Error("Skip must have the same sequence length as input");if(n.dims.length!==1)throw new Error("Gamma must be 1D");if(n.dims[n.dims.length-1]!==r)throw new Error("Gamma must have the same hidden size as input");if(e.length>3){let s=e[3];if(s.dims.length!==1)throw new Error("Beta must be 1D");if(s.dims[s.dims.length-1]!==r)throw new Error("Beta must have the same hidden size as input")}if(e.length>4){let s=e[4];if(s.dims.length!==1)throw new Error("Bias must be 1D");if(s.dims[s.dims.length-1]!==r)throw new Error("Bias must have the same hidden size as input")}},f4=(e,t,i,n)=>{let r=t.simplified,o=e[0].dims,s=Q.size(o),a=o,u=s,c=o.slice(-1)[0],f=n?o.slice(0,-1).concat(1):[],p=!r&&e.length>3,m=e.length>4,v=n&&i>1,b=n&&i>2,w=i>3,C=64,x=tn(c),y=[{type:12,data:u},{type:12,data:x},{type:12,data:c},{type:1,data:t.epsilon}],I=T=>{let $=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],k=[te("x",e[0].dataType,e[0].dims,x),te("skip",e[1].dataType,e[1].dims,x),te("gamma",e[2].dataType,e[2].dims,x)];p&&k.push(te("beta",e[3].dataType,e[3].dims,x)),m&&k.push(te("bias",e[4].dataType,e[4].dims,x)),k.push(Ie("output",e[0].dataType,a,x)),v&&k.push(Ie("mean_output",1,f)),b&&k.push(Ie("inv_std_output",1,f)),w&&k.push(Ie("input_skip_bias_sum",e[0].dataType,a,x));let P=Dn(e[0].dataType),j=Dn(1,x);return`

      ${T.registerUniforms($).declareVariables(...k)}
      var<workgroup> sum_shared : array<${j}, ${C}>;
      var<workgroup> sum_squared_shared : array<${j}, ${C}>;

      ${T.mainStart([C,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${C};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${C};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${C-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${m?"bias[offset1d + i]":P+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${w?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${ql(P,x,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${C};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${as("sum",x)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${as("square_sum",x)} / f32(uniforms.hidden_size) ${r?"":"- mean * mean"} + uniforms.epsilon);
        ${v?"mean_output[global_idx] = mean;":""}
        ${b?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${r?"":`- ${P}(mean)`}) *
            ${P}(inv_std_dev) * gamma[offset1d + i]
            ${p?"+ beta[offset1d + i]":""};
        }
      }`},S=[{dims:a,dataType:e[0].dataType}];return i>1&&S.push({dims:f,dataType:1}),i>2&&S.push({dims:f,dataType:1}),i>3&&S.push({dims:o,dataType:e[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${x};${v};${b};${w}`,inputDependencies:e.map((T,$)=>"type")},getShaderSource:I,getRunData:()=>({outputs:S,dispatchGroup:{x:Math.ceil(u/c)},programUniforms:y})}},HU=(e,t)=>{d4(e.inputs);let i=[0];e.outputCount>1&&i.push(-3),e.outputCount>2&&i.push(-3),e.outputCount>3&&i.push(3),e.compute(f4(e.inputs,t,e.outputCount,!1),{outputs:i})}}),h4,Ff,p4,hE,m4,g4,WU,qU,Iee=ce(()=>{"use strict";ze(),He(),sn(),Ye(),h4=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");if(t.axes.length!==0){if(t.axes.length!==t.starts.length||t.axes.length!==t.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(t.starts.length!==t.ends.length)throw new Error("starts and ends must have the same length");e.slice(1).forEach((i,n)=>{if(e[n+1].dataType!==6&&e[n+1].dataType!==7)throw new Error(`Input ${n} must be an array of int32 or int64`)})},Ff=(e,t)=>{let i=[];if(e.length>t)if(e[t].dataType===7)e[t].getBigInt64Array().forEach(n=>i.push(Number(n)));else if(e[t].dataType===6)e[t].getInt32Array().forEach(n=>i.push(Number(n)));else throw new Error(`Input ${t} must be an array of int32 or int64`);return i},p4=(e,t)=>{if(e.length>1){let i=Ff(e,1),n=Ff(e,2),r=Ff(e,3);return r.length===0&&(r=[...Array(e[0].dims.length).keys()]),kt({starts:i,ends:n,axes:r})}else return t},hE=(e,t,i,n,r)=>{let o=e;return e<0&&(o+=i[n[t]]),r[t]<0?Math.max(0,Math.min(o,i[n[t]]-1)):Math.max(0,Math.min(o,i[n[t]]))},m4=(e,t,i)=>`fn calculateInputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
          var input_indices: ${e.type.indices};
          var carry = 0u;
          for (var i = ${i.length}; i >= 0; i--) {
            let input_shape_i = ${De("uniforms.input_shape","i",i.length)};
            let steps_i = ${De("uniforms.steps","i",i.length)};
            let signs_i = ${De("uniforms.signs","i",i.length)};
            let starts_i = ${De("uniforms.starts","i",i.length)};
            var output_index = ${t.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${e.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,g4=(e,t)=>{let i=e[0].dims,n=Q.size(i),r=t.axes.length>0?Q.normalizeAxes(t.axes,i.length):[...Array(i.length).keys()],o=Ff(e,4);o.forEach(x=>x!==0||(()=>{throw new Error("step cannot be 0")})),o.length===0&&(o=Array(r.length).fill(1));let s=t.starts.map((x,y)=>hE(x,y,i,r,o)),a=t.ends.map((x,y)=>hE(x,y,i,r,o));if(r.length!==s.length||r.length!==a.length)throw new Error("start, ends and axes should have the same number of elements");if(r.length!==i.length)for(let x=0;x<i.length;++x)r.includes(x)||(s.splice(x,0,0),a.splice(x,0,i[x]),o.splice(x,0,1));let u=o.map(x=>Math.sign(x));o.forEach((x,y,I)=>{if(x<0){let S=(a[y]-s[y])/x,T=s[y],$=T+S*o[y];s[y]=$,a[y]=T,I[y]=-x}});let c=i.slice(0);r.forEach((x,y)=>{c[x]=Math.ceil((a[x]-s[x])/o[x])});let f={dims:c,dataType:e[0].dataType},p=Ie("output",e[0].dataType,c.length),m=te("input",e[0].dataType,e[0].dims.length),v=Q.size(c),b=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:s.length},{name:"signs",type:"i32",length:u.length},{name:"steps",type:"u32",length:o.length}],w=[{type:12,data:v},{type:12,data:s},{type:6,data:u},{type:12,data:o},...$e(e[0].dims,c)],C=x=>`
      ${x.registerUniforms(b).declareVariables(m,p)}
        ${m4(m,p,i)}
        ${x.mainStart()}
          ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${p.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${p.setByOffset("global_idx",m.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${u.length}_${s.length}_${o.length}`,inputDependencies:["rank"]},getShaderSource:C,getRunData:()=>({outputs:[f],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:w})}},WU=(e,t)=>{h4(e.inputs,t);let i=p4(e.inputs,t);e.compute(g4(e.inputs,i),{inputs:[0]})},qU=e=>{let t=e.starts,i=e.ends,n=e.axes;return kt({starts:t,ends:i,axes:n})}}),_4,v4,GU,KU,See=ce(()=>{"use strict";ze(),He(),sn(),ls(),Ye(),_4=e=>{if(!e||e.length!==1)throw new Error("Softmax op requires 1 input.")},v4=(e,t)=>{let i=e.inputs[0],n=i.dims,r=Q.size(n),o=n.length,s=Q.normalizeAxis(t.axis,o),a=s<n.length-1,u,c=[];a?(c=Array.from({length:o},(k,P)=>P),c[s]=o-1,c[o-1]=s,u=e.compute(Mi(i,c),{inputs:[i],outputs:[-1]})[0]):u=i;let f=u.dims,p=f[o-1],m=r/p,v=tn(p),b=p/v,w=64;m===1&&(w=256);let C=(k,P)=>P===4?`max(max(${k}.x, ${k}.y), max(${k}.z, ${k}.w))`:P===2?`max(${k}.x, ${k}.y)`:P===3?`max(max(${k}.x, ${k}.y), ${k}.z)`:k,x=te("x",u.dataType,u.dims,v),y=Ie("result",u.dataType,u.dims,v),I=x.type.value,S=Dn(u.dataType)==="f32"?`var threadMax = ${I}(-3.402823e+38f);`:`var threadMax = ${I}(-65504.0h);`,T=k=>`
      var<workgroup> rowMaxShared : ${I};
      var<workgroup> rowSumShared : ${I};
      var<workgroup> threadShared : array<${I}, ${w}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${I} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${I}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${k.registerUniform("packedCols","i32").declareVariables(x,y)}
      ${k.mainStart(w)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${w};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${S}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${I}(${C("threadShared[0]",v)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${I}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${I}(${as("threadShared[0]",v)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          setValue(row, col, row_stride, value);
        }
      }`,$=e.compute({name:"Softmax",shaderCache:{hint:`${v};${w}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:f,dataType:u.dataType}],dispatchGroup:{x:m},programUniforms:[{type:6,data:b}]}),getShaderSource:T},{inputs:[u],outputs:[a?-1:0]})[0];a&&e.compute(Mi($,c),{inputs:[$]})},GU=(e,t)=>{_4(e.inputs),v4(e,t)},KU=e=>kt({axis:e.axis})}),pE,b4,y4,w4,ZU,Dee=ce(()=>{"use strict";ze(),He(),Ye(),pE=e=>Array.from(e.getBigInt64Array(),Number),b4=e=>{if(!e||e.length!==2)throw new Error("Tile requires 2 inputs.");if(e[0].dataType!==1&&e[0].dataType!==10&&e[0].dataType!==6&&e[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(e[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(e[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(pE(e[1]).length!==e[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},y4=(e,t)=>{let i=[];for(let n=0;n<e.length;++n)i.push(e[n]*t[n]);return i},w4=(e,t)=>{let i=e[0].dims,n=t??pE(e[1]),r=y4(i,n),o=Q.size(r),s=e[0].dataType,a=te("input",s,i.length),u=Ie("output",s,r.length),c=f=>`
      const inputShape = ${a.indices(...i)};
      ${f.registerUniform("output_size","u32").declareVariables(a,u)}
      ${f.mainStart()}
      ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${u.offsetToIndices("global_idx")};
      var input_indices: ${a.type.indices};
      for (var i = 0; i < ${i.length}; i++) {
        let input_dim_i = ${a.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${u.indicesGet("output_indices","i")}  % input_dim_i;

        ${a.indicesSet("input_indices","i","input_dim_value")}
      }
      ${u.setByOffset("global_idx",a.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${n}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:[{type:12,data:o},...$e(e[0].dims,r)]}),getShaderSource:c}},ZU=e=>{b4(e.inputs),e.compute(w4(e.inputs),{inputs:[0]})}}),x4,C4,QU,Tee=ce(()=>{"use strict";ze(),He(),Ye(),x4=(e,t,i,n,r)=>{let o=Ie("output_data",r,i.length,4),s=te("a_data",t[1].dataType,t[1].dims.length,4),a=te("b_data",t[2].dataType,t[2].dims.length,4),u=te("c_data",t[0].dataType,t[0].dims.length,4),c,f=(p,m,v)=>`select(${m}, ${p}, ${v})`;if(!n)c=o.setByOffset("global_idx",f(s.getByOffset("global_idx"),a.getByOffset("global_idx"),u.getByOffset("global_idx")));else{let p=(m,v,b="")=>{let w=`a_data[index_a${v}][component_a${v}]`,C=`b_data[index_b${v}][component_b${v}]`,x=`bool(c_data[index_c${v}] & (0xffu << (component_c${v} * 8)))`;return`
            let output_indices${v} = ${o.offsetToIndices(`global_idx * 4u + ${v}u`)};
            let offset_a${v} = ${s.broadcastedIndicesToOffset(`output_indices${v}`,o)};
            let offset_b${v} = ${a.broadcastedIndicesToOffset(`output_indices${v}`,o)};
            let offset_c${v} = ${u.broadcastedIndicesToOffset(`output_indices${v}`,o)};
            let index_a${v} = offset_a${v} / 4u;
            let index_b${v} = offset_b${v} / 4u;
            let index_c${v} = offset_c${v} / 4u;
            let component_a${v} = offset_a${v} % 4u;
            let component_b${v} = offset_b${v} % 4u;
            let component_c${v} = offset_c${v} % 4u;
            ${m}[${v}] = ${b}(${f(w,C,x)});
          `};r===9?c=`
            var data = vec4<u32>(0);
            ${p("data",0,"u32")}
            ${p("data",1,"u32")}
            ${p("data",2,"u32")}
            ${p("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:c=`
            ${p("output_data[global_idx]",0)}
            ${p("output_data[global_idx]",1)}
            ${p("output_data[global_idx]",2)}
            ${p("output_data[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(u,s,a,o)}
        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${c}
      }`},C4=e=>{let t=e[1].dims,i=e[2].dims,n=e[0].dims,r=e[1].dataType,o=!(Q.areEqual(t,i)&&Q.areEqual(i,n)),s=t,a=Q.size(t);if(o){let c=Gl.calcShape(Gl.calcShape(t,i,!1),n,!1);if(!c)throw new Error("Can't perform where op on the given tensors");s=c,a=Q.size(s)}let u=Math.ceil(a/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:c=>x4(c,e,s,o,r),getRunData:()=>({outputs:[{dims:s,dataType:r}],dispatchGroup:{x:Math.ceil(a/64/4)},programUniforms:[{type:12,data:u},...$e(n,t,i,s)]})}},QU=e=>{e.compute(C4(e.inputs))}}),YU,$ee=ce(()=>{"use strict";VX(),YE(),UX(),HX(),WX(),qX(),GX(),JX(),eee(),tee(),nee(),iee(),ree(),oee(),see(),aee(),lee(),uee(),cee(),dee(),fee(),hee(),pee(),mee(),gee(),_U(),_ee(),vee(),bee(),yee(),wee(),QE(),xee(),Cee(),Eee(),Iee(),See(),yU(),Dee(),ls(),JE(),Tee(),YU=new Map([["Abs",[Wj]],["Acos",[qj]],["Acosh",[Gj]],["Add",[DV]],["ArgMax",[jj,SE]],["ArgMin",[Bj,SE]],["Asin",[Kj]],["Asinh",[Zj]],["Atan",[Qj]],["Atanh",[Yj]],["Attention",[Vj]],["AveragePool",[$U,TU]],["BatchNormalization",[Uj]],["BiasAdd",[Hj]],["BiasSplitGelu",[SV]],["Cast",[Xj,Jj]],["Ceil",[tV]],["Clip",[eV]],["Concat",[FV,zV]],["Conv",[AE,ME]],["ConvTranspose",[KV,GV]],["Cos",[nV]],["Cosh",[iV]],["CumSum",[ZV,QV]],["DepthToSpace",[YV,JV]],["DequantizeLinear",[PU,FU]],["Div",[TV]],["Einsum",[XV,eU]],["Elu",[rV,Vf]],["Equal",[$V]],["Erf",[oV]],["Exp",[sV]],["Expand",[tU]],["FastGelu",[nU]],["Floor",[aV]],["FusedConv",[AE,ME]],["Gather",[rU,iU]],["GatherElements",[cU,uU]],["GatherBlockQuantized",[aU,lU]],["GatherND",[oU,sU]],["Gelu",[lV]],["Gemm",[fU,dU]],["GlobalAveragePool",[MU,kU]],["GlobalMaxPool",[NU,OU]],["Greater",[RV]],["GreaterOrEqual",[NV]],["GridSample",[hU,pU]],["GroupQueryAttention",[wU]],["HardSigmoid",[gV,mV]],["InstanceNormalization",[xU]],["LayerNormalization",[CU]],["LeakyRelu",[uV,Vf]],["Less",[OV]],["LessOrEqual",[PV]],["Log",[EV]],["MatMul",[EU]],["MatMulNBits",[IU,SU]],["MaxPool",[AU,RU]],["Mul",[kV]],["MultiHeadAttention",[gU,mU]],["Neg",[dV]],["Not",[cV]],["Pad",[DU]],["Pow",[MV]],["QuickGelu",[IV,Vf]],["Range",[zU]],["Reciprocal",[fV]],["ReduceMin",[Nj]],["ReduceMean",[kj]],["ReduceMax",[Oj]],["ReduceSum",[Fj]],["ReduceProd",[Pj]],["ReduceL1",[Mj]],["ReduceL2",[Aj]],["ReduceLogSum",[Lj]],["ReduceLogSumExp",[Rj]],["ReduceSumSquare",[zj]],["Relu",[hV]],["Resize",[jU,VU]],["RotaryEmbedding",[UU]],["ScatterND",[BU,LU]],["Sigmoid",[pV]],["Sin",[_V]],["Sinh",[vV]],["Slice",[WU,qU]],["SkipLayerNormalization",[HU]],["Split",[vU,bU]],["Sqrt",[bV]],["Softmax",[GU,KU]],["Sub",[AV]],["Tan",[yV]],["Tanh",[wV]],["ThresholdedRelu",[CV,Vf]],["Tile",[ZU]],["Transpose",[vj,bj]],["Where",[QU]]])}),JU,kee=ce(()=>{"use strict";Cr(),xo(),Ye(),JU=class{constructor(e){this.backend=e,this.repo=new Map,this.attributesBound=!1}getArtifact(e){return this.repo.get(e)}setArtifact(e,t){this.repo.set(e,t)}run(e,t,i,n,r){jr(e.programInfo.name);let o=this.backend.device,s=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let a=[];for(let c of t)a.push({binding:a.length,resource:{buffer:c.buffer}});for(let c of i)a.push({binding:a.length,resource:{buffer:c.buffer}});r&&a.push({binding:a.length,resource:r});let u=o.createBindGroup({layout:e.computePipeline.getBindGroupLayout(0),entries:a,label:e.programInfo.name});if(this.backend.sessionStatus==="capturing"){let c={kernelId:this.backend.currentKernelId,computePipeline:e.computePipeline,bindGroup:u,dispatchGroup:n};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(c)}s.setPipeline(e.computePipeline),s.setBindGroup(0,u),s.dispatchWorkgroups(...n),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),xr(e.programInfo.name)}dispose(){}build(e,t){jr(e.name);let i=this.backend.device,n=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"},{feature:"subgroups-f16",extension:"subgroups_f16"}].forEach(c=>{i.features.has(c.feature)&&n.push(`enable ${c.extension};`)});let r=_j(t,this.backend.device.limits),o=e.getShaderSource(r),s=`${n.join(`
`)}
${r.additionalImplementations}
${o}`,a=i.createShaderModule({code:s,label:e.name});mt("verbose",()=>`[WebGPU] ${e.name} shader code: ${s}`);let u=i.createComputePipeline({compute:{module:a,entryPoint:"main"},layout:"auto",label:e.name});return xr(e.name),{programInfo:e,computePipeline:u,uniformVariablesInfo:r.variablesInfo}}normalizeDispatchGroupSize(e){let t=typeof e=="number"?e:e.x,i=typeof e=="number"?1:e.y||1,n=typeof e=="number"?1:e.z||1,r=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(t<=r&&i<=r&&n<=r)return[t,i,n];let o=t*i*n,s=Math.ceil(Math.sqrt(o));if(s>r){if(s=Math.ceil(Math.cbrt(o)),s>r)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[s,s,s]}else return[s,s,1]}}}),E4,I4,S4,D4,XU,Mee=ce(()=>{"use strict";Cr(),ze(),xo(),dj(),BX(),$ee(),kee(),E4=(e,t)=>{if(t.length!==e.length)throw new Error(`inputDependencies length ${t.length} is not equal to inputTensors length ${e.length}.`);let i=[];for(let n=0;n<e.length;++n){let r=e[n].dataType;switch(t[n]){case"none":{i.push("");break}case"type":{i.push(`${r}`);break}case"rank":{let o=e[n].dims.length;i.push(`${r};${o}`);break}case"dims":{let o=e[n].dims.join(",");i.push(`${r};${o}`);break}default:throw new Error(`unsupported input dependency: ${t[n]}`)}}return i.join("|")},I4=(e,t,i)=>{let n=e.name;return e.shaderCache?.hint&&(n+="["+e.shaderCache.hint+"]"),n+=":"+i+`:${E4(t,e.shaderCache?.inputDependencies??new Array(t.length).fill("dims"))}`,n},S4=class{constructor(e){e&&(this.architecture=e.architecture,this.vendor=e.vendor)}isArchitecture(e){return this.architecture===e}isVendor(e){return this.vendor===e}},D4=class{constructor(e){this.subgroupsSupported=e.features.has("subgroups"),this.subgroupsF16Supported=e.features.has("subgroups");let t=e.limits;!this.subgroupsSupported||!t.minSubgroupSize||!t.maxSubgroupSize?this.subgroupSizeRange=void 0:this.subgroupSizeRange=[t.minSubgroupSize,t.maxSubgroupSize]}},XU=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let e=this.kernelCustomData.get(this.currentKernelId);return e||(e={},this.kernelCustomData.set(this.currentKernelId,e)),e}initialize(e,t){return J(this,null,function*(){this.env=e;let i=[],n={requiredLimits:{maxComputeWorkgroupStorageSize:t.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:t.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:t.limits.maxStorageBufferBindingSize,maxBufferSize:t.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:t.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:t.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:t.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:t.limits.maxComputeWorkgroupSizeZ},requiredFeatures:i},r=o=>t.features.has(o)&&i.push(o)&&!0;r("chromium-experimental-timestamp-query-inside-passes")||r("timestamp-query"),r("shader-f16"),r("subgroups")&&r("subgroups-f16"),this.device=yield t.requestDevice(n),this.deviceInfo=new D4(this.device),this.adapterInfo=new S4(t.info||(yield t.requestAdapterInfo())),this.gpuDataManager=fj(this),this.programManager=new JU(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,qE(e.logLevel,!!e.debug),this.device.onuncapturederror=o=>{o.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${o.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:t,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()})}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let e=this.getCommandEncoder(),t={};this.queryType==="at-passes"&&(t.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=e.beginComputePass(t)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;jr(),this.endComputePass();let e;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),e=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(e,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&e.mapAsync(GPUMapMode.READ).then(()=>{let t=new BigUint64Array(e.getMappedRange()),i=this.pendingQueries.get(e);for(let n=0;n<t.length/2;n++){let r=i[n],o=r.kernelId,s=this.kernels.get(o),a=s.kernelType,u=s.kernelName,c=r.programName,f=r.inputTensorViews,p=r.outputTensorViews,m=t[n*2],v=t[n*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=m);let b=Number(m-this.queryTimeBase),w=Number(v-this.queryTimeBase);if(!Number.isSafeInteger(b)||!Number.isSafeInteger(w))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:f.map(C=>({dims:C.dims,dataType:Sa(C.dataType)})),outputsMetadata:p.map(C=>({dims:C.dims,dataType:Sa(C.dataType)})),kernelId:o,kernelType:a,kernelName:u,programName:c,startTime:b,endTime:w});else{let C="";f.forEach((y,I)=>{C+=`input[${I}]: [${y.dims}] | ${Sa(y.dataType)}, `});let x="";p.forEach((y,I)=>{x+=`output[${I}]: [${y.dims}] | ${Sa(y.dataType)}, `}),console.log(`[profiling] kernel "${o}|${a}|${u}|${c}" ${C}${x}execution time: ${w-b} ns`)}Jg("GPU",`${c}::${m}::${v}`)}e.unmap(),this.pendingQueries.delete(e)}),xr()}run(e,t,i,n,r,o){jr(e.name);let s=[];for(let y=0;y<t.length;++y){let I=t[y].data;if(I===0)continue;let S=this.gpuDataManager.get(I);if(!S)throw new Error(`no GPU data for input: ${I}`);s.push(S)}let{outputs:a,dispatchGroup:u,programUniforms:c}=e.getRunData(t),f=i.length===0?a.map((y,I)=>I):i;if(f.length!==a.length)throw new Error(`Output size ${f.length} must be equal to ${a.length}.`);let p=[],m=[];for(let y=0;y<a.length;++y){if(!Number.isInteger(f[y])||f[y]<-3||f[y]>=o)throw new Error(`Invalid output index: ${f[y]}`);if(f[y]===-3)continue;let I=f[y]===-1,S=f[y]===-2,T=I||S?r(a[y].dataType,a[y].dims):n(f[y],a[y].dataType,a[y].dims);if(p.push(T),T.data===0)continue;let $=this.gpuDataManager.get(T.data);if(!$)throw new Error(`no GPU data for output: ${T.data}`);if(I&&this.temporaryData.push($),S){let k=this.kernelPersistentData.get(this.currentKernelId);k||(k=[],this.kernelPersistentData.set(this.currentKernelId,k)),k.push($)}m.push($)}if(s.length!==t.length||m.length!==p.length){if(m.length===0)return xr(e.name),p;throw new Error(`Program ${e.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let v;if(c){let y=0,I=[];c.forEach(k=>{let P=typeof k.data=="number"?[k.data]:k.data;if(P.length===0)return;let j=k.type===10?2:4,H,re;k.type===10?(re=P.length>4?16:P.length>2?8:P.length*j,H=P.length>4?16:j*P.length):(re=P.length<=2?P.length*j:16,H=16),y=Math.ceil(y/re)*re,I.push(y);let ae=k.type===10?8:4;y+=P.length>4?Math.ceil(P.length/ae)*H:P.length*j});let S=16;y=Math.ceil(y/S)*S;let T=new ArrayBuffer(y);c.forEach((k,P)=>{let j=I[P],H=typeof k.data=="number"?[k.data]:k.data;if(k.type===6)new Int32Array(T,j,H.length).set(H);else if(k.type===12)new Uint32Array(T,j,H.length).set(H);else if(k.type===10)new Uint16Array(T,j,H.length).set(H);else if(k.type===1)new Float32Array(T,j,H.length).set(H);else throw new Error(`Unsupported uniform type: ${Sa(k.type)}`)});let $=this.gpuDataManager.create(y,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer($.buffer,0,T,0,y),this.gpuDataManager.release($.id),v={offset:0,size:y,buffer:$.buffer}}let b=this.programManager.normalizeDispatchGroupSize(u),w=b[1]===1&&b[2]===1,C=I4(e,t,w),x=this.programManager.getArtifact(C);if(x||(x=this.programManager.build(e,b),this.programManager.setArtifact(C,x),mt("info",()=>`[artifact] key: ${C}, programName: ${e.name}`)),c&&x.uniformVariablesInfo){if(c.length!==x.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${x.uniformVariablesInfo.length}, got ${c.length} in program "${x.programInfo.name}".`);for(let y=0;y<c.length;y++){let I=c[y],S=I.type,T=typeof I.data=="number"?1:I.data.length,[$,k]=x.uniformVariablesInfo[y];if(S!==$||T!==k)throw new Error(`Uniform variable ${y} mismatch: expect type ${$} with size ${k}, got type ${S} with size ${T} in program "${x.programInfo.name}".`)}}if(mt("info",()=>`[ProgramManager] run "${e.name}" (key=${C}) with ${b[0]}x${b[1]}x${b[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let y={kernelId:this.currentKernelId,programName:x.programInfo.name,inputTensorViews:t,outputTensorViews:p};this.pendingKernels.push(y),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(y)}return this.programManager.run(x,s,m,b,v),xr(e.name),p}upload(e,t){this.gpuDataManager.upload(e,t)}memcpy(e,t){this.gpuDataManager.memcpy(e,t)}download(e,t){return J(this,null,function*(){yield this.gpuDataManager.download(e,t)})}alloc(e){return this.gpuDataManager.create(e).id}free(e){return this.gpuDataManager.release(e)}createKernel(e,t,i,n){let r=YU.get(e);if(!r)throw new Error(`kernel not implemented: ${e}`);let o={kernelType:e,kernelName:n,kernelEntry:r[0],attributes:[r[1],i]};this.kernels.set(t,o)}releaseKernel(e){let t=this.kernelPersistentData.get(e);if(t){for(let i of t)this.gpuDataManager.release(i.id);this.kernelPersistentData.delete(e)}this.kernelCustomData.delete(e),this.kernels.delete(e)}computeKernel(e,t,i){let n=this.kernels.get(e);if(!n)throw new Error(`kernel not created: ${e}`);let r=n.kernelType,o=n.kernelName,s=n.kernelEntry,a=n.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${r}] ${o}" is not allowed to be called recursively`);this.currentKernelId=e,a[0]&&(a[1]=a[0](a[1]),a[0]=void 0),mt("info",()=>`[WebGPU] Start to run kernel "[${r}] ${o}"...`);let u=this.env.debug;this.temporaryData=[];try{return u&&this.device.pushErrorScope("validation"),s(t,a[1]),0}catch(c){return i.push(Promise.resolve(`[WebGPU] Kernel "[${r}] ${o}" failed. ${c}`)),1}finally{u&&i.push(this.device.popErrorScope().then(c=>c?`GPU validation error for kernel "[${r}] ${o}": ${c.message}`:null));for(let c of this.temporaryData)this.gpuDataManager.release(c.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(e,t,i,n){let r=this.sessionExternalDataMapping.get(e);r||(r=new Map,this.sessionExternalDataMapping.set(e,r));let o=r.get(t),s=this.gpuDataManager.registerExternalBuffer(i,n,o);return r.set(t,[s,i]),s}unregisterBuffers(e){let t=this.sessionExternalDataMapping.get(e);t&&(t.forEach(i=>this.gpuDataManager.unregisterExternalBuffer(i[0])),this.sessionExternalDataMapping.delete(e))}getBuffer(e){let t=this.gpuDataManager.get(e);if(!t)throw new Error(`no GPU data for buffer: ${e}`);return t.buffer}createDownloader(e,t,i){return()=>J(this,null,function*(){let n=yield CE(this,e,t);return GE(n.buffer,i)})}writeTimestamp(e){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,e)}setQueryType(){this.queryType="none",(this.env.webgpu.profiling?.mode==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){mt("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){mt("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){mt("info","replay"),this.sessionStatus="replaying";let e=this.capturedCommandList.get(this.currentSessionId),t=this.capturedPendingKernels.get(this.currentSessionId),i=e.length;this.pendingKernels=[];for(let n=0;n<i;n++){let r=this.getComputePassEncoder(),o=e[n];this.writeTimestamp(this.pendingDispatchNumber*2),r.setPipeline(o.computePipeline),r.setBindGroup(0,o.bindGroup),r.dispatchWorkgroups(...o.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(t[n]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(e){this.unregisterBuffers(e),this.capturedCommandList.has(e)&&this.capturedCommandList.delete(e),this.capturedPendingKernels.has(e)&&this.capturedPendingKernels.delete(e),this.gpuDataManager.onReleaseSession(e)}onRunStart(e){this.currentSessionId=e,this.setQueryType()}}}),T4,mE,$4,gE,_E,vE,k4,eH,Aee=ce(()=>{"use strict";xo(),T4=1,mE=()=>T4++,$4=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),gE=(e,t)=>{let i=$4.get(e);if(!i)throw new Error("Unsupported data type.");return t.length>0?Math.ceil(t.reduce((n,r)=>n*r)*i/8):0},_E=class{constructor(e){this.sessionId=e.sessionId,this.mlContext=e.context,this.mlTensor=e.tensor,this.dataType=e.dataType,this.tensorShape=e.shape}get tensor(){return this.mlTensor}get type(){return this.dataType}get shape(){return this.tensorShape}get byteLength(){return gE(this.dataType,this.tensorShape)}destroy(){mt("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}read(e){return J(this,null,function*(){return e?this.mlContext.readTensor(this.mlTensor,e):this.mlContext.readTensor(this.mlTensor)})}canReuseTensor(e,t,i){return this.mlContext===e&&this.dataType===t&&this.tensorShape.length===i.length&&this.tensorShape.every((n,r)=>n===i[r])}},vE=class{constructor(e,t){this.tensorManager=e,this.wrapper=t}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}ensureTensor(e,t,i,n){return J(this,null,function*(){let r=this.tensorManager.getMLContext(e);if(this.wrapper){if(this.wrapper.canReuseTensor(r,t,i))return this.wrapper.tensor;if(n){if(this.wrapper.byteLength!==gE(t,i))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(yield this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let o=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=yield this.tensorManager.getCachedTensor(e,t,i,o,!0,!0),n&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor})}upload(e){if(this.wrapper)if(e.byteLength===this.wrapper.byteLength){this.wrapper.write(e);return}else mt("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor();this.activeUpload?this.activeUpload.set(e):this.activeUpload=new Uint8Array(e)}download(e){return J(this,null,function*(){if(this.activeUpload)if(e){e instanceof ArrayBuffer?new Uint8Array(e).set(this.activeUpload):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(this.activeUpload);return}else return this.activeUpload.buffer;if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read(e):this.wrapper.read()})}},k4=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let t=this.backend.getMLContext(e);if(!t)throw new Error("MLContext not found for session.");return t}reserveTensorId(){let e=mE();return this.tensorTrackersById.set(e,new vE(this)),e}releaseTensorId(e){let t=this.tensorTrackersById.get(e);t&&(this.tensorTrackersById.delete(e),t.tensorWrapper&&this.releaseTensor(t.tensorWrapper))}ensureTensor(e,t,i,n,r){return J(this,null,function*(){mt("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${t}, dataType: ${i}, shape: ${n}, copyOld: ${r}}`);let o=this.tensorTrackersById.get(t);if(!o)throw new Error("Tensor not found.");return o.ensureTensor(e,i,n,r)})}upload(e,t){let i=this.tensorTrackersById.get(e);if(!i)throw new Error("Tensor not found.");i.upload(t)}download(e,t){return J(this,null,function*(){mt("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${e}, dstBuffer: ${t?.byteLength}}`);let i=this.tensorTrackersById.get(e);if(!i)throw new Error("Tensor not found.");return i.download(t)})}releaseTensorsForSession(e){for(let t of this.freeTensors)t.sessionId===e&&t.destroy();this.freeTensors=this.freeTensors.filter(t=>t.sessionId!==e)}registerTensor(e,t,i,n){let r=this.getMLContext(e),o=mE(),s=new _E({sessionId:e,context:r,tensor:t,dataType:i,shape:n});return this.tensorTrackersById.set(o,new vE(this,s)),this.externalTensors.add(s),o}getCachedTensor(e,t,i,n,r,o){return J(this,null,function*(){let s=this.getMLContext(e);for(let[u,c]of this.freeTensors.entries())if(c.canReuseTensor(s,t,i)){mt("verbose",()=>`[WebNN] Reusing tensor {dataType: ${t}, shape: ${i}}`);let f=this.freeTensors.splice(u,1)[0];return f.sessionId=e,f}mt("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${t}, shape: ${i}}`);let a=yield s.createTensor({dataType:t,shape:i,dimensions:i,usage:n,writable:r,readable:o});return new _E({sessionId:e,context:s,tensor:a,dataType:t,shape:i})})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},eH=(...e)=>new k4(...e)}),Wg,M4,tH,Ree=ce(()=>{"use strict";ze(),Ma(),dj(),Aee(),xo(),Wg=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),M4=(e,t)=>{if(e===t)return!0;if(e===void 0||t===void 0)return!1;let i=Object.keys(e).sort(),n=Object.keys(t).sort();return i.length===n.length&&i.every((r,o)=>r===n[o]&&e[r]===t[r])},tH=class{constructor(e){this.tensorManager=eH(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.temporaryGraphInputs=[],this.temporarySessionTensorIds=new Map,qE(e.logLevel,!!e.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(e){mt("verbose",()=>`[WebNN] onRunStart {sessionId: ${e}}`),this.activeSessionId=e}onRunEnd(e){mt("verbose",()=>`[WebNN] onRunEnd {sessionId: ${e}}`);let t=this.temporarySessionTensorIds.get(e);if(t){for(let i of t)mt("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${i}}`),this.tensorManager.releaseTensorId(i);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}createMLContext(e){return J(this,null,function*(){if(e instanceof GPUDevice){let i=this.mlContextCache.findIndex(n=>n.gpuDevice===e);if(i!==-1)return this.mlContextCache[i].mlContext;{let n=yield navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:n}),n}}else if(e===void 0){let i=this.mlContextCache.findIndex(n=>n.options===void 0&&n.gpuDevice===void 0);if(i!==-1)return this.mlContextCache[i].mlContext;{let n=yield navigator.ml.createContext();return this.mlContextCache.push({mlContext:n}),n}}let t=this.mlContextCache.findIndex(i=>M4(i.options,e));if(t!==-1)return this.mlContextCache[t].mlContext;{let i=yield navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:i}),i}})}registerMLContext(e,t){this.mlContextBySessionId.set(e,t);let i=this.sessionIdsByMLContext.get(t);i||(i=new Set,this.sessionIdsByMLContext.set(t,i)),i.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e);let t=this.mlContextBySessionId.get(e);if(!t)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let i=this.sessionIdsByMLContext.get(t);if(i.delete(e),i.size===0){this.sessionIdsByMLContext.delete(t);let n=this.mlContextCache.findIndex(r=>r.mlContext===t);n!==-1&&this.mlContextCache.splice(n,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){mt("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e)}ensureTensor(e,t,i,n,r){return J(this,null,function*(){let o=Wg.get(i);if(!o)throw new Error(`Unsupported ONNX data type: ${i}`);return this.tensorManager.ensureTensor(e??this.currentSessionId,t,o,n,r)})}createTemporaryTensor(e,t,i){return J(this,null,function*(){mt("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${t}, shape: ${i}}`);let n=Wg.get(t);if(!n)throw new Error(`Unsupported ONNX data type: ${t}`);let r=this.tensorManager.reserveTensorId();yield this.tensorManager.ensureTensor(e,r,n,i,!1);let o=this.temporarySessionTensorIds.get(e);return o?o.push(r):this.temporarySessionTensorIds.set(e,[r]),r})}uploadTensor(e,t){if(!Sn().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");mt("verbose",()=>`[WebNN] uploadTensor {tensorId: ${e}, data: ${t.byteLength}}`),this.tensorManager.upload(e,t)}downloadTensor(e,t){return J(this,null,function*(){return this.tensorManager.download(e,t)})}createMLTensorDownloader(e,t){return()=>J(this,null,function*(){let i=yield this.tensorManager.download(e);return GE(i,t)})}registerMLTensor(e,t,i,n){let r=Wg.get(i);if(!r)throw new Error(`Unsupported ONNX data type: ${i}`);let o=this.tensorManager.registerTensor(e,t,r,n);return mt("verbose",()=>`[WebNN] registerMLTensor {tensor: ${t}, dataType: ${r}, dimensions: ${n}} -> {tensorId: ${o}}`),o}registerMLConstant(e,t,i,n,r,o){if(!o)throw new Error("External mounted files are not available.");let s=e;e.startsWith("./")&&(s=e.substring(2));let a=o.get(s);if(!a)throw new Error(`File with name ${s} not found in preloaded files.`);if(t+i>a.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let u=a.slice(t,t+i).buffer,c;switch(r.dataType){case"float32":c=new Float32Array(u);break;case"float16":c=new Uint16Array(u);break;case"int32":c=new Int32Array(u);break;case"uint32":c=new Uint32Array(u);break;case"int64":c=new BigInt64Array(u);break;case"uint64":c=new BigUint64Array(u);break;case"int8":c=new Int8Array(u);break;case"int4":case"uint4":case"uint8":c=new Uint8Array(u);break;default:throw new Error(`Unsupported data type: ${r.dataType} in creating WebNN Constant from external data.`)}return mt("verbose",()=>`[WebNN] registerMLConstant {dataType: ${r.dataType}, shape: ${r.shape}}}`),n.constant(r,c)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}isGraphInput(e,t){let i=this.sessionGraphInputs.get(e);return i?i.includes(t):!1}flush(){}}}),nH={};qf(nH,{init:()=>iH});var qg,A4,iH,Oee=ce(()=>{"use strict";ze(),Mee(),xo(),He(),Ree(),qg=class rH{constructor(t,i,n,r){this.module=t,this.dataType=i,this.data=n,this.dims=r}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let t=Q.size(this.dims);return t===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,t)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let t=Q.size(this.dims);return t===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,t)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let t=Q.size(this.dims);return t===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,t)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let t=Q.size(this.dims);return t===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,t)}reshape(t){if(Q.size(t)!==Q.size(this.dims))throw new Error("Invalid new shape");return new rH(this.module,this.dataType,this.data,t)}},A4=class{constructor(e,t,i){this.module=e,this.backend=t,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=t.adapterInfo,this.deviceInfo=t.deviceInfo;let n=e.PTR_SIZE,r=i/e.PTR_SIZE,o=n===4?"i32":"i64";this.opKernelContext=Number(e.getValue(n*r++,o));let s=Number(e.getValue(n*r++,o));this.outputCount=Number(e.getValue(n*r++,o)),this.customDataOffset=Number(e.getValue(n*r++,"*")),this.customDataSize=Number(e.getValue(n*r++,o));let a=[];for(let u=0;u<s;u++){let c=Number(e.getValue(n*r++,o)),f=Number(e.getValue(n*r++,"*")),p=Number(e.getValue(n*r++,o)),m=[];for(let v=0;v<p;v++)m.push(Number(e.getValue(n*r++,o)));a.push(new qg(e,c,f,m))}this.inputs=a}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(e,t){let i=t?.inputs?.map(s=>typeof s=="number"?this.inputs[s]:s)??this.inputs,n=t?.outputs??[],r=(s,a,u)=>new qg(this.module,a,this.output(s,u),u),o=(s,a)=>{let u=Da(s,a);if(!u)throw new Error(`Unsupported data type: ${s}`);let c=u>0?this.backend.gpuDataManager.create(u).id:0;return new qg(this.module,s,c,a)};return this.backend.run(e,i,n,r,o,this.outputCount)}output(e,t){let i=this.module.stackSave();try{let n=this.module.PTR_SIZE,r=n===4?"i32":"i64",o=this.module.stackAlloc((1+t.length)*n);this.module.setValue(o,t.length,r);for(let s=0;s<t.length;s++)this.module.setValue(o+n*(s+1),t[s],r);return this.module._JsepOutput(this.opKernelContext,e,o)}catch(n){throw new Error(`Failed to generate kernel's output[${e}] with dims [${t}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${n}`)}finally{this.module.stackRestore(i)}}},iH=(e,t,i,n)=>J(void 0,null,function*(){let r=t.jsepInit;if(!r)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(e==="webgpu"){let o=new XU;yield o.initialize(i,n),r("webgpu",[o,s=>o.alloc(Number(s)),s=>o.free(s),(s,a,u,c=!1)=>{if(c)mt("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(s)}, dst=${Number(a)}, size=${Number(u)}`),o.memcpy(Number(s),Number(a));else{mt("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(s)}, gpuDataId=${Number(a)}, size=${Number(u)}`);let f=t.HEAPU8.subarray(Number(s>>>0),Number(s>>>0)+Number(u));o.upload(Number(a),f)}},(s,a,u)=>J(void 0,null,function*(){mt("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${s}, dataOffset=${a}, size=${u}`),yield o.download(Number(s),()=>t.HEAPU8.subarray(Number(a)>>>0,Number(a+u)>>>0))}),(s,a,u)=>o.createKernel(s,Number(a),u,t.UTF8ToString(t._JsepGetNodeName(Number(a)))),s=>o.releaseKernel(s),(s,a,u,c)=>{mt("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${u}, kernel=${s}, contextDataOffset=${a}`);let f=new A4(t,o,Number(a));return o.computeKernel(Number(s),f,c)},()=>o.captureBegin(),()=>o.captureEnd(),()=>o.replay()])}else{let o=new tH(i);r("webnn",[o,()=>o.reserveTensorId(),s=>o.releaseTensorId(s),(s,a,u,c,f)=>J(void 0,null,function*(){return o.ensureTensor(s,a,u,c,f)}),(s,a)=>{o.uploadTensor(s,a)},(s,a)=>J(void 0,null,function*(){return o.downloadTensor(s,a)})])}})}),R4,rI,oI,os,O4,r_,sI,aI,bE,lI,uI,cI,oH=ce(()=>{"use strict";zX(),LX(),ze(),Ma(),jE(),cj(),R4=(e,t)=>{Sn()._OrtInit(e,t)!==0&&St("Can't initialize onnxruntime.")},rI=e=>J(void 0,null,function*(){R4(e.wasm.numThreads,e_(e.logLevel))}),oI=(e,t)=>J(void 0,null,function*(){{let i=(Oee(),Yg(nH)).init;if(t==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let n=e.webgpu.adapter;if(n){if(typeof n.limits!="object"||typeof n.features!="object"||typeof n.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let r=e.webgpu.powerPreference;if(r!==void 0&&r!=="low-power"&&r!=="high-performance")throw new Error(`Invalid powerPreference setting: "${r}"`);let o=e.webgpu.forceFallbackAdapter;if(o!==void 0&&typeof o!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${o}"`);if(n=yield navigator.gpu.requestAdapter({powerPreference:r,forceFallbackAdapter:o}),!n)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}yield i("webgpu",Sn(),e,n)}if(t==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");yield i("webnn",Sn(),e)}}}),os=new Map,O4=e=>{let t=Sn(),i=t.stackSave();try{let n=t.PTR_SIZE,r=t.stackAlloc(2*n);t._OrtGetInputOutputCount(e,r,r+n)!==0&&St("Can't get session input/output count.");let o=n===4?"i32":"i64";return[Number(t.getValue(r,o)),Number(t.getValue(r+n,o))]}finally{t.stackRestore(i)}},r_=e=>{let t=Sn(),i=t._malloc(e.byteLength);if(i===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,i),[i,e.byteLength]},sI=(e,t)=>J(void 0,null,function*(){let i,n,r=Sn();Array.isArray(e)?[i,n]=e:e.buffer===r.HEAPU8.buffer?[i,n]=[e.byteOffset,e.byteLength]:[i,n]=r_(e);let o=0,s=0,a=0,u=[],c=[],f=[];try{if([s,u]=uj(t),t?.externalData&&r.mountExternalData){let y=[];for(let I of t.externalData){let S=typeof I=="string"?I:I.path;y.push(WE(typeof I=="string"?I:I.data).then(T=>{r.mountExternalData(S,T)}))}yield Promise.all(y)}for(let y of t?.executionProviders??[])if((typeof y=="string"?y:y.name)==="webnn"){if(r.shouldTransferToMLTensor=!1,typeof y!="string"){let I=y,S=I?.context,T=I?.gpuDevice,$=I?.deviceType,k=I?.powerPreference;S?r.currentContext=S:T?r.currentContext=yield r.jsepCreateMLContext(T):r.currentContext=yield r.jsepCreateMLContext({deviceType:$,powerPreference:k})}else r.currentContext=yield r.jsepCreateMLContext();break}o=yield r._OrtCreateSession(i,n,s),o===0&&St("Can't create a session."),r.jsepOnCreateSession?.(),r.currentContext&&(r.jsepRegisterMLContext(o,r.currentContext),r.currentContext=void 0,r.shouldTransferToMLTensor=!0);let[p,m]=O4(o),v=!!t?.enableGraphCapture,b=[],w=[],C=[];for(let y=0;y<p;y++){let I=r._OrtGetInputName(o,y);I===0&&St("Can't get an input name."),c.push(I),b.push(r.UTF8ToString(I))}for(let y=0;y<m;y++){let I=r._OrtGetOutputName(o,y);I===0&&St("Can't get an output name."),f.push(I);let S=r.UTF8ToString(I);w.push(S);{if(v&&t?.preferredOutputLocation===void 0){C.push("gpu-buffer");continue}let T=typeof t?.preferredOutputLocation=="string"?t.preferredOutputLocation:t?.preferredOutputLocation?.[S]??"cpu";if(T!=="cpu"&&T!=="cpu-pinned"&&T!=="gpu-buffer"&&T!=="ml-tensor")throw new Error(`Not supported preferred output location: ${T}.`);if(v&&T!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${T}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);C.push(T)}}let x=null;return C.some(y=>y==="gpu-buffer"||y==="ml-tensor")&&(a=r._OrtCreateBinding(o),a===0&&St("Can't create IO binding."),x={handle:a,outputPreferredLocations:C,outputPreferredLocationsEncoded:C.map(y=>xE(y))}),os.set(o,[o,c,f,x,v,!1]),[o,b,w]}catch(p){throw c.forEach(m=>r._OrtFree(m)),f.forEach(m=>r._OrtFree(m)),a!==0&&r._OrtReleaseBinding(a)!==0&&St("Can't release IO binding."),o!==0&&r._OrtReleaseSession(o)!==0&&St("Can't release session."),p}finally{r._free(i),s!==0&&r._OrtReleaseSessionOptions(s)!==0&&St("Can't release session options."),u.forEach(p=>r._free(p)),r.unmountExternalData?.()}}),aI=e=>{let t=Sn(),i=os.get(e);if(!i)throw new Error(`cannot release session. invalid session id: ${e}`);let[n,r,o,s,a]=i;s&&(a&&t._OrtClearBoundOutputs(s.handle)!==0&&St("Can't clear bound outputs."),t._OrtReleaseBinding(s.handle)!==0&&St("Can't release IO binding.")),t.jsepOnReleaseSession?.(e),r.forEach(u=>t._OrtFree(u)),o.forEach(u=>t._OrtFree(u)),t._OrtReleaseSession(n)!==0&&St("Can't release session."),os.delete(e)},bE=(e,t,i,n,r,o=!1)=>J(void 0,null,function*(){if(!e){t.push(0);return}let s=Sn(),a=s.PTR_SIZE,u=e[0],c=e[1],f=e[3],p=f,m,v;if(u==="string"&&(f==="gpu-buffer"||f==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(o&&f!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${r} when enableGraphCapture is true.`);if(f==="gpu-buffer"){let C=e[2].gpuBuffer;v=Da(Hl(u),c);let x=s.jsepRegisterBuffer;if(!x)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');m=x(n,r,C,v)}else if(f==="ml-tensor"){let C=e[2].mlTensor;v=Da(Hl(u),c);let x=s.jsepRegisterMLTensor;if(!x)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');m=x(n,C,Hl(u),c)}else{let C=e[2];if(Array.isArray(C)){v=a*C.length,m=s._malloc(v),i.push(m);for(let x=0;x<C.length;x++){if(typeof C[x]!="string")throw new TypeError(`tensor data at index ${x} is not a string`);s.setValue(m+x*a,Vn(C[x],i),"*")}}else{let x=s.jsepIsGraphInput;if(u!=="string"&&x){let y=s._OrtGetInputName(n,r),I=s.UTF8ToString(y);if(x(n,I)){let S=Hl(u);v=Da(S,c),p="ml-tensor";let T=s.jsepCreateTemporaryTensor,$=s.jsepUploadTensor;if(!T||!$)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let k=yield T(n,S,c);$(k,new Uint8Array(C.buffer,C.byteOffset,C.byteLength)),m=k}else v=C.byteLength,m=s._malloc(v),i.push(m),s.HEAPU8.set(new Uint8Array(C.buffer,C.byteOffset,v),m)}else v=C.byteLength,m=s._malloc(v),i.push(m),s.HEAPU8.set(new Uint8Array(C.buffer,C.byteOffset,v),m)}}let b=s.stackSave(),w=s.stackAlloc(4*c.length);try{c.forEach((x,y)=>s.setValue(w+y*a,x,a===4?"i32":"i64"));let C=s._OrtCreateTensor(Hl(u),m,v,w,c.length,xE(p));C===0&&St(`Can't create tensor for input/output. session=${n}, index=${r}.`),t.push(C)}finally{s.stackRestore(b)}}),lI=(e,t,i,n,r,o)=>J(void 0,null,function*(){let s=Sn(),a=s.PTR_SIZE,u=os.get(e);if(!u)throw new Error(`cannot run inference. invalid session id: ${e}`);let c=u[0],f=u[1],p=u[2],m=u[3],v=u[4],b=u[5],w=t.length,C=n.length,x=0,y=[],I=[],S=[],T=[],$=s.stackSave(),k=s.stackAlloc(w*a),P=s.stackAlloc(w*a),j=s.stackAlloc(C*a),H=s.stackAlloc(C*a);try{[x,y]=lj(o);for(let L=0;L<w;L++)yield bE(i[L],I,T,e,t[L],v);for(let L=0;L<C;L++)yield bE(r[L],S,T,e,w+n[L],v);for(let L=0;L<w;L++)s.setValue(k+L*a,I[L],"*"),s.setValue(P+L*a,f[t[L]],"*");for(let L=0;L<C;L++)s.setValue(j+L*a,S[L],"*"),s.setValue(H+L*a,p[n[L]],"*");if(m&&!b){let{handle:L,outputPreferredLocations:ge,outputPreferredLocationsEncoded:ye}=m;if(f.length!==w)throw new Error(`input count from feeds (${w}) is expected to be always equal to model's input count (${f.length}).`);for(let Y=0;Y<w;Y++){let ve=t[Y];(yield s._OrtBindInput(L,f[ve],I[Y]))!==0&&St(`Can't bind input[${Y}] for session=${e}.`)}for(let Y=0;Y<C;Y++){let ve=n[Y];r[Y]?.[3]?s._OrtBindOutput(L,p[ve],S[Y],0)!==0&&St(`Can't bind pre-allocated output[${Y}] for session=${e}.`):s._OrtBindOutput(L,p[ve],0,ye[ve])!==0&&St(`Can't bind output[${Y}] to ${ge[Y]} for session=${e}.`)}os.set(e,[c,f,p,m,v,!0])}s.jsepOnRunStart?.(c);let re;m?re=yield s._OrtRunWithBinding(c,m.handle,C,j,x):re=yield s._OrtRun(c,P,k,w,H,C,j,x),re!==0&&St("failed to call OrtRun().");let ae=[];for(let L=0;L<C;L++){let ge=Number(s.getValue(j+L*a,"*"));if(ge===S[L]){ae.push(r[L]);continue}let ye=s.stackSave(),Y=s.stackAlloc(4*a),ve=!1,we,X=0;try{s._OrtGetTensorData(ge,Y,Y+a,Y+2*a,Y+3*a)!==0&&St(`Can't access output tensor data on index ${L}.`);let xe=a===4?"i32":"i64",z=Number(s.getValue(Y,xe));X=s.getValue(Y+a,"*");let W=s.getValue(Y+a*2,"*"),R=Number(s.getValue(Y+a*3,xe)),se=[];for(let gt=0;gt<R;gt++)se.push(Number(s.getValue(W+gt*a,xe)));s._OrtFree(W)!==0&&St("Can't free memory for tensor dims.");let Ke=se.reduce((gt,Xe)=>gt*Xe,1);we=Sa(z);let zt=m?.outputPreferredLocations[n[L]];if(we==="string"){if(zt==="gpu-buffer"||zt==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let gt=[];for(let Xe=0;Xe<Ke;Xe++){let vn=s.getValue(X+Xe*a,"*"),Ot=s.getValue(X+(Xe+1)*a,"*"),Vr=Xe===Ke-1?void 0:Ot-vn;gt.push(s.UTF8ToString(vn,Vr))}ae.push([we,se,gt,"cpu"])}else if(zt==="gpu-buffer"&&Ke>0){let gt=s.jsepGetBuffer;if(!gt)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let Xe=gt(X),vn=Da(z,Ke);if(vn===void 0||!UE(we))throw new Error(`Unsupported data type: ${we}`);ve=!0,ae.push([we,se,{gpuBuffer:Xe,download:s.jsepCreateDownloader(Xe,vn,we),dispose:()=>{s._OrtReleaseTensor(ge)!==0&&St("Can't release tensor.")}},"gpu-buffer"])}else if(zt==="ml-tensor"&&Ke>0){let gt=s.jsepEnsureTensor;if(!gt)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(Da(z,Ke)===void 0||!HE(we))throw new Error(`Unsupported data type: ${we}`);let Xe=yield gt(e,X,z,se,!1);ve=!0,ae.push([we,se,{mlTensor:Xe,download:s.jsepCreateMLTensorDownloader(X,we),dispose:()=>{s.jsepReleaseTensorId(X),s._OrtReleaseTensor(ge)}},"ml-tensor"])}else{let gt=VE(we),Xe=new gt(Ke);new Uint8Array(Xe.buffer,Xe.byteOffset,Xe.byteLength).set(s.HEAPU8.subarray(X,X+Xe.byteLength)),ae.push([we,se,Xe,"cpu"])}}finally{s.stackRestore(ye),we==="string"&&X&&s._free(X),ve||s._OrtReleaseTensor(ge),s.jsepOnRunEnd?.(c)}}return m&&!v&&(s._OrtClearBoundOutputs(m.handle)!==0&&St("Can't clear bound outputs."),os.set(e,[c,f,p,m,v,!1])),ae}finally{s.stackRestore($),I.forEach(re=>s._OrtReleaseTensor(re)),S.forEach(re=>s._OrtReleaseTensor(re)),T.forEach(re=>s._free(re)),x!==0&&s._OrtReleaseRunOptions(x),y.forEach(re=>s._free(re))}}),uI=e=>{let t=Sn(),i=os.get(e);if(!i)throw new Error("invalid session id");let n=i[0],r=t._OrtEndProfiling(n);r===0&&St("Can't get an profile file name."),t._OrtFree(r)},cI=e=>{let t=[];for(let i of e){let n=i[2];!Array.isArray(n)&&"buffer"in n&&t.push(n.buffer)}return t}}),ss,Hi,Ul,zf,Lf,Gg,yE,Kg,Ca,Ea,N4,sH,aH,lH,uH,cH,dH,fH,hH=ce(()=>{"use strict";Cr(),oH(),Ma(),LE(),ss=()=>!!Jt.wasm.proxy&&typeof document<"u",Ul=!1,zf=!1,Lf=!1,Kg=new Map,Ca=(e,t)=>{let i=Kg.get(e);i?i.push(t):Kg.set(e,[t])},Ea=()=>{if(Ul||!zf||Lf||!Hi)throw new Error("worker not ready")},N4=e=>{switch(e.data.type){case"init-wasm":Ul=!1,e.data.err?(Lf=!0,yE[1](e.data.err)):(zf=!0,yE[0]()),Gg&&(URL.revokeObjectURL(Gg),Gg=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=Kg.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out);break}default:}},sH=()=>J(void 0,null,function*(){if(!zf){if(Ul)throw new Error("multiple calls to 'initWasm()' detected.");if(Lf)throw new Error("previous call to 'initWasm()' failed.");if(Ul=!0,ss())return new Promise((e,t)=>{Hi?.terminate(),sj().then(([i,n])=>{try{Hi=n,Hi.onerror=o=>t(o),Hi.onmessage=N4,yE=[e,t];let r={type:"init-wasm",in:Jt};!r.in.wasm.wasmPaths&&(i||import.meta.url?.startsWith("file:"))&&(r.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.jsep.wasm",import.meta.url).href}),Hi.postMessage(r),Gg=i}catch(r){t(r)}},t)});try{yield BE(Jt.wasm),yield rI(Jt),zf=!0}catch(e){throw Lf=!0,e}finally{Ul=!1}}}),aH=e=>J(void 0,null,function*(){if(ss())return Ea(),new Promise((t,i)=>{Ca("init-ep",[t,i]);let n={type:"init-ep",in:{epName:e,env:Jt}};Hi.postMessage(n)});yield oI(Jt,e)}),lH=e=>J(void 0,null,function*(){return ss()?(Ea(),new Promise((t,i)=>{Ca("copy-from",[t,i]);let n={type:"copy-from",in:{buffer:e}};Hi.postMessage(n,[e.buffer])})):r_(e)}),uH=(e,t)=>J(void 0,null,function*(){if(ss()){if(t?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Ea(),new Promise((i,n)=>{Ca("create",[i,n]);let r={type:"create",in:{model:e,options:ie({},t)}},o=[];e instanceof Uint8Array&&o.push(e.buffer),Hi.postMessage(r,o)})}else return sI(e,t)}),cH=e=>J(void 0,null,function*(){if(ss())return Ea(),new Promise((t,i)=>{Ca("release",[t,i]);let n={type:"release",in:e};Hi.postMessage(n)});aI(e)}),dH=(e,t,i,n,r,o)=>J(void 0,null,function*(){if(ss()){if(i.some(s=>s[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(r.some(s=>s))throw new Error("pre-allocated output tensor is not supported for proxy.");return Ea(),new Promise((s,a)=>{Ca("run",[s,a]);let u=i,c={type:"run",in:{sessionId:e,inputIndices:t,inputs:u,outputIndices:n,options:o}};Hi.postMessage(c,cI(u))})}else return lI(e,t,i,n,r,o)}),fH=e=>J(void 0,null,function*(){if(ss())return Ea(),new Promise((t,i)=>{Ca("end-profiling",[t,i]);let n={type:"end-profiling",in:e};Hi.postMessage(n)});uI(e)})}),wE,P4,pH,Nee=ce(()=>{"use strict";Cr(),hH(),ze(),zE(),cj(),wE=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${t()}`)}},P4=e=>{switch(e[3]){case"cpu":return new qi(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!UE(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:i,download:n,dispose:r}=e[2];return qi.fromGpuBuffer(i,{dataType:t,dims:e[1],download:n,dispose:r})}case"ml-tensor":{let t=e[0];if(!HE(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:i,download:n,dispose:r}=e[2];return qi.fromMLTensor(i,{dataType:t,dims:e[1],download:n,dispose:r})}default:throw new Error(`invalid data location: ${e[3]}`)}},pH=class{fetchModelAndCopyToWasmMemory(e){return J(this,null,function*(){return lH(yield WE(e))})}loadModel(e,t){return J(this,null,function*(){jr();let i;typeof e=="string"?i=yield this.fetchModelAndCopyToWasmMemory(e):i=e,[this.sessionId,this.inputNames,this.outputNames]=yield uH(i,t),xr()})}dispose(){return J(this,null,function*(){return cH(this.sessionId)})}run(e,t,i){return J(this,null,function*(){jr();let n=[],r=[];Object.entries(e).forEach(p=>{let m=p[0],v=p[1],b=this.inputNames.indexOf(m);if(b===-1)throw new Error(`invalid input '${m}'`);n.push(v),r.push(b)});let o=[],s=[];Object.entries(t).forEach(p=>{let m=p[0],v=p[1],b=this.outputNames.indexOf(m);if(b===-1)throw new Error(`invalid output '${m}'`);o.push(v),s.push(b)});let a=n.map((p,m)=>wE(p,()=>`input "${this.inputNames[r[m]]}"`)),u=o.map((p,m)=>p?wE(p,()=>`output "${this.outputNames[s[m]]}"`):null),c=yield dH(this.sessionId,r,a,s,u,i),f={};for(let p=0;p<c.length;p++)f[this.outputNames[s[p]]]=o[p]??P4(c[p]);return xr(),f})}startProfiling(){}endProfiling(){fH(this.sessionId)}}}),mH={};qf(mH,{OnnxruntimeWebAssemblyBackend:()=>NE,initializeFlags:()=>OE,wasmBackend:()=>gH});var OE,NE,gH,Pee=ce(()=>{"use strict";Cr(),hH(),Nee(),OE=()=>{if((typeof Jt.wasm.initTimeout!="number"||Jt.wasm.initTimeout<0)&&(Jt.wasm.initTimeout=0),Jt.wasm.simd===!1&&console.warn('Deprecated property "env.wasm.simd" is set to false. non-SIMD build is no longer provided, and this setting will be ignored.'),typeof Jt.wasm.proxy!="boolean"&&(Jt.wasm.proxy=!1),typeof Jt.wasm.trace!="boolean"&&(Jt.wasm.trace=!1),typeof Jt.wasm.numThreads!="number"||!Number.isInteger(Jt.wasm.numThreads)||Jt.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)Jt.wasm.numThreads=1;else{let e=typeof navigator>"u"?yX("node:os").cpus().length:navigator.hardwareConcurrency;Jt.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},NE=class{init(e){return J(this,null,function*(){OE(),yield sH(),yield aH(e)})}createInferenceSessionHandler(e,t){return J(this,null,function*(){let i=new pH;return yield i.loadModel(e,t),Promise.resolve(i)})}},gH=new NE});Cr();Cr();Cr();var Fee="1.21.0";{let e=(Pee(),Yg(mH)).wasmBackend;Wl("webgpu",e,5),Wl("webnn",e,5),Wl("cpu",e,10),Wl("wasm",e,10)}Object.defineProperty(Jt.versions,"web",{value:Fee,enumerable:!0});var _H=(()=>{class e{router;global_service;mytext_app;path_img="";input_ml;constructor(i,n){this.router=i,this.global_service=n,this.mytext_app=n.text_app()}ngOnInit(){}ngOnDestroy(){}clickPhoto0(){this.path_img="/camerafeet1/assets/images/photo0.png",this.executionML()}clickPhoto1(){this.path_img="/camerafeet1/assets/images/photo1.png",this.executionML()}clickPhoto2(){this.path_img="/camerafeet1/assets/images/photo2.png",this.executionML()}clickPhoto3(){this.path_img="/camerafeet1/assets/images/photo3.png",this.executionML()}clickPhoto4(){this.path_img="/camerafeet1/assets/images/photo4.png",this.executionML()}clickPhoto5(){this.path_img="/camerafeet1/assets/images/photo5.png",this.executionML()}clickPhoto6(){this.path_img="/camerafeet1/assets/images/photo6.png",this.executionML()}convertBlobToBase64(i){return J(this,null,function*(){return new Promise((n,r)=>{let o=new FileReader;o.onerror=r,o.onload=()=>{n(o.result)},o.readAsDataURL(i)})})}downloadImageAsBase64(){return J(this,null,function*(){let n=yield(yield fetch(this.path_img)).blob();return this.convertBlobToBase64(n)})}executionML(){return J(this,null,function*(){let i=0,n=yield this.imageToML(),r=[1,3,640,640],o=new qi("float32",n,r);this.input_ml={images:o};let a=yield this.global_service.get_ml_model().arrayBuffer(),u=yield o_.create(a,{executionProviders:["webgpu"]}),c=performance.now(),f=yield u.run(this.input_ml,["output0"]),m=performance.now()-c;console.log("duration_milliseconds = "+m);let v=Array.prototype.slice.call(f.output0.data);console.log(".............."),console.log(v),console.log("..............");let b=[];for(let H=0;H<8400;H++)b.push(v[H]);let w=[];for(let H=8400;H<16800;H++)w.push(v[H]);let C=[];for(let H=16800;H<25200;H++)C.push(v[H]);let x=[];for(let H=25200;H<33600;H++)x.push(v[H]);let y=[];for(let H=33600;H<42e3;H++)y.push(v[H]);let S=new Number(y.indexOf(Math.max(...y))).valueOf();console.log("index_optimus = "+S),i=y[S],console.log("confidence_value = "+i);let T=b[S];console.log("centerX_value = "+T);let $=w[S];console.log("centerY_value = "+$);let k=C[S];console.log("width_value = "+k);let P=x[S];console.log("height_value = "+P);let j="Gpu = "+i.toString();alert(j)})}imageToML(){return J(this,null,function*(){let i=yield this.downloadImageAsBase64();return new Promise((n,r)=>{let o=new Image;o.src=i;let s=document.createElement("canvas"),a=s.getContext("2d");if(!a)throw new Error("Could not get context");o.onerror=r,o.onload=function(){let u=[1,3,640,640];s.width=u[2],s.height=u[3],a.drawImage(o,0,0,u[2],u[3]);let c=a.getImageData(0,0,u[2],u[3]),[f,p,m]=new Array(new Array,new Array,new Array);for(let x=0;x<c.data.length;x+=4)f.push(c.data[x]),p.push(c.data[x+1]),m.push(c.data[x+2]);let v=f.concat(p).concat(m),b,w=v.length,C=new Float32Array(u[1]*u[2]*u[3]);for(b=0;b<w;b++)C[b]=v[b]/255;n(C)}})})}static \u0275fac=function(n){return new(n||e)(V(ft),V(Rt))};static \u0275cmp=Oe({type:e,selectors:[["app-screen98ml"]],decls:20,vars:1,consts:[[1,"custom-toolbar"],[1,"example-fill-remaining-space"],[1,"span-custom"],[1,"custom-div-centered"],["src","assets/images/photo1.png",1,"custom-img-foot",3,"click"]],template:function(n,r){n&1&&(N(0,"mat-toolbar",0)(1,"span"),K(2),O(),G(3,"span",1),O(),G(4,"br")(5,"br")(6,"br")(7,"br")(8,"br"),N(9,"span",2),K(10,"Pulsa sobre la imagen"),O(),N(11,"span",2),K(12,"\xA0"),O(),N(13,"span",2),K(14,"\xA0"),O(),N(15,"div",3)(16,"TABLE")(17,"tr")(18,"td")(19,"img",4),Ce("click",function(){return r.clickPhoto1()}),O()()()()()),n&2&&(U(2),fe(r.mytext_app))},dependencies:[Mt],styles:[".example-fill-remaining-space[_ngcontent-%COMP%]{flex:1 1 auto}.custom-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:400}.custom-div-centered[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#fff}.custom-img-foot[_ngcontent-%COMP%]{width:640px;height:640px}.span-custom[_ngcontent-%COMP%]{width:100%;font-weight:700;font-size:14px;text-align:center;display:block}"]})}return e})();var Lee=[{path:"screen01",component:Lx},{path:"screen01/:input",component:Lx},{path:"screen01acc",component:SM},{path:"screen01bis",component:DM},{path:"screen02",component:TM},{path:"screen03",component:MM},{path:"screen04",component:OM},{path:"screen05",component:zM},{path:"screen06",component:LM},{path:"screen07",component:BM},{path:"screen08",component:jM},{path:"screen21acc",component:VM},{path:"screen22acc",component:UM},{path:"screen31acc",component:HM},{path:"screen99ml",component:rz},{path:"screen98ml",component:_H},{path:"",redirectTo:"/screen01",pathMatch:"full"},{path:"**",component:WM}],vH=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=Ge({type:e});static \u0275inj=qe({imports:[zx.forRoot(Lee),zx]})}return e})();var bH=(()=>{class e{title="ScanFeet";static \u0275fac=function(n){return new(n||e)};static \u0275cmp=Oe({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(n,r){n&1&&G(0,"router-outlet")},dependencies:[Mx]})}return e})();var yH=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=Ge({type:e,bootstrap:[bH]});static \u0275inj=qe({providers:[VT()],imports:[YT,I$,vH,Y$,J$,X$,dk,qd,kk,Ok]})}return e})();QT().bootstrapModule(yH,{ngZoneEventCoalescing:!0}).catch(e=>console.error(e));
